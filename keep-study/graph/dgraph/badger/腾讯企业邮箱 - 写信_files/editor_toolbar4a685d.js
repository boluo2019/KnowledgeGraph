QMEditorAdapter,extend(QMEditor.CONST.LANGUAGE.zh_CN,{FUN_SEPERATE:"\u95f4\u9694\u7ebf",FUN_BOLD:"\u52a0\u7c97",FUN_ITALIC:"\u659c\u4f53",FUN_UNDERLINE:"\u4e0b\u5212\u7ebf",FUN_FONTNAME:"\u9009\u62e9\u5b57\u4f53",FUN_FONTSIZE:"\u9009\u62e9\u5b57\u4f53\u5927\u5c0f",FUN_FORECOLOR:"\u9009\u62e9\u5b57\u4f53\u989c\u8272",FUN_BACKCOLOR:"\u9009\u62e9\u80cc\u666f\u989c\u8272",FUN_ALIGNMODE:"\u9009\u62e9\u5bf9\u9f50\u65b9\u5f0f",FUN_SERIAL:"\u8bbe\u7f6e\u7f16\u53f7",FUN_INDENT:"\u8bbe\u7f6e\u7f29\u8fdb",FUN_QUOT:"\u5f15\u7528\u5185\u5bb9",FUN_CREATELINK:"\u63d2\u5165/\u79fb\u9664\u94fe\u63a5",FUN_SOURCEEDIT:"\u7f16\u8f91HTML\u6e90\u7801",FUN_PREVIEW:"\u9884\u89c8",FUN_UPLOADEML:"\u4e0a\u4f20eml\u6587\u4ef6",FUN_SPELLCHECK:"\u62fc\u5199\u68c0\u67e5",FUN_SPELLCHECKTITLE:"\u82f1\u6587\u62fc\u5199\u68c0\u67e5",FUN_SPELLCHECKING:"\u68c0\u67e5\u4e2d",FUN_FORMATMATCH:"\u683c\u5f0f\u5237",FUN_FORMATMATCH_LABEL:"\u683c\u5f0f\u5237",FUN_FULLSCREEN:"\u5168\u5c4f",FUN_FULLSCREEN_LABEL:"\u5168\u5c4f",FUN_FULLSCREEN_OUT:"\u9000\u51fa\u5168\u5c4f",FUN_FULLSCREEN_OUT_LABEL:"\u9000\u51fa\u5168\u5c4f",FS_XXSMALL:"\u5c0f",FS_XSMALL:"\u4e2d",FS_MEDIUM:"\u5927",FS_LARGE:"\u8f83\u5927",FS_XLARGE:"\u6700\u5927",AM_LEFT:"\u5de6\u5bf9\u9f50",AM_CENTER:"\u5c45\u4e2d\u5bf9\u9f50",AM_RIGHT:"\u53f3\u5bf9\u9f50",SL_NUMBER:"\u6570\u5b57\u7f16\u53f7",SL_PROJECT:"\u9879\u76ee\u7f16\u53f7",IT_INDENT:"\u5411\u53f3\u7f29\u8fdb",IT_OUTDENT:"\u5411\u5de6\u7f29\u8fdb",CL_NAME:"\u6587\u5b57\uff1a",CL_LINK:"\u94fe\u63a5\uff1a",CL_MODIFY:"\u4fee\u6539",CL_DELETE:"\u79fb\u9664",CL_CONFIRM:"\u6dfb\u52a0",CL_CANCEL:"\u53d6\u6d88",CL_NAME_DEF:"\u9ed8\u8ba4\u4f7f\u7528\u94fe\u63a5\u540d\u5b57",SE_PREVIEW:"\u8fd4\u56de\u53ef\u89c6\u5316\u7f16\u8f91",SE_PREVIEW_TITLE:"\u6240\u89c1\u5373\u6240\u5f97",SE_FORMAT:"\u683c\u5f0f\u5316",SE_FORMAT_TITLE:"\u4ee3\u7801\u683c\u5f0f\u5316",SE_FORMATTING:"\u6b63\u5728\u683c\u5f0f\u5316\uff0c\u8bf7\u4e0d\u8981\u4fee\u6539\u4ee3\u7801..."}),extend(QMEditor.CONST._TEMPLATE,{_MENU_COLOR:T(['<div class="QMEditorMenuItem" param="$color$" title="$color$" style="float:left;width:auto;height:auto;" unselectable="on" $event$ >','<div class="QMEditorMenuColor" param="$color$" style="background:$color$;" unselectable="on"></div>',"</div>"]),_MENU_BREAKLINE:T(['<br style="clear:both;">']),MENU_SELECT_ITEM:T(["<b>&#187;</b>&nbsp;$content$"]),MENU_ICON_ITEM:T(['<div class="QMEditorMenuItem" cmd="$cmd$" style="$style$;" title="$title$" unselectable="on" $event$ >','<div class="QMEditorMenuIcon" cmd="$cmd$" style="float:left;widthed:$width$px;width:14px;margin:$margin$;overflow:hidden;" unselectable="on">','<img src="$path$$src$" style="margin-left:$bgleft$px;margin-top:$topNum$px;" unselectable="on" onmousedown="return false;" />',"</div>",'&nbsp;<span cmd="$cmd$" unselectable="on">$content$</span>',"</div>"]),MENU_CREATELINK:T(['<div class="QMEditorMenuPanel" unselectable="on" >','<div class="QMEditorLinkDiv" unselectable="on" >','$langName$<input param="name" type="text" onmousedown="try{stopPropagation(event);}catch(e){getTop().stopPropagation(event);}" > ',"</div>",'<div class="QMEditorLinkDiv" unselectable="on" >','$langLink$<input param="link" type="text" onmousedown="try{stopPropagation(event);}catch(e){getTop().stopPropagation(event);}" />',"</div>",'<div class="QMEditorLinkButton" unselectable="on" >','<button param="modify" class="QMEditorButton1 QMEditorLinkBtn" unselectable="on" >$langModify$</button>','<button param="delete" class="QMEditorButton1 QMEditorLinkBtn" unselectable="on" >$langDelete$</button>','<button param="confirm" class="QMEditorButton1 QMEditorLinkBtn" unselectable="on" >$langConfirm$</button>','<button param="cancel" class="QMEditorButton1 QMEditorLinkBtn" unselectable="on" >$langCancel$</button>',"</div>","</div>"]),BOTTON_ICON_SOURCEEDIT:T(['<div class="QMEditorBtnA" style="$style$;padding-left:0;" ',' unselectable="on" onmousedown="return false;" title="$title$" onmouseover="this.style.textDecoration=\'underline\'" onmouseout="this.style.textDecoration=\'none\'">&lt;HTML&gt;</div>']),SOURCEEDIT_TOOLBAR:T(['<div class="QMEditorBtnA" style="float:right;padding:2px 5px 0 0;* padding:3px 5px 0 0;" unselectable="on" onmousedown="return false;" onmouseover="this.style.textDecoration=\'underline\'" onmouseout="this.style.textDecoration=\'none\'" title="$formatTitle$" >','<span style="display:none;">',"$langFormatting$<span></span>","</span>","<span>$langFormat$</span>","</div>",'<div class="QMEditorBtnA QMEditorFormatBtn" unselectable="on" onmousedown="return false;" title="$previewTitle$"onmouseover="this.style.textDecoration=\'underline\'" onmouseout="this.style.textDecoration=\'none\'">',"$langPreview$<b>&#187;</b>","</div>"]),BOTTON_ICON_PREVIEW:T(['<div class="QMEditorBtnA" onmouseover="this.style.textDecoration=\'underline\'" onmouseout="this.style.textDecoration=\'none\'" style="$style$;padding-left:0;" ',' unselectable="on" onmousedown="return false;" title="$title$" >$langPreview$</div>']),BOTTON_ICON_UPLOADEML:T(['<div class="QMEditorBtnA" onmouseover="this.style.textDecoration=\'underline\'" onmouseout="this.style.textDecoration=\'none\'" style="$style$;padding-left:0;" ',' unselectable="on" onmousedown="return false;" title="$title$" >$langUploadEml$</div>']),BOTTON_ICON_SPELLCHECK:T(['<div class="QMEditorBtnA" onmouseover="this.style.textDecoration=\'underline\'" onmouseout="this.style.textDecoration=\'none\'" style="$style$;padding-left:0;" ',' unselectable="on" onmousedown="return false;" title="$title$" >$content$</div>']),DIALOG_FULLSCREEN:T(['<div style="text-align:center;padding:58px; padding-bottom:78px;">','<img src="$images_path$ico_loading2.gif" style="position:relative; top: 12px;"> \u6b63\u5728\u5bfc\u5165\u2026 <span id="percent"></span>',"</div>"])}),QMEditor.CONST._COLORS=["#000000 #993300 #333300 #003300 #003366 #000080 #333399 #333333","#800000 #FF6600 #808000 #008000 #008080 #0000FF #666699 #808080","#FF0000 #FF9900 #99CC00 #339966 #33CCCC #3366FF #800080 #999999","#FF00FF #FFCC00 #FFFF00 #00FF00 #00FFFF #00CCFF #993366 #C0C0C0","#FF99CC #FFCC99 #FFFF99 #CCFFCC #CCFFFF #99CCFF #CC99FF #FFFFFF"],QMEditor.prototype._isCollapsed=function(){if(this._moEditWin.getSelection){var t=this._moEditWin.getSelection();return t.isCollapsed||t.getRangeAt(0).collapsed}return"None"==this._moEditDoc.selection.type},QMEditor.prototype._hasAncestorNode=function(i){for(var t=this._moEditWin,e=this._getSelectionElement(),n=e,o=gbIsIE||gbIsOpera;n&&n.nodeName!=i;)n=n.parentNode;if(n)return!0;if(this._isCollapsed())return!1;if(!o){var r=e.previousSibling;if(r&&r.nodeName==i)return t.getSelection().containsNode(r,!0)}return function(t){if(t)if(t.nodeName!=i)for(var e,o=t.firstChild;o;o=e)e=o.nextSibling,arguments.callee(o);else n=t}(o?e.parentNode:e),!!n},QMEditor.prototype._changeEditMode=function(t){if("text"==this._msEditMode)return!1;if(this._msEditMode==t)return!0;var e="source"==t,o=e?"source":"html";gbIsWebKit&&(e?this._moEditBody:this._moSrceBody).blur(),this._moEditObj.style.display=e?"none":"block",this._moSrceBody.style.display=e?"block":"none","autoReply"==this._msEditorId&&(this._moSrceBody.style.width="98%"),show(this._moRichToolBarObj,!e),show(this._moSrceToolBarObj,e),this._setEditContent(o,this._getEditContent(e?"html":"source")),this._msEditMode=o,this.focus(0)},QMEditor.FUNCLIB._MENUSTATUS=QMEditor.FUNCLIB._inheritFrom(function(){this._msId="MENUSTATUS",this._msType="menu",this._mfOnShowMenu=this._doDefaultShowMenu},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB._MENUSTATUS.prototype._doDefaultShowMenu=function(t){var n=this,r=n._moBindEditor._moTemplate.MENU_SELECT_ITEM,a=n._moBindEditor._queryCmdValue(n._msCmd);"string"!=typeof a&&"number"!=typeof a&&(a=""),a=a.toString().toUpperCase(),E(this._moBindMenu.childNodes,function(t){var e=t.getAttribute("param").toUpperCase(),o=n._moParamSet[e].content,i=a==e?"QMEditorMenuItemCheck":"QMEditorMenuItem";t.className!=i&&(t.className=i,t.setAttribute("curclass",i)),t.innerHTML=a==e?r.replace({content:o}):o})},QMEditor.FUNCLIB._MENUCOLOR=QMEditor.FUNCLIB._inheritFrom(function(){this._msId="MENUCOLOR",this._msType="menu",this._moMenuData=QMEditor.CONST._COLORS,this._mfOnShowMenu=this._doDefaultShowMenu},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB._MENUCOLOR.prototype._doDefaultShowMenu=function(t){var i=this._moBindEditor._queryCmdValue(this._msCmd);if("string"==typeof i){for(var e=i.substring(4,i.length-1).split(","),o=0,n=e.length;o<n;o++)e[o]=parseInt(trim(e[o])).toString(16),1==e[o].length&&(e[o]="0"+e[o]);i=e.join("")}else{if("number"!=typeof i)return;for(o=0,n=6-(e=[i.toString(16)])[0].length;o<n;o++)e.unshift("0");var r=(e=e.join("").split(""))[0];e[0]=e[4],e[4]=r,r=e[1],e[1]=e[5],e[5]=r,i=e.join("")}i="#"+i,this._moBindEditor._moTemplate.MENU_SELECT_ITEM,i=i.toString().toUpperCase(),E(this._moBindMenu.childNodes,function(t){var e=t.getAttribute("param");if(e){var o=i==e?"QMEditorMenuItemCheck":"QMEditorMenuItem";o!=t.className&&(t.className=o,t.setAttribute("curclass",o))}})},QMEditor.FUNCLIB._MENUCOLOR.prototype._getMenuUI=function(){var t=this._moBindEditor,e=t._moTemplate._MENU_COLOR,o=t._moTemplate._MENU_ITEM_EVENT,i=t._moTemplate._MENU_BREAKLINE,n=[];return E(this._moMenuData,function(t){E(t.split(" "),function(t){n.push(e.replace({color:t,event:o}))}),n.push(i)}),n.join("")},QMEditor.FUNCLIB._MENUICON=QMEditor.FUNCLIB._inheritFrom(function(){this._msId="MENUICON",this._msType="menu",this._msTmplName="MENU_ICON_ITEM"},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB._MENUICONSTATUS=QMEditor.FUNCLIB._inheritFrom(function(){this._msId="MENUICONSTATUS",this._mfOnShowMenu=this._doDefaultShowMenu},QMEditor.FUNCLIB._MENUICON),QMEditor.FUNCLIB._MENUICONSTATUS.prototype._doDefaultShowMenu=function(t){var r=this,a=r._moBindEditor._moTemplate.MENU_SELECT_ITEM;E(r._moBindMenu.childNodes,function(t,e){var o=r._getCmdValue(t.getAttribute("cmd"));if("boolean"==typeof o){var i=r._moMenuData[e].content,n=o?"QMEditorMenuItemCheck":"QMEditorMenuItem";n!=t.className&&(t.className=n,t.setAttribute("curclass",n)),t.lastChild.innerHTML=o?a.replace({content:i}):i}})},QMEditor.FUNCLIB._MENUICONSTATUS.prototype._getCmdValue=function(t){return this._moBindEditor._queryCmdState(t)},QMEditor.FUNCLIB._MENUICONDISABLE=QMEditor.FUNCLIB._inheritFrom(function(){this._msId="MENUICONDISABLE",this._mfOnShowMenu=this._doDefaultShowMenu},QMEditor.FUNCLIB._MENUICON),QMEditor.FUNCLIB._MENUICONDISABLE.prototype._doDefaultShowMenu=function(t){var o=this;E(o._moBindMenu.childNodes,function(t){var e=o._moBindEditor._queryCmdEnabled(t.getAttribute("cmd"))?"QMEditorMenuItem":"QMEditorMenuItemDisabled";e!=t.className&&(t.className=e,t.setAttribute("curclass",e))})},QMEditor.FUNCLIB.Separate=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="Separate",this._msType="label",this._moBindEditor=t.editor,this._moUiConfig.icon={bgleft:-27,width:3,margin:"0",title:this._moBindEditor._moLanguage.FUN_SEPERATE}},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.Bold=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="Bold",this._msType="btn",this._moBindEditor=t.editor,this._moUiConfig.icon={bgleft:2,width:20,margin:"0",title:this._moBindEditor._moLanguage.FUN_BOLD},this._mfOnKeyDown=function(t){t.ctrlKey&&66==t.keyCode&&(this._doDefaultClick(),preventDefault(t))}},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.Italic=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="Italic",this._msType="btn",this._moBindEditor=t.editor,this._moUiConfig={},this._moUiConfig.icon={bgleft:-30,width:20,margin:"0",title:this._moBindEditor._moLanguage.FUN_ITALIC},this._mfOnKeyDown=function(t){t.ctrlKey&&73==t.keyCode&&(this._doDefaultClick(),preventDefault(t))}},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.Underline=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="Underline",this._msType="btn",this._moBindEditor=t.editor,this._moUiConfig.icon={bgleft:-60,width:18,margin:"0 4px 0 0",title:this._moBindEditor._moLanguage.FUN_UNDERLINE},this._mfOnKeyDown=function(t){t.ctrlKey&&85==t.keyCode&&(this._doDefaultClick(),preventDefault(t))}},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.FontName=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="FontName",this._moBindEditor=t.editor,this._moUiConfig.icon={bgleft:-94,width:24,margin:"0 1px 0 0",title:this._moBindEditor._moLanguage.FUN_FONTNAME},this._moMenuData=[{param:"\u5b8b\u4f53",style:"font-family:\u5b8b\u4f53",content:"\u5b8b\u4f53"},{param:"\u9ed1\u4f53",style:"font-family:\u9ed1\u4f53",content:"\u9ed1\u4f53"},{param:"KaiTi, STKaiti",style:"font-family:KaiTi, STKaiti",content:"\u6977\u4e66"},{param:"\u5e7c\u5706",style:"font-family:\u5e7c\u5706",content:"\u5e7c\u5706"},{param:"Arial",style:"font-family:Arial",content:"Arial"},{param:"Arial Black",style:"font-family:Arial Black;",content:"Arial Black"},{param:"Times New Roman",style:"font-family:Times New Roman",content:"Times New Roman"},{param:"Verdana",style:"font-family:Verdana",content:"Verdana"}]},QMEditor.FUNCLIB._MENUSTATUS),QMEditor.FUNCLIB.FontSize=QMEditor.FUNCLIB._inheritFrom(function(t){var e=t.editor._moLanguage;this._msId="FontSize",this._moBindEditor=t.editor,this._moUiConfig.icon={bgleft:-124,width:24,margin:"0 1px 0 0",title:e.FUN_FONTSIZE},this._moMenuData=[{param:"1",style:"font-size:xx-small;",content:e.FS_XXSMALL},{param:"2",style:"font-size:x-small;",content:e.FS_XSMALL},{param:"4",style:"font-size:medium;",content:e.FS_MEDIUM},{param:"5",style:"font-size:large;line-height:28px;height:26px;",content:e.FS_LARGE},{param:"6",style:"font-size:x-large;line-height:36px;height:34px;",content:e.FS_XLARGE}]},QMEditor.FUNCLIB._MENUSTATUS),QMEditor.FUNCLIB.ForeColor=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="ForeColor",this._moBindEditor=t&&t.editor,this._moUiConfig.icon={bgleft:-158,width:24,margin:"0 1px 0 0",title:this._moBindEditor&&this._moBindEditor._moLanguage.FUN_FORECOLOR}},QMEditor.FUNCLIB._MENUCOLOR),QMEditor.FUNCLIB.BackColor=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="BackColor",this._msCmd=gbIsIE||gbIsWebKit?this._msId:"hilitecolor",this._moBindEditor=t.editor,this._moUiConfig.icon={bgleft:-190,width:24,margin:"0 4px 0 0",title:this._moBindEditor._moLanguage.FUN_BACKCOLOR}},QMEditor.FUNCLIB._MENUCOLOR),QMEditor.FUNCLIB.AlignMode=QMEditor.FUNCLIB._inheritFrom(function(t){var e=t.editor._moLanguage;this._msId="AlignMode",this._moBindEditor=t.editor,this._moUiConfig.icon={bgleft:-222,width:24,topNum:2,margin:"0 1px 0 0",title:e.FUN_ALIGNMODE},this._moMenuData=[{bgleft:-350,topNum:2,cmd:"justifyleft",content:e.AM_LEFT},{bgleft:-382,topNum:2,cmd:"justifycenter",content:e.AM_CENTER},{bgleft:-414,topNum:2,cmd:"justifyright",content:e.AM_RIGHT}]},QMEditor.FUNCLIB._MENUICONSTATUS),QMEditor.FUNCLIB.Serial=QMEditor.FUNCLIB._inheritFrom(function(t){var e=t.editor._moLanguage;this._msId="Serial",this._moBindEditor=t.editor,this._moUiConfig.icon={bgleft:-254,width:24,topNum:2,margin:"0 1px 0 0",title:e.FUN_SERIAL},this._moMenuData=[{bgleft:-446,topNum:2,cmd:"insertorderedlist",content:e.SL_NUMBER},{bgleft:-478,topNum:2,cmd:"insertunorderedlist",content:e.SL_PROJECT}]},QMEditor.FUNCLIB._MENUICONSTATUS),QMEditor.FUNCLIB.Indent=QMEditor.FUNCLIB._inheritFrom(function(t){var e=t.editor._moLanguage;this._msId="Indent",this._moBindEditor=t.editor,this._moUiConfig.icon={bgleft:-286,width:24,topNum:2,margin:"0 1px 0 0",title:e.FUN_INDENT},this._moMenuData=[{bgleft:-542,topNum:2,cmd:"indent",content:e.IT_INDENT},{bgleft:-510,topNum:2,cmd:"outdent",content:e.IT_OUTDENT}]},QMEditor.FUNCLIB._MENUICONDISABLE),QMEditor.FUNCLIB.CreateLink=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="CreateLink",this._msType="menu",this._mbIsSaveRange=!0,this._moBindEditor=t.editor,this._msTmplName="MENU_CREATELINK";var e=this._moBindEditor._moLanguage;this._moUiConfig.icon={bgleft:-318,width:20,topNum:2,margin:"0 4px 0 0",title:e.FUN_CREATELINK},this._moMenuData=[{langName:e.CL_NAME,langLink:e.CL_LINK,langModify:e.CL_MODIFY,langDelete:e.CL_DELETE,langConfirm:e.CL_CONFIRM,langCancel:e.CL_CANCEL}],this._mfOnShowMenu=this._doDefaultShowMenu},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.CreateLink.prototype._filterElement=function(t,e,o){for(var i=0,n=t.length;i<n;i++)if(t[i].getAttribute(e)==o)return t[i];return null},QMEditor.FUNCLIB.CreateLink.prototype._initMenuElements=function(){var e=this,t=e._moBindEditor._moLanguage,o=GelTags("input",e._moBindMenu),i=GelTags("button",e._moBindMenu),n=this._moMenuElements={_oNameText:e._filterElement(o,"param","name"),_oLinkText:e._filterElement(o,"param","link"),_oModifyBtn:e._filterElement(i,"param","modify"),_oDeleteBtn:e._filterElement(i,"param","delete"),_oConfirmBtn:e._filterElement(i,"param","confirm"),_oCancelBtn:e._filterElement(i,"param","cancel")},r=n._oNameText,a=n._oConfirmBtn,s=n._oCancelBtn;r.className="QMEditorCLNameDef",r.value=t.CL_NAME_DEF,r.onfocus=function(){"QMEditorCLNameMdf"!=this.className&&(this.className="QMEditorCLNameMdf",this.value="")},r.onblur=function(){this.value||(this.className="QMEditorCLNameDef",this.value=t.CL_NAME_DEF)},addEvent(r,"keydown",function(t){13==t.keyCode&&preventDefault(t),27==t.keyCode&&(e._doDefaultMenuClick({target:s}),preventDefault(t))}),addEvent(n._oLinkText,"keydown",function(t){13==t.keyCode&&(e._doDefaultMenuClick({target:isShow(a)?a:n._oModifyBtn}),preventDefault(t)),27==t.keyCode&&(e._doDefaultMenuClick({target:s}),preventDefault(t))})},QMEditor.FUNCLIB.CreateLink.prototype._setMenuElementAttr=function(){var t=this._moMenuElements,e=t._oLinkText,o=this._mbIsEnabledUnlink,i=this._moLink;show(t._oNameText.parentNode,!o&&this._bIsCollapsed),show(e.parentNode,!(o&&!i)),show(t._oModifyBtn,i),show(t._oDeleteBtn,o),show(t._oConfirmBtn,!o),e.value=i&&i.href||"",isShow(e.parentNode)&&(e.focus(),e.select())},QMEditor.FUNCLIB.CreateLink.prototype._doDefaultShowMenu=function(t){var e=this._moBindEditor;_oEditorWin=e._moEditWin,_bIsUnlink=e._queryCmdEnabled("Unlink"),!_bIsUnlink&&e._moCurrentEditObj&&(e.loadRange("notclear"),_bIsUnlink=e._queryCmdEnabled("Unlink")),this._mbIsEnabledUnlink=_bIsUnlink&&e._hasAncestorNode("A"),this._moLink=this._mbIsEnabledUnlink&&e._moveToAncestorNode("A"),e._moCurrentEditObj?this._bIsCollapsed=!1:this._bIsCollapsed=e._isCollapsed(),this._setMenuElementAttr()},QMEditor.FUNCLIB.CreateLink.prototype._doDefaultMenuClick=function(t){var e=t.target||t.srcElement,o=e&&e.getAttribute("param"),i=this._moBindEditor;switch(o){case"delete":this._hideMenu(!0),i._execCmd("Unlink");break;case"modify":this._hideMenu(!0),this._moLink.href=this._getLinkText();break;case"confirm":if(this._hideMenu(!0),this._bIsCollapsed)if(i._moEditDoc.selection)i.focus(),(n=i._moEditDoc.selection.createRange()).pasteHTML(T('<a href="$url$" >$name$</a>').replace({url:this._getLinkText(),name:this._getNameText()}));else{var n=i._moEditWin.getSelection().getRangeAt(0),r=i._moEditDoc.createElement("a");r.href=this._getLinkText(),r.innerHTML=this._getNameText(),n.insertNode(r),n.setStartAfter(r)}else i._execCmd(this._msCmd,this._getLinkText());break;case"cancel":this._hideMenu(!0)}},QMEditor.FUNCLIB.CreateLink.prototype._getLinkText=function(){var t=this._moMenuElements._oLinkText.value;return/[a-zA-Z_0-9.-]+@[a-zA-Z_0-9.-]+\.\w+/.test(t)?0==trim(t).toLowerCase().indexOf("mailto")?t:"mailto:"+t:-1==trim(t).indexOf("://")?"http://"+t:t},QMEditor.FUNCLIB.CreateLink.prototype._getNameText=function(){var t=this._moMenuElements._oNameText;return"QMEditorCLNameDef"==t.className?this._getLinkText():t.value||this._getLinkText()},QMEditor.FUNCLIB.SourceEdit=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="SourceEdit",this._msType="custom",this._moBindEditor=t.editor;var e=this._moBindEditor._moLanguage;this._moUiConfig.icon={title:e.FUN_SOURCEEDIT},this._moUiConfig.sourceToolBar={formatTitle:e.SE_FORMAT_TITLE,langFormat:e.SE_FORMAT,previewTitle:e.SE_PREVIEW_TITLE,langPreview:e.SE_PREVIEW,langFormatting:e.SE_FORMATTING},this._mfOnClick=this._doDefaultClick},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.SourceEdit.prototype._setMouseOverEvent=function(t){},QMEditor.FUNCLIB.SourceEdit.prototype._doDefaultClick=function(t){var e=this._moBindEditor._moToolBarInfo.SpellCheck;e&&e._show(0,0,1),this._setupSourceToolBar(),this._moBindEditor.hideMenu(),this._moBindEditor._changeEditMode("source")},QMEditor.FUNCLIB.SourceEdit.prototype._setupSourceToolBar=function(){var t=this._moBindEditor._moSrceToolBarObj;if("true"==t.getAttribute("setuped"))return!1;t.innerHTML=this._moBindEditor._moTemplate.SOURCEEDIT_TOOLBAR.replace(this._moUiConfig.sourceToolBar),t.setAttribute("setuped","true"),this._setSourceToolBarEvent()},QMEditor.FUNCLIB.SourceEdit.prototype._setSourceToolBarEvent=function(){var e=this,t=e._moBindEditor._moSrceToolBarObj.firstChild;t.nextSibling.onclick=function(){e._mnWaitLoadTimer&&clearInterval(e._mnWaitLoadTimer),e._moBindEditor._changeEditMode("html");var t=e._moBindEditor._moToolBarInfo.SpellCheck;t&&t._show(1,0,1)},t.onclick=function(){e._formatCode()}},QMEditor.FUNCLIB.SourceEdit.prototype._formatCode=function(){var t=this;if(_oEditor=t._moBindEditor,window.QMFormatter){this._mnWaitLoadTimer&&clearInterval(this._mnWaitLoadTimer);var e=_oEditor._moSrceToolBarObj.firstChild,o=e.firstChild,i=o.lastChild,n=e.lastChild;show(o,!0),show(n,!1),e.className="QMEditorFormatting",i.innerHTML="0%",QMFormatter.format(_oEditor._getEditContent("source"),function r(t){_oEditor._setEditContent("source",t),show(o,!1),show(n,!0),e.className="QMEditorBtnA"},function a(t){i.innerHTML=t})}else{if(_oEditor._loadFile({"qqmaileditor/plus/formatter.js":!0}),t._mnWaitLoadTimer)return;this._mnWaitLoadTimer=setInterval(function(){t._formatCode()},500)}},QMEditor.FUNCLIB.Preview=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="Preview",this._msType="custom",this._moBindEditor=t.editor,this._msContainerClassName="qmEditorToolBarItemRight";var e=this._moBindEditor._moLanguage;this._moUiConfig.icon={title:e.FUN_PREVIEW,langPreview:e.FUN_PREVIEW},this._mfOnClick=this._doDefaultClick},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.Preview.prototype._doDefaultClick=function(t){var e=this._moBindEditor;getTop().callBack.call(e,e._mfOnPreview)},QMEditor.FUNCLIB.Preview.prototype._setMouseOverEvent=function(t){},QMEditor.FUNCLIB.UploadEml=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="UploadEml",this._msType="custom",this._moBindEditor=t.editor,this._msContainerClassName="qmEditorToolBarItemRight";var e=this._moBindEditor._moLanguage;this._moUiConfig.icon={title:e.FUN_UPLOADEML,langUploadEml:e.FUN_UPLOADEML},this._mfOnClick=this._doDefaultClick},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.UploadEml.prototype._doDefaultClick=function(t){var e=this._moBindEditor;getTop().callBack.call(e,e._mfOnUploadEml)},QMEditor.FUNCLIB.UploadEml.prototype._setMouseOverEvent=function(t){},QMEditor.FUNCLIB.SpellCheck=QMEditor.FUNCLIB._inheritFrom(function(t){if(getOpenSpellCheck()){this._msId="spellcheck",this._msType="custom",this._moBindEditor=t.editor,this._msContainerClassName="qmEditorToolBarItemRight";var e=this._moBindEditor._moLanguage;this._moUiConfig.icon={title:e.FUN_SPELLCHECKTITLE,content:e.FUN_SPELLCHECK},this._mfOnClick=this._doDefaultClick,this._moCheckCharset={},(this._moBindEditor._moToolBarInfo.SpellCheck=this)._moSeparateSet_html=/(.*?)((<.*?>)|(&nbsp;)|[^\x00-\xff]|[\[\]\"\'\\\-!$^()_,.:;<>?/`\uFF04\uFF3E\uFF0A\uFF3F\uFF3B\uFF3D{}\uFF0E\uFF02\uFF07\uFF1C\uFF1E\uFF0F\uFFE3\uFF40@#%&*+=|~\uFF01\uFF20\uFF03\uFFE5\uFF05\u2026\uFF06\u8133\uFF08\uFF09\uFF0D\u2014\uFF0B\uFF1D\u3010\u3011\uFF5B\uFF5D\uFF0C\u3002\uFF1A\uFF1B\u201C\u201D\u2018\u2019\uFF3C\uFF5C\u300A\u300B\uFF1F\u3001\uFF5E\u8DEF\t\r\v\f\x20\n\u3000])/g,this._moSeparateSet_text=/(.*?)([\[\]\"\'\\\-!$^()_,.:;<>?/`\uFF04\uFF3E\uFF0A\uFF3F\uFF3B\uFF3D{}\uFF0E\uFF02\uFF07\uFF1C\uFF1E\uFF0F\uFFE3\uFF40@#%&*+=|~\uFF01\uFF20\uFF03\uFFE5\uFF05\u2026\uFF06\u8133\uFF08\uFF09\uFF0D\u2014\uFF0B\uFF1D\u3010\u3011\uFF5B\uFF5D\uFF0C\u3002\uFF1A\uFF1B\u201C\u201D\u2018\u2019\uFF3C\uFF5C\u300A\u300B\uFF1F\u3001\uFF5E\u8DEF\t\r\v\f\x20\n\u3000])/g;var i={text:0,html:1},n=this;this._mnStatus=i[this._moBindEditor.getContentType()],createBlankIframe(getTop(),{id:"spellcheckDocument"}),this._moAjax=new QMAjax("/cgi-bin/speller"),this._moAjax.onComplete=function(t){for(var e=n._moAjax._moNewWord,o=e.length-1;0<=o;o--)n._moCheckCharset[e[o]]={};"object"==typeof(e=evalValue(t.responseText))&&extend(n._moCheckCharset,e),n._mnStatus&i[n._moBindEditor.getContentType()]&&n._show(1),n._requestFinishUI()},this._moAjax.onError=function(t,e){"abort"!=e&&showError("\u68c0\u67e5\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\u3002"),n._requestFinishUI()}}},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.SpellCheck.prototype._doDefaultClick=function(t){this._moBindEditor;var e=getEventTarget(t),o=(this._mnStatus,this);this._moButton=e,4&this._mnStatus||setTimeout(function(){o._intervalCheck()})},QMEditor.FUNCLIB.SpellCheck.prototype._setMouseOverEvent=function(t){},QMEditor.FUNCLIB.SpellCheck.prototype._intervalCheck=function(t){if(t)return this._moAjax.abort(),void this._show(0);this._checkWord()},QMEditor.FUNCLIB.SpellCheck.prototype._separateWord=function(){for(var t=this._moBindEditor,e="text"==t.getContentType()?this._moSeparateSet_text:this._moSeparateSet_html,i=this._moCheckCharset,n=[],r={},a=T('<$label$ class="" title="\u8bf7\u5355\u51fb\u9f20\u6807\u6765\u663e\u793a\u62fc\u5199\u5efa\u8bae" name="spellcheck" style="border-bottom:1px dotted #FF2E7E;">$w1$</$label$>$w2$'),o=now(),s=[["&lt;","%"+o+"#"],["&gt;","%"+(o+1)+"#"],["&amp;","%"+(o+2)+"#"],["&quot;","%"+(o+3)+"#"]],l={},d=t.getContent(),u=s.length-1;0<=u;u--)d=d.replace(new RegExp(s[u][0],"gi"),s[u][1]),l[o+u]=1;for(d=d.replace(e,function(t,e,o){if(e&&!l[e])if(i[e]){if(i[e].suggestion&&!i[e]._mbIgnorable&&(1!=i[e].suggestion.length||""!=i[e].suggestion[0]))return a.replace({w1:e,w2:o,label:gbIsIE?"a":"span"})}else r[e]||(r[e]=1,n.push(e));return t}),u=s.length-1;0<=u;u--)d=d.replace(new RegExp(s[u][1],"gi"),s[u][0]);return[n,d]},QMEditor.FUNCLIB.SpellCheck.prototype._requestFinishUI=function(){var t=this._moBindEditor._moLanguage,e=this._moButton,o=e.style;e.innerHTML=t.FUN_SPELLCHECK,e.title=t.FUN_SPELLCHECKTITLE,o.paddingTop="2px",o.cursor="pointer",o.textDecoration="underline",this._mnStatus&=11},QMEditor.FUNCLIB.SpellCheck.prototype._requestBeginUI=function(){var t=this._moBindEditor._moLanguage,e=this._moButton,o=e.style;e.innerHTML=t.FUN_SPELLCHECKING,e.title=t.FUN_SPELLCHECKING,o.paddingTop="0",o.cursor="auto",o.textDecoration="none"},QMEditor.FUNCLIB.SpellCheck.prototype._checkWord=function(){var t=this._separateWord(),e=this;if(this._requestBeginUI(),t[0].length)return this._mnStatus|=4,this._moAjax.abort(),this._moAjax._moNewWord=t[0],void this._moAjax.send(T("wordlist=$wl$&sid=$sid$&t=compose_speller").replace({wl:t[0].join(" "),sid:getSid()}));this._show(1,t[1]),setTimeout(function(){e._requestFinishUI()},1e3)},QMEditor.FUNCLIB.SpellCheck.prototype._removeSpellCheck=function(t){for(var e=t.parentNode;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)},QMEditor.FUNCLIB.SpellCheck.prototype._removeAllSpellCheck=function(t){for(var e=(t=t||this._moBindEditor._moEditDoc).getElementsByName("spellcheck"),o=e.length-1;0<=o;o--)this._removeSpellCheck(e[o])},QMEditor.FUNCLIB.SpellCheck.prototype._showDropDown=function(t){var e=getEventTarget(t),o=this._moCheckCharset[e.innerHTML];if(o){if(o.suggestion){var i=calcPosFrame(e,this._moBindEditor._moEditWin),n=o.suggestion,r=this;_oItems=[];for(var a=0,s=n.length;a<s;a++)n[a]&&_oItems.push({sId:a,sItemValue:n[a]});_oItems.length||_oItems.push({sItemValue:"\u6ca1\u6709\u5efa\u8bae"}),_oItems.push({sItemValue:"<hr/>"}),_oItems.push({sId:"ignore",sItemValue:"\u5ffd\u7565"}),1<this._moBindEditor._moEditDoc.getElementsByName("spellcheck").length&&_oItems.push({sId:"ignoreall",sItemValue:"\u5168\u90e8\u5ffd\u7565"}),o._msId=o._msId||unikey("m"),new(getTop().QMMenu)({sId:o._msId,oEmbedWin:getTop(),nX:i[3],nY:i[2],nWidth:150,nItemHeight:21,oItems:_oItems,onitemclick:function(t){"ignore"==t?(o._mbIgnorable=1,r._removeSpellCheck(e)):"ignoreall"==t?(E(r._moCheckCharset,function(t){t._mbIgnorable=1}),r._removeAllSpellCheck()):(e.innerHTML=_oItems[t].sItemValue,r._removeSpellCheck(e))}})}}else this._checkWord()},QMEditor.FUNCLIB.SpellCheck.prototype._setSpellCheckEvent=function(){var e=this,o=function(){},i=function(t){e._showDropDown(t)};E(e._moBindEditor._moEditDoc.getElementsByName("spellcheck"),function(t){t.onclick||(addEvent(t,"click",i),t.onclick=o)})},QMEditor.FUNCLIB.SpellCheck.prototype._show=function(t,e,o){if(t){if(!o||8&this._mnStatus){var i=this._moBindEditor;this._mnStatus&=7,this._mnStatus|=2,i.setContent(e||this._separateWord()[1]),this._setSpellCheckEvent(),i.focus(0)}}else o&&2&this._mnStatus&&(this._mnStatus|=8),this._moAjax.abort(),this._mnStatus&=13,this._removeAllSpellCheck()},QMEditor.FUNCLIB.Quot=QMEditor.FUNCLIB._inheritFrom(function(t){var e=this;e.setId("formatblock"),e.setCmd("formatblock"),e.setType("btn"),e.setBindEditor(t.editor),this._moUiConfig.icon={bgleft:-570,topNum:0,width:20,margin:"0",src:"newicon/editornew.gif",title:this._moBindEditor._moLanguage.FUN_QUOT},e.setfOnClick(e._fDoDefaultClick),e.setfDoDefaultClick(e._fDoDefaultClick)},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.Quot.prototype._fDoDefaultClick=function(t){this.getBindEditor().queryFormatBlockState()?this._removeQuot(t):this._insertQuot(t)},QMEditor.FUNCLIB.Quot.prototype._insertQuot=function(t){var l=this;this.getBindEditor()._execCmd(gbIsIE?"indent":"formatblock","blockquote",function(){var t=this._getSelectionElement(),e=t&&function s(t){for(var e=t,o=0;e&&"BLOCKQUOTE"!=e.tagName&&("OL"==e.tagName&&++o)<2;)e=e.parentNode;if(e&&"OL"==e.tagName){var i=l.getBindEditor().getEditDoc().createElement("blockquote"),n=e.childNodes;e.parentNode.insertBefore(i,e);for(var r=0,a=n.length;r<a;r++)i.appendChild(n[r]);e.parentNode.removeChild(e),e=i}return e}(t);e&&(e.style.cssText="margin:0.8em 0 0.8em 2em; padding:0 0 0 0.7em; border-left:2px solid #DDDDDD;",attr(e,"formatblock",1),e=t=undefined)})},QMEditor.FUNCLIB.Quot.prototype._removeQuot=function(t){this.getBindEditor()._execCmd("outdent","blockquote",function(){var t=this.getEditBody();E(t.getElementsByTagName("blockquote"),function(t){t&&!trim(t.innerHTML)&&t.parentNode.removeChild(t),t=undefined}),gbIsIE&&E(t.getElementsByTagName("p"),function(t){t&&attr(t,"formatblock")&&(t.removeAttribute("formatblock"),t.style.cssText=""),t=undefined})})},QMEditor.setupFunc(),function(t,e){var u=QMEditor.getTopWin();QMEditor.FUNCLIB.FormatMatch=QMEditor.FUNCLIB._inheritFrom(function(t){var e=this;e.setId("FormatMatch"),e.setCmd("FormatMatch"),e.setType("btn"),e.setBindEditor(t.editor);var o=e.getBindEditor().getLanguage();this._moUiConfig.icon={bgleft:-670,topNum:1,width:20,margin:"0",src:"newicon/editornew.gif",label:o.FUN_FORMATMATCH_LABEL},e.setfDoDefaultClick(this._dofaultClick)},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.FormatMatch.prototype.init_=function(){var e=this,o=(e.getBindEditor(),e.getContainer());window.getSelection?(u.addClass(o,"opa50"),u.loadJsFileToTop(["$js_path$qqmaileditor/qmeditorext/"+getFullResSuffix("editor_toolbar_ext.js")]),waitFor(function(){return u.QMEditorExt},function(t){t&&(u.rmClass(o,"opa50"),o.firstElementChild.title=["\u683c\u5f0f\u5237\u7528\u6cd5\uff1a","1. \u9009\u4e2d\u5177\u6709\u76ee\u6807\u683c\u5f0f\u7684\u5185\u5bb9","2. \u5355\u51fb\u683c\u5f0f\u5237","3. \u518d\u9009\u4e2d\u5176\u5b83\u5185\u5bb9\uff0c\u8fd9\u4e9b\u5185\u5bb9\u4f1a\u81ea\u52a8\u5e94\u7528\u76ee\u6807\u683c\u5f0f","","\u63d0\u793a\uff1a\u6b65\u9aa42\u4e2d\u82e5\u53cc\u51fb\u683c\u5f0f\u5237\uff0c\u53ef\u8fde\u7eed\u6267\u884c\u6b65\u9aa43\u3002"].join("\n"),new n(e))})):u.show(o,!1)},QMEditor.FUNCLIB.FormatMatch.prototype._dofaultClick=function(){};var o={};u.E(["font-size","font-family","color","text-decoration","background-color","font-weight","font-style"],function(t){o[t]=function(t){return t.replace(/-(\w)/,function(t,e){return e.toUpperCase()})}(t)});var i={};function n(t){this._moToolBar=t,this._init()}u.E(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"],function(t){i[t]=!0}),n.prototype={_oStyleList:o,_sWarpNodeMarker:"__editorWarp__",_getBrowerStyle:function(t,e,o){if(o||"text-decoration"!=e&&"textDecoration"!=e)return getStyle(t,e);for(var i=8,n="",r=t;r&&i--;){if(-1==(n=getStyle(r,e)).indexOf("none"))return n.split(" ")[0];r=r.parentNode}return n.split(" ")[0]},_getBindEditor:function(){return this._moToolBar.getBindEditor()},_getWin:function(){return this._getBindEditor().getEditWin()},_init:function(){var t=this._getWin();this._clearFormat(),u.evalCss(".cursor_formatMatch{cursor:url("+getRes("$images_path$newicon/cursor_format.cur")+"), text;}",t),this._initEvent()},_isBlockElement:function(t){return 1==t.nodeType&&i[getStyle(t,"display")]},_getNodeText:function(t,e,o){for(var i=this;e;){if(3==e.nodeType||"BR"==e.tagName)t.appendChild(e.cloneNode(!1));else{if(e===o)return!1;if("A"==e.tagName){if((n=i._createWarpNode("a")).style.display=getStyle(e,"display"),n.href=e.href,!(r=i._resertLineNodeWarp2(e.firstChild,o,n,t)))return!1}else if(i._isBlockElement(e)){var n;if((n=e.cloneNode(!1)).style.display=getStyle(e,"display"),!(r=i._resertLineNodeWarp2(e.firstChild,o,n,t)))return!1}else{if(QMSelection.isBookmarkNode(e)){e=e.nextSibling;continue}var r;if(!(r=i._getNodeText(t,e.firstChild,o)))return r}}var a=e;e=e.nextSibling,removeSelf(a)}return!0},_resertLineNodeWarp:function(t,e){var o=this._createWarpNode(),i=this._createTempNode(t),n=this._getNodeText(o,t,e);return o.firstChild&&(this._ajustFormat(o),i.parentNode.insertBefore(o,i)),removeSelf(i),n},_resertLineNodeWarp2:function(t,e,o,i){var n=this._getNodeText(o,t,e);return o.firstChild&&(this._ajustFormat(o),i.appendChild(o)),n},_createWarpNode:function(t){var e=this._getWin().document.createElement(t||"font");return e.style.display="inline",attr(e,this._sWarpNodeMarker,"1"),e},_createTempNode:function(t){var e=this._getWin().document.createElement("span");return e.style.display="none",t&&t.parentNode.insertBefore(e,t),e},_breakNode:function(t){for(var e,o=u.QMEditorExt.domUtils;(e=t.parentNode)&&!this._isBlockElement(e);)o.breakParent(t,e),o.clearEmptySibling(t)},_initEvent:function(){var a=this,s=a._getBindEditor(),t=a._moToolBar.getContainer(),l=s.getEditWin(),e=t.firstChild;function o(){var t=u.QMSelection.getSelection(l).getRange();if(t.isCollapsed()){var e=a._createWarpNode();e.innerHTML="&#8203;",t.insertNode(e),a._ajustFormat(e),t.setEndAfter(e),t.collapse(!1),t.select()}else try{var o=t.createBookmark();a._breakNode(o.oStartNode),a._breakNode(o.oEndNode);for(var i=o.oStartNode.nextSibling||o.oStartNode.parentNode;i;){var n=i.parentNode.nextSibling;if(!a._resertLineNodeWarp(i,o.oEndNode))break;i=n}t.gotoBookmark(o),t.clear()}catch(r){u.debug(r)}1==a._mnFlag&&d(),gbIsFF&&s.setContentEditable()}function d(){u.addEvent(l.document,"mouseup",o,!0),u.rmClass(e,"qmEditorBtnIconCheck"),u.rmClass(l.document.body,"cursor_formatMatch"),a._clearFormat()}function i(){if(!a._mnFlag)return a._saveFormat()?(u.addEvent(l.document,"mouseup",o),u.addClass(e,"qmEditorBtnIconCheck"),u.addClass(l.document.body,"cursor_formatMatch"),!0):void 0;d()}var n=!1;e.onclick=function(){return!n&&(!!i()&&(n=!0,setTimeout(function(){n=!1},800),!(a._mnFlag=1)))},e.ondblclick=function(){return!(!n&&!i())&&!(a._mnFlag=2)},gbIsFF&&s.bindPrevCmd(function(t,e,o){if("execCommand"==t||"Italic"==e){var i=u.QMSelection.getSelection(l),n=i.getRange();if(!n.isCollapsed()){var r=n.createBookmark(),a=r.oStartNode.nextSibling;a&&3!=a.nodeType&&attr(a,i._sWarpNodeMarker)&&r.oEndNode.previousSibling===a?(n.gotoBookmark(r),n.setStartBefore(a),n.setEndAfter(a),n.select()):n.gotoBookmark(r)}}})},_saveFormat:function(){var o=this;try{var t=u.QMSelection.getSelection(o._getWin()),e=t.getRange(),i=e.createBookmark(),n=i.oStartNode.parentNode;return u.E(o._oStyleList,function(t,e){o._moCurrentStyleList[e]=o._getBrowerStyle(n,e)||o._getBrowerStyle(n,t)}),e.gotoBookmark(i),t.clear(!0),!0}catch(r){return u.debug("formatmatch has no range"),!1}},_clearFormat:function(){this._mnFlag=0,this._moCurrentStyleList={}},_ajustFormat:function(o){var i=this;u.E(i._moCurrentStyleList,function(t,e){i._getBrowerStyle(o,e,!0)!=t&&i._oStyleList[e]&&(o.style[i._oStyleList[e]]=t)})}},QMEditor.setupFunc()}(QMEditorAdapter),function(t,e){var l=QMEditor.getTopWin(),r="__FullScreenEditor__",o=QMEditor.FUNCLIB.FullScreen=QMEditor.FUNCLIB._inheritFrom(function(t){var e=this;e.setId("FullScreen"),e.setType("btn"),e.setBindEditor(t.editor);var o=e.getBindEditor(),i=o.getLanguage(),n=l==o.getEditorAreaWin()&&o.getEditorConfig("editorId")==r;(e._mbFullEditor=n)?this._moUiConfig.icon={bgleft:-637,topNum:2,width:20,margin:"0",src:"newicon/editornew.gif",title:i.FUN_FULLSCREEN_OUT,label:i.FUN_FULLSCREEN_OUT_LABEL}:(e._msFullScreenEditorId=r,this._moUiConfig.icon={bgleft:-603,topNum:2,width:20,margin:"0",src:"newicon/editornew.gif",title:i.FUN_FULLSCREEN,label:i.FUN_FULLSCREEN_LABEL}),e.setfDoDefaultClick(this._dofaultClick),e.setContainerClassName("qmEditorToolBarItemRight")},QMEditor.FUNCLIB._BASE);function d(r){var a=r.getEditorCustomVar("FullScreenToolbar.oSrcEditor");_(r),r.hideMenu(),l.bnewwin||(l.msgBox.createMessageBox(43),l.showProcess.createProcessBox(43)),setTimeout(function(){try{var t=r.getEditWin(),e=a.getEditWin();r._changeEditMode("html");var o=u(t),i=r.getContent();a.setContent(i),m(o,e,a)}catch(n){}})}function u(t){try{return l.QMSelection.getSelection(t).getRange().createBookmark()}catch(e){}}function m(o,i,n){o?(o={oStartNode:S(o.oStartNode.id,i),oEndNode:o.oEndNode&&S(o.oEndNode.id,i)},setTimeout(function(){try{n.focus(0);var t=l.QMSelection.getSelection(i).getRange();t.gotoBookmark(o),t.select(),n.saveRange()}catch(e){removeSelf(o.oStartNode),o.oEndNode&&removeSelf(o.oEndNode)}},gbIsFF?100:10)):n.focus(0,n.getContentObj("QQMAILSTATIONERY"))}function _(t){l.show(t.getEditorArea(),!1),l.show(c(),!1),t.setEditorCustomVar("FullScreenToolbar.bUseFullEdtior",!1)}function c(){var t="qqmail_fulleditor_mask",e=l.S(t,l);return e||(l.insertHTML(l.S("resize",l),"beforeEnd",T('<div id="$id$" class="$class$" style="z-index:110;display:none;width:100%;height:100%;_zoom:1;" onkeypress="return false;" onkeydown="return false;" tabindex="0" onclick="getTop().QMEditor.getEditor(\'$editorId$\') && getTop().QMEditor.getEditor(\'$editorId$\').getEditorCustomVar(\'FullScreenToolbar.gooutFullScreenEditor\')();return false;"></div>').replace({"class":"opaMaskDark",editorId:r,id:t})),e=l.S(t,l)),e}o.prototype.init_=function(){var a=this,t=a.getBindEditor();if(a._mbFullEditor){var e=t,o=a.getContainer();l.addClass(o.firstChild,"qmEditorFullScreenFull"),e.setEditorCustomVar("FullScreenToolbar.oFullToolbarBtn",a)}else{var s=t;l.loadJsFileToTop(["$js_path$qqmaileditor/qmeditorext/"+getFullResSuffix("editor_toolbar_ext.js")]),a._getFullScreenEditor()&&a._delFullScreenEditor(),setTimeout(function(){var t=l.document.createElement("div");l.S("resize",l).appendChild(t),t.id=a._msFullScreenEditorId,t.style.cssText="display:none; position:absolute; top:2%; left:1%; width:98%; height:96%; z-index: 111;",a._moFullEditorContainer=t;var e=s.getEditorConfig(),o=e.fullscreenCfg||{},i=QMEditor.createEditor(extend({},e,o,{editorId:a._msFullScreenEditorId,editorAreaWin:l,editorAreaId:null,editorAreaObj:t,height:null,isNoEditScroll:!1,nAutoRisizeMinHeight:null,onload:function(){l.callBack.call(this,o.onload,[i])},onputcontent:null}));i.initialize("",!0,"",""),l.gbIsIE&&6==l.gnIEVer&&l.insertHTML(t,"afterbegin",'<iframe style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;" src="javascript:(function(){document.open();document.domain=\''+document.domain+"';document.close();})();\"></iframe>");var n={oSrcEditor:s,oFullEditor:i,bUseFullEdtior:!1,oSrcToolbatBtn:a,hideFullScreenEditor:function(){_(i)},gooutFullScreenEditor:function(){d(i)}};i.setEditorCustomVar("FullScreenToolbar",n),s.setEditorCustomVar("FullScreenToolbar",n),addEvent(s.getEditorAreaWin(),"unload",function(){a._delFullScreenEditor()});var r=s.getContent;s.getContent=function(){return s.getEditorCustomVar("FullScreenToolbar.bUseFullEdtior")?i.getContent.apply(i,arguments):r.apply(s,arguments)}},400)}},o.prototype._dofaultClick=function(){var s=this;s._mbFullEditor?d(s.getBindEditor()):l.waitFor(function(){return s._getFullScreenEditor()},function(t){if(t){var e=s.getBindEditor(),o=s._getFullScreenEditor(),i=e.getEditWin(),n=o.getEditWin();o._changeEditMode("html");var r=u(i);if(o.setContent(e.getContent()),l.show(s._moFullEditorContainer,!0),l.show(c(),!0),m(r,n,o),l.gbIsIE&&6==l.gnIEVer&&(setTimeout(function(){c().parentNode.style.zoom=1},0),o.getEditObj()&&(o.getEditObj().parentNode.style.height="100%")),l.callBack(o.getEditorConfig().onfullscreenshow,[o]),e.setEditorCustomVar("FullScreenToolbar.bUseFullEdtior",!0),!l.getCookie("editor_fs")){var a="editor_fullscreen_compose_tip";o.getEditorCustomVar("FullScreenToolbar.oFullToolbarBtn").getContainer().id=a,l.setCookie("editor_fs","1",new Date(l.now()+2592e6)),l.waitForShowTip({tipid:101,win:l,domid:a,arrow_offset:9,msg:"\u70b9\u51fb\u8fd9\u91cc\u6216\u6309 ESC \u9000\u51fa\u5168\u5c4f\u7f16\u8f91\u6a21\u5f0f\u3002"},"show")}l.bnewwin||(l.msgBox.createMessageBox(0),l.showProcess.createProcessBox(0))}})},o.prototype._getFullScreenEditor=function(){return QMEditor.getEditor(this._msFullScreenEditorId)},o.prototype._delFullScreenEditor=function(){this._getFullScreenEditor()&&QMEditor.delEditor(this._msFullScreenEditorId);var t=l.S(this._msFullScreenEditorId,l);t&&l.removeSelf(t)},QMEditor.setupFunc()}(QMEditorAdapter);