(function(t){var e=getTop(),o={document:e.document,window:e,gsAgent:gsAgent,gbIsFF:gbIsFF,gbIsChrome:gbIsChrome,gbIsSafari:gbIsSafari,gbIsOpera:gbIsOpera,gbIsWebKit:gbIsWebKit,gbIsIE:gbIsIE,gnIEVer:gnIEVer,gbIsMac:gbIsMac,evalCss:evalCss,S:S,T:T,TE:TE,E:E,createBlankIframe:createBlankIframe,createIframe:createIframe,GelTags:GelTags,insertHTML:insertHTML,attr:attr,getStyle:getStyle,setClass:setClass,finds:finds,isShow:isShow,show:show,callBack:callBack,addEvent:addEvent,addEvents:addEvents,removeEvent:removeEvent,getEventTarget:getEventTarget,preventDefault:preventDefault,stopPropagation:stopPropagation,isObjContainTarget:isObjContainTarget,loadJsFile:loadJsFile,waitFor:waitFor,calcPos:calcPos,calcAdjPos:calcAdjPos,calcPosFrame:calcPosFrame,bodyScroll:bodyScroll,getPath:getPath,getPaths:getPaths,getRes:getRes,extend:extend,trim:trim,now:now,unikey:unikey,subAsiiStr:subAsiiStr,debug:debug,QMMenu:QMMenu,QMDialog:QMDialog,QMSelect:QMSelect};window.QMEditorAdapter=o})(),function(t){var e=getTop();QMEditorAdapter.extend(QMEditorAdapter,{calcPos:e.calcPos,calcAdjPos:e.calcAdjPos,calcPosFrame:e.calcPosFrame,showError:e.showError,QMAjax:e.QMAjax,ossLog:e.ossLog,getSid:e.getSid,searchMusic:e.searchMusic,QMAXInfo:e.QMAXInfo,detectActiveX:e.detectActiveX,createActiveX:e.createActiveX,getAttachList:e.getAttachList,hasClass:e.hasClass,addClass:e.addClass,rmClass:e.rmClass,subAsiiStr:e.subAsiiStr,parents:e.parents,finds:e.finds,getDomWin:e.getDomWin,removeSelf:e.removeSelf,LogKV:e.LogKV})}(),function(t,e){var n=['.QMEditorBtnIcon,.qmEditorMenuIcon{width:24px;height:17px;text-align:center;padding:1px;border:none;}.qmEditorMenuIcon{overflow:hidden;}.qmEditorBtnIconOver{padding:1px 0 0 1px;border-left:none;border-top:none;border-right:1px solid gray;border-bottom:1px solid gray;}.qmEditorBtnIconCheck,.qmEditorBtnIconPrevCheck{padding:0;border-left:1px solid gray;border-top:1px solid gray;border-right:1px solid white;border-bottom:1px solid white;}.qmEditorBtnA,.qmEditorFormatting{padding:2px 0 3px 8px;color:#039;font:normal 12px "lucida Grande",Verdana;cursor:pointer;white-space:nowrap;-moz-user-select:none}.qmpanel_shadow .arrow{position:absolute;top:-4px;width:11px;height:11px;overflow:hidden;border:1px solid #bababa;background:#FFFFFF;clip:rect(-3px,10px,10px,-3px);-moz-box-shadow:0 0 3px rgba(0,0,0,0.15);-webkit-box-shadow:0 0 3px rgba(0,0,0,0.15);-o-box-shadow:0 0 3px rgba(0,0,0,0.15);box-shadow:0 0 3px rgba(0,0,0,0.15);-moz-transform:rotate(45deg);-webkit-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg);top:-10px\\9;clip:rect(-3px 100px 100px -3px)\\9;clip:rect(-3px 100px 100px -3px)\\9\\0;filter:progid:DXImageTransform.Microsoft.Matrix(Dx=-2,Dy=12,M11=0.7,M12=0.7,M21=-0.7,M22=0.7);}@media screen and (-webkit-min-device-pixel-ratio:0){.qmpanel_shadow .arrow{clip:rect(-3px,10px,10px,-3px);}}@media screen and (-ms-high-contrast:active),(-ms-high-contrast:none){.qmpanel_shadow .arrow{top:-4px;clip:rect(-3px,10px,10px,-3px);}}.qmpanel_shadow .btn_close{position:absolute;z-index:3;right:8px;top:8px;width:13px;height:13px;overflow:hidden;vertical-align:middle;background:url($js_path$qqmaileditor/images/mail.png) no-repeat scroll -96px -19px;-moz-border-radius:2px;-webkit-border-radius:2px;-o-border-radius:2px;border-radius:2px;}.qmpanel_shadow .btn_close:hover{background-position:-107px -19px;background-color:#999;}.qmpanel_shadow .btn_close:active{opacity:0.6;filter:alpha(opacity=60);}.qm_addinput{height:22px;line-height:1;border-width:1px;border-color:#9a9a9a #7c7c7c #c3c3c3 #c3c3c3;box-shadow:0 1px 1px #d4d4d4 inset;margin:0 5px 0 0;padding:0 5px;padding:5px\\9;height:12px\\9;width:295px;border-radius:3px;background:#FFFFFF;}.qmEdMap_head{padding:20px 0;text-align:center;}.qmEdMap_search{position:relative;width:427px;margin:0 auto;text-align:left;overflow:hidden;*zoom:1;}.qmEdMap_search .qm_addinput{float:left;width:356px;margin-right:5px;_width:353px;}.qmEdMap_search .button_gray_s{float:left;width:52px;}.qmEdMap_searchPlaceholder{position:absolute;top:4px;*top:5px;left:6px;color:#999;cursor:text;}.qmEdMap_bg{height:126px;margin-top:80px;background-image:url($js_path$qqmaileditor/images/editor_map.png);background-repeat:no-repeat;background-position:130px 0;}.qmEdMap_resultTitle{position:relative;border-top:1px solid #ddd;}.qmEdMap_resultTitleText{position:absolute;left:50%;top:-9px;width:100px;margin-left:-50px;line-height:normal;text-align:center;color:#c4c4c4;background:#fff;}.qmEdMap_resultList{position:relative;height:317px;margin:10px 0 8px;overflow-x:hidden;overflow-y:auto;}.qmEdMap_resultList .itemSplit{position:absolute;left:0;width:100%;height:10px;line-height:0;background:#fff;}.qmEdMap_resultList .itemSplit_Top{top:0;}.qmEdMap_resultList .itemSplit_Bottom{bottom:0;}.qmEdMap_resultItem a{display:block;padding:5px 20px 4px;line-height:20px;border-bottom:1px solid #eaeaea;_width:411px;}.qmEdMap_resultItem a:hover{background:#f0f1f1;text-decoration:none;}.qmEdMap_resultItem .title,.qmEdMap_resultItem .text{display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-o-text-overflow:ellipsis;word-break:break-all;color:#a4a4a4;_width:411px;}.qmEdMap_resultItem .title{color:#000;}.qmEdMap_resultLocation{padding:20px 20px 0;overflow:hidden;}.qmEdMap_resultMap{position:relative;height:250px;border:1px solid #b0b0b0;overflow:hidden;}.qmEdMap_resultMapList{position:absolute;left:0;width:100%;}.qmEdMap_resultMapControl{width:16px;height:33px;margin:11px 0 0 13px;background-color:#fff;border:1px solid #d7d7d7;border-color:rgba(0,0,0,.2);border-radius:2px;}.qmEdMap_resultMapControl_btn{display:block;height:16px;background:url($js_path$qqmaileditor/images/common.png) no-repeat -48px 0;}.qmEdMap_resultMapControl_btn:hover{text-decoration:none;}.qmEdMap_resultMapControl_btn_Increase{border-bottom:1px solid #ccc;}.qmEdMap_resultMapControl_btn_Decrease{background-position:-64px 0;}.qmEdMap_resultItem_MapWrap{position:relative;}.qmEdMap_resultItem_MapWrap .mask{position:absolute;top:0;left:0;bottom:0;right:0;width:100%;_height:204px;background:#000;opacity:.9;-moz-opacity:.9;filter:Alpha(Opacity=90);-ms-filter:alpha(opacity=90);}.qmEdMap_resultItem_MapWrap .listWrap{position:relative;height:204px;overflow-x:hidden;overflow-y:auto;}.qmEdMap_resultItem_MapWrap .listWrap::-webkit-scrollbar{width:15px;}.qmEdMap_resultItem_MapWrap .listWrap::-webkit-scrollbar-button{width:0;height:0;display:none}.qmEdMap_resultItem_MapWrap .listWrap::-webkit-scrollbar-corner{background-color:transparent;}.qmEdMap_resultItem_MapWrap .listWrap::-webkit-scrollbar-thumb{background-color:#7b7b7b;border-radius:10px;border:3px solid #494949;border-top-width:2px;border-bottom-width:2px;}.qmEdMap_resultItem_MapWrap .listWrap::-webkit-scrollbar-thumb:hover{background-color:#a3a3a3;border-radius:10px;}.qmEdMap_resultItem_MapWrap .listWrap::-webkit-scrollbar-track{background-color:#494949;}.qmEdMap_resultItem_Map a{padding:4px 10px;line-height:16px;border-color:#505050;_width:390px;}.qmEdMap_resultItem_Map a:hover{background:#505050;}.qmEdMap_resultItem_Map .more{float:right;position:relative;width:50px;height:36px;border-left:1px solid #505050;padding-left:0;padding-right:0;}.qmEdMap_resultItem_Map .trangle{position:absolute;top:20px;left:18px;display:block;content:" ";width:0;line-height:0;font-size:0;border-style:solid;border-color:transparent;border-width:6px;_border-color:red;_filter:chroma(color=red);}.qmEdMap_resultItem_Map .trangle_top{border-top:0;border-bottom-color:#fff;_border-bottom-color:#fff;}.qmEdMap_resultItem_Map .trangle_down{border-bottom:0;border-top-color:#fff;_border-top-color:#fff;}.qmEdMap_resultItem_Map .now{background:none!important;cursor:default;overflow:hidden;_float:left;}.qmEdMap_resultItem_Map .now .text{color:#a4a4a4;}.qmEdMap_resultItem_Map .text,.qmEdMap_resultItem_Map .title{_width:390px;}.qmEdMap_resultItem_Map .title{color:#fff;}.qmEdMap_resultItem_MapWrap_Curr .mask{_height:46px;opacity:.8;-moz-opacity:.8;filter:Alpha(Opacity=80);-ms-filter:alpha(opacity=80);}.qmEdMap_resultItem_MapWrap_Curr ul{position:relative;_height:46px;_overflow:hidden;}.qmEdMap_resultItem_MapWrap_Curr .qmEdMap_resultItem_Map{border-top:1px solid #505050;_zoom:1;}.qmEdMap_resultItem_MapWrap_Curr a{width:354px;height:36px;padding:5px 10px 3px;line-height:18px;}.qmEdMap_resultItem_MapWrap_Curr .title,.qmEdMap_resultItem_MapWrap_Curr .text{_width:354px;}.qmEdMap_resultAddBtn{display:block;width:145px;height:30px;margin:15px auto;line-height:30px;text-align:center;background:#5d99db;border:1px solid #5293db;-moz-border-radius:3px;-khtml-border-radius:3px;-webkit-border-radius:3px;border-radius:3px;color:#fff!important;text-decoration:none!important;}.qmEdMap_resultEmpty,.qmEdMap_resultLoading{position:relative;height:335px;overflow:hidden;}.qmEdMap_resultEmptyTips{position:absolute;top:50%;margin-top:-10px;width:100%;line-height:20px;text-align:center;color:#000;}.qmEdMap_resultLoading img{position:absolute;top:50%;left:50%;margin:-16px 0 0 -16px;}.qmEdMap_iconLocation{display:inline-block;width:42px;height:34px;background-size:100% 100%;background-image:url($js_path$qqmaileditor/images/icon_location.png);background-repeat:no-repeat;_width:22px;_height:32px;_background-image:url($js_path$qqmaileditor/images/icon_location_ie6.png);}.QMEditorToolPop .qmEditorHead{color:#494949;padding:10px 10px 10px 15px;border-bottom:1px solid #bababa;text-align:left;}.editor_btn{position:relative;margin-right:14px;display:inline-block;white-space:nowrap;}.editor_btn_text{display:inline-block;padding:0 0 2px 18px;padding-top:1px\\0;*padding:2px 0 0 18px;width:auto;height:auto;}.MacOS .editor_btn_text{padding-top:1px;}.menu_bd .editor_btn_text{padding-top:0;padding-bottom:0;}.editor_btn .ico_moreupload{margin-left:3px;cursor:pointer;}.qmEditorMap{background-position:0 -691px;}.menu_item_high .qmEditorMap{background-position:0 -741px;}.qmEditorToolBarItem .qmEditorPhoto,.qmEditorToolBarItem .qmEditorScreenSnap,.qmEditorToolBarItem .qmEditorMo,.qmEditorToolBarItem .qmEditorWord{background:none;}@media only screen and (-webkit-min-device-pixel-ratio:2),only screen and (min-device-pixel-ratio:2){.menu_item_high .qmEditorMap{background-position:0 -691px;}.qmEditorToolBarItem .qmEditorPhoto,.qmEditorToolBarItem .qmEditorScreenSnap,.qmEditorToolBarItem .qmEditorMo,.qmEditorToolBarItem .qmEditorWord{background:none;}.qmEdMap_bg{background-image:-webkit-image-set(url($js_path$qqmaileditor/images/editor_map.png) 1x,url($js_path$qqmaileditor/images/editor_map_2x.png) 2x);}.qmEdMap_iconLocation{background-image:-webkit-image-set(url($js_path$qqmaileditor/images/icon_location.png) 1x,url($js_path$qqmaileditor/images/icon_location_2x.png) 2x);}.qmEdMap_resultMapControl_btn{background-image:-webkit-image-set(url($js_path$qqmaileditor/images/common.png) 1x,url($js_path$qqmaileditor/images/common_2x.png) 2x);}}.qmEdMap_resultEmpty{text-align:initial;}.qmEdMap_resultItem{text-align:initial;}.qmEdMap_body .qmEdMap_resultItem{text-align:left;}'].join("\n");function m(t){t||(t={}),this._msEditorId=t.editorId||["QMEditor",(new Date).valueOf()].join(""),this._msTbExternId=t.tbExternId||"QMEditorToolBarPlusArea",this._moTbExternObj=t.tbExternObj,this._moEditorAreaWin=t.editorAreaWin||window,this._msEditorAreaId=t.editorAreaId||"QMEditorArea",this._moEditorAreaObj=t.editorAreaObj,this._mnFixedHeight=t.height,this._moAllowCustomTag=t.customtags,this._msResPath=t.resPath||getPath("image"),this._moLanguage=t.language||m.CONST.LANGUAGE.zh_CN,this._moTemplate=m.CONST._TEMPLATE,this._msStyle=[";",t.style].join("").toLowerCase(),this._moFuncList=t.funclist||m.CONST.FUNCLIST.BASE,this._msEditMode="html",this._msEditorStatus="NotInited",this._moDefaultFontInfo={},this._moLoaddingFile={},this._moInfile={},this._mbIsOpenEditBar=t.isOpenEditBar;var e=m.CONST._FILES;for(var o in e)for(var i=e[o].split(" "),n=i.length-1;0<=n;n--)this._moInfile[i[n]]=o;this._mfOnLoad=t.onload,this._mfOnFocus=t.onfocus,this._mfOnBlur=t.onblur,this._mfOnClick=t.onclick,this._mfOnMouseDown=t.onmousedown,this._mfOnKeyDown=t.onkeydown,this._mfOnKeyUp=t.onkeyup,this._mfOnPaste=t.onpaste,this._mfOnPutContent=t.onputcontent,this._mfOnBeforeSaveRange=t.onbeforesaverange,this._mfOnUserSelectChange=t.onselectionchange,this._mfOnChangeContentType=t.onchangecontenttype,this._mfOnChangeBgMusic=t.onchangebgmusic,this._mfOnShowInstallactive=t.onshowinstallactive,this._mfOnPreview=t.onpreview,this._mfOnUploadEml=t.onuploademl,this._msPhotoActionSrc=t.photoCGI,this._moPhotoConfig=t.photoConfig,this._moParamSet=t,this._moCustomVar=t.customVar||{},this._moPrevCmdList=[],this._moResizeEditorHeightList=[]}m.prototype.appendContent=function(e){function t(t,e,o){if(!t)return!1;try{if(t.insertAdjacentHTML)t.insertAdjacentHTML(e,o);else{var i=t.ownerDocument.createRange(),n=0==e.indexOf("before"),r=-1!=e.indexOf("Begin");if(n==r)i[n?"setStartBefore":"setStartAfter"](t),t.parentNode.insertBefore(i.createContextualFragment(o),r?t:t.nextSibling);else{var a=t[n?"lastChild":"firstChild"];a?(i[n?"setStartAfter":"setStartBefore"](a),t[n?"appendChild":"insertBefore"](i.createContextualFragment(o),a)):t.innerHTML=o}}return!0}catch(s){return!1}}var o=this;if("text"==o.getContentType())o.setContent(o.getContent()+e);else{m.getTopWin();if("html"==o.getContentType()){var i=o.getContentTags("sign")[0];if(i)return t(i,"beforeBegin",e),this;var n=o.getContentObj("QQMAILSTATIONERY");if(n)return t(n,"beforeEnd",e),this;var r=o.getContentTags("includetail")[0];if(r)return t(r,"beforeBegin",e),this;o.setContent(o.getContent()+e)}else{var a=o.getContent(),s=!1,d="",l=a.replace(/<includetail>[\s\S]*<\/includetail>/g,function(t){return d+=t,""});l=l.replace(/<sign +signid=\S+? +nreadytime=\S+? *>[\s\S]*<\/sign>/,function(t){return s=!0,e+t}),s||-1==l.indexOf("QQMAILSTATIONERY")||(l=l.replace(/<\/td>[\s\S]*?$/,function(t){return s=!0,e+t})),a=s?l+d:a.replace(/<includetail>[\s\S]*<\/includetail>/,function(t){return s=!0,e+t}),s||(a+=e),o.setContent(a)}}return this},m.prototype.getEditorId=function(){return this._msEditorId},m.prototype.getPhotoActionSrc=function(){return this._msPhotoActionSrc},m.prototype.getTbExtern=function(){var t=this,e=t._moTbExternObj;return e||(t._moTbExternObj=S(t._msTbExternId,t._moEditorAreaWin))},m.prototype.getEditorArea=function(){var t=this,e=t._moEditorAreaObj;return e||(t._moEditorAreaObj=S(t._msEditorAreaId,t._moEditorAreaWin))},m.prototype.getEditorAreaWin=function(){return this._moEditorAreaWin},m.prototype.getEditorCustomVar=function(t){if(t){for(var e=t.split("."),o=this._moCustomVar,i=0,n=e.length;i<n;i++){if(!o||"object"!=typeof o||!o[e[i]])return;o=o[e[i]]}return o}return this._moCustomVar},m.prototype.setEditorCustomVar=function(t,e){for(var o=t.split("."),i=o.pop(),n=this._moCustomVar,r=0,a=o.length;r<a;r++)n&&"object"==typeof n?n=n[o[r]]:n[o[r]]={};return n[i]=e,this},m.prototype.getContentType=function(){return"text"==this._msEditMode?"text":"html"},m.prototype.adjustBodyStyle=function(t,e){try{"txt"!==this._msEditCore&&(this._moEditBody.style[t]=e)}catch(o){debug("QMEditor adjustBodyStyle err:"+o.message)}return this},m.prototype.getBodyStyle=function(t){return"txt"!==this._msEditCore?this._moEditBody.style[t]:""},m.prototype.getEditWin=function(){return this._moEditWin},m.prototype.initialize=function(t,e,o){var i=this;return!(!i.getEditorArea()||"NotInited"!=i._msEditorStatus)&&(i._msEditorStatus="Initlizing","function"==typeof evalCssNew?(evalCssNew(n,this._moEditorAreaWin.parent,"qmEditor"),evalCssNew(n,this._moEditorAreaWin,"qmEditor")):(evalCss(n,this._moEditorAreaWin.parent,"qmEditor"),evalCss(n,this._moEditorAreaWin,"qmEditor")),(/android|ipad|iphone|ipod/i.test(gsAgent)?i._initializeForTxt:i._initializeForIframe).call(i,m.getBreakLine(),o,function(){t&&i.setContent(t),"txt"!==i._msEditCore&&(i._fixHtmlContent(),i._setFixFocusEvent(),i._setFixIEBreakLineEvent(),i._setFixIEBackSpaceEvent(),i._setEditorSelectionChangeEvent()),i._setUnloadEvent(),i._setMouseEvent(),i._setKeyDownEvent(),i._setFocusEvent(),i._mbIsOpenEditBar&&(i._moEditMenuObj=new m.EditMenu({editor:i,editorAreaWin:i._moEditorAreaWin})),i._msEditorStatus="Ready",m.setEditor(i),"txt"!==i._msEditCore&&(i._initializeToolbar(),e&&i.showToolBar(!0)),"function"==typeof i._mfOnLoad&&i._moEditorAreaWin.setTimeout(function(){i._mfOnLoad.call(i)})}),!0)},m.prototype.isInitialized=function(){return"Ready"==this._msEditorStatus},m.prototype.isSelectionInObject=function(t){if(t&&"txt"!==this._msEditCore){if(this._moEditWin.getSelection){if(!((r=this._moEditWin.getSelection())&&0<r.rangeCount))return!1;var e=r.getRangeAt(0),o=this._moEditDoc.createRange();o.selectNode(t.firstChild||t);var i=1==e.compareBoundaryPoints(Range.START_TO_START,o);o.selectNode(t.lastChild||t);var n=-1==e.compareBoundaryPoints(Range.END_TO_END,o);if(!i||!n)return!1}else{(e=this._moEditDoc.body.createTextRange()).moveToElementText(t);var r,a=(r=this._moEditDoc.selection).createRange();if("Control"==r.type)for(var s=0,d=a.length;s<d;s++)if(a(s).parentNode){var l=a(s).parentNode;(a=this._moEditDoc.body.createTextRange()).moveToElementText(l);break}if(!e.inRange(a))return!1}return!0}},m.prototype.focus=function(t,e){var o=null;if("txt"===this._msEditCore)o=this._moEditBody;else switch(this._msEditMode){case"text":this._moEditorAreaWin.focus(),this._moTextBody.focus(),o=this._moTextBody;break;case"source":this._moEditorAreaWin.focus(),this._moSrceBody.focus(),o=this._moSrceBody;break;case"html":default:(o=e)||((o=this._hasDesignMode(this._moEditDoc)?this._moEditWin:this._moEditBody).focus(),!t&&""===o.innerText&&(t=1))}this._setCursorPos(o,t)},m.prototype.scrollTo=function(t){switch(this._msEditMode){case"html":this._moEditBody.scrollTop=t;break;case"text":this._moTextBody.scrollTop=t;break;case"source":this._moSrceBody.scrollTop=t}},m.prototype.showCursor=function(){try{this._moEditDoc.selection.createRange().select()}catch(t){}},m.prototype.changeContentType=function(t,e){var o=t?"text"!=t:"text"==this.getContentType();if((t=o?"html":"text")==this.getContentType())return!0;if("txt"!==this._msEditCore){if(!o&&!confirm(this._moLanguage.CHG_CONTENTTYPE))return!1;this._moEditObj.style.display=o?"block":"none",this._moTextBody.style.display=o?"none":"block",this._moSrceBody.style.display="none",o?this._syncTextContentTo("html"):this._syncHtmlContentTo("text"),this.showToolBar(o&&this.isShowToolBar(),!0),show(this.getTbExtern(),o)}return this._msEditMode=t,this.focus(0),"function"==typeof this._mfOnChangeContentType&&this._mfOnChangeContentType.call(this),!0},m.prototype.showToolBar=function(t,e){var o=this;"txt"!==o._msEditCore&&(t=null==t?!o.isShowToolBar():t,!e&&o._moToolBarObj.setAttribute("disp",t?"true":"false"),o._moToolBarObj.parentNode.style.display=t?"":"none",o._fixHeight())},m.prototype.isShowToolBar=function(){return"txt"!==this._msEditCore&&this._moToolBarObj&&"true"==this._moToolBarObj.getAttribute("disp")},m.prototype.isSupportToolBar=function(){return"txt"!==this._msEditCore},m.prototype.getBgMusicInfo=function(){return"txt"!==this._msEditCore?this._moBgMusicInfo:null},m.prototype.getContent=function(t){var e=this;return("txt"!==e._msEditCore?e._getEditContent:e._getEditContentForTxt).call(e,e._msEditMode,t)},m.prototype.getContentByHasMapWarpLink=function(t){var e;try{if("txt"===this._msEditCore)return t;var o,i=getTop();try{o=(i.getActionWin&&i.getActionWin()||i).document}catch(u){o=document}var n,r,a,s,d,l=o.createElement("div"),m=o.createElement("div"),c=i.TE(['<a href="$jump$" target="_blank" notForEdit="true" attr-hasmapwrap="1">$img$</a>']);l.style.display="none",m.style.display="none",o.body.appendChild(l),l.innerHTML=t;for(var p=(a=i.finds('img[ui-type="share_map"]',l)).length-1;-1<p;--p)r=a[p],s=i.attr(r,"jump"),d=r.parentNode,!s||!/apis\.map\.qq\.com/i.test(s)||d&&/^a$/i.test(d.tagName)&&"1"==i.attr(d,"attr-hasmapwrap")||(m.appendChild(r.cloneNode()),n=c.replace({jump:s,img:m.innerHTML}),m.innerHTML="",i.replaceHTML(r,n),!0);e=l.innerHTML,i.removeSelf(m),i.removeSelf(l)}catch(u){e=t}return e},m.prototype.getContentWidthSpellcheck=function(t){var e=this;return("txt"!==e._msEditCore?e._getEditContent:e._getEditContentForTxt).call(e,e._msEditMode,t,1)},m.prototype.getContentObj=function(t){return"txt"!==this._msEditCore?S(t,this._moEditWin):null},m.prototype.getContentTags=function(t){return"txt"!==this._msEditCore?GelTags(t,this._moEditDoc):[]},m.prototype.getDefaultFontInfo=function(){return"txt"!==this._msEditCore?this._moDefaultFontInfo:{}},m.prototype.setContent=function(t){var e=this;return("txt"!==e._msEditCore?e._setEditContent:e._setEditContentForTxt).call(e,e._msEditMode,t)},m.prototype.setBgMusicInfo=function(t,e,o){if("txt"!==this._msEditCore){var i=this._moBgMusicInfo||{},n=i.song,r=i.singer,a=i.url,s=n||t?n!=t||r!=e:o!=a;if(this._moBgMusicInfo=t||o?{song:t,singer:e,url:o}:null,!s)return;"function"==typeof this._onprivatechangebgmusic&&this._onprivatechangebgmusic(this),"function"==typeof this._mfOnChangeBgMusic&&this._mfOnChangeBgMusic.call(this)}};m.prototype.setDefaultFontInfo=function(t,e,o){return this.adjustBodyStyle("fontFamily",(this._moDefaultFontInfo.fontName=t)||"Verdana").adjustBodyStyle("fontSize",(this._moDefaultFontInfo.fontSize=e)||"14px").adjustBodyStyle("color",(this._moDefaultFontInfo.fontColor=o)||"#000")},m.prototype.hideNewMenu=function(t,e){var o=QMMenu();for(var i in o)o[i].close()},m.prototype.hideMenu=function(t,e){this._getCurMenuFuncObj()&&this._getCurMenuFuncObj()._hideMenu(t),e&&m.prototype.hideNewMenu.call(this,t,e),this._mbIsOpenEditBar&&!e&&this._moEditMenuObj.hideEditMenu()},m.prototype.addEvent=function(t,e){if("function"!=typeof e)return!1;var o=["on",t,"List"].join("");return this[o]||(this[o]=[]),this[o].push(e),!0},m.prototype.saveRange=function(){"txt"!==this._msEditCore&&("function"==typeof this._mfOnBeforeSaveRange&&this._mfOnBeforeSaveRange.call(this),this._moEditorRange=this._getRange())},m.prototype.loadRange=function(t){"txt"!==this._msEditCore&&("last"==t?this._loadLastRange():this._setRange(this._moEditorRange)&&"notclear"!=t&&this.clearRange())},m.prototype.clearRange=function(){this._moEditorRange=null},m.prototype.paste=function(){"txt"!==this._msEditCore&&this._execCmd("paste")},m.prototype.updateToolBarUI=function(e){if("txt"!==this._msEditCore){var t=function(t){E(t,function(t){t.funcObj&&t.funcName==e&&t.funcObj._updateUI()})};t(this._moToolBarInfo),t(this._moTbExternInfo)}},m.prototype.setSelection=function(t){var e=this;if(e._moEditWin.getSelection){var o=e._moEditWin.getSelection(),i=e._moEditDoc.createRange();o.removeAllRanges(),i.selectNodeContents(t),o.addRange(i)}else if(e._moEditDoc.selection){var n=e._moEditBody.createTextRange();n.moveToElementText(t),n.select()}},m.prototype.getSelectionDom=function(){var t=this;return t._moEditDoc.selection?t._moEditDoc.selection.createRange().parentElement():t._moEditWin.getSelection&&t._moEditWin.getSelection().anchorNode?"SPAN"==t._moEditWin.getSelection().anchorNode.nodeName?t._moEditWin.getSelection().anchorNode:t._moEditWin.getSelection().anchorNode.parentNode:void 0},m.prototype.getPhotoConfig=function(){return this._moPhotoConfig},m.prototype.loadLastRange=function(){return this._loadLastRange()},m.prototype.test=function(){try{return this.getEditorArea().getAttribute("QMEditorId")==this._msEditorId&&("txt"===this._msEditCore||GelTags("td",this._moEditorAreaObj)[1].firstChild==this._moEditObj)}catch(t){return!1}},m.prototype.resetFixHeight=function(){var t=this;t._moEditorAreaObj.style.height=t._mnFixedHeight,gbIsIE&&(GelTags("td",t._moEditorAreaObj)[1].style.height=t._mnFixedHeight),t._moEditObj.style.height=t._mnFixedHeight},m.prototype.setMapImgFlag=function(t){t?this._moMapImg?this._moMapImg.push(!0):this._moMapImg=[!0]:this._moMapImg&&this._moMapImg.pop()},m.prototype.hasMapImg=function(){return this._moMapImg&&0<this._moMapImg.length},m.prototype.execCmdNew=function(t,e,o){var i=this;if(i._mbIsFinish&&!i._mbIsFocus)return i.focus(),i._mbIsFocus=!0,setTimeout(function(){i.execCmdNew(t,e,o)}),!0;this.loadLastRange();var n=i._doCmd("execCommand",t,e);return n&&("function"==typeof o&&o.call(i),i._mbIsFinish&&i._doOnSelectionChange({},!0)),n},m.prototype.insertImage=function(d,l,m){var c=this,p=getTop(),t=m&&m.cmd||"InsertImage";this.execCmdNew(t,d,function(){var t,e,o=c._moEditDoc.selection,i=m&&m.bIsFromMap;o&&"Control"==o.type?(t=c.getSelectionElement(),(e=c._moEditDoc.body.createTextRange()).moveToElementText(t),e.moveEnd("character",i?0:1),e.collapse(!1),e.select()):t=(e=c._moEditWin.getSelection().getRangeAt(0)).startContainer.childNodes[e.startOffset-1];if(i){var n=c.getImgDom(t);if(n)if(m.isLoading){n.style.cssText="padding: 109px 196px 109px 197px;border: 1px solid #b0b0b0;*padding: 0;*margin: 109px 196px 109px 197px;*border: 0;",p.attr(n,"ui-type","qqmail_share_map_loading");try{(n.previousSibling&&!/^br$/i.test(n.previousSibling.tagName)||3==n.previousSibling.nodeType)&&p.insertHTML(n,"beforeBegin","<div></br></div>")}catch(s){}}else{n.height=250,n.width=425,p.attr(n,"ui-type","share_map"),p.attr(n,"stitle",m.title),p.attr(n,"center",m.center),p.attr(n,"skwd",m.searchkeyword),p.attr(n,"pos",m.pos),p.attr(n,"jump",m.sMapRedirectUrl),p.attr(n,"desc",m.detaildesc),p.attr(n,"zoom",m.zoom),n.style.cssText="border: 1px solid #b0b0b0;";try{if(p.gbIsIE){n.contentEditable=!1;for(var r=n.previousSibling||n.parentNode,a=!0;("qqmail_share_map_loading"!=p.attr(r,"ui-type")||!/img/i.test(r.tagName))&&9!=r.nodeType||(a=!1);)r=r.previousSibling||r.parentNode;!a&&p.removeSelf(r)}else n.previousSibling&&/img/i.test(n.previousSibling.tagName)&&p.removeSelf(n.previousSibling);n.nextSibling?(/^br$/i.test(n.nextSibling.tagName)&&3!=n.nextSibling.nodeType||p.insertHTML(n,"afterEnd","</br>"),n.nextSibling.nextSibling&&c._setCursorPos(n.nextSibling.nextSibling,0)):n.parentNode.nextSibling&&1==n.parentNode.nextSibling.nodeType?c._setCursorPos(n.parentNode.nextSibling,0):(p.insertHTML(n,"afterEnd","<div></br></div>"),n.nextSibling&&c._setCursorPos(n.nextSibling,0))}catch(s){}}}c.autoScaleImg(t,d),"function"==typeof l&&l.call(c,d,t),"function"==typeof c.onafterinsertimage&&c.onafterinsertimage(_asPicUrl)})},m.prototype.getImgDom=function(t){var e;return"IMG"==t.nodeName?t:(e=t.getElementsByTagName&&t.getElementsByTagName("IMG"))&&e.length&&e[0]},m.prototype.autoScaleImg=function(t,e){var o=this,c=o.getImgDom(t);if(c){var i=e.match(/originalwidth=.*&/),n=e.match(/originalheight=.*/),r=i&&i[0],a=n&&n[0],s=r&&parseInt(r.split("=")[1]),d=a&&parseInt(a.split("=")[1]),l=!!s&&!!d,m=parseInt(.8*o._moEditorAreaObj.clientWidth||960);l?(p(m,s,d),o.resizeNoScrollEditor()):addEvent(c,"load",function(){p(m),o.resizeNoScrollEditor()})}function p(t,e,o){var i=e||parseInt(c.naturalWidth||c.offsetWidth),n=o||parseInt(c.naturalHeight||c.offsetHeight),r=c.getAttribute("modifysize");if(!c.naturalWidth&&(c.naturalW=i),!c.naturalWidth&&(c.naturalH=n),r){var a=parseInt(r||100),s=parseInt(i*(a/100)),d=parseInt(n*(a/100));c.style.width=s+"px",c.style.height=d+"px"}else if(t<i){d=parseInt(t*(n/i));var l=(a=(s=t)/i)<.25,m=parseInt(60*(a-(l?0:.25))*(l?1:100/175))+-1;c.style.width=s+"px",c.style.height=d+"px",c.setAttribute("modifysize",(parseInt(100*a)||1)+"%"),c.setAttribute("diffpixels",m+"px"),c.setAttribute("scalingmode",l?"normal":"zoom")}}},m.prototype.getEditorConfig=function(t){return t?this._moParamSet[t]:this._moParamSet},m.prototype._initializeForIframe=function(t,e,o){var i=this,n=i._moTemplate,r=i._mnFixedHeight?"height:"+i._mnFixedHeight:"";i._moEditorAreaObj.innerHTML=n._FRAME_BASE.replace({border:-1!=i._msStyle.indexOf(";border:none")?"border:none;":"",style:r}),createBlankIframe(i._moEditorAreaWin,{obj:GelTags("textarea",i._moEditorAreaObj)[0].parentNode,where:"afterBegin",className:"QMEditorIfrmEditArea",scrolling:"auto",style:r,attrs:["hideFocus",isNaN(e)?"":" tabIndex="+e].join(""),header:n._FRAME_HEADER,body:n._FRAME_BODY.replace({editable:i._hasDesignMode(document)?"":"contentEditable=true",content:t}),defcss:!1,onload:function(){i._msEditCore="iframe",i._moEditObj=this,i._moEditWin=i._moEditObj.contentWindow,i._moEditDoc=i._moEditWin.document,i._moEditBody=i._moEditDoc.body,i._moSrceBody=i._moEditObj.nextSibling,i._moTextBody=i._moSrceBody.nextSibling,i._setContentEditable(),i._setAllowCustomTag(),i._fixHeight(),i._mbIsFinish=!0,o.call(i)},useCache:!1})},m.prototype._initializeForTxt=function(t,e,o){var i=this,n=(i._moTemplate,i._mnFixedHeight?"height:"+i._mnFixedHeight:"");i._moEditorAreaObj.innerHTML=i._moTemplate._FRAME_BASE.replace({editcontainer:i._moTemplate._FRAME_TXT.replace({style:n,tabIdx:e}),border:-1!=i._msStyle.indexOf(";border:none")?"border:none;":"",style:n}),i._msEditCore="txt",i._moEditObj=GelTags("td",i._moEditorAreaObj)[1].firstChild,i._moEditBody=i._moEditObj,i._setContentEditable(),o.call(i)},m.prototype._initializeToolbar=function(){if(this._moToolBarObj=GelTags("td",this._moEditorAreaObj)[0],this.getTbExtern(),this._moRichToolBarObj=this._moToolBarObj.firstChild.firstChild,this._moSrceToolBarObj=this._moRichToolBarObj.nextSibling,0<(this._moToolBarInfo=this._pasteFuncList(this._moFuncList.toolbar)).length)for(var t=this._moToolBarInfo.length-1;0<=t;t--)insertHTML(this._moRichToolBarObj,"afterBegin",this._moTemplate._TOOLBAR_ITEM),this._moToolBarInfo[t].funcArea=this._moRichToolBarObj.firstChild;if(0<(this._moTbExternInfo=this._moTbExternObj&&this._pasteFuncList(this._moFuncList.tbExtern)||[]).length)for(t=this._moTbExternInfo.length-1;0<=t;t--)insertHTML(this._moTbExternObj,"afterBegin",this._moTemplate._TBEXTERN_ITEM),this._moTbExternInfo[t].funcArea=this._moTbExternObj.firstChild;var e=this;this._moEditorAreaWin.setTimeout(function(){e._setupFunction()},100)},m.prototype._setContentEditable=function(){this._hasDesignMode(this._moEditDoc)&&(this._moEditDoc.designMode="on",this._execCmd("useCSS",!1),this._moEditorAreaWin.focus()),this._moEditorAreaObj.setAttribute("QMEditorId",this._msEditorId)},m.prototype._setAllowCustomTag=function(){var t=this._moAllowCustomTag,e=this._moEditDoc;return t&&E(t,function(t){e.createElement(t)}),this},m.prototype._pasteFuncList=function(t){var e=[];return E((t||"").replace(/\|/gi,"Separate").split(" "),function(t){t&&e.push({funcName:t})}),e},m.prototype._setupFunction=function(){var i=this,n={};function t(t,o){E(t,function(t){if(!t.funcObj){var e=t.funcName;m.FUNCLIB[e]?(t.funcObj=new m.FUNCLIB[e]({oParamSet:i._moParamSet,editor:i}),t.funcObj._setup({container:t.funcArea,uiType:o}),"Map"==e&&i.setMapFunc(t.funcObj)):n[i._moInfile[e]]=!0}})}t(this._moToolBarInfo,"icon"),t(this._moTbExternInfo,-1!=this._msStyle.indexOf(";icon:big")?"big":"text"),this._loadFile(n)},m.prototype._loadFile=function(t){for(var e in this._moLoaddingFile||(this._moLoaddingFile={}),t){var o=this._moLoaddingFile[e];(!o||2e3<now()-o)&&(loadJsFile(getPath("js")+getFullResSuffix(e)),this._moLoaddingFile[e]=now())}return this},m.prototype.loadFile=function(t,e){for(var o in this._moLoaddingFile||(this._moLoaddingFile={}),t){var i=this._moLoaddingFile[o];(!i||2e3<now()-i)&&(loadJsFile(getRes(o),!1,document,e),this._moLoaddingFile[o]=now())}return this},m.prototype._getCurMenuFuncObj=function(){return this._moCurMenuFuncObj},m.prototype.setMapFunc=function(t){this._moMapFunc=t},m.prototype.getMapFunc=function(){return this._moMapFunc},m.prototype.setMoreFunc=function(t){this._moMoreFunc=t},m.prototype.getMoreFunc=function(){return this._moMoreFunc},m.prototype._setCurMenuFuncObj=function(t){var e=this._moCurMenuFuncObj;return this._moCurMenuFuncObj=t,e},m.prototype._hasDesignMode=function(t){var e=t&&t.designMode&&t.designMode.toString().toLowerCase()||"";return("off"==e||"on"==e)&&!gbIsWebKit},m.prototype._getEditContent=function(t,e,o){switch(t){case"html":var i=this._moEditBody,n=this._moToolBarInfo&&this._moToolBarInfo.SpellCheck;if(!o&&n&&2&n._mnStatus){var r=F("spellcheckDocument",getTop()).document,a=i.innerHTML;r.body&&a!=r.body.innerHTML&&(r.body.innerHTML=a,n._removeAllSpellCheck(r),i=r.body)}return e?i.innerText||i.textContent||"":i.innerHTML;case"text":return this._moTextBody.value;case"source":return this._moSrceBody.value}return""},m.prototype._getEditContentForTxt=function(t,e){return e||"text"==t?this._moEditBody.value:(gbIsIE||gbIsOpera?textToHtml:textToHtmlForNoIE)(this._moEditBody.value)},m.prototype._setEditContent=function(t,e){switch(t){case"html":this._moEditBody.innerHTML=e||m.getBreakLine(),this._fixHtmlContent()._clearLastRange();var o=this._moToolBarInfo&&this._moToolBarInfo.SpellCheck;o&&o._setSpellCheckEvent();break;case"text":this._moTextBody.value=e;break;case"source":this._moSrceBody.value=e}return this},m.prototype._setEditContentForTxt=function(t,e){var o=htmlDecode(e.replace(/\n/gi,"").replace(/<div>[ \t]*<br>[ \t]*<\/div>/gi,"\n").replace(/<div .*?>[ \t]*<br .*?>[ \t]*<\/div>/gi,"\n").replace(/(<\/div>)|(<\/p>)|(<br\/?>)/gi,"\n").replace(/<.*?>/gi,"")).replace(/&nbsp;/gi," ").replace(/[\t ]*\n/g,"\n").replace(/\s*$/,"");this._moEditBody.value=o},m.prototype._syncHtmlContentTo=function(t){switch(t){case"text":gbIsIE||gbIsWebKit||this._setEditContent("html",htmlToText(this._getEditContent("html"))),this._setEditContent("text",this._getEditContent("html",!0));break;case"source":this._setEditContent("source",this._getEditContent("html"))}return this},m.prototype._syncTextContentTo=function(t){"html"!=t&&"source"!=t||this._setEditContent("html",(gbIsIE||gbIsOpera?textToHtml:textToHtmlForNoIE)(this._getEditContent("text"))),"source"==t&&this._syncHtmlContentTo("source")},m.prototype._setCursorPos=function(o,t){if("number"==typeof t)if(window.getSelection)if("TEXTAREA"!=o.tagName){var i=this;function e(){i._moEditWin.focus();var t=i._moEditWin.getSelection();if(!t)return!1;if(0<t.rangeCount&&t.removeAllRanges(),o instanceof window.constructor)return!1;var e=i._moEditDoc.createRange();return e.selectNode(o&&o.firstChild||o||i._moEditBody.firstChild||i._moEditBody),e.collapse(!0),t.addRange(e),!0}e()||this._moEditorAreaWin.setTimeout(e)}else o.selectionStart=t,o.selectionEnd=t;else{var n=(o.createTextRange?o:this._moEditBody).createTextRange();n.moveToElementText(o),n.moveStart("character",t),n.collapse(!0),n.select()}return this},m.prototype._isSelectionInEditArea=function(t){if("equal"!=t)return!0;var e=this._moEditDoc.body.createTextRange();e.moveToElementText("equal"==t?this._moEditBody:this._moEditorAreaObj);try{return e["equal"==t?"isEqual":"inRange"](this._moEditDoc.selection.createRange())}catch(o){return!1}},m.prototype._fixHtmlContent=function(){if("function"==typeof this._mfOnPutContent)try{this._mfOnPutContent.call(this)}catch(t){}return gbIsIE&&E(GelTags("div",this._moEditBody),function(t){var e=t.firstChild,o=e&&3==e.nodeType&&!e.nextSibling?e.nodeValue:"";1==o.length&&" "==fixNonBreakSpace(o)&&(t.innerHTML="")}),this},m.prototype._fixHeight=function(){if(gbIsIE){var t=this,e=t.getEditorArea(),o=(e.clientHeight||e.offsetHeight||+e.style.height)-(t.isShowToolBar()?t._moToolBarObj.clientHeight:0)-2;!isNaN(o)&&0<o&&(t._moEditObj.parentNode.style.height=t._moSrceBody.style.height=t._moTextBody.style.height=o+"px"),!t._mbIsSetFixHeightEvent&&(t._mbIsSetFixHeightEvent=!0)&&"function"==typeof e.attachEvent&&e.attachEvent("onpropertychange",function(){t._fixHeight()})}},m.prototype._setUnloadEvent=function(){var t=this;return addEvent(t._moEditorAreaWin,"unload",function(){m.delEditor(t._msEditorId)}),t},m.prototype._setMouseEvent=function(){var e=this,t=e._moEditDoc;return"iframe"==e._msEditCore&&(addEvent(t,"mousedown",function(){e._clearLastRange()}),addEvent(t,"mousedown",function o(){e.hideMenu(null,!0)})),"function"==typeof e._mfOnMouseDown&&addEvent("txt"===e._msEditCore?e._moEditBody:t,"mousedown",function(t){e._mfOnMouseDown.call(e,t)}),"function"==typeof e._mfOnMouseOver&&addEvent("txt"===e._msEditCore?e._moEditBody:t,"mouseover",function(t){e._mfOnMouseOver.call(e,t)}),"function"==typeof e._mfOnMouseOut&&addEvent("txt"===e._msEditCore?e._moEditBody:t,"mouseout",function(t){e._mfOnMouseOut.call(e,t)}),"function"==typeof this._mfOnClick&&addEvent("txt"===e._msEditCore?e._moEditBody:t,"click",function(t){e._mfOnClick.call(e,t)}),e},m.prototype._setClickEvent=function(){var e=this,t=e._moEditDoc;return"iframe"==e._msEditCore&&(addEvent(t,"mousedown",function(){e._clearLastRange()}),addEvent(t,"mousedown",function o(){e.hideMenu()})),"function"==typeof e._mfOnMouseDown&&addEvent("txt"===e._msEditCore?e._moEditBody:t,"mousedown",function(t){e._mfOnMouseDown.call(e,t)}),"function"==typeof this._mfOnClick&&addEvent("txt"===e._msEditCore?e._moEditBody:t,"click",function(t){e._mfOnClick.call(e,t)}),e},m.prototype._moveToAncestorNode=function(t){for(var e=this._getSelectionElement();e&&e.nodeName!=t;)e=e.parentNode;return e},m.prototype._getSelectionElement=function(){var t,e,o=this._moEditDoc.selection;if(!0!==this._mbIsFocus)return t;if(o)if(e=o.createRange(),"Control"==o.type){if(1==e.length&&1==e(0).nodeType)t=e(0);else for(var i=0,n=e.length;i<n;i++)if(e(i).parentNode){t=e(i).parentNode;break}}else t=e.parentElement();else try{(e=this._moEditWin.getSelection().getRangeAt(0)).startContainer==e.endContainer&&1==e.startContainer.nodeType&&e.startOffset==e.endOffset-1&&1!=(t=e.startContainer.childNodes[e.startOffset]).nodeType&&(t=null),t||(t=e.endContainer)}catch(r){}return t},m.prototype.getSelectionElement=function(){var t,e,o=this._moEditDoc.selection;if(!0!==this._mbIsFocus)return t;if(o)if(e=o.createRange(),"Control"==o.type){if(1==e.length&&1==e.item(0).nodeType)t=e.item(0);else for(var i=0,n=e.length;i<n;i++)if(e(i).parentNode){t=e(i).parentNode;break}}else t=e.parentElement();else try{if((e=this._moEditWin.getSelection().getRangeAt(0)).startContainer==e.endContainer&&1==e.startContainer.nodeType&&e.startOffset==e.endOffset-1&&1!=(t=e.startContainer.childNodes[e.startOffset]).nodeType&&(t=null),!t){var r=e.startContainer,a=e.endContainer;t=gbIsFF&&3==r.nodeType&&"BODY"==a.tagName?r:e.endContainer}}catch(s){}return t},m.prototype._setKeyDownEvent=function(){var e=this;return"function"==typeof e._mfOnKeyDown&&addEvent("txt"===e._msEditCore?e._moEditBody:e._moEditDoc,"keydown",function(t){e._mfOnKeyDown.call(e,t)}),"function"==typeof e._mfOnKeyUp&&addEvent("txt"===e._msEditCore?e._moEditBody:e._moEditDoc,"keyup",function(t){e._mfOnKeyUp.call(e,t)}),"function"==typeof e._mfOnPaste&&addEvent("txt"===e._msEditCore?e._moEditBody:e._moEditDoc.body,"paste",function(t){e._mfOnPaste.call(e,t)}),e},m.prototype._setFocusEvent=function(){var e=this;addEvents("txt"===e._msEditCore?e._moEditBody:e._moEditWin,{focus:function(t){e._mbIsFocus||(e._mbIsFocus=!0,e._loadLastRange(),"function"==typeof e._mfOnFocus&&e._mfOnFocus.call(e,t))},blur:function(t){e._mbIsFocus&&(e._mbIsFocus=!1,"function"==typeof e._mfOnBlur&&e._mfOnBlur.call(e,t))}});var o=0;return addEvents(e._moEditBody,{dragenter:function(t){e._mbIsFocus||(e._mbIsFocus=!0,"function"==typeof e._mfOnFocus&&e._mfOnFocus.call(e,t)),o&&(e._moEditorAreaWin.clearTimeout(o)||(o=0))},dragleave:function(t){e._mbIsFocus&&(o&&e._moEditorAreaWin.clearTimeout(o),o=e._moEditorAreaWin.setTimeout(function(){e._mbIsFocus&&(e._mbIsFocus=!1,"function"==typeof e._mfOnBlur&&e._mfOnBlur.call(e,t))},500))}}),e},m.prototype._setFixFocusEvent=function(){var i=this;gbIsIE?addEvent(i._moEditWin,"blur",function(t){try{i._moEditBody.ownerDocument.selection.empty()}catch(e){}}):addEvent(i._moEditWin,"focus",function(t){try{var e=i._moEditWin.getSelection();e.focusNode&&"HTML"==e.focusNode.tagName&&e.collapse(i._moEditBody.firstChild||i._moEditBody,0)}catch(o){m.getTopWin().doPageError(["editor focus error: ",o.message].join(""))}})},m.prototype._setFixIEBreakLineEvent=function(){var n=this;if(gbIsIE){function o(t,e,o){function i(){n._moEditBody.innerHTML="<div>&nbsp;</div>",n._fixHtmlContent().focus(0),!o&&t&&preventDefault(t)}n._isSelectionInEditArea("equal")&&("number"==typeof e?n._moEditorAreaWin.setTimeout(i,e):i())}addEvent(n._moEditBody,"keydown",function i(t){var e=t.keyCode;t.altKey||t.ctrlKey||!(48<=e&&e<=57||65<=e&&e<=90||96<=e&&e<=111||186<=e&&e<=192||219<=e&&e<=222||8==e||32==e||13==e||46==e||229==e)||o(8==e?t:null)}),addEvent(n._moEditBody,"cut",function(){o(null,0,!0)})}return n},m.prototype._setFixIEBackSpaceEvent=function(){var e=this;return gbIsIE&&addEvent(this._moEditBody,"keydown",function(t){if(e._isSelectionInEditArea()&&8==t.keyCode&&"Control"==e._moEditDoc.selection.type)return e._moEditDoc.selection.clear(),void preventDefault(t)}),e},m.prototype._setEditorSelectionChangeEvent=function(){var o=this;if(o._mbIsSetSelectionChangeEvent)throw new Error("*** can not set once again!!");o._mbIsSetSelectionChangeEvent=!0;var t=o._moEditDoc;return addEvent(t,"mouseup",function(t){o._doOnSelectionChange(t,!0)}),addEvent(t,"keyup",function(t){o._doOnSelectionChange(t,!0)}),addEvent(t,"keydown",function(t){var e=t.keyCode;t.ctrlKey&&65<=e&&e<=90&&o._doOnEvent("keydown",t)}),addEvent(t,"contextmenu",function(t){o._doOnEvent("contextmenu",t)}),addEvent(o._moEditBody,"paste",function(t){o._doOnEvent("paste",t)}),o},m.prototype._getRange=function(){if("html"!=this._msEditMode)return null;if(window.getSelection){var t=this._moEditWin.getSelection(),e=null;try{e=t?t.getRangeAt(0):null}catch(o){e=null}return e}return this._moEditDoc.selection.createRange()},m.prototype._setRange=function(t){if(!t)return!1;if(this.focus(),window.getSelection){var e=this._moEditWin.getSelection();e.removeAllRanges(),e.addRange(t)}else t.select();return!0},m.prototype._saveLastRange=function(){this._moEditorLastRange=this._getRange()},m.prototype._loadLastRange=function(){this._setRange(this._moEditorLastRange)},m.prototype._clearLastRange=function(){this._moEditorLastRange=null},m.prototype._doOnEvent=function(t,e){var o=this[["on",t,"List"].join("")],i=o&&o.length||0;if(0<i&&this._isSelectionInEditArea())for(var n=0;n<i&&!0!==o[n](e);n++);return this},m.prototype._doOnSelectionChange=function(o,t){var i=this,n=i.onselectionchangeList||[];if(i._mnOnSelectionChangeTimer&&i._moEditorAreaWin.clearTimeout(i._mnOnSelectionChangeTimer),i._isSelectionInEditArea()){function e(){i._saveLastRange();for(var t=0,e=n.length;t<e&&!0!==n[t](o);t++);"function"==typeof i._mfOnUserSelectChange&&i._mfOnUserSelectChange.call(i)}t?e():i._mnOnSelectionChangeTimer=this._moEditorAreaWin.setTimeout(function(){i._mnOnSelectionChangeTimer=null,e()},100)}return i},m.prototype._doCmd=function(t,e,o){if("html"!=this._msEditMode)return!1;"execCommand"==t&&this.focus();try{return this._moEditDoc[t](e,!1,o||!1)}catch(i){return!1}},m.prototype.execCmd=m.prototype._execCmd=function(t,e,o){var i=this._doCmd("execCommand",t,e);return i&&("function"==typeof o&&o.call(this),this._doOnSelectionChange({},!0)),i},m.prototype._queryCmdState=function(t){return this._doCmd("queryCommandState",t)},m.prototype._queryCmdEnabled=function(t){return this._doCmd("queryCommandEnabled",t)},m.prototype._queryCmdValue=function(t){return this._doCmd("queryCommandValue",t)},m.prototype.queryFormatBlockState=function(){return function o(t){for(var e=t;e&&e.parentNode;){if(e.tagName&&"BLOCKQUOTE"==e.tagName&&attr(e,"formatblock"))return!0;e.parentNode&&(e=e.parentNode)}return!1}(this._getSelectionElement())||function r(i){try{var t=gbIsIE?i.htmlText||"":function n(){var t,e=i.cloneContents(),o=e.ownerDocument.createElement("div");return o.appendChild(e),t=o.innerHTML,e=o=void 0,t}();return/<blockquote[^>]+formatblock[^>]+>.*?<\/blockquote>/gi.test(t)}catch(e){return!1}}(this._getRange())},m.prototype.getTemplate=function(){return this._moTemplate},m.prototype.getLanguage=function(){return this._moLanguage},m.prototype.getEditBody=function(){return this._moEditBody},m.prototype.getEditDoc=function(){return this._moEditDoc},m.prototype.getEditObj=function(){return this._moEditObj},m.prototype.resizeNoScrollEditor=function(t,e){var o=this,i=gbIsIE,n=i&&6===gnIEVer,r=o._moEditBody,a=o._mDefHeight||o._mnAutoRisizeMinHeight||(o._mDefHeight=r.clientHeight),s=r.scrollHeight;if(o._mbNoEditScroll&&0!=a&&a<s){var d=o._moEditorAreaObj;if(i&&t)GelTags("td",o._moEditorAreaObj)[1].style.height=s+"px",d.style.height=s+"px";else{var l=o._calEditBodyRealHeight();l<a&&(l=a),(o._mnFixedHeight||n)&&(o._moEditObj.style.height=l-5-o._moToolBarObj.offsetHeight+"px",getTop.scrollTop=l),!n&&(d.style.height=l+"px")}}},m.createEditor=function(t){return new this(t)},m.getEditorSet=function(){return this.getTopWin().gQmEditorSet||{}},m.getEditor=function(t){var e=this.getTopWin(),o=e.gQmEditorSet&&e.gQmEditorSet[t];if(o){if(o.test())return o;this.delEditor(t)}return null},m.getTopWin=function(){try{getTop().document;return getTop()}catch(t){return window}},m.setEditor=function(t){if(!this.getEditor)return!1;var e=t.getEditorId(),o=this.getTopWin();return this.delEditor(e),o.gQmEditorSet||(o.gQmEditorSet={}),o.gQmEditorSet[e]=t,!0},m.delEditor=function(t){var e=this.getTopWin();e.gQmEditorSet&&e.gQmEditorSet[t]&&delete e.gQmEditorSet[t]},m.hideEditorMenu=function(){var t=this.getEditorSet();for(var e in t)try{t[e].hideMenu()}catch(o){this.delEditor(e)}},m.getBreakLine=function(t){var e="<BR>";return gbIsIE?e="<DIV>&nbsp;</DIV>":(gbIsOpera||gbIsWebKit)&&(e="<DIV><BR></DIV>"),new Array((t||1)+1).join(e)},m.setupFunc=function(){E(this.getEditorSet(),function(t){t._setupFunction()})},(m.CONST={})._name="QMEditor_45t62ASG^TfgSDA@#!Raaf",m.CONST.LANGUAGE={},m.CONST.LANGUAGE.zh_CN={CHG_CONTENTTYPE:"\u8f6c\u6362\u5185\u5bb9\u4e3a\u7eaf\u6587\u672c\u683c\u5f0f\u6709\u53ef\u80fd\u4e22\u5931\u67d0\u4e9b\u683c\u5f0f\uff0c\u786e\u5b9a\u4f7f\u7528\u7eaf\u6587\u672c\u5417\uff1f"},m.CONST._FILES={"qqmaileditor/editor_toolbar.js":"Separate Bold Italic Underline FontName FontName FontSize ForeColor BackColor AlignMode Serial Indent Quot CreateLink SourceEdit Preview SpellCheck UploadEml FullScreen FormatMatch","qqmaileditor/editor_toolbar_plus.js":"Photo Mo ScreenSnap Word Music Map"},m.CONST.FUNCLIST={},m.CONST.FUNCLIST.BASE={toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent | CreateLink Mo Photo ScreenSnap SourceEdit",tbExtern:"Photo Word Mo ScreenSnap Map"},m.CONST.FUNCLIST.SETTING={toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent | CreateLink Mo PhotoOld ScreenSnap SourceEdit",tbExtern:"PhotoOld Word Mo ScreenSnap Map"},m.CONST.FUNCLIST.COMPOSE={toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent Quot | CreateLink FormatMatch SourceEdit Preview SpellCheck FullScreen",tbExtern:"Photo Word Mo ScreenSnap Map"},m.CONST.FUNCLIST.BIZMAIL_COMPOSE={toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent Quot | CreateLink FormatMatch SourceEdit Preview SpellCheck FullScreen",tbExtern:"Photo Mo ScreenSnap Map"},m.CONST.FUNCLIST.QF_COMPOSE={toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent Quot | CreateLink FormatMatch SourceEdit Preview UploadEml",tbExtern:""},m.CONST.FUNCLIST.GROUP={toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent Quot | CreateLink FormatMatch SourceEdit",tbExtern:"Photo Word Mo ScreenSnap Map"},m.CONST.FUNCLIST.NOTE={toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent Quot | CreateLink SourceEdit",tbExtern:"Photo Mo ScreenSnap"},m.CONST.FUNCLIST.READMAIL={toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent Quot | CreateLink SourceEdit",tbExtern:"Photo Mo ScreenSnap"},m.CONST.FUNCLIST.MO={toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent | CreateLink Mo SourceEdit"},m.CONST._TEMPLATE={_FRAME_BASE:T(['<table cellspacing=0 cellpadding=0 class="QMEditorBase" style="$border$" >','<tr style="display:none;"><td height="1%" class="QMEditorToolBar" valign="top" unselectable="on" onmousedown="return false;" >','<div class="QMEditorToolBarDiv">','<div></div><div style="display:none;"></div><div class="QMEditorBtnIcon" style="width:1px;" ></div>',"</div>","</td></tr>",'<tr><td height="99%" valign="top" unselectable="on" class="QMEditorContent">',"$editcontainer$",'<textarea class="QMEditorText" style="display:none;font-size:12px;$style$"></textarea>','<textarea class="QMEditorText" style="display:none;font-size:12px;$style$"></textarea>',"</td></tr>",'</table><div class="QMEditorBaseBd"></div>']),_FRAME_DIV:T(['<div class="QMEditorDivEditArea">$content$</div>']),_FRAME_TXT:T(['<textarea class="QMEditorText" tabindex="$tabIdx$" style="font-size:12px;$style$"></textarea>']),_FRAME_HEADER:T(["<script>","window.onerror = function() { return true; };","<\/script>","<style>","body {margin:0;overflow:auto;font:normal 14px Verdana;background:#fff;padding:2px 4px 0;cursor:text;}","body, p, font, div, li { line-height: 1.5;}","body, td, th {color:#000000;}",".i {width:100%;*width:auto;table-layout:fixed;}","pre {white-space: pre-wrap;white-space: -moz-pre-wrap;white-space: -pre-wrap;white-space: -o-pre-wrap;word-wrap: break-word;}","a img {border:none;}","a { color: -moz-hyperlinktext !important;text-decoration: -moz-anchor-decoration;}","</style>"]),_FRAME_BODY:T(['<body $editable$ aria-label="\u90ae\u4ef6\u6b63\u6587\u53ef\u7f16\u8f91\u6587\u672c">$content$</body>']),_TOOLBAR_ITEM:T(['<div class="QMEditorToolBarItem" unselectable="on" onmousedown="return false;" style="float:$floatPositon$"></div>']),_TBEXTERN_ITEM:T(['<span tabindex="-1" class="QMEditorTBExternItem"></span>']),BOTTON_ICON:T(['<div class="QMEditorBtnIcon" style="width:$width$px;margin:$margin$;$style$;overflow:hidden;" ',' unselectable="on" onmousedown="return false;" title="$title$" >','<div style="$imgstyle$">','<img src="$path$$src$" style="margin-left:$bgleft$px;margin-top:$topNum$px;" unselectable="on" onmousedown="return false;" />',"</div>","</div>"]),BOTTON_TEXT:TE(['<span tabindex="-1" style="font-size:12px;cursor:pointer;margin:$margin$;" title="$title$" unselectable="on" >','<input tabindex="-1" unselectable="on" style="background:url($path$$src$) $bgleft$px $bgup$px no-repeat;" class="qmEditorToolBarPlusIcon" />','<a tabindex="-1" style="margin:$lbMargin$;" href="javascript:;" unselectable="on" >$label$</a>',"$@$if($imgUpload$==1)$@$",'<div tabindex="-1" id="composeImgUploadDiv" style="width: 44px;height: 15px;position: absolute;top: 0;left: 0;" unselectable="on">','<div style="width:44px;height:15px;">',"</div>","</div>","$@$endif$@$","</span>","$@$if($moreBtn$==1)$@$",'<span class="ico_moreupload" opt="more"></span>',"$@$endif$@$"]),BOTTON_BIG:T(['<a unselectable="on">','<img src="$src$" align="absmiddle">$label$',"</a>"]),_MENU_BORDER:T(['<div class="QMEditorMenuBorder" style="display:none;$style$" unselectable="on" onmousedown="return false;" >$innerHTML$</div>']),_MENU_ITEM:T(['<div class="QMEditorMenuItem" param="$param$" style="$style$;" title="$title$" unselectable="on" $event$ >',"$content$","</div>"]),_MENU_ITEM_EVENT:T(['onmouseover="',"if ( this.className != 'QMEditorMenuItemDisabled' && this.className != 'QMEditorMenuItemOver' )","{","this.className = 'QMEditorMenuItemOver';","}",'" onmouseout="',"var _sClassName = this.getAttribute( 'curclass' ) || 'QMEditorMenuItem';","if ( this.className != _sClassName )","{","this.className = _sClassName","}",'" '])},window.QMEditor=m}(QMEditorAdapter),QMEditorAdapter,QMEditor.FUNCLIB={},QMEditor.CONST.getTemplate=function(){return QMEditor.CONST._TEMPLATE},QMEditor.FUNCLIB._inheritFrom=function(t,e){return t.prototype=new e,t},QMEditor.FUNCLIB._BASE=function(t){this._msId="_BASE",this._msType="label",this._mbIsSelected=!1,this._msContainerClassName="",this._moUiConfig={},this._moParamSet={}},QMEditor.FUNCLIB._BASE.prototype._setup=function(t){if(this._isSetuped())return!1;if(this._moContainer=t.container,this._msUiType=t.uiType,!this._moBindEditor||!this._moContainer)return!1;if(this._moContainer.innerHTML=this._getUI(),this._msContainerClassName&&(this._moContainer.className=this._msContainerClassName),this._msCmd||(this._msCmd=this._msId),"string"!=typeof this._msType&&(this._msType="label"),"label"!=this._msType){if("function"!=typeof this._mfOnClick){var e=this,o={btn:e._doDefaultClick,checkbox:e._doDefaultClick,menu:e._doShowMenuClick}[e._msType];"Word"==this._msCmd&&o.call(this),e._mfOnClick=function(t){e._moBindEditor._changeEditMode&&e._moBindEditor._changeEditMode("html"),o.call(this,t)}}"menu"==this._msType&&"function"!=typeof this._mfOnMenuClick&&(this._mfOnMenuClick=this._doDefaultMenuClick),"btn"==this._msType&&(this._mfOnSelectionChange=this._doDefaultSelectionChange),this._setEditorEvent("keydown"),this._setEditorEvent("selectionchange"),this._setEditorEvent("contextmenu"),this._setEditorEvent("paste"),this._setMouseOverEvent(),this._setClickEvent(),"FormatMatch"!=this._msId&&"FullScreen"!=this._msId&&"Photo"!=this._msId||this.init_()}return this._mbIsSetupOK=!0},QMEditor.FUNCLIB._BASE.prototype.getUiType=function(){return this._msUiType},QMEditor.FUNCLIB._BASE.prototype._isSetuped=function(){return this._mbIsSetupOK},QMEditor.FUNCLIB._BASE.prototype._setfDoDefaultClick=function(t){this._doDefaultClick=t},QMEditor.FUNCLIB._BASE.prototype._getUI=function(){"string"!=typeof this._msUiType&&(this._msUiType="icon");var t=this._moUiConfig[this._msUiType];if(!t)return"";var e=this._moBindEditor._moTemplate[["BOTTON_",this._msUiType.toUpperCase(),"custom"==this._msType?"_"+this._msId.toUpperCase():""].join("")];return e?(t.path||(t.path=this._moBindEditor._msResPath),t.src||(t.src="newicon/editor_new.gif"),gbIsIE||"icon"!=this._msUiType||(t.width=t.width-2),e.replace(t)):""},QMEditor.FUNCLIB._BASE.prototype._updateUI=function(){this._updateUIInfo&&(this._updateUIInfo(),this._moContainer.innerHTML=this._getUI())},QMEditor.FUNCLIB._BASE.prototype._getStatus=function(){return this._mbIsSelected},QMEditor.FUNCLIB._BASE.prototype._changeStatus=function(t){if(this._mbIsSelected=t,"icon"==this._msUiType){var e=this._moContainer.firstChild;setClass(e,e.className.replace(" qmEditorBtnIconCheck","")+(t?" qmEditorBtnIconCheck":""))}},QMEditor.FUNCLIB._BASE.prototype._setEditorEvent=function(t){var e={keydown:this._mfOnKeyDown,selectionchange:this._mfOnSelectionChange,contextmenu:this._mfOnContextMenu,paste:this._mfOnPaste}[t],o=this;return"function"==typeof e&&o._moBindEditor.addEvent(t,function(t){e.call(o,t)}),o},QMEditor.FUNCLIB._BASE.prototype._setMouseOverEvent=function(){if("icon"==this._msUiType){var t=this._moContainer;addEvent(t,"mouseover",function(){setClass(t.firstChild,t.firstChild.className.replace(" qmEditorBtnIconOver","")+" qmEditorBtnIconOver")}),addEvent(t,"mouseout",function(){setClass(t.firstChild,t.firstChild.className.replace(" qmEditorBtnIconOver",""))})}return this},QMEditor.FUNCLIB._BASE.prototype._setClickEvent=function(){var i=this;return"function"==typeof i._mfOnClick&&(i._moContainer.onclick=function(t){t=t||i._moBindEditor._moEditorAreaWin.event,i._mfOnClick.call(i,t),preventDefault(t),stopPropagation(t);try{var e=getTop().addrHint;e&&"function"==typeof e.closeHint&&e.closeHint()}catch(o){}},!0)},QMEditor.FUNCLIB._BASE.prototype._createMenu=function(){if(this._moBindMenu)return!1;var t=this._moBindEditor._moEditorAreaWin.document.body;return insertHTML(t,"afterBegin",this._moBindEditor._moTemplate._MENU_BORDER.replace({innerHTML:this._getMenuUI()})),this._moBindMenu=t.firstChild,this._initMenuElements(),this._setMenuClickEvent(),!0},QMEditor.FUNCLIB._BASE.prototype._getMenuUI=function(){for(var t=this._moBindEditor,e=t._moTemplate[this._msTmplName||"MENU_"+this._msId.toUpperCase()]||t._moTemplate._MENU_ITEM,o=[],i=0,n=(this._moMenuData||[]).length;i<n;i++){var r=this._moMenuData[i],a=r._moTemplate||e;r.event=r.event||t._moTemplate._MENU_ITEM_EVENT,r.path=r.path||t._msResPath,r.src=r.src||"newicon/editor.gif",o.push(a.replace(r)),(r.param||r.cmd)&&(this._moParamSet[(r.param||r.cmd).toUpperCase()]=r)}return o.join("")},QMEditor.FUNCLIB._BASE.prototype._initMenuElements=function(){},QMEditor.FUNCLIB._BASE.prototype._setMenuClickEvent=function(){var e=this;return"function"==typeof e._mfOnMenuClick&&(e._moBindMenu.onclick=function(t){t=t||e._moBindEditor._moEditorAreaWin.event,e._mfOnMenuClick.call(e,t)||preventDefault(t),stopPropagation(t)},!0)},QMEditor.FUNCLIB._BASE.prototype._adjustMenuPos=function(){var t=calcPos(this._moContainer),e=t[2],o=t[3];"text"==this._msUiType&&(e+=1);var i=this._moBindMenu,n=i.ownerDocument.body,r=i.offsetWidth,a=i.offsetHeight,s=n.clientWidth+n.scrollLeft,d=n.clientHeight+n.scrollTop;d<e+a&&(e=d-a),s<o+r&&(o=s-r),i.style.top=(e<0?0:e)+"px",i.style.left=(o<0?0:o)+"px"},QMEditor.FUNCLIB._BASE.prototype._showMenu=function(t){if(!this._moBindMenu)return!1;var e=this._moBindEditor._getCurMenuFuncObj();return e==this||(e&&e._hideMenu(t),this._moBindEditor._setCurMenuFuncObj(this),this._mbIsSaveRange&&this._moBindEditor.saveRange(),this._changeStatus(!0),show(this._moBindMenu,!0),this._adjustMenuPos(),"function"==typeof this._mfOnShowMenu&&this._mfOnShowMenu()),!0},QMEditor.FUNCLIB._BASE.prototype._hideMenu=function(t){return!!this._moBindMenu&&(this._moBindEditor._getCurMenuFuncObj()==this&&this._moBindEditor._setCurMenuFuncObj(null),isShow(this._moBindMenu)&&show(this._moBindMenu,!1),this._mbIsSaveRange&&t&&this._moBindEditor.loadRange(),this._changeStatus(!1),this._afterHideMenu(),!0)},QMEditor.FUNCLIB._BASE.prototype._afterHideMenu=function(){},QMEditor.FUNCLIB._BASE.prototype._doDefaultClick=function(t){this._moBindEditor._execCmd(this._msCmd),this._moBindEditor.hideMenu()},QMEditor.FUNCLIB._BASE.prototype._doDefaultSelectionChange=function(t){var e=this._moBindEditor;e._queryCmdEnabled(this._msCmd)&&this._changeStatus(e._queryCmdState(this._msCmd))},QMEditor.FUNCLIB._BASE.prototype._doShowMenuClick=function(t){this._moBindMenu||this._createMenu(),"Word"!=this._msCmd&&(this._getStatus()?this._hideMenu(!0):(this._showMenu(!0),getTop().LogKvEx({businame:"common_stat",item:"webmail|menu|emoji|click",sid:getTop().getSid()})))},QMEditor.FUNCLIB._BASE.prototype._doDefaultMenuClick=function(t){var e=t.target||t.srcElement,o=e&&e.getAttribute("cmd"),i=e&&e.getAttribute("param");(i||o)&&(this._moBindEditor._execCmd(o||this._msCmd,i),this._hideMenu())},QMEditor.FUNCLIB._BASE.prototype.setCmd=function(t){this._msCmd=t},QMEditor.FUNCLIB._BASE.prototype.getCmd=function(){return this._msCmd},QMEditor.FUNCLIB._BASE.prototype.setBindEditor=function(t){this._moBindEditor=t},QMEditor.FUNCLIB._BASE.prototype.getBindEditor=function(){return this._moBindEditor},QMEditor.FUNCLIB._BASE.prototype.getContainer=function(){return this._moContainer},QMEditor.FUNCLIB._BASE.prototype.setId=function(t){this._msId=t},QMEditor.FUNCLIB._BASE.prototype.getId=function(){return this._msId},QMEditor.FUNCLIB._BASE.prototype.setType=function(t){this._msType=t},QMEditor.FUNCLIB._BASE.prototype.getType=function(){return this._msType},QMEditor.FUNCLIB._BASE.prototype.setUiConfig=function(t){this._moUiConfig=t},QMEditor.FUNCLIB._BASE.prototype.getUiConfig=function(){return this._moUiConfig},QMEditor.FUNCLIB._BASE.prototype.setfOnClick=function(t){this._mfOnClick=t},QMEditor.FUNCLIB._BASE.prototype.setfDoDefaultClick=function(t){this._doDefaultClick=t},QMEditor.FUNCLIB._BASE.prototype.setContainerClassName=function(t){this._msContainerClassName=t},QMEditor.FUNCLIB._BASE.prototype.setFuncConfig=function(t){this._moFuncConfig=t},QMEditor.FUNCLIB._BASE.prototype.getFuncConfig=function(t){return this._moFuncConfig},QMEditorAdapter,QMEditor.EditMenu=function(t){this.init(t)},QMEditor.EditMenu._TEMPLATE={_EDIT_MENU_CONTAINER:'<div unselectable="on" onclick="getTop().stopPropagation(event);" id="QMEditorMenuBar" class="menubarbg editormenubar" style="display:none;z-index:120;"></div>',_IMG_MENU_CONTENT:TE(['<a func="zoom1_1" class="menubarbg imgzoomoriginal" title="\u539f\u59cb\u5927\u5c0f" unselectable="on"></a>','<a func="zoomout" class="menubarbg imgzoomout" title="\u7f29\u5c0f" href="javascript:;" unselectable="on" onclick="getTop().preventDefault(event);"></a>','<span class="menubarbg imgzoombar" unselectable="on"><a id="zoomhandle" func="drag" class="menubarbg zoomhandle" title="$size$" unselectable="on" style="left:$pixels$"></a></span>','<a func="zoomin" class="menubarbg imgzoomin" title="\u653e\u5927" href="javascript:;" unselectable="on" onclick="getTop().preventDefault(event);"></a>','<span class="menubarbg menubarspl" unselectable="on"></span>','<a func="del" unselectable="on" class="menubarbg menubarremove" title="\u5220\u9664\u56fe\u7247" href="javascript:;" onclick="getTop().preventDefault(event);"></a>']),_IMG_MENU_BAR_IMG:TE(['<span id="QMEditorIMGMenu">$imgcontent$</span>']),_IMG_MENU_BAR_LINK:TE(['<span class="menubarbg menubariconlink" unselectable="on"></span>','<span id="QMEditMenuCommon" class="linkcommon" unselectable="on">','<a class="menubarlink" id="QMEditMenuLink" href="$link$" unselectable="on" target="blank">$link$</a>','<span class="menubarbg menubarspl" unselectable="on"></span>','<a href="javascript:;" func="modify" class="menubarbg linkmodify" title="\u4fee\u6539\u94fe\u63a5" unselectable="on"></a>','<span class="menubarbg menubarspl" unselectable="on"></span>','<a func="unlink" unselectable="on" class="menubarbg menubarremove" title="\u6e05\u9664\u94fe\u63a5" unselectable="on"></a>',"</span>",'<span id="QMEditMenuModify" class="linkedit" style="display:none;" unselectable="on">','<input type="text" id="QMEditMenuInput" class="menubarinput"/>','<span class="menubarbg menubarspl" unselectable="on"></span>','<a func="save" class="menubarbg menubarfinish" title="\u786e\u5b9a" unselectable="on"></a>',"</span>"]),_IMG_MENU_BAR_IMG_MAP:TE(['<span id="QMEditorIMGMenu">','<a href="javascript:;" func="editmap" class="menubarbg linkmodify" title="\u7f16\u8f91" unselectable="on" src="$img_map$"></a>','<span class="menubarbg menubarspl" unselectable="on"></span>','<a href="javascript:;" func="jumptomap" class="menubarbg menubarpreview" title="\u9884\u89c8" unselectable="on" src="$img_map$"></a>','<span class="menubarbg menubarspl" unselectable="on"></span>','<a href="javascript:;" func="del" class="menubarbg menubarremove" title="\u5220\u9664\u56fe\u7247" unselectable="on"></a>',"</span>"]),_IMG_MENU_BAR:TE(['<a func="showimg" class="menubarbg menubariconimg" title="\u7f16\u8f91\u56fe\u7247"></a>','<span class="menubarbg menubarspl"></span>','<a func="showlink" class="menubarbg menubariconlink2" title="\u7f16\u8f91\u94fe\u63a5"></a>'])},QMEditor.EditMenu.prototype.init=function(t){var i,n=this;n._moBindEditor=t.editor,n._moBindEditAreaWin=i=t.editorAreaWin,n._moCurrentEditObj=null,insertHTML(i.document.body,"afterBegin",QMEditor.EditMenu._TEMPLATE._EDIT_MENU_CONTAINER),n._moEditMenuBar=S("QMEditorMenuBar",i),n._setMouseDownEvent(),i.setInterval(function(){var t=n._moBindEditor._getSelectionElement(),e=n._moEditMenuBar;if(!isShow(S("QMEditMenuModify",i))){var o=n._checkEditMenuType(t);if(o&&""!=o.sHtml){if(n._moCurrentEditObj==o.oEditObj)return;e.innerHTML=o.sHtml,n._moCurrentEditObj=o.oEditObj,isShow(e)?show(e,!0):n._adjustEditMenuPos(o.oEditObj)}else show(e,!1),n._moCurrentEditObj=null}},500)},QMEditor.EditMenu.prototype._setMouseDownEvent=function(){var f=this,g=f._moBindEditAreaWin,b=f._moEditMenuBar,M=f._moBindEditor,y=QMEditor.EditMenu._TEMPLATE;return addEvent("txt"===M._msEditCore?M._moEditBody:M._moEditDoc,"mousedown",function(t){f.showEditMenu(t)}),addEvent(b,"mousedown",function(t){var e=S("QMEditMenuInput",g);if(h=getEventTarget(t)){var o=attr(h,"func");switch(o){case"del":M._execCmd("Delete"),show(b,!1);break;case"unlink":if(!gbIsIE){var i=M._moEditWin.getSelection(),n=M._moEditDoc.createRange();gbIsOpera&&"IMG"==f._moCurrentEditObj.nodeName?(n.selectNode(f._moCurrentEditObj),i.removeAllRanges(),i.addRange(n)):"A"==f._moCurrentEditObj.nodeName&&(n.selectNode(M._moveToAncestorNode("A")),i.removeAllRanges(),i.addRange(n))}show(b,!1),M._execCmd("Unlink");break;case"modify":var r=S("QMEditMenuLink",g),a=S("QMEditMenuCommon",g),s=S("QMEditMenuModify",g);show(a,!1),show(s,!0),M.saveRange(),e.value=r.href,e.focus();break;case"save":r=S("QMEditMenuLink",g),a=S("QMEditMenuCommon",g),s=S("QMEditMenuModify",g);var d=e.value,l="A"==(m=f._moCurrentEditObj).nodeName?m:m.parentNode;d=/[a-zA-Z_0-9.-]+@[a-zA-Z_0-9.-]+\.\w+/.test(d)?0==trim(d).toLowerCase().indexOf("mailto")?d:"mailto:"+d:-1==trim(d).indexOf("://")?"http://"+d:d,l.href=r.href=r.innerHTML=d,M.loadRange(),show(a,!0),show(s,!1);break;case"close":show(b,!1);break;case"showimg":b.innerHTML=y._IMG_MENU_BAR_IMG.replace({imgcontent:f._getImgMenuContent(f._moCurrentEditObj,y)});break;case"showlink":var m;l="A"==(m=f._moCurrentEditObj).nodeName?m:m.parentNode,b.innerHTML=y._IMG_MENU_BAR_LINK.replace({link:l.href});break;case"drag":var c=t.clientX,p=g.document,u=function(){removeEvent(p,"mousemove",_),removeEvent(p,"mouseup",u),callBack.call(f,f._fView,[h,t,o,parseInt(h.style.left)])},_=function(t){var e=parseInt(h.style.left)+(t.clientX-c),o=!1;(e<-5||65<e)&&(o=!0),e<=-1?e=-1:59<=e&&(e=59),h.style.left=e+"px",c=t.clientX,o&&u()};addEvents(p,{mousemove:_,mouseup:u});break;case"editmap":var h;if(preventDefault(t),(h=f._moCurrentEditObj)&&"share_map"==attr(h,"ui-type")){var E=M.getMapFunc();E._doDefaultClick.call(E,{searchKeyword:getTop().htmlEncode(attr(h,"skwd")||""),title:attr(h,"stitle")||"",center:getTop().htmlEncode(attr(h,"center")||""),pos:getTop().htmlEncode(attr(h,"pos")||""),zoom:parseInt(getTop().htmlEncode(attr(h,"zoom"))||15),posDesc:getTop().htmlEncode(attr(h,"desc")||"")})}break;case"jumptomap":preventDefault(t),window.open(attr(h,"src"),"_blank");break;default:callBack.call(f,f._fView,[h,t,o])}}isShow(e)||(getTop().preventDefault(t),getTop().stopPropagation(t))}),f},QMEditor.EditMenu.prototype._checkEditMenuType=function(t,e){var o=this._moBindEditor,i=null,n=null,r=!0,a=0,s="",d=QMEditor.EditMenu._TEMPLATE,l={1:d._IMG_MENU_BAR_LINK,2:d._IMG_MENU_BAR_IMG,3:d._IMG_MENU_BAR,4:d._IMG_MENU_BAR_IMG_MAP};if(!t)return{sHtml:"",oEditObj:null};if("A"==t.nodeName?i=t:t.parentNode&&"A"==t.parentNode.nodeName&&"share_map"!=attr(t,"ui-type")?i=t.parentNode:"DIV"==t.nodeName&&t.firstChild&&t.firstChild==t.lastChild&&"A"==t.firstChild.nodeName&&(i=t.firstChild),i&&"spellcheck"!=i.name&&(a=1,n=i),!e&&(r=gbIsIE?"None"!=o._moEditDoc.selection.type:!o._moEditWin.getSelection().getRangeAt(0).collapsed),r&&t&&"IMG"==t.nodeName&&!t.src.match(/soso/))a+=2,n=t;else if(r&&!gbIsIE&&1==a){var m=t.getElementsByTagName&&t.getElementsByTagName("IMG");(t=m&&m.length&&m[0])&&"IMG"==t.nodeName&&!t.src.match(/soso/)&&(a+=2,n=t)}return 2==a&&"share_map"==getTop().attr(t,"ui-type")&&(a=4),(2==a||3==a)&&(s=this._getImgMenuContent(n,d)),{sHtml:l[a]?l[a].replace({link:i&&i.href||"",images_path:o._msResPath,imgcontent:s,img_map:getTop().attr(n,"jump")}):"",oEditObj:n}},QMEditor.EditMenu.prototype._getImgMenuContent=function(t,e){return e._IMG_MENU_CONTENT.replace({size:t.getAttribute("modifysize")||"100%",pixels:t.getAttribute("diffpixels")||"25px"})},QMEditor.EditMenu.prototype._adjustEditMenuPos=function(t){var e,o=this._moBindEditor,i=this._moBindEditAreaWin,n=this._moEditMenuBar,r=calcPos(o._moEditorAreaObj),a=r[0],s=r[3],d=r[2],l=getTop().document.body.clientHeight,m=bodyScroll(i,"scrollTop"),c=bodyScroll(o._moEditWin,"scrollTop"),p=a,u=s,_=t.getElementsByTagName("IMG");if(0<_.length&&(t=_[0]),a+=(r=calcPos(t))[2]+3,s+=r[3],a-=c,o.isShowToolBar()){var h=o._moToolBarObj.offsetHeight;a+=h,d+=h,p+=h}d<(e=a)&&(a=d),l-95<a-m&&(a=r[2]-c>t.offsetHeight+20?e-(t.offsetHeight+35):e-(r[2]-c+10)),"IMG"==t.nodeName&&(a=e-t.offsetHeight),n.style.top=(a<p?p:a)+"px",n.style.left=(s<u?u:s)+"px",setTimeout(function(){show(n,!0)},100)},QMEditor.EditMenu.prototype._fView=function(t,e,o,i){var n=this._moCurrentEditObj,r=S("zoomhandle",this._moBindEditAreaWin);if(o&&o.match(/zoom/)||i){var a={25:"-1px",50:"8px",75:"16px",100:"25px",125:"33px",150:"42px",175:"51px",200:"59px"},s="";_nWidth=n.naturalWidth||n.naturalW,_nHeight=n.naturalHeight||n.naturalH,_nSize=parseInt(n.getAttribute("modifysize")||100),_nRemainder=_nSize%25,!_nWidth&&(_nWidth=n.naturalW=n.offsetWidth),!_nHeight&&(_nHeight=n.naturalH=n.offsetHeight),"zoomin"==o?(0<_nRemainder?_nSize+=25-_nRemainder:_nSize+=25,200<_nSize&&(_nSize=200)):"zoomout"==o?(0<_nRemainder?_nSize-=_nRemainder:_nSize-=25,_nSize<25&&(_nSize=25)):"zoom1_1"==o?_nSize=100:i&&(_nSize=parseInt((i+1)/60*175)+25,s=i+"px"),r.setAttribute("title",_nSize+"%"),r.style.left=a[_nSize]||s,n.style.width=parseInt(parseInt(_nWidth)*(_nSize/100))+"px",n.style.height=parseInt(parseInt(_nHeight)*(_nSize/100))+"px",n.setAttribute("modifysize",_nSize+"%"),n.setAttribute("diffpixels",a[_nSize]||s),this._adjustEditMenuPos(n)}},QMEditor.EditMenu.prototype.hideEditMenu=function(){show(this._moEditMenuBar,!1)},QMEditor.EditMenu.prototype.showEditMenu=function(t){var e,o=this,i=o._moBindEditor,n="txt"===i._msEditCore?i._moEditBody:i._moEditDoc,r=(n.body&&n.body,o._moEditMenuBar),a=getEventTarget(t);if(r&&(a.nodeName.match(/IMG|A/)&&(e=o._checkEditMenuType(a,!0)),e&&""!=e.sHtml)){var s="A"==a.parentNode.nodeName?a.parentNode:a;if(r.innerHTML=e.sHtml,o._moCurrentEditObj=e.oEditObj,o._adjustEditMenuPos(s),gbIsChrome||gbIsSafari){var d=i._moEditWin.getSelection(),l=i._moEditDoc.createRange();l.selectNode(s),d.removeAllRanges(),d.addRange(l)}}},QMEditorAdapter,QMEditor.prototype.isUsedFSEditor=function(){if(this.getEditorCustomVar)return this.getEditorCustomVar("FullScreenToolbar.bUseFullEdtior")},QMEditor.prototype.getCurrentEditor=function(){return this.isUsedFSEditor()?this.getEditorCustomVar("FullScreenToolbar.oFullEditor"):"__FullScreenEditor__"==this.getEditorId()&&this.getEditorCustomVar("FullScreenToolbar.oSrcEditor")||this},void QMEditorAdapter;