var goCompose={oQmSender:null,_bIsUserSave:!1,_oAutoSaveTimer:null,_bIsSkinSubject:!1,_bIsAlarmedBigAttach:!1,_bIsSkinNoAttach:!1,_bIsAlarmNickName:!1,_bIsAlarmedDomainAddr:!1,_oErrCheckTimer:null,_oDomainChecker:null,_oSecretChecker:null},_oTop=getTop();function loadAddress(){getTop().waitFor(function(){return getTop().QMAddress&&getTop().QMLinkman},function(e){e&&getTop().QMAddress.initAddress(showQuickAddr)},100,3e4)}function initComposeForPage(e,t){var i=getTop();if(!getPageId()){if(!goCompose._oErrCheckTimer){var o="";goCompose._oErrCheckTimer=setTimeout(function(){o=i.QMEditor?i.QMEditor.isInitialized?"inited":"noInited":"noEditor",i.ossLog("delay","all","stat=nothing&locval=editorErr,"+o+","+e)},2e4)}if(!i.QMEditor&&!t.nowait){i.loadJsFileToTop(i.getPath("js"),[i.getFullResSuffix("qqmaileditor/editor.js")]);var n=arguments,a=this;return setTimeout(function(){n.callee.apply(a,n)},50)}arguments.callee.pageId=e,arguments.callee.pageConfig=t;var r={compose:_initEditorForComposePage,group:_initEditorForGroupPage,groupsms:_initEditorForGroupSmsPage,card:_initEditorForCardPage,voice:_initEditorForVoicePage,postcard:_initForPostcardPage,qq:_initEditorForQQPage,readmailGroup:_initEditorForReadMailGroupPage,note:_initEditorForNotePage,noteFirstPage:_initEditorForNoteFirstPage,remind:_initForRemindPage,readmailConv:_initForReadmailConv,qfcompose:_initEditorForQfCompose}[e];r&&r(e,t||{}),i.addEvent(window,"unload",function(){i.cancelDoSend(),i.QMDialog("composeExitAlert","close")}),loadAddress(),i.setKeepAlive(window),"1"==i.gbBackGroundSend&&i.loadJsFileToTop(i.getPath("js"),[i.getFullResSuffix("backsend.js")]),QMAttach._isSupportActiveXDrag()||QMAttach._isSupportHTML5Drag()?QMAttach._initDragAndDropTrap():(getTop().gbIsIE||getTop().QMAXInfo.mbAblePlugin&&!getTop().gbIsOpera)&&QMAttach._initDragAndDropTrap(!0)}}function _getCombineFiles(e,t){for(var i=["self","attach"],o=0;o<i.length;o++){var n=i[o];if(e[n]&&getTop().QMDialog("ftnupload_"+n)){for(var a in e[n].moFile)t.moFile[a]=e[n].moFile[a],t.moFile[a].listType=n;t.mnUploaderCount+=e[n].mnUploaderCount||0}}}function _closeDlg(){for(var e=["self","attach"],t=0;t<e.length;t++)try{getTop().QMDialog("ftnupload_"+e[t]).close()}catch(i){}}function _getUncomplete(e){var t=0;for(var i in e)t++;return t}function _removeAttach(e){var t=e||{},i=getTop();for(var o in t)i.removeSelf(i.S("BigAttach_"+o,window))}function initBigAttachFile(e,t,i){var o=arguments,n=getTop(),a=arguments.callee;if(clearTimeout(a.nAttachTimer),"remove"!=e){var r=e||"self",s=n.QMDialog("ftnupload_"+r),l=t||s&&s.getDialogWin().oMainObj,d=l&&l.getFtnBase&&l.getFtnBase()||s&&s.getDialogWin().oFtnBase,c={mnUploaderCount:0,moFile:{}};s&&s.getDialogWin().gbIsAutoSend&&(i=!0,o.length&&(o[2]=!0)),a[r]=l,_getCombineFiles(a,c),a.oUncomplete||(a.oUncomplete={});var p=c.moFile,g=86400*(d&&d.mnExpiredDay||10);for(var u in p)addExistBigAttach(p[u].uploadCompleteTime+g,p[u].downloadUrl,p[u].fileName,p[u].fileId,d&&d.constructor.getFileSize(p[u].fileSize)||p[u].uploadedSize||"0","complete"==p[u].state?100:p[u].currentPercent),a.oUncomplete[p[u].fileId]=p[u].fileId,"complete"==p[u].state&&(delete a.oUncomplete[p[u].fileId],delete p[u]);for(var m in a.oUncomplete)p[m]||(n.removeSelf(n.S("BigAttach_"+m,window)),delete a.oUncomplete[m]);0<_getUncomplete(a.oUncomplete)?a.nAttachTimer=setTimeout(function(){a.apply(null,o)},800):(_closeDlg(),i&&doFtnUploaded())}else _removeAttach(a.oUncomplete)}function _clearEditorCheckTimer(){goCompose._oErrCheckTimer&&(clearTimeout(goCompose._oErrCheckTimer),goCompose._oErrCheckTimer=null)}function _initButtonEvent(r){var s={card:"card",voice:"voice"}[getPageId()],l={note:!0}[getPageId()];function d(e,t){var i=_getSubmitForm(),o=i.sendtime,n=i.verifycode,a=i.verifycode_cn;return!o||"keeptimer"==e||n&&n.value||a&&a.value||(o.value=0),"function"==typeof r.onsend?r.onsend.call(this,r):(r.safemode&&-1==_getSubmitForm().action.indexOf("groupmail_send")&&alert("\u60a8\u5f53\u524d\u6b63\u5728\u4f7f\u7528QQ\u90ae\u7bb1\u53ea\u8bfb\u6a21\u5f0f\uff0c\u90ae\u4ef6\u80fd\u6b63\u5e38\u53d1\u9001\uff0c\u4f46\u6240\u53d1\u9001\u7684\u90ae\u4ef6\u5c06\u4e0d\u80fd\u4fdd\u5b58\u5230\u201c\u5df2\u53d1\u9001\u201d\u6587\u4ef6\u5939\u3002"),doProcess(r.t||"",s||"send",l,t)),!1}function c(e){var t=e.get("solarDate"),i=getTop().QMDialog("timeSend"),o=i&&i.S("sendtimemsg");e.get("isLunar")?o&&(o.innerHTML=getTop().TE('\u65e5\u671f\u7b49\u540c\u4e8e&nbsp;<span class="black bold">\u516c\u5386\u7684$year$\u5e74$month$\u6708$day$\u65e5</span>&nbsp;\uff0c\u5c4a\u65f6\u4e8e&nbsp;<span class="black bold">$hour$:$@$if($minute$<10)$@$0$@$endif$@$$minute$</span>&nbsp;\u6295\u9012\u3002').replace({year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),hour:t.getHours(),minute:t.getMinutes()})):o&&(o.innerHTML=getTop().T('\u672c\u90ae\u4ef6\u5c06\u5728&nbsp;<span class="black bold">$time$</span>&nbsp;\u6295\u9012\u5230\u5bf9\u65b9\u90ae\u7bb1\u3002').replace({time:getTop().QMTimeLang.formatRefer(t)})),p(t)}function p(e){getInputObj("sendtimeyear").value=e.getFullYear(),getInputObj("sendtimemonth").value=e.getMonth()+1,getInputObj("sendtimeday").value=e.getDate(),getInputObj("sendtimehour").value=e.getHours(),getInputObj("sendtimemin").value=e.getMinutes()}function e(t){return function(e){e.onclick=t}}getTop().E(getTop().SN("sendbtn",window),e(d)),getTop().E(getTop().SN("timeSendbtn",window),e(function m(t,e,i){var n=getTop();if(i=void 0===i?0:i,e||doProcessCheck("",s||"send",i,function(e){m(t,!1,e)})){n.loadJsFile(n.getPath("js")+n.getFullResSuffix("qmlunar.js"),!0),n.loadJsFile(n.getPath("js")+n.getFullResSuffix("qmdatectrl.js"),!0);var o=_getSubmitForm().sendtimetip,a=null;return new n.QMDialog({sId:"timeSend",sBodyHtml:n.T(['<div class="cnfx_content">','<div style="_zoom:1; padding-left:4px;margin-bottom:10px;">$tip$<span id="sendTimeType"></span></div>','<div id="sendTimeContainer" style="margin:6px 0 8px;font-family:Tahoma"><span style="padding-left:4px;">\u52a0\u8f7d\u4e2d...</span></div>','<div class="clr"></div>','<div class="addrtitle" id="sendtimemsg" style="margin-top:20px;padding-left:4px;"></div>',"</div>"]).replace({tip:o&&o.value||"\u9009\u62e9\u5b9a\u65f6\u53d1\u9001\u7684\u65f6\u95f4\uff1a"}),sFootHtml:['<input class="btn_blue btn_input" id="confirm" type="button" md="0" nocheck="true" initlized="true" value="\u786e\u5b9a" />','<input class="btn_gray btn_input" id="cancel" type="button" md="0" nocheck="true" initlized="true" value="\u53d6\u6d88"/>'].join(""),sTitle:"\u5b9a\u65f6\u53d1\u9001",nWidth:487,nHeight:"auto",onshow:function(){this.S("cancel").focus()},onload:function(){var t=this;n.addEvent(t.S("confirm"),"click",function(){var e=Math.floor((a.get("solarDate")-n.now())/6e4);return e<0?n.showError("\u60a8\u8bbe\u7f6e\u7684\u5b9a\u65f6\u65f6\u95f4\u5df2\u7ecf\u8fc7\u671f"):e<5?n.showError("\u60a8\u8bbe\u7f6e\u7684\u5b9a\u65f6\u65f6\u95f4\u8ddd\u79bb\u60a8\u8981\u53d1\u9001\u7684\u65f6\u95f4\u592a\u8fd1\u4e86"):(t.S("confirm").setAttribute("selected","true"),void t.close())}),n.addEvent(this.S("cancel"),"click",function(){t.close()})},onbeforeclose:function(){if("true"==this.S("confirm").getAttribute("selected"))getInputObj("sendtime").value=1,setTimeout(function(){d("keeptimer",!0)});else{var e=getPageEditor();e&&e.focus()}return!0}}),n.waitFor(function(){return n.Lunar&&n.QMDateCtrl},function(e){if(!e)return n.loadJsFile(n.getPath("js")+n.getFullResSuffix("qmlunar.js"),!0),void n.loadJsFile(n.getPath("js")+n.getFullResSuffix("qmdatectrl.js"),!0);getInputObj("sendtimeyear").value||p(new Date(n.now()+36e5));var t=n.QMDialog("timeSend"),i=t&&t.S("sendTimeType");i&&(i.innerHTML=n.T('(<input type="radio" name="dateType" id="solar_radio" checked/><label for="solar_radio">\u516c\u5386</label><input type="radio" name="dateType" id="lunar_radio"/><label for="lunar_radio">\u519c\u5386</label>)')),n.E(i.getElementsByTagName("input"),function(e){var t="lunar_radio"==e.id;e.onclick=function(){a.changeDateType(t,"sameday")}});var o=t&&t.S("sendTimeContainer");o&&(o.innerHTML=""),c(a=new n.QMDateCtrl({container:o,type:n.QMDateCtrl.LUNAR_LEAP_SUPPORT,year:{current:getInputObj("sendtimeyear").value,end:parseInt(getInputObj("sendtimeyear").value)+2},month:{current:getInputObj("sendtimemonth").value},day:{current:getInputObj("sendtimeday").value},hour:{current:getInputObj("sendtimehour").value},minute:{current:getInputObj("sendtimemin").value},onchange:function(e){c(e)}}))}),!1}})),getTop().E(getTop().SN("savebtn",window),e(function f(){return goCompose._bIsUserSave=!0,"function"==typeof r.onsave?r.onsave.call(this,r):doProcess("savedraft",s||"save",l),!1}));var o=getTop(),t=o.S("noletter",window);t&&(t.onclick=function(){var e=getPageEditor(),t=e.getContentObj("QQMAILSTATIONERY");if("html"==e.getContentType()&&t){var i=getTop().GelTags("includetail",e.getEditWin().document)[0];e.setContent(t.innerHTML+(i?i.innerHTML:"")),e.focus()}else useStationery(),this.checked=!1,e.focus()});var n=o.S("mobile_email",window);if(n){var i,a=o.getDefaultSender(),g=_getOneSender("phone","1");i=g?function(){if(n.checked)o.confirmBox({msg:o.T("<b>\u662f\u5426\u4e34\u65f6\u6539\u7528$email$\u6765\u53d1\u4fe1?</b><div class='addrtitle'>\u5bf9\u65b9\u56de\u4fe1\u5230\u6b64\u5730\u5740\uff0c\u76f8\u5e94\u624b\u673a\u4e0a\u4f1a\u7acb\u5373\u6536\u5230\u77ed\u4fe1\u63d0\u9192\u3002</div>").replace({email:g}),width:450,onreturn:function(e){e?(goCompose.oQmSender.setSenderSelected(g),o.showInfo(o.T("\u5c06\u4f7f\u7528$email$\u53d1\u4fe1\uff0c\u6b64\u5730\u5740\u6536\u5230\u90ae\u4ef6\u4f1a\u63d0\u9192\u5230\u624b\u673a\u3002").replace({email:g})),o.ossLog("delay","all","stat=nothing&locval=,,mobileemailclick,1")):n.checked=!1}});else{var e=a==g?_getOneSender("phone","0"):a;e?(goCompose.oQmSender.setSenderSelected(e),o.showInfo(o.T("\u5c06\u4f7f\u7528$email$\u53d1\u4fe1\uff0c\u907f\u514d\u6536\u5230\u624b\u673a\u53f7\u90ae\u7bb1\u7684\u77ed\u4fe1\u63d0\u9192\u3002").replace({email:e})),o.ossLog("delay","all","stat=nothing&locval=,,mobileemailclick,2")):(o.showInfo("\u60a8\u53ea\u62e5\u6709\u624b\u673a\u53f7\u90ae\u7bb1\u5e10\u53f7\uff0c\u65e0\u6cd5\u6539\u7528\u5176\u4ed6\u5e10\u53f7\u5730\u5740\u6765\u53d6\u6d88\u63d0\u9192"),n.checked=!0)}}:function(){o.ossLog("delay","all","stat=nothing&locval=,,mobileemailclick,0"),o.confirmBox({msg:"<b>\u60a8\u9700\u8981\u5148\u6ce8\u518c\u624b\u673a\u53f7\u90ae\u7bb1\uff0c\u624d\u80fd\u5f00\u542f\u6b64\u529f\u80fd\u3002</b><div class='addrtitle'>\u624b\u673a\u53f7\u90ae\u7bb1\u53ca\u9644\u5c5e\u77ed\u4fe1\u63d0\u9192\u90fd\u662f\u514d\u8d39\u7684\u3002<br>\u5f00\u901a\u540e\u5728\u4e0b\u6b21\u5199\u4fe1\u65f6\u624d\u53ef\u4f7f\u7528\u63d0\u9192\u529f\u80fd\u3002</div>",width:430,confirmBtnTxt:"\u5f00\u901a\u624b\u673a\u53f7\u90ae\u7bb1",cancelBtnTxt:"\u4e86\u89e3\u8be6\u60c5",neverBtnTxt:"\u5173\u95ed",onload:function(){this.S("cancel").onclick=function(){window.open("http://service.exmail.qq.com/cgi-bin/help?subtype=1&&id=8&&no=1000605")}},onreturn:function(e,t,i){e&&o.goNewWin(o.T("/cgi-bin/register?sid=$sid$&action=phonelist&t=phone_alias_reg1&vipfun=phone&loc=register,mail,phone,2").replace({sid:o.getSid()}),!1,!0),n.checked=!1}})},n.onclick=i,n.checked=a==g}var u=getTop().S("secmailcode",window);u&&(u.onclick=function(){u.value?(u.value="",u.checked=!1,getTop().show(getTop().S("encrypt_mail_tips",window),!1)):new o.QMDialog({sid:"encryptdlg",sTitle:"\u90ae\u4ef6\u52a0\u5bc6",sBodyHtml:o.TE(['<div class="cnfx_content" style="line-height:1.6;">','<div style="border-bottom:1px solid #E4E4E4; margin:0 0 15px; padding:0 0 15px;">\u8bbe\u7f6e\u90ae\u4ef6\u52a0\u5bc6\u4e4b\u540e\uff0c\u6536\u4ef6\u4eba\u9700\u8981\u89e3\u5bc6\u540e\u624d\u80fd\u67e5\u770b\u90ae\u4ef6\u5185\u5bb9\u3002<br/>\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b<a href="http://service.exmail.qq.com/cgi-bin/help?subtype=1&&no=1000888&&id=23" target="_blank">\u4f01\u4e1a\u90ae\u7bb1\u52a0\u5bc6\u90ae\u4ef6</a>\u3002</div>','<div style="margin-top:12px;"><label>\u8f93\u5165\u5bc6\u7801: <input class="dialog_input" type="password" id="pw1" value="" style="width:220px;margin:0;"/></label></div>','<div style="margin-top:12px;"><label>\u786e\u8ba4\u5bc6\u7801: <input class="dialog_input" type="password" id="pw2" value="" style="width:220px;margin:0;"/></label></div>',"</div>"]).replace({}),sFootHtml:['<a id="ok" class="btn_blue" initlized="true" md="0" href="javascript:;" nocheck="true">\u786e\u5b9a</a>','<a id="cancel" md="0" nocheck="true" initlized="true" class="btn_gray" href="javascript:;">\u53d6\u6d88</a>'].join(""),nHeight:"auto",nWidth:400,onclose:function(){u.value||(u.checked=!1)},onshow:function(){this.S("pw1").focus()},onload:function(){var i=this;i.S("ok").onclick=function(){var e=i.S("pw1"),t=i.S("pw2");e.value?t.value?e.value!=t.value?(e.focus(),getTop().showError("\u5bc6\u7801\u4e0d\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u786e\u8ba4")):(u.value=e.value,getTop().show(getTop().S("encrypt_mail_tips",window),!0),i.close()):(t.focus(),getTop().showError("\u8bf7\u8f93\u5165\u5bc6\u7801")):(e.focus(),getTop().showError("\u8bf7\u8f93\u5165\u5bc6\u7801"))},i.S("cancel").onclick=function(){i.close()}}})})}function _getOneSender(e,t){var i=getTop().getDefalutAllMail();for(var o in i){var n=i[o];if(n[e]==t)return n.email}}function _initEditorForQfCompose(e,t){getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,funclist:getTop().QMEditor.CONST.FUNCLIST.QF_COMPOSE,photoCGI:getTop().getPhotoCGI(),customtags:_getCustomTagList(),onload:function(){getTop(),getPageEditor();t.oMailInfo&&setComposeData(t.oMailInfo),_initButtonEvent(t),_showEditorToolBar(!0),setNeedCloseConform(!0),autoSave(!1),_setEditorPageEvent(),S("subject").focus()},onfocus:_fixStationeryFocus,onmousedown:_doEditorMouseDown,onclick:_fixStationeryClick,onbeforesaverange:_fixStationeryClick,onkeydown:_composeKeyDown,onpaste:_pasteUrlAnalyse,onputcontent:_fixBodyPadding,onchangecontenttype:_onChangeContentTypeEvent,onchangebgmusic:_changeEditorBgMusic,onshowinstallactive:showInstallActiveXDialog,onpreview:_showPreview,onuploademl:uploadComposeEml}).initialize(t.source,!1,3),_autoResizeEditor()}function _initEditorForComposePage(e,s){var t=this,i=getTop().GelTags("player",getTop().S("source",window)),l={};if(i&&0<i.length&&"cmd:bgmusic"==i[0].id.toLowerCase()){var o=i[0];l.url=o.getAttribute("url"),l.song=decodeURIComponent(o.getAttribute("song")),l.singer=decodeURIComponent(o.getAttribute("singer"))}var n=function(){var t=getTop(),e=getPageEditor(),i=_reloadSaveContent()||_setEditorSource(s,!0);isEditMeetingMail()&&Compose&&Compose.initMeetingEditHtml&&Compose.initMeetingEditHtml(),_setSaveSendCheckBox(),(l.song||l.url)&&e.setBgMusicInfo(l.song,l.singer,l.url),_initButtonEvent(s),QMAttach.initAttBigSize(s);var o,n={onproxyclose:function(){QMAttach.hideDragAndDropContainer()},onselect:function(e){QMAttach.hideDragAndDropContainer(),QMAttach._moCurUploader=e[0],QMAttach.onmgrselect(e,function(e){QMAttach.isUploading()?QMAttach._moCurUploadAttachArray=QMAttach._moCurUploadAttachArray.concat(e):(QMAttach._moCurUploadAttachArray=e,QMAttach._upload(!0))}),t.LogKvEx({businame:"common_stat",item:"webmail|menu|upload|click",sid:t.getSid()})},onprocess:function(e){var t,i=QMAttach._moCurUploadAttachInfo;i&&e.get("sId")==i._sId&&("signing"==e.get("sUploadStep")?t=.8*e.get("nSignPercent"):"creating"==e.get("sUploadStep")?t=80:"posting"!=e.get("sUploadStep")&&"waiting"!=e.get("sUploadStep")||(t=0==e.get("nPercent")?80:80+parseInt(e.get("nPercent"),10)/5),QMAttach._uploadProgress(t||0,1))},oncomplete:function(e){var t=QMAttach._moCurUploadAttachInfo;if(t&&e.get("sId")==t._sId){getTop().extend(t,e._moInfo),!t._nSize&&e.get("nSize")&&(t._nSize=e.get("nSize")),!t.sFileUrl&&e.get("sFileUrl")&&(t.sFileUrl=e.get("sFileUrl")),QMAttach._updateExistAttachInfo(t);var i=e.get("sFileId");i?(t._sUploadId=i,QMAttach._uploadProgress(100,1)._updateAttachStatus(t,"finish")._clearUploadInfo()._upload(!0),1<QMAttach._getTotalControlAttachLength()&&"http:"==location.protocol&&getTop().requestShowTip("AttachFrame",31,window)):QMAttach._uploadError("__response__",i)}},onerror:function(){QMAttach._bUseNewLogic=!0,QMAttach._uploadError("__response__")}},a=t.extend(s,{uploadCallBacks:n}),r=QMAttach.useNewDragMethod();(QMAttach.initFileUpload(a),r&&QMAttach.initFileDragUpload(a),goCompose.oQmSender=new t.QMSender({oWin:window,nCurFolderId:s.folderid,sCurSaveFrom:s.saveFrom||t.getDefaultSender(),sWidth:180,bShowNode:"parentNode",sVerAlign:"top",onclickItemCallBack:function(e){var t=getTop().S("mobile_email",window);t&&(t.checked="1"==e.phone)}}),"false"==s.encryptmail&&"800"==s.xqqstyle&&"forward"==s.subtmpl&&setTimeout(function(){getTop().fireMouseEvent(getTop().S("otherComposeOptionBtn",window),"click"),getTop().requestShowTip("savesendbox",78,window)},1e3),_showEditorToolBar(getTop().getDefaultEditor()),getTop().show(getTop().S("editor_toolbar_btn_container",window),e.isSupportToolBar()),s.pluscontent||(i||{}).isconfirm||loadValue(!0),isEditMeetingMail()?setNeedCloseConform(!1):setNeedCloseConform(!0),autoSave(!1),_setEditorPageEvent(),setMultiSignatureSelect(),setOtherComposeOptionEvent(),"function"==typeof s.onload&&s.onload(_fixStationeryFocus),!r&&QMDragFile(),t.S("tmpl_style",e.getEditWin()))?(useComposeTmpl(),t.show(t.S("signSelContainer",t.getMainWin()),!1),t.show(t.S("contenttype_check",t.getMainWin()),!1),o=-1==t.location.href.indexOf("dev.exmail.qq.com")?"'//exmail.qq.com/zh_CN/htmledition/images/compose_tmpl_bg.png'":"'//dev.exmail.qq.com/zh_CN/htmledition/images/compose_tmpl_bg.png'",e.getEditWin().document.body.style.background="url("+o+") repeat 0 0"):-1!=e.getEditWin().document.body.innerHTML.indexOf("tmpl_default")&&debug("template initialize error");t.AddrHint&&(!t.gbIsIE||t.gbIsIE&&8<t.gnIEVer)&&(t.addrHint=new t.AddrHint)};function a(){getTop().waitFor(function(){return!s.asyncGetContent||getTop().goAsyncContent},function(e){n()},500,1e4)}getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,funclist:getTop().QMEditor.CONST.FUNCLIST.COMPOSE,photoCGI:getTop().getPhotoCGI(),customtags:_getCustomTagList(),isOpenEditBar:!0,onload:function(){this._mbIsGuideMap="1"==s.bIsGuideMap||!1,t._editorOnLoader(a).apply(this,arguments)},onfocus:_fixStationeryFocus,onmousedown:_doEditorMouseDown,onclick:_fixStationeryClick,onbeforesaverange:_fixStationeryClick,onkeydown:_composeKeyDown,onkeyup:_composeKeyUp,onblur:_composeBlur,onpaste:_pasteUrlAnalyse,onputcontent:_fixBodyPadding,onchangecontenttype:_onChangeContentTypeEvent,onchangebgmusic:_changeEditorBgMusic,onshowinstallactive:showInstallActiveXDialog,onpreview:_showPreview}).initialize(s.source||outputDataLoading(),!1,3),_autoResizeEditor(),getTop().addEvent(window,"unload",function(){QMDragFile._addEvent(3,!0)})}function _initEditorForGroupPage(e,t){getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,funclist:getTop().QMEditor.CONST.FUNCLIST.GROUP,photoCGI:getTop().getPhotoCGI(),photoConfig:{widthlimit:1024,heightlimit:1024,sizelimit:1},customtags:_getCustomTagList(),isOpenEditBar:!0,onload:_editorOnLoader(function i(){getTop().waitFor(function(){return!t.asyncGetContent||getTop().goAsyncContent},function(e){!function(){var e=_reloadSaveContent(t)||_setEditorSource(t,!0);QMAttach.initHideAttach(t),_initButtonEvent(t),_showEditorToolBar(getTop().getDefaultEditor()),getTop().show(getTop().S("editor_toolbar_btn_container",window),getPageEditor().isSupportToolBar()),(e||{}).isconfirm||loadValue(!0),setNeedCloseConform(!0),_setEditorPageEvent(),"function"==typeof t.onload&&t.onload(_fixStationeryFocus),QMDragFile()}()},500,1e4)}),onfocus:_fixStationeryFocus,onmousedown:_doEditorMouseDown,onclick:_fixStationeryClick,onbeforesaverange:_fixStationeryClick,onkeydown:_composeKeyDown,onpaste:_pasteUrlAnalyse,onputcontent:_fixBodyPadding,onshowinstallactive:showInstallActiveXDialog}).initialize(t.source||outputDataLoading(),!1,5),_autoResizeEditor(),getTop().addEvent(window,"unload",function(){QMDragFile._addEvent(3,!0)})}function _initEditorForGroupSmsPage(e,t){var r=getTop(),i=r.S("QMEditorArea",window);if(i){r.QMEditor.createEditor({editorId:e,editorAreaWin:window,height:r.getStyle(i,"height"),funclist:r.QMEditor.CONST.FUNCLIST.GROUP,photoCGI:r.getPhotoCGI(),photoConfig:{widthlimit:1024,heightlimit:1024,sizelimit:1},customtags:_getCustomTagList(),onload:_editorOnLoader(function _(){_initButtonEvent(t),QMAttach.initHideAttach(t),_showEditorToolBar(!1),r.show(r.S("editor_toolbar_btn_container",window),getPageEditor().isSupportToolBar()),(d=getPageEditor()).setContent(""),o=i.getElementsByTagName("iframe")[0],n=o.contentWindow,a=n.document,s=+a[r.gbIsIE?"body":"documentElement"].scrollHeight,l=+i.getAttribute("maxHeight"),i.style.height="",r.show(r.S("smsInputHead",window),!0),r.addEvent(a.body,"click",function(e){f(e)}),QMDragFile()}),onfocus:function v(e){s=c,f(e)},onblur:function T(e){return},onmousedown:_doEditorMouseDown,onkeydown:f,onpaste:f,onshowinstallactive:showInstallActiveXDialog}).initialize(t.source||outputDataLoading(),!1,5);var o,n,a,s,l,d=null,c=(r.S("editorToolContainer",window),62);i.clientHeight;window.ajustEditor=f;var p=r.S("quickEditorContainer",window),g=r.S("fullModeLink",window),u=r.S("foldLink",window),m=r.S("expandLink",window);g&&u&&m&&(m.onclick=function(){h(p,!0,function(){r.show(m,!1);var e=new Date;e.setTime(e.getTime()+2592e7),r.setUserCookie("QUICK_EDITOR_FOLD",1,e)})},u.onclick=function(){h(p,!1,function(){r.show(m,!0);var e=new Date;e.setTime(e.getTime()+2592e7),r.setUserCookie("QUICK_EDITOR_FOLD",0,e)})},g.onclick=function(){if(d){d.getContent().toLowerCase();var e=d.getContent(!0),t=r.trim(e.replace(/&nbsp;/gi,"")),i=_getSubmitForm(),o=r.S("filecell",window),n=r.S("BigAttach",window);10<o.innerHTML.length||10<n.innerHTML.length||"vote"==i.mailtype.value?r.confirmBox({msg:['<div style="padding:5px 10px 0 5px;"><b>',"\u5207\u6362\u5230\u5b8c\u6574\u683c\u5f0f\u4f1a\u4e22\u5931\u9644\u4ef6\u548c\u6295\u7968\u6570\u636e\u3002","</b></div>",'<div style="padding:5px;">',"\u60a8\u786e\u5b9a\u7ee7\u7eed\u5207\u6362\uff1f","</div>"].join(""),width:430,onreturn:function(e){e&&a()}}):a()}function a(){t&&_createReloadInfo(),i.action="/cgi-bin/grouplist1?sid="+getTop().getSid(),i.target="mainFrame",i.t.value="compose_group",i.s.value="",i.submit()}}),getTop().addEvent(window,"unload",function(){QMDragFile._addEvent(3,!0)})}function f(t){!t||!t.ctrlKey||10!=t.keyCode&&13!=t.keyCode?setTimeout(function(){r.gbIsIE||8!=t.keyCode||(o.style.height=s+"px");var e=n.document[r.gbIsIE?"body":"documentElement"].scrollHeight;n.document.body.style.overflowY=l<e?"auto":"hidden",o.style.height=(l<e?l:e<s?s:e)+"px"},0):_composeKeyDown(t)}function h(e,t,i){getTop().qmAnimation[t?"expand":"fold"](e,{durlimit:300,type:"wait",speed:"fast",oncomplete:function(){i(),r.show(e,t)}})}}function _initEditorForCardPage(e,t){getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,funclist:getTop().QMEditor.CONST.FUNCLIST.MO,customtags:_getCustomTagList(),onmousedown:_doEditorMouseDown,onload:_editorOnLoader(function(){_setEditorSource(t,!0,1),_initButtonEvent(t),_setSaveSendCheckBox(),_showEditorToolBar(getTop().getDefaultEditor()),getTop().show(getTop().S("editor_toolbar_btn_container",window),getPageEditor().isSupportToolBar()),getTop().S("sendmailname",window).value=getTop().getDefaultSender(),_setEditorPageEvent(),"function"==typeof t.onload&&t.onload(_fixStationeryFocus)}),onkeydown:_composeKeyDown}).initialize(t.source||outputDataLoading(),!1,3)}function initCardListPage(e,t){var i=getTop();i.extend(window,t),loadAddress(),initComposeForPage.pageId="card",_initButtonEvent(initComposeForPage.pageConfig=e),_setSaveSendCheckBox();try{i.S("sendmailname",window).value=i.getDefaultSender()}catch(o){debug(["getDefaultSender error:",o.message])}}function _initEditorForVoicePage(e,t){if(getTop().S("QMEditorArea",window)){getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,funclist:getTop().QMEditor.CONST.FUNCLIST.MO,customtags:_getCustomTagList(),onload:_editorOnLoader(function(){var e=getTop();_setEditorSource(t,!0),_initButtonEvent(t),goCompose.oQmSender=new e.QMSender({nCurFolderId:"",sCurSaveFrom:"",sWidth:210,bShowNode:"parentNode"}),_setEditorPageEvent(),_setSaveSendCheckBox(),setNeedCloseConform(!0),"function"==typeof t.onload&&t.onload(_fixStationeryFocus)}),onkeydown:_composeKeyDown}).initialize(t.source,!1,3)}else{_initButtonEvent(t),_setEditorPageEvent(),_setSaveSendCheckBox(),setNeedCloseConform(!0),"function"==typeof t.onload&&t.onload(_fixStationeryFocus);try{getTop().S("sendmailname",window).value=getTop().getDefaultSender()}catch(i){debug(i.message)}}}function _initForPostcardPage(e,t){_editorOnLoader(function(){_initButtonEvent(t),_setEditorPageEvent(),_setSaveSendCheckBox(),getTop().S("sendmailname",window).value=getTop().getDefaultSender(),setNeedCloseConform(!0)})()}function _initEditorForQQPage(e,t){getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,style:"border:none;icon:big;",funclist:{tbExtern:"Mo PhotoOld"},photoCGI:getTop().getPhotoCGI(),customtags:_getCustomTagList(),onload:_editorOnLoader(function(){_initButtonEvent(t),_setEditorSource(t,!0,1),_setSaveSendCheckBox(),_setEditorPageEvent(),"function"==typeof t.onload&&t.onload()}),onfocus:_fixStationeryFocus,onmousedown:_doEditorMouseDown,onclick:_fixStationeryClick,onbeforesaverange:_fixStationeryClick,onkeydown:_composeKeyDown,onputcontent:_fixBodyPadding}).initialize(t.source||outputDataLoading(),!1,5)}function _initEditorForReadMailGroupPage(e,t){getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,funclist:{tbExtern:"Mo"},customtags:_getCustomTagList(),onmousedown:_doEditorMouseDown,onload:function(){this.setContent(getTop().QMEditor.getBreakLine(1)),_setEditorPageEvent(),"function"==typeof t.onload&&t.onload(),_clearEditorCheckTimer(),setTimeout(function(){focusPageEditor(0)})},onkeydown:_composeKeyDown}).initialize(t.source,!1)}function _initEditorForNoteFirstPage(e,t){getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,height:t.height||getTop().getStyle(getTop().S("QMEditorArea",window),"height"),onmousedown:_doEditorMouseDown,onkeydown:_composeKeyDown,onpaste:function(){callBack.call(this,t.onpaste)},onfocus:function(){this.getContent(!0)==getNoteFirstPageSource(!0,t.sDefaultText)&&(this.setContent(getTop().QMEditor.getBreakLine()),this.focus(0))},onblur:function(){var e=this.getContent().toLowerCase();e&&e!=getTop().QMEditor.getBreakLine().toLowerCase()||this.setContent(getNoteFirstPageSource(!1,t.sDefaultText))},onload:function(){"function"==typeof t.onload&&t.onload(_fixStationeryFocus),_clearEditorCheckTimer()}}).initialize(getNoteFirstPageSource(!1,t.sDefaultText),!1)}function _initEditorForNotePage(e,i){var o=getTop();getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,funclist:getTop().QMEditor.CONST.FUNCLIST.NOTE,photoCGI:getTop().getPhotoCGI(),onload:function t(){getTop().waitFor(function(){return!i.asyncGetContent||getTop().goAsyncContent},function(e){!function(){if(_initButtonEvent(i),i.isPaste)getPageEditor().setContent(""),getPageEditor().paste();else if(i.isReadCache){var e=getTop().getGlobalVarValue("NOTE_CONTENT_CACHE");e&&getPageEditor().setContent(e)}else if(i.asyncGetContent||o.goAsyncContent){var t=o.S("subject",window);t&&(t.value=o.goAsyncContent.subject,t.focus()),getPageEditor().setContent(o.goAsyncContent.content)}else getPageEditor().setContent(filterSourceContent(getTop().S("source",window).innerHTML)||getTop().QMEditor.getBreakLine());_showEditorToolBar(1==getTop().getUserCookieFlag("CCSHOW")[3]),getTop().show(getTop().S("editor_toolbar_btn_container",window),getPageEditor().isSupportToolBar()),loadValue(!0),setNeedCloseConform(!0),autoSave(!1),_setEditorPageEvent(),_clearEditorCheckTimer(),"function"==typeof i.onload&&i.onload(_fixStationeryFocus)}()},500,1e4)},onmousedown:_doEditorMouseDown,onkeydown:_composeKeyDown,onpaste:_pasteUrlAnalyse,onchangecontenttype:_onChangeContentTypeEvent,onshowinstallactive:showInstallActiveXDialog}).initialize(i.source||outputDataLoading(),!1,5),_autoResizeEditor()}function _initForReadmailConv(e,t){getTop().QMEditor.createEditor({editorId:e,editorAreaWin:window,funclist:getTop().QMEditor.CONST.FUNCLIST.NOTE,photoCGI:getTop().getPhotoCGI(),onload:function(){_showEditorToolBar(1==getTop().getUserCookieFlag("CCSHOW")[3]),getTop().show(getTop().S("editor_toolbar_btn_container",window),getPageEditor().isSupportToolBar()),loadValue(!0),setNeedCloseConform(!0),_setEditorPageEvent(),_clearEditorCheckTimer(),"function"==typeof t.onload&&t.onload(_fixStationeryFocus),setTimeout(focusPageEditor)},onmousedown:_doEditorMouseDown,onkeydown:_composeKeyDown,onpaste:_pasteUrlAnalyse,onchangecontenttype:_onChangeContentTypeEvent,onshowinstallactive:showInstallActiveXDialog}).initialize("",!1,5),_autoResizeEditor()}function _initForRemindPage(e,t){_editorOnLoader(function(){_initButtonEvent(t),_setEditorPageEvent()})()}function _getCustomTagList(){return["sign","qzone","includetail"]}function _editorOnLoader(e){return function(){_clearEditorCheckTimer(),getTop().waitFor(function(){try{return getTop().getDefaultEditor()!=undefined}catch(e){return!1}},e,50)}}function getPageId(){return initComposeForPage.pageId}function getPageConfig(){return initComposeForPage.pageConfig}function getPageEditor(){return getTop().QMEditor&&getTop().QMEditor.getEditor(getPageId())}function getDomainList(){var o=getTop();window.domainList=[],o.QMAjax.send("/cgi-bin/readtemplate?sid="+o.getSid()+"&action=get_owner_domain_list&t=biz_rf_mgr&ef=jsnew&r="+Math.random(),{method:"POST",onload:function(e,t){if(e){var i=o.evalValue(t);window.domainList=i.data.domainList}}})}function getPublicMailList(){var o=getTop();window.publicMailList=[],o.QMAjax.send("/cgi-bin/readtemplate?sid="+o.getSid()+"&action=get_all_public_email&t=biz_rf_mgr&ef=jsnew&r="+Math.random(),{method:"POST",onload:function(e,t){if(e){var i=o.evalValue(t);window.publicMailList=i.data.publicMailList}}})}function _insertEditorImage(e,t,i){try{var o=getTop().S("QMEditorArea",getTop().getMainWin()).getElementsByTagName("iframe")[0].contentDocument;o&&(o.body.focus(),o.execCommand("insertImage",!1,e),o.execCommand("insertHTML","<br><br>"))}catch(n){}}function attachInsertImage(i,o){var e=getTop();return _oWin=e.getMainWin(),_oEditor=getPageEditor(),"text"==_oEditor.getContentType()?getTop().confirmBox({msg:"\u65e0\u6cd5\u6dfb\u52a0\u56fe\u7247\u5230\u7eaf\u6587\u672c\uff0c\u60a8\u662f\u5426\u6539\u7528\u5bcc\u6587\u672c\u7f16\u8f91\uff1f",title:"\u63d0\u793a",onreturn:function(e){if(e){var t=getPageEditor();t.changeContentType("html"),getTop().S("contenttype",_oWin).checked=!1,_oWin.setTimeout(function(){_insertEditorImage(i,o,t)},100)}}}):_insertEditorImage(i,o,_oEditor),!1}function attachInsertFile(e,t){var i=getTop(),o=QMAttach.getExistInfos()[t]||QMAttach.getExistInfos()[e],n=new QMAttach._qmTmpFile(o),a=n.sFileUrl||_getPreviewView(n);return 1048576<n.get("nSize")&&-1!=a.indexOf("&filetype=txt&")?i.showError("\u8bfb\u53d6\u6587\u6863\u5185\u5bb9\u5931\u8d25\uff0c\u6682\u65e0\u6cd5\u5bfc\u5165"):(doAttachInsertFile(a),!1)}function existAttachInsertFile(e,t,i,o){getTop();var n=new QMAttach._qmTmpFile({sName:e,mailid:t,composepath:i,attachname:e,attachid:o});return doAttachInsertFile(_getPreviewView(n)),!1}function doAttachInsertFile(n){var a=getTop(),r=this.getPageEditor();function s(){return"html"==r.getContentType()||(a.showError("\u6587\u672c\u7f16\u8f91\u5668\u4e0d\u652f\u6301\u5bfc\u5165"),!1)}s()&&(-1==n.indexOf("t=attachments_simple")&&(-1<n.indexOf("&t=")||-1<n.indexOf("?t=")?n=n.replace(/t=([^&]*)/,"t=attachments_simple"):n+="&t=attachments_simple"),n=n.replace("/cgi-bin/viewfile","/cgi-bin/readtemplate"),-1!=(n+="&not302=yes&filter=false").indexOf("&filetype=pdf&")&&(n+="&firstpage=1&lastpage=999"),a.showProcess(1,!0,"\u6b63\u5728\u8bfb\u53d6\u6587\u6863\u5185\u5bb9...",null,!1),a.QMAjax.send(n,{onload:function(e,t){if(e&&t&&0!==(""+t).indexOf("\x3c!--cgi exception--\x3e")){function i(e,t){s()&&(!0!==_appendEditorFileContent(e,r,t)&&a.showError("\u8bfb\u53d6\u6587\u6863\u5185\u5bb9\u5931\u8d25\uff0c\u6682\u65e0\u6cd5\u5bfc\u5165"),a.showProcess(0))}if(!a.trim(t))return void a.showError("\u8bfb\u53d6\u5185\u5bb9\u5931\u8d25\uff0c\u6216\u6587\u6863\u5185\u5bb9\u4e3a\u7a7a");if(-1==t.indexOf("qmbox")){if(-1!=n.indexOf("/cgi-bin/readtemplate"))return void i(t,-1==n.indexOf("&filetype=html"));var o=a.evalValue(t);if(o.ret)return void("-9006"==o.ret?a.showError("\u6587\u6863\u88ab\u52a0\u5bc6\uff0c\u5bfc\u5165\u5931\u8d25"):a.showError("\u672a\u77e5\u9519\u8bef\uff0c\u83b7\u53d6\u6587\u6863\u4fe1\u606f\u5931\u8d25"))}if(!s())return;a.getOfficeRealContent(t,{onload:function(e,t){e?i(t):(a.ossLog("delay","all","stat=import_word&type=attach|input_error|office_read"),a.showError("\u8bfb\u53d6\u6587\u6863\u5185\u5bb9\u5931\u8d25"))},charset:"UTF8"})}else a.showError("\u8bfb\u53d6\u6587\u6863\u5931\u8d25"),a.ossLog("delay","all","stat=import_word&type=attach|input_error|cgi"+(e?"_http":"_err"))}}))}function getInputObj(e,t,i){var o=t||_getSubmitForm();if(!o)return null;var n=o[e];return n||(getTop().insertHTML(o,"afterBegin",getTop().T('<input name="$name$" type="hidden" $disabled$/>').replace({name:e,disabled:i?"disabled":""})),n=o[e]),n}function focusPageEditor(e,t){var i=getPageEditor();i&&i.focus(e||0,i.getContentObj(t||"QQMAILSTATIONERY"))}function changeContentType(e){getPageEditor().changeContentType(e.checked?"text":"html")||(e.checked=!e.checked)}function _onChangeContentTypeEvent(){var e="html"!=this.getContentType(),t=getTop();e&&((t.S("noletter",window)||{}).checked=!1,getPageEditor().setBgMusicInfo()),t.S("contenttype",window).checked=e,t.show(t.S("QMEditorToolBarPlusArea",window),!e),t.show(t.S("editor_toolbar_btn_container",window),!e)}function outputDataLoading(e){return getTop().T(['<div class="$className$" style="$height$font-size:12px;color:gray;$padding$">\u6570\u636e\u52a0\u8f7d\u4e2d...</div>']).replace({className:e?"QMEditorBase":"",padding:e?"padding:5px;":"",height:e?"height:100%;":""})}function outputToolBarControlBtn(e){return getTop().T(['<span tabindex="-1" id="$id$" style="display:none;" unselectable="on" onmousedown="return false;">','<input tabindex="-1" type="button" style="cursor:pointer;background:url($imgpath$newicon/compose.png) -112px 0;','width:16px;height:16px;border:none;padding:0;margin:0 2px 0 -3px;*margin:0 2px 0 0;vertical-align:middle!important;vertical-align:auto;text-decoration:none;" ','unselectable="on" onmousedown="return false;"/>','<a tabindex="-1" href="javascript:;">','\u6587\u5b57\u683c\u5f0f<span>\u2191</span><span style="display:none;" >\u2193</span>',"</a>","</span>"]).replace({imgpath:getTop().getPath("image"),id:e||"editor_toolbar_btn_container",path:getTop().getPath("editor")})}function filterSourceContent(e){return getTop().filteScript(e.replace(/<div id=\'?\"?QQMailBgMusicInfo\'?\"?.*?>.*?<\/div>/gi,"").replace(/<player .*?><\/player>/gi,"").replace(/(^\s+)|(\s+$)/gi,""))}function _setEditorSource(e,t,i){t&&"draft"!=e.subtmpl&&"background"!=e.subtmpl&&_filteStationeryAndCard();var o=getTop().S("source",window)&&getTop().S("source",window).innerHTML,n=getTop().getSignature(e.folderid,e.saveFrom),a="draft"==e.subtmpl||"content"==e.subtmpl||"background"==e.subtmpl,r=[],s=getPageEditor();if(getTop().gbIsIE)for(var l=' xmlns="',d=0,c=-1,p=-1,g="";d<o.length&&-1<(c=o.indexOf(l,d));)p=o.indexOf('"',c+l.length),g=o.slice(c,p),o=o.replace(g,g.replace("<","&lt;").replace(">","&gt;")),d=c+l.length;a||"cliwrite"==e.subtmpl||(e.pluscontent?r.push(e.pluscontent,getTop().QMEditor.getBreakLine(1)):r.push(getTop().QMEditor.getBreakLine(i||(getTop().filteSignatureTag(n)?2:1))),r.push(n)),e.isNoInclude||!o||"draft"!=e.subtmpl&&"background"!=e.subtmpl||r.push(getTop().filteSignatureTag(o,"2LOWCASE")),a||"compose"!=getPageId()&&"qq"!=getPageId()||(r=[getTop().getDetaultStationery("Header"),r.join(""),getTop().getDetaultStationery("bottom")],getTop().getDetaultStationery("Header")&&getTop().requestShowTip("editor_toolbar_btn_container","45",window)),o=transXss(o),!e.isNoInclude&&o&&"draft"!=e.subtmpl&&"background"!=e.subtmpl&&(o=filterSourceContent(getTop().filteSignatureTag(o)))&&r.push(["<div><includetail>",o,"</includetail></div>"].join("")),a||s.setDefaultFontInfo(getTop().getGlobalVarValue("DEF_FONT_FAMILY"),getTop().getGlobalVarValue("DEF_FONT_SIZE"),getTop().getGlobalVarValue("DEF_FONT_COLOR"));r=filterSourceContent(r.join(""));try{r=filterComposeContent(r)}catch(m){}if(s.setContent(r),getTop().gbIsEdge){var u=document.createRange();u.selectNode(s.getEditWin().document.body.firstChild),s._setRange(u)}}function transXss(e){var t=document.createElement("div");t.innerHTML=e;for(var i=0,o=t.getElementsByTagName("*").length;i<o;i++)if(t.getElementsByTagName("*")[i].attributes)for(var n=0;n<t.getElementsByTagName("*")[i].attributes.length;n++)try{t.getElementsByTagName("*")[i].setAttribute(t.getElementsByTagName("*")[i].attributes[n].name,t.getElementsByTagName("*")[i].attributes[n].value.replace(/\</g,"&lt;").replace(/\>/g,"&gt;"))}catch(a){}return t.innerHTML}function filterComposeContent(e){var t=getTop(),i=document.createElement("div");i.innerHTML=e;var o=t.CN("department",i,"p");o&&o[0]&&(o[0].innerHTML=o[0].innerHTML.replace(/^(&nbsp;)+\//,""));for(var n=i.getElementsByTagName("img"),a=0;a<n.length;++a)n[a].setAttribute("onerror","");var r=i.getElementsByTagName("iframe");for(a=0;a<r.length;++a){r[a].setAttribute("onerror","");var s=r[a].getAttribute("src")||"";0==(s=getTop().trim(decodeURIComponent(s)).toLowerCase()).indexOf("javascript:")&&r[a].setAttribute("src","")}return i.innerHTML}function _setEditorPageEvent(){getTop().addEvent(document,"keydown",_composeKeyDown)}function _setSaveSendCheckBox(){var e=getTop().S("savesendbox",window);if(e)try{e.checked=!getTop().getDefaultSaveSendbox()}catch(t){e.checked=!0}}function _showEditorToolBar(e){var t=getTop();e=null==e||e,getPageEditor().showToolBar(e);var i=getTop().S("editor_toolbar_btn_container",window);if(!i)return!1;var o=getTop().GelTags("span",i);getTop().show(o[0],e),getTop().show(o[1],!e);var n=arguments.callee;i.onclick=function(){return n(!e),!1},e&&t.LogKvEx({businame:"common_stat",item:"webmail|menu|editor|click",sid:t.getSid()})}function _changeEditorBgMusic(){var e=getTop(),t=e.S("editor_bgmusic_container",window);if(t){"true"!=t.getAttribute("inited")&&(t.innerHTML=e.T(["<div></div>",'<div id="bg_music_listen" style="display:none;margin:4px 0 4px 0;">','<div id="mp3player_msg" ></div>','<div id="mp3player_container" style="display:none;" >\u64ad\u653e\u5668\u52a0\u8f7d\u4e2d...</div>',"</div>"]),t.setAttribute("inited","true"));var i=this.getBgMusicInfo();e.show(t,i),i&&(t.firstChild.innerHTML=e.T(['<span style="word-break:break-all;"><span class="graytext">\u80cc\u666f\u97f3\u4e50\uff1a</span>$bgmusic$</span>','<a style="margin:0 5px 0 10px;" onclick="',"if ( confirm( '\u60a8\u786e\u8ba4\u5220\u9664\u8be5\u80cc\u666f\u97f3\u4e50\uff1f' ) ) {","getTop().audioStop();","getPageEditor().setBgMusicInfo();","}",'">\u5220\u9664</a>','<a onclick="',"tryListenBgMusic( this );",'" >\u8bd5\u542c</a>']).replace({bgmusic:i.song?e.T("$song$($singer$)").replace({song:e.htmlEncode(i.song),singer:e.htmlEncode(i.singer)}):e.htmlEncode(i.url)}),e.audioStop(),e.show(e.S("mp3player_container",window),!1),e.show(e.S("mp3player_msg",window),!0),i.song&&(getTop().S("mp3player_msg",window).innerHTML="\u6b4c\u66f2\u52a0\u8f7d\u4e2d...\u8bf7\u7a0d\u5019",getTop().getMusicUrl(i.song,i.singer,function(e,t,i){getPageEditor()&&(i?(getPageEditor().setBgMusicInfo(e,t,i),o("open")):getTop().S("mp3player_msg",window).innerHTML="\u6b4c\u66f2\u52a0\u8f7d\u5931\u8d25")})),o("open"))}function o(e){tryListenBgMusic(t.firstChild.lastChild,i.song,i.singer,e)}}function tryListenBgMusic(e,t,i,o){var n=["\u8bd5\u542c","\u5173\u95ed"];if("close"==o||e.innerHTML!=n[0]&&"open"!=o)e.innerHTML=n[0],getTop().audioStop(),getTop().show(getTop().S("mp3player_container",window),!1),getTop().show(getTop().S("mp3player_msg",window),!0),getTop().show(getTop().S("bg_music_listen",window),!1);else{e.innerHTML=n[1];var a=getPageEditor().getBgMusicInfo();a&&a.url&&(getTop().show(getTop().S("mp3player_container",window),!0),getTop().show(getTop().S("mp3player_msg",window),!1),setTimeout(function(){getTop().audioPlay({url:a.url,author:a.singer,title:a.song,autoplay:!0,global:!0})},200)),getTop().show(getTop().S("bg_music_listen",window),!0)}}function _filteStationeryAndCard(e){var t,i;i=(t="editor"==e?getPageEditor().getContentObj("QQMAILSTATIONERY"):getTop().S("QQMAILSTATIONERY",window),getPageEditor().getContentObj("QqMAiLcARdWoRD")),t&&(t.id=""),i&&(i.id=""),(t||i)&&_filteStationeryAndCard(e)}function _doEditorMouseDown(e){_fixStationeryMouseDown(e),getTop().hideMenuEvent(e),QMAttach.hideDragAndDropContainer()}function _fixStationeryMouseDown(e){var t=getPageEditor(),i=t&&t.getContentObj("QQMAILSTATIONERY"),o=e.srcElement||e.target;i&&o&&(getTop().isObjContainTarget(i,o)||(getTop().preventDefault(e),getTop().gbIsIE&&setTimeout(function(){_fixStationeryClick(e)})))}function _fixStationeryClick(e,t){var i=getPageEditor(),o=i&&i.getContentObj("QQMAILSTATIONERY");!o||!t&&i.isSelectionInObject(o)||i.focus(0,o);var n=getTop().addrHint;n&&"function"==typeof n.closeHint&&n.closeHint()}function _fixStationeryFocus(e){arguments.callee.editorEverFocus=!0,_fixStationeryClick(e,getTop().gbIsWebKit)}function _fixBodyPadding(){var e=this.getContentObj("QQMAILSTATIONERY"),t=getTop().S("noletter",window);this.adjustBodyStyle("padding",e?"0":"2px 4px 0"),_fixQQMailStationery(getTop().gbIsIE?"auto":"100%"),t&&(t.checked=!!e)}function _fixQQMailStationery(e){try{for(var t=getPageEditor().getContentTags("table"),i=0,o=Math.min(t.length,50);i<o;i++){var n=t[i];"i"==n.className&&(n.style.width=e)}}catch(a){}}function _pasteUrlAnalyse(e){var d=arguments.callee,c=getTop().S("subjectsample",window);if(!(getTop().S("subject",window).value&&getTop().S("subject",window).value!=(c&&c.value)||d._process)){var p=this,g=this.getContent(!0);setTimeout(function(){var e=p.getContent(!0),t=g.length,i=e.length;if(!(3001<t||3001<i)){for(var o=0;o<t&&o<i&&g.charAt(t-o-1)==e.charAt(i-o-1);o++);var n=i-o,a=t-o;for(o=0;o<t&&o<i&&g.charAt(o)==e.charAt(o);o++);o<a&&(a=o);var r=(a==n?e:e.substring(a,n)).replace(/[\r\n]/gi,"");if(getTop().isUrl(r)){var s=getTop(),l=d._process=new s.QMAjaxRequest("/cgi-bin/geturlinfo","POST",2e4);l.onComplete=function(e){var t=e.responseText;0==t.indexOf("ok|")?(getTop().S("subject",window).value&&getTop().S("subject",window).value!=(c&&c.value)||(getTop().getMainWin().SubjectCtrl&&getTop().getMainWin().SubjectCtrl(1),getTop().S("subject",window).value=getTop().trim(getTop().htmlDecode(t).substr(3).replace(/&#(x)?([^&]{1,5});?/g,function(e,t,i){return String.fromCharCode(parseInt(i,t?16:10))}).replace(/[\r\n]/g,""))),delete l):l.onError()},l.onError=function(){delete l},l.send(getTop().T("sid=$sid$&url=$url$&pageid=$id$").replace({sid:getTop().getSid(),id:getPageId(),url:encodeURIComponent(r)}))}}},13)}}function trimEditorContent(e){var t=e.getContent(!0),i=e.getContent();return t&&""!=t.replace(/ /gi,"")||-1!=i.toLowerCase().indexOf("img")?i:""}function noteFirstPageQuickSave(){return"\u8bf7\u8f93\u5165\u8bb0\u4e8b\u5185\u5bb9..."==getPageEditor().getContent(!0)?getTop().showError("\u8bf7\u5148\u8f93\u5165\u5185\u5bb9",800):(getTop().S("content",window).value=getPageEditor().getContent(),window.unloadwarning=!1,_getSubmitForm().submit())}function getNoteFirstPageSource(e,t){var i=t||"\u8bf7\u8f93\u5165\u8bb0\u4e8b\u5185\u5bb9...";return e?i:["<div style='color:#a0a0a0;font-size:14px;'>",i,"</div>"].join("")}function _insertWbr(e,t){for(var i=t||12,o=e||"",n=[],a=o.length/i,r=0;r<a;r++)n[r]=getTop().htmlEncode(o.substr(r*i,i));return n.join("<wbr>")}var QMAttach={mbHideBigAttach:!1,mbHideAttach:!1,mnAttBigSizeIn:0,mnAttBigSizeEx:0,_mnAttToFtnSize:20,_msMode:"normal",_msWarnningTypes:"exe|msi|scr|cmd|bat|com",_msSecretAllowTypes:"doc|xls|ppt|docx|xlsx|pptx|rtf|pdf|txt|js|htm|html|mht|xhtml|eml|h|java|cpp|xml|pps|dot|docm|wps|et|dps|jpg|jpeg|bmp|gif|png",_mnSizeLimit:50,_mnAttachId:0,_moTmplSet:{},_moExistList:[],_moExistInfos:{},_moCurUploader:null,_moCurUploadAttachInfo:null,_moCurUploadTimeStamp:null,_moCurUploadAttachArray:null,_moDragAndDropContainer:null,_moAppletCtrl:null,_moFlashCtrl:null,_mbIsInitlized:!1,_mbIsDisableControl:!1,onprogress:null,onfinish:null,_msDragEnter:"\u5c06\u6587\u4ef6\u62d6\u62fd\u81f3\u6b64\u533a\u57df",_msDragOver:"\u91ca\u653e\u9f20\u6807",_sUploadImplement:null,_bFlashUploaderStatus:!1,_oCurrentFile:null,_moUploadFtnFileId:[],_bUseNewLogic:!1,initHideAttach:function(e){e&&(this.mbHideBigAttach=e.hideBigAttach,this.mbHideAttach=e.hideAttach)},getFileInfo:function(a){var r,s=getTop(),l=function(e){return s.parents("div.attsep",e)[0]},d=function(e){return-1<"txt,html".indexOf(s.getFileTypeByExt(e||""))},c=function(e){for(var t=s.finds("div.attsep [uploadid]",s.S("attachContainer",window)),i=0,o=t.length;i<o;i++)if(s.attr(t[i],"uploadid")==e)return t[i]}(a);if(c&&"big"==s.attr(c,"attachtype")){var e=s.attr(c,"fid"),t=s.attr(c,"key"),i=s.attr(c,"code"),o=s.attr(c,"downloadlink"),n=s.attr(c.parentNode,"appid");if(!n&&a){var p=a.indexOf("/");-1<p&&(n=a.substr(0,p))}(r={}).yozo=s.gbUseYozo?1:0,r.sAttachId_=a,r.sName=s.attr(c,"filename"),r.sFrom="bigattach",r.sSuffix=s.getFileExt(r.sName),r.sType=s.getViewTypeByExt(r.sSuffix),r.sFileType=s.getFileTypeByExt(r.sSuffix||""),r.sUrl=o||({doc:s.TE(["/cgi-bin/ftnfilefunc?sid=$sid$&code=$code$&k=$k$&oper=$oper$","&appid=$appid$&t=$t$&nocheckframe=true&s=yozo&fromattach=1","&ftnpreviewtype=$type$&filename=$filename$&nofixedname=$@$eval getTop().htmlEncode($filename$)$@$&ef=qfunc","&filetype=$filetype$&viewtype=$viewtype$"]),compress:s.TE(["/cgi-bin/ftnviewcompress?sid=$sid$&cpsfile=$@$eval getTop().encodeURI($filename$)$@$","&fid=$fid$&filetype=$filetype$&action=list&t=cps.json&fromattach=1&k=$k$&code=$code$"])}[r.sType]||s.T("/cgi-bin/ftnDownload302?sid=$sid$&fid=$fid$&code=$code$&k=$k$")).replace({oper:-1!="doc,xls,ppt,docx,xlsx,pptx,pdf,eml,pps,rtf,docm,dot,dotx,dotm,".indexOf(r.sSuffix+",")?"htmlopen":"view",sid:s.getSid(),code:i,fid:e,k:t,t:"eml"==r.sSuffix?"preview_eml":"attachments_content",type:r.sType,filetype:r.sFileType,filename:encodeURIComponent(r.sName),appid:n||72,viewtype:"eml"==r.sSuffix?"eml":""})}else if(this._getExistAttachInfo(a)){var g=this._getExistAttachInfo(a),u=new this._qmTmpFile(g);if(u.get("sId")==a){var m,f;"collection"==("collection"==u.get("sUploadMode")?"collection":"attach")?f=[u.get("mailid"),u.get("attachid"),u.get("attachname")].join("|"):m=u.get("sFileId");var h,_=u.get("sName"),v=s.getFileExt(_),T=s.getViewTypeByExt(v);switch(T){case"compress":h="cps.json";break;case"doc":h="eml"==v?"preview_eml":"attachments_content";break;default:h=""}(r={}).yozo=s.gbUseYozo?1:0,r.sAttachId_=a,r.sName=_,r.sFrom="attach",r.sSuffix=v,r.sType=T,r.sFileType=s.getFileTypeByExt(r.sSuffix||""),r.sUrl=u.get("sFileUrl")||s.T(["/cgi-bin/$appname$?sid=$sid$&upfilelistitem=$upfileid$&mailattach=$mailattach$","&filename=$filename$&t=$t$&readprev=$compose$&filepath=$filepath$","&action=$action$$viewdocparam$&filetype=$filetype$&viewtype=$viewtype$&nf=$nf$"]).replace({sid:s.getSid(),appname:{txt:"viewfile",html:"viewfile",eml:"viewdocument"}[r.sFileType]||{compress:"viewcompress",video:"viewfile",music:"viewfile",img:"viewfile"}[r.sType]||"viewdocument",action:"compress"==r.sType?"list":d(r.sSuffix)?"view":"",compose:"group"==u.get("sComposePage")?u.get("sComposePage"):"normal",t:h,filetype:r.sFileType,filename:s.encodeURI(r.sName),upfileid:m,filepath:u.get("sFilePath")||"",mailattach:f,viewdocparam:"doc"==r.sType?"&s=yozo&fromattach=1&from=attachfolder":"",viewtype:"eml"==r.sSuffix?"eml":"",nf:u.get("sNf")||""})}}else{var w=s.finds("div.attsep [uploadid]",s.S("attachContainer",window));s.E(w,function(e){if(s.attr(e,"uploadid")==a){var t,i=s.trim(s.htmlDecode(s.finds("span[ui-type='filename']",l(c))[0].innerHTML.replace(/\<.*?\>/gi,""))),o=s.getFileExt(i),n=s.getViewTypeByExt(o);switch(n){case"compress":t="cps.json";break;case"doc":t="eml"==o?"preview_eml":"attachments_content";break;default:t=""}return(r={}).yozo=s.gbUseYozo?1:0,r.sAttachId_=a,r.sName=i,r.sFrom="attach",r.sSuffix=o,r.sType=n,r.sFileType=s.getFileTypeByExt(r.sSuffix||""),r.sUrl=s.T(["/cgi-bin/$appname$?sid=$sid$&upfilelistitem=$upfileid$&mailattach=$mailattach$","&filename=$filename$&t=$t$&readprev=$compose$&filepath=$filepath$","&action=$action$$viewdocparam$&filetype=$filetype$&viewtype=$viewtype$"]).replace({sid:s.getSid(),appname:{txt:"viewfile",html:"viewfile",eml:"viewdocument"}[r.sFileType]||{compress:"viewcompress",video:"viewfile",music:"viewfile",img:"viewfile"}[r.sType]||"viewdocument",action:"compress"==r.sType?"list":d(r.sSuffix)?"view":"",compose:"group"==getPageId()?getPageId():"normal",t:t,filetype:r.sFileType,filename:s.encodeURI(r.sName),filepath:"",mailattach:s.encodeURI(s.finds("input[name='replymailattach']",l(e)).length&&s.finds("input[name='replymailattach']",l(e))[0].value||s.finds("input[name='mailattach']",l(e)).length&&s.finds("input[name='mailattach']",l(e))[0].value||""),viewdocparam:"doc"==r.sType?"&s=yozo&fromattach=1&from=attachfolder":"",viewtype:"eml"==o?"eml":""}),!1}})}return r},preview:function(e,t){var s=getTop(),l=this,i="string"==typeof e?e:s.attr(e,"uploadid"),o=l.getFileInfo(i);if(!o||!o.sUrl)return!1;s.loadJsFileToTop(["$js_path$qmplayer/player.js","$js_path$com/kits/qmpreviewer/js/qmpreviewer.js"]),s.waitFor(function(){return s.QMPlayer&&s.QMPreviewer},function(e){if(e){var t=function(r){return function(e){for(var t,i=s.finds("div.attsep [uploadid]",s.S("attachContainer",window)),o=-1,n=e._sId||e.sAttachId_,a=0;a<i.length;a++)if(s.attr(i[a],"uploadid")==n){o=a;break}return"prev"==r&&0<o?t=l.getFileInfo(s.attr(i[o-1],"uploadid")):"next"==r&&o<i.length-1&&(t=l.getFileInfo(s.attr(i[o+1],"uploadid"))),t}};s.QMPreviewer.show(o,{fPrev:t("prev"),fNext:t("next")},{bIsShowBreakLine:!1,bShowDownBtn:!1})}})},initAttBigSize:function(e){e&&(this.mnAttBigSizeIn=e.nAttBigSizeIn||0,this.mnAttBigSizeEx=e.nAttBigSizeEx||0)},addExistAttach:function(e,t,i){for(var o=getTop(),n=o.T('<input id="$id$" name="$attachname$" value="$mailattach$" type="hidden" />'),a=(e.forward,e.attach),r=o.S("fattachlist",window).value&&o.S("fattachlist",window).value.split("|")||[],s=0,l=a.length;s<l;s++){var d=0==a[s].mailid.indexOf("@")?a[s].attid:a[s].symname||a[s].attid;if(t){if(t&&!o.S(d,window)){if(QMAttach.getAttachSize()+QMAttach._unFormatSize(a[s].size)>QMAttach.getAttachLimit())return void QMAttach.showAttachLimit(QMAttach.getAttachLimit());var c=!1;getTop().E(r,function(e){e==a[s].name&&(c=!0)}),c||r.push(a[s].name),o.insertHTML(t?o.S("exist_file",window):document.frm,"beforeEnd",QMAttach._getFileCellTmpl("exist").replace({id:d,value:[a[s].mailid,d,a[s].name].join("|"),viewname:a[s].name,newname:o.htmlEncode(a[s].newname),size:a[s].size,viewfileurl:a[s].viewfileurl,attachname:i?"replymailattach":"mailattach"}))}}else o.insertHTML(t?o.S("exist_file",window):document.frm,"beforeEnd",n.replace({id:d,mailattach:[a[s].mailid,d,a[s].name].join("|"),attachname:i?"replymailattach":"mailattach"}))}o.S("fattachlist",window).value=r.join("|")},addExistMeetingAttach:function(e,t,i){for(var o=getTop(),n=o.T('<input id="$id$" name="$attachname$" value="$mailattach$" type="hidden" />'),a=(e.forward,e.attach),r=o.S("fattachlist",window).value&&o.S("fattachlist",window).value.split("|")||[],s=0,l=a.length;s<l;s++){var d=0==a[s].mailid.indexOf("@")?a[s].attid:a[s].symname||a[s].attid;if(t){if(t&&!o.S(d,window)){if(QMAttach.getAttachSize()+QMAttach._unFormatSize(a[s].size)>QMAttach.getAttachLimit())return void QMAttach.showAttachLimit(QMAttach.getAttachLimit());var c=!1;getTop().E(r,function(e){e==a[s].name&&(c=!0)}),c||r.push(a[s].name),o.insertHTML(t?o.S("exist_file",window):document.frm,"beforeEnd",QMAttach._getFileCellTmpl("exist_meeting").replace({id:d,value:[a[s].mailid,a[s].name].join("|"),viewname:a[s].name,newname:o.htmlEncode(a[s].newname),viewfileurl:a[s].viewfileurl,attachname:i?"replymailattach":"mailattach"}))}}else o.insertHTML(t?o.S("exist_file",window):document.frm,"beforeEnd",n.replace({id:d,mailattach:[a[s].mailid,d,a[s].name].join("|"),attachname:i?"replymailattach":"mailattach"}))}o.S("fattachlist",window).value=r.join("|")},addExistAttach_Big:function(e,t){var i=getTop(),o=e.bigattach,n=t?i.S("exist_BigAttach",window):i.S("BigAttach",window);if(e.bigattach)for(var a=0,r=o.length;a<r;a++)!i.S("eabig_"+o[a].id,window)&&i.insertHTML(n,"beforeEnd",QMAttach._getFileCellTmpl("exist_big").replace(i.extend(o[a],{mode:t?"replaybigattach":"",ispic:"img"==i.getViewTypeByExt(o[a].filename.split(".").pop()),sid:i.getSid()})))},initFileUpload:function(n){var e,a=getTop(),r=this;r._moWin,r._moCompose;_oUploadMgr=QMAttach.oFileUploadMgr,a&&a.QMFileAdaptor&&a.QMFileAdaptor.getNormalUploadCom&&"function"==typeof a.QMFileAdaptor.getNormalUploadCom&&(e=a.QMFileAdaptor.getNormalUploadCom()),(!(a.QMFileAdaptor.isBrowser("ie")&&a.gnIEVer<11)||window.location.host.match(/exmail\.qq\.com$/)||getTop().goExpers&&1==getTop().goExpers.dropFlash||"RawLocal"==e||"NoFlash"==e)&&a.waitFor(function(){return!!a.QMFileUpload&&!!document.getElementById("AttachFrame")},function(e){if(e){QMAttach._mbIsInitlized=!0;var t=a.QMFileUpload.createForFTN("popup",a.extend({oContainer:document.getElementById("AttachFrame")},n.uploadCallBacks));"FlashPopupFMail"===t.name?QMAttach._sUploadImplement="flashFTN":"H5CPopupMail"===t.name?QMAttach._sUploadImplement="h5c":QMAttach._sUploadImplement="tradition"}});var s="dragAndDropTrap";a.S(s,window).onclick=function(){var e,t=a.calcPos(a.S("AttachFrame",window)),i=[{sId:"drag",sItemValue:"\u62d6\u62fd\u4e0a\u4f20"}];(n.attachs&&n.attachs.length||n.bigattachs&&n.bigattachs.length)&&"replyattach"!=window.attachflag&&i.push({sId:"addExist",sItemValue:"\u6dfb\u52a0\u539f\u90ae\u4ef6\u9644\u4ef6"}),e=a.S("bigAttachLink",window)?a.calcPos(a.S("bigAttachLink",window))[2]+4:t[2]+(a.gbIsIE?-7:2);var o=a.QMMenu(s);return o&&o.isShow()||(a.hideMenuEvent(),o=new a.QMMenu({oEmbedWin:window,sId:s,nX:t[3],nY:e,nItemHeight:21,nWidth:150,oItems:i,onitemclick:function(e){switch(e){case"drag":getTop().QMFileUpload.oCreater.detects.Html5Drag()||getTop().QMFileUpload.oCreater.detects.ActivexDrag()?r._showDragAndDropContainer(!0):showInstallActiveXDialog();break;case"addExist":r.addExistAttach({attach:n.attachs},!0),r.addExistAttach_Big({bigattach:n.bigattachs}),a.ossLog("delay","all","stat=nothing&loc=compose,rlyatt,0,0"),a.show("attachContainer",!0,a.getMainWin()),window.attachflag="replyAllAttach";var t=a.S("domnewRcpt",window);a.show(t,0),getInputObj("newrcpt",null,!1).value=""}}})),!1}},initFileDragUpload:function(e){var t=getTop();this._initDragAndDropContainer(),this._moFileDragUpload=t.QMFileUpload.createForFTN("drag",t.extend({oContainer:this._moDragAndDropContainer.lastChild,sDragLeaveMsg:t.detectActiveX(2,1)&&"\u5c06\u6587\u4ef6\u62d6\u62fd\u81f3\u6b64\u533a\u57df\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5feb\u6377\u952ectrl+c\u3001ctrl+v\u6765\u6dfb\u52a0\u9644\u4ef6\u3002"},e.uploadCallBacks)),this.initFileDragUploadEvent()},useNewDragMethod:function(){return!getTop().gbIsIE||getTop().gbIsIE&&/Trident\/[67]\./.test(navigator.userAgent)},initFileDragUploadEvent:function(e){var t=getTop(),i=this,o=t.getMainWin();(!t.gbIsIE||t.gbIsIE&&/Trident\/[67]\./.test(navigator.userAgent))&&(i._moFileDragUpload||i._moImgDragUpload)&&(t.addEvents([o,getPageEditor().getEditWin()],{dragleave:i._onDragLeave(),dragenter:i._onDragEnter(),drop:i._onDrop()},e),QMDragFile.bInit=!0)},_onDrop:function(){var t=this;return t._mfOnDropFunc||(t._mfOnDropFunc=function(e){t.hideDragAndDropContainer()}),t._mfOnDropFunc},_onDragEnter:function(e){var i=getTop(),o=this,n=i.getMainWin();return o._mfOnDragEnterFunc||(o._mfOnDragEnterFunc=function(e){if(o._mbIsDragOver=1,i.QMFileUpload.oUtil.isFileDragOver(e)){o._showDragAndDropContainer(),n.setTimeout(function(){n.clearTimeout(+o._mnDragTimer)});var t=e.dataTransfer;t&&(t.effectAllowed=t.dropEffect="none"),i.preventDefault(e)}}),o._mfOnDragEnterFunc},_onDragLeave:function(){var t=this,i=_oTop.getMainWin();return t._mfOnDragLeaveFunc||(t._mfOnDragLeaveFunc=function(e){t._mbIsDragOver=0,i.clearTimeout(+t._mnDragTimer),t._mnDragTimer=i.setTimeout(function(){t._mbIsDragOver||t.hideDragAndDropContainer()},200)}),t._mfOnDragLeaveFunc},onmgrselect:function(e,l){var d=this,c=(d._moCompose,window,getTop());d._isAllowSelectFile()?d._checkExeAndZeroSize(e,function(a){function r(){c.E(a,function(e){!1===QMAttach._bFlashUploaderStatus&&(QMAttach._sUploadImplement="tradition"),0==e.get("sType").indexOf("H5C")&&(QMAttach._sUploadImplement="h5c"),"RawinputPopupMail"==e.oUploader.name&&(QMAttach._sUploadImplement="rawinput"),"Html5Drag"!=e.oUploader.name&&"Html5DragMail"!=e.oUploader.name||(QMAttach._sUploadImplement="flashFTN"),debug("checking FTN logic : "+QMAttach._sUploadImplement),d._addFileCell(QMAttach._sUploadImplement,e.get("sId"),e.get("sName"),e.get("sName"),e.get("nSize"))}),l(a)}var t,s,i,e,o=0;c.E(a,function(e){void 0!==e.get("nSize")&&(e.get("nSize")>1024*d._mnAttToFtnSize*1024&&(t=!0),e.get("nSize")>c.QMFileUpload.oUtil.nMinDownloadFTNwidgetFileSize&&(i=!0),o+=e.get("nSize"))}),d.getAttachSize("normal")+o>d.getAttachLimit()&&(s=!0),d.getAttachSize("normal")+o>d.getAttachLimit()&&(e=!0),"qq"==getPageId()?s?d.showAttachLimit(d.getAttachLimit()):r():isMeetingMail()?e?d.showMeetingAttachLimit(d.getAttachLimit()):r():(s||t)&&a[0].uploadToFtn?d._confirmToFtn(a,s,t,i,function(e){if(e){if(40<=a.length)return getTop().showError("\u4e00\u6b21\u4e0d\u80fd\u9009\u62e9\u8d85\u8fc740\u4e2a\u6587\u4ef6"),!1;var t=getTop().detectActiveX(3)||getTop().gbIsChrome&&41<parseInt(getTop().gsChromeVer);if(a[0].oUploader){var i=a[0].oUploader.name;if(/H5C/.test(i))t=!1;else if(/FlashPopup/.test(i)){var o=getTop().QMFileUpload.oUtil.getFlashMaxFileSizeForBurst(),n=!0;c.E(a,function(e){e.get("nSize")>o&&(n=!1)}),n&&(t=!1)}else/FlashH5Drag/.test(i)&&(t=!1)}t?(initFileTransporter(!0),debug("switch upload to: ftn")):(c.E(a,function(e){e.set("bUpToFtn",!0),d._addFileCell(QMAttach._sUploadImplement,e.get("sId"),e.get("sName"),e.get("sName"),e.get("nSize"),e)}),l(a),debug("switch upload to: "+(a[0].oUploader?a[0].oUploader.name:"undefined")))}else s||r()}):r(),d._checkBtn()}):function t(){c.E(e,function(e){e.destroy()})}()},_checkExeAndZeroSize:function(e,t){var i=getTop(),o=this,n=[],a=[],r=[],s=[],l=[],d=[],c=[],p=i.goUserInfo.get("DEF_FTN_MAXFILESIZE")||3221225472;if(i.E(e,function(e){var t=e.get("nSize"),i=e.get("sName");"error"==e.get("sStatus")?(d.push(i),e.destroy()):0===t?(a.push(i),e.destroy()):t<0?(r.push(i),e.destroy()):p<t?(n.push(i),e.destroy()):o._isWarnningType(i)?(s.push(i),e.destroy()):!o._isSecretAllowType(i)&&getPageConfig().bSecretMail?(l.push(i),e.destroy()):c.push(e)}),e=c,a.length||r.length||s.length||d.length||n.length||l.length){var g=i.T(['<div class="dialog_f_t">$title$</div>','<div class="dialog_f_d addrtitle" style="width:400px;max-height:160px;_white-space:nowrap;word-wrap:break-word; word-break:break-all; overflow:hidden; text-overflow:ellipsis;">$filelist$</div>']),u=[];a.length&&u.push(g.replace({title:"\u4ee5\u4e0b\u6587\u4ef6\u5927\u5c0f\u4e3a 0 \u5b57\u8282\uff0c\u8bf7\u68c0\u67e5\u540e\u91cd\u8bd5\u3002",filelist:i.htmlEncode(a.join(", "))})),r.length&&u.push(g.replace({title:"\u4ee5\u4e0b\u6587\u4ef6\u8def\u5f84\u8bc6\u522b\u9519\u8bef\u6216\u8d85\u51fa\u5927\u5c0f\u9650\u5236\u3002",filelist:i.htmlEncode(r.join(", "))})),s.length&&u.push(g.replace({title:"\u51fa\u4e8e\u5b89\u5168\u6027\u8003\u8651\uff0c\u4e0d\u5141\u8bb8\u6dfb\u52a0\u4ee5\u4e0b\u53ef\u6267\u884c\u6587\u4ef6\u3002",filelist:i.htmlEncode(s.join(", "))})),l.length&&u.push(g.replace({title:"\u4fdd\u5bc6\u90ae\u4ef6\u4e0d\u5141\u8bb8\u6dfb\u52a0\u4ee5\u4e0b\u683c\u5f0f\u7684\u6587\u4ef6\u3002",filelist:i.htmlEncode(l.join(", "))})),d.length&&u.push(g.replace({title:"\u4ee5\u4e0b\u6587\u4ef6\u5185\u5bb9\u8bfb\u53d6\u5931\u8d25\uff0c\u8bf7\u5c1d\u8bd5\u538b\u7f29\u540e\u518d\u53d1\u9001",filelist:i.htmlEncode(d.join(", "))})),n.length&&u.push(g.replace({title:"\u5355\u4e2a\u6587\u4ef6\u4e0d\u80fd\u8d85\u8fc7"+Math.round(p/1024/1024/1024)+"G",filelist:i.htmlEncode(n.join(", "))})),i.alertBox({msg:u.join('<div style="height: 8px; width:100%;"></div>'),title:"\u786e\u8ba4",onreturn:function(){t(e)}})}else t(e)},_confirmToFtn:function(e,t,i,o,n){var a=getTop(),r=this,s=o&&a.QMFileUpload.oUtil.isNeedDownloadFTNwidget(e[0].get("sType"))&&parseInt(a.gbIsChrome&&a.gsChromeVer||0)<42;r.hasSend=!1,getPageConfig()&&getPageConfig().bSecretMail?s||t?new a.QMDialog({sId:"attachAlert",sTitle:"\u9644\u4ef6\u63d0\u793a",sBodyHtml:a.TE(['<div class="dialog_function">','<span class="dialog_icon icon_info_b"></span>','<div class="dialog_f_c" style="text-align:left;">',"$@$if($needDownloadFTNwidget$)$@$",'<div class="bold">\u4f60\u6dfb\u52a0\u7684\u6587\u4ef6\u8f83\u5927\uff0c\u4fdd\u5bc6\u90ae\u4ef6\u6682\u4e0d\u652f\u6301\u3002</div>',"$@$else$@$","$@$if($overtotal$==1)$@$",'<div class="bold" style="margin-bottom:10px;">\u4f60\u6dfb\u52a0\u7684\u9644\u4ef6\u6587\u4ef6\u603b\u5927\u5c0f\u8d85\u8fc7$totalsize$M\uff0c\u4fdd\u5bc6\u90ae\u4ef6\u6682\u4e0d\u652f\u6301\u3002</div>',"$@$endif$@$","$@$endif$@$","</div>","</div>",'<div class="dialog_operate">','<div id="dlgtype" dlgtype="$overtotal$">','<a href="javascript:;" class="btn_gray" id="cancel" nocheck="true" initlized="nocheck">\u786e\u5b9a</a>',"</div>","</div>"]).replace({totalsize:r._mnSizeLimit,overtotal:t?1:0,needDownloadFTNwidget:s?1:0}),onload:function(){var t=this,i=t.S("dlgtype").getAttribute("dlgtype");a.addEvent(t.S("send"),"click",function(e){0==r.hasSend&&(a.preventDefault(e),a.stopPropagation(e),n(!1),a.ossLog("delay","all","stat=nothing&locval=qmattach,toftn,0,"+i),t.close(),r.hasSend=!0)}),a.addEvent(t.S("cancel"),"click",function(e){a.preventDefault(e),a.stopPropagation(e),a.ossLog("delay","all","stat=nothing&locval=qmattach,toftn,-1,"+i),t.close()})}}):0==r.hasSend&&(n(!1),a.ossLog("delay","all","stat=nothing&locval=qmattach,toftn,0,"+_nDlgType),r.hasSend=!0):new a.QMDialog({sId:"attachAlert",sTitle:"\u9644\u4ef6\u63d0\u793a",sBodyHtml:a.TE(['<div class="dialog_function">','<span class="dialog_icon icon_info_b"></span>','<div class="dialog_f_c" style="text-align:left;">',"$@$if($needDownloadFTNwidget$)$@$",'<div class="bold">\u4f60\u6dfb\u52a0\u7684\u6587\u4ef6\u8f83\u5927\uff0c\u5efa\u8bae\u5b89\u88c5\u63a7\u4ef6\u540e\u4f7f\u7528\u8d85\u5927\u9644\u4ef6\u4e0a\u4f20\u3002</div>','<div class="addrtitle">\u4f7f\u7528\u63a7\u4ef6\u80fd\u591f\u66f4\u52a0\u5feb\u901f\u7a33\u5b9a\u5730\u4e0a\u4f20\u6587\u4ef6\u3002</div>',"$@$else$@$","$@$if($overtotal$==1)$@$",'<div class="bold" style="margin-bottom:10px;">\u4f60\u6dfb\u52a0\u7684\u9644\u4ef6\u6587\u4ef6\u603b\u5927\u5c0f\u8d85\u8fc7$totalsize$M</div>',"$@$else$@$",'<div class="bold" style="margin-bottom:10px;">\u4f60\u6dfb\u52a0\u7684\u9644\u4ef6\u6587\u4ef6\u4e2d\uff0c\u6709\u4e9b\u8d85\u8fc7\u4e86$singlesize$M</div>',"$@$endif$@$","\u5efa\u8bae\u4f60\u8f6c\u4e3a\u8d85\u5927\u9644\u4ef6\u53d1\u9001\u3002<br>",'<div class="addrtitle">\u8d85\u5927\u9644\u4ef6\u4e0d\u6c38\u4e45\u4fdd\u5b58\uff0c\u66f4\u73af\u4fdd\uff0c\u5bf9\u65b9\u4e5f\u53ef\u4ee5\u9ad8\u901f\u4e0b\u8f7d\u3002</div>',"$@$endif$@$","</div>","</div>",'<div class="dialog_operate">','<div id="dlgtype" dlgtype="$overtotal$">',"$@$if($needDownloadFTNwidget$)$@$",'<a href="/cgi-bin/readtemplate?t=browser_addon&kvclick=readtemplate|browser_addon|bigattach_recommend|qmattach_select&returnsid=$sid$&sid=$sid$&nocheckframe=true" class="btn_blue" id="download" nocheck="true" target="_blank" initlized="nocheck">\u7acb\u5373\u5b89\u88c5</a>','<a href="javascript:;" class="btn_gray" id="bigAttSend" nocheck="true" initlized="nocheck">\u7ee7\u7eed\u4e0a\u4f20</a>',"$@$else$@$",'<a class="btn_blue btn_space" id="bigAttSend" initlized="nocheck">\u662f\uff0c\u4f7f\u7528\u8d85\u5927\u9644\u4ef6</a>',"$@$if($overtotal$==1)$@$",'<a class="btn_gray" id="cancel" value="" nocheck="true" initlized="nocheck">\u4e0d\uff0c\u53d6\u6d88\u4e0a\u4f20</a>',"$@$else$@$",'<a class="btn_gray" id="send" value="" nocheck="true" initlized="nocheck">\u4e0d\uff0c\u4f7f\u7528\u666e\u901a\u9644\u4ef6</a>',"$@$endif$@$","$@$endif$@$","</div>","</div>"]).replace({singlesize:r._mnAttToFtnSize,totalsize:r._mnSizeLimit,oversingle:i?1:0,overtotal:t?1:0,needDownloadFTNwidget:s?1:0,sid:a.getSid()}),onshow:function(){this.S("download")?this.S("download").focus():this.S("bigAttSend")&&this.S("bigAttSend").focus()},onload:function(){var t=this,i=t.S("dlgtype").getAttribute("dlgtype");a.addEvent(t.S("bigAttSend"),"click",function(e){0==r.hasSend&&(a.preventDefault(e),a.stopPropagation(e),n(!0),a.ossLog("delay","all","stat=nothing&locval=qmattach,toftn,1,"+i),t.close(),r.hasSend=!0)}),a.addEvent(t.S("send"),"click",function(e){0==r.hasSend&&(a.preventDefault(e),a.stopPropagation(e),n(!1),a.ossLog("delay","all","stat=nothing&locval=qmattach,toftn,0,"+i),t.close(),r.hasSend=!0)}),a.addEvent(t.S("download"),"click",function(e){a.stopPropagation(e),t.close()}),a.addEvent(t.S("cancel"),"click",function(e){a.preventDefault(e),a.stopPropagation(e),a.ossLog("delay","all","stat=nothing&locval=qmattach,toftn,-1,"+i),t.close()})}})},afterAddFileWithIE:function(e){var t=getTop().createActiveX(2),i=e.name,o=e.value;if(t){var n=parseInt(t.GetFileSize(o));null!=n&&(getTop().S("SIZE"+i,window).name=n,getTop().S("SIZE"+i,window).innerHTML="("+this._formatSize(parseInt(n))+")"),delete t}return getTop().S("S"+i,window).innerHTML=_insertWbr(o.split("\\").pop()),getTop().show(getTop().S("D"+i,window),!0),setFileNameToSubject(o),this._addFileCell("ie")._checkBtn()},checkAttachWarnningType:function(){var o=this,n=[],e=getTop().S("exist_file",window),t=e?e.childNodes:[];return getTop().E(t,function(e){if("DIV"==e.tagName){var t=getTop().S("eas_"+e.id.split("_").pop(),window),i=t&&(t.innerText||t.textContent)||"";o._isWarnningType(i)&&n.push(o._subFileName(i))}}),getTop().E(o._moExistList,function(e){var t=getTop().S("Uploader"+e,window),i=t&&t.value||"";o._isWarnningType(i)&&n.push(o._subFileName(i))}),n},delAttach:function(e){var t=this;return _oFileObj=getTop().S(e),_oCurInfo=t._moCurUploadAttachInfo,_nListIdx=t._getExistListIdxByAttachName(e),_oFileObj&&_oFileObj.disabled&&t._removeForwardAttachList(_oFileObj.value),_oCurInfo&&"Uploader"+_oCurInfo._sId==e&&t._stopCurUpload(_oCurInfo._sId),-1!=_nListIdx&&t._spliceExistList(_nListIdx),getTop().removeSelf(getTop().S("D"+e,window)),t._checkBtn()},delExistAttach:function(e){getTop();var t=getTop().S("eas_"+e,window);return t&&this._removeForwardAttachList(getTop().fixNonBreakSpace(t.textContent||t.innerText)),getTop().removeSelf(getTop().S("ea_"+e,window)),this._checkBtn()},delBigAttach:function(e){var t=getTop().parents("div.attsep",e)[0];getTop().removeSelf(t);var i=e.getAttribute("data-sid");if(i){var o=this._getExistListIdxByAttachId(i);t&&-1!=o&&this._spliceExistList(o)}},disableControl:function(e){return this._mbIsDisableControl=!0,(e?this.delAttach(e):this._removeNotFinishAttach())._disableFlash()},getAttachLimit:function(){return 1024*this._mnSizeLimit*1024},getAttachSize:function(i){var o=this,n=0,e=getTop().S("exist_file",window),t=e?e.childNodes:[],a=this._moExistInfos;return getTop().E(t,function(e){if("DIV"==e.tagName){var t=getTop().S("s"+e.id,window);t&&(n+=o._unFormatSize(t.innerHTML))}}),getTop().E(this._moExistList,function(e){if("normal"==i){var t=a[e]._oFile;t&&t.get&&(t.get("bUpToFtn")||72===t.get("nAppId"))||(n+=a[e]._nSize)}else n+=a[e]._nSize}),n},getExistList:function(){return this._moExistList},setExistList:function(e){this._moExistList=e},getExistInfos:function(){return this._moExistInfos},setExistInfos:function(e){this._moExistInfos=e},hasAttach:function(e){for(var t,i=this._moExistList,o=this._moExistInfos,n=0,a=i.length;n<a;n++){var r=i[n];if(o[r]._sCode)return!0;if(getTop().S("Uploader"+r,window).value)return!0}if(getTop().S("exist_file",window))for(n=0,a=(t=getTop().S("exist_file",window).childNodes).length;n<a;n++)if(3!=t[n].nodeType)return!0;if(e&&getTop().S("BigAttach",window))for(n=0,a=(t=getTop().S("BigAttach",window).childNodes).length;n<a;n++)if(3!=t[n].nodeType&&getTop().isShow(t[n]))return!0;return!1},hasUploadError:function(){return 0!=this._getTotalStatusAttachLength("error")},updateBigAttachCnt:function(){var e=getTop().CN("js_exist_big_attach",document.getElementById("BigAttach"));e&&0<e.length&&(_getSubmitForm().bigattachcnt.value=e.length)},hideDragAndDropContainer:function(){var e=getTop(),t=this._moDragAndDropContainer,i=e.S("dragAndDropTrap",window),o=e.GelTags("a",i)[0];t&&(t.style.left=t.style.top="-400px",o.innerHTML="",o.title="\u70b9\u51fb\u6253\u5f00\u62d6\u62fd\u6258\u76d8",getPageEditor()._bOpenDragDropContainer=!1)},outputBtn:function(e,t,i,o){var n,a="number"!=typeof i?this._mnSizeLimit:this._mnSizeLimit=i;if(!(0<a&&this._isAllowFlash())||getTop().gbIsTT&&this._isAllowUseActiveX()||getTop().goExpers&&1==getTop().goExpers.dropFlash?this._mbIsInitlized=!0:(n=getTop().T(['<div id="flashUploadContainer" ','style="position:absolute;width:$width$px;height:$height$px;margin:$margin$;z-index:1;" ',"onMouseOver=\"this.parentNode.getElementsByTagName('a')[0].style.textDecoration='underline'\" ","onMouseOut=\"this.parentNode.getElementsByTagName('a')[0].style.textDecoration='none'\">","$code$","</div>"]).replace(o?{width:95,height:25,margin:"-3px 0 0",code:this._getFlashUploaderCode()}:{width:70,height:19,margin:"0",code:this._getFlashUploaderCode()}),this._initFlashUploader()),getTop().gbIsIE&&getTop().createBlankIframe(window,{body:['<input id="btn" type="button" onclick="',"parent.document.getElementById('AttachFrame').onclick = function() ","{","var _oUploaderBtn = parent.QMAttach.selectFileWithIE();","if(_oUploaderBtn)","{","_oUploaderBtn.click();","}","return false;","};",'" />'].join(""),onload:function(){getTop().fireMouseEvent(getTop().S("btn",this.contentWindow),"click")}}),o)return this._msMode="easy",getTop().T(["$flash$",'<a id="AttachFrame" onclick="$onclick$();" onmousedown="return false;" style="display:$display$;" ',' title="\u6dfb\u52a0\u5c0f\u4e8e $sizelimit$M \u7684\u6587\u4ef6\u4f5c\u4e3a\u9644\u4ef6" sizelimit="$sizelimit$" >','<img src="$image_path$compose_easy_attch.gif" align="absmiddle"/>\u53d1\u6587\u4ef6',"</a>"]).replace({flash:n,onclick:"QMAttach.selectFile",display:0<a?"":"none",sizelimit:a,image_path:getTop().getPath("image")});getTop().detectActiveX(3,1);var r=getTop().T("\u53ef\u4ee5\u5411\u4efb\u4f55\u90ae\u7bb1\u53d1\u9001\u6700\u5927 $size$ \u7684\u9644\u4ef6").replace({size:"2G"});return e&&0<a&&(this._isSupportActiveXDrag()||this._isSupportHTML5Drag()?this._initDragAndDropTrap():(getTop().gbIsIE||getTop().QMAXInfo.mbAblePlugin&&!getTop().gbIsOpera)&&this._initDragAndDropTrap(!0)),getTop().TE(["$flash$",'$@$if($display$!="none")$@$','<span style="position:relative;margin:0 10px 0 0;" class="dragAndDropTrap_box">','<span id="AttachFrame" onclick="$onclick$();return false;" onmousedown="return false;" ','title="\u6dfb\u52a0\u5c0f\u4e8e $sizelimit$M \u7684\u6587\u4ef6\u4f5c\u4e3a\u9644\u4ef6" sizelimit="$sizelimit$" >','<input tabindex="-1" type="button" class="ico_att" align="absmiddle"','unselectable="on" onmousedown="return false"/>','<a href="javascript:;" hidefocus>','<span id="sAddAtt1" tabindex="0">\u6dfb\u52a0\u9644\u4ef6</span>','<span id="sAddAtt2" tabindex="0" style="display:none;">\u7ee7\u7eed\u6dfb\u52a0</span>',"</a>","</span>",'<span id="dragAndDropTrap" style="display:none;"> <a onmousedown="return false;"','title="\u70b9\u51fb\u6253\u5f00\u62d6\u62fd\u6258\u76d8" class="ico_moreupload" tabindex="-1"> </a></span>',"</span>","$@$endif$@$",'$@$if($baDisplay$!="none")$@$','<span id="bigAttachLink" style="margin-right:12px;" title="$baTitle$" onclick="initFileTransporter();return false" onmousedown="return false;" >','<input name="activexControlBtn" type="button" class="ico_attbig" align="absmiddle" hidefocus/>','<a href="javascript:;" hidefocus>\u8d85\u5927\u9644\u4ef6</a>',"</span>","$@$endif$@$"]).replace({flash:n,onclick:"QMAttach.selectFile",display:0<a&&e?"":"none",sizelimit:a,baDisplay:t?"":"none",baTitle:r})},retryUpload:function(e){var t=this._getExistListIdxByAttachName(e);if(-1!=t){var i=this._moExistInfos[this._moExistList[t]];"error"==i._sStatus&&(this._updateAttachStatus(i,"ready"),this._upload())}return this},selectFile:function(e,t){if(this._isAllowUseActiveX()){if(this._isAllowSelectFile()){var i=getTop().createActiveX(2);i&&(this._addActiveXFile("clipboard"==e?i.GetClipboardFiles():i.SelectFiles(getTop()),i),"clipboard"==e&&i.GetClipboardFiles()&&getTop().preventDefault(t),delete i)}}else"clipboard"!=e&&this._isAllowSelectFile()&&this._addFileCell("tradition")._checkBtn();return this},selectFileWithIE:function(){if(this._isAllowUseActiveX())this.selectFile();else if(this._isAllowSelectFile()){var e=getTop().S("Uploader"+this._getCurAttachId(),window);return e||(this._addFileCell("ie"),e=getTop().S("Uploader"+this._getCurAttachId(),window)),e}},setInput:function(e,t){var i=this._moExistList,a=this._moExistInfos,r=this._moUploadFtnFileId;if(e&&t){var s=[],l=[];return getTop().E(i,function(e){var t=a[e],i=t._sUploadId,o=(t._sMode,t._oFile),n=!1;i&&!t._bIsSeted&&(o&&o.get&&(o.get("bUpToFtn")||72==o.get("nAppId"))||(0<r.length&&getTop().E(r,function(e){i==e&&(l.push(i),n=!0)}),0==n&&s.push(i)))}),e.value=s.join("|"),t.value=l.join("|"),s}return 0},showAttachLimit:function(e){var t=getTop();new t.QMDialog({sid:"attachAlert",sTitle:"\u9644\u4ef6\u63d0\u793a",sBodyHtml:t.TE(['<div style="padding:12px 10px 0 12px;text-align:left;">','<div style="float:left;height:60px;">','<img src="$image_path$ico_question.gif" align="absmiddle"',' style="margin:5px 0 0 10px;">',"</div>",'<div style="padding-top:10px;height:60px;overflow:hidden;">',"\u60a8\u6240\u9009\u62e9\u7684\u6587\u4ef6\u8d85\u8fc7\u4e86 $size$ \u7684\u9644\u4ef6\u5927\u5c0f\u4e0a\u9650\u3002<br>","$@$if($hideBigAttach$==0)$@$",'<span>\u5efa\u8bae\u4f7f\u7528 <a id="link_bigattach" nocheck="true">','<input type="button" class="ico_attbig" align="absmiddle"',' style="margin:0 3px 0 0!important;margin:0 3px 2px 0" />',"\u8d85\u5927\u9644\u4ef6</a> \u4e0a\u4f20\u53d1\u9001\u3002</span>","$@$endif$@$","</div>","</div>"]).replace({hideBigAttach:this.mbHideBigAttach?1:0,image_path:t.getPath("image"),size:this._formatSize(e)}),nHeight:135,onload:function(){var e=this;t.addEvent(e.S("link_bigattach"),"click",function(){e.close(),_bGoFtn?(initFileTransporter(!0),debug("switch upload to: ftn")):(t.E(_aoFiles,function(e){e.set("bUpToFtn",!0),_oSelf._addFileCell(e)}),_afCallback(_aoFiles),debug("switch upload to: "+(_aoFiles[0].oUploader?_aoFiles[0].oUploader.name:"undefined")))})}})},showMeetingAttachLimit:function(e){var i=getTop();new i.QMDialog({sid:"attachAlert",sTitle:"\u9644\u4ef6\u63d0\u793a",sBodyHtml:i.TE(['<div class="dialog_function">','<span class="dialog_icon icon_info_b"></span>','<div class="dialog_f_c" style="text-align:left;">','<div class="bold">\u6682\u4e0d\u652f\u6301\u4e0a\u4f20\u603b\u91cf\u8d85\u8fc7 $size$ \u7684\u9644\u4ef6</div>',"</div>","</div>",'<div class="dialog_operate">','<div id="dlgtype" dlgtype="$overtotal$">','<a class="btn_gray" id="meetingAttach" value="" nocheck="true" initlized="nocheck">\u5173\u95ed</a>',"</div>","</div>"]).replace({size:this._formatSize(e)}),nHeight:135,onload:function(){var t=this;i.addEvent(t.S("meetingAttach"),"click",function(e){t.close()})}})},isUploading:function(){for(var e=0,t=this._moExistList.length;e<t;e++){var i=this._moExistList[e],o=this._moExistInfos[i]._sStatus;if("uploading"==o||"progress"==o)return!0}},upload:function(){return this._upload(!0)},_addActiveXFile:function(e,a){if(e&&"string"==typeof e){var r=[],s=0;getTop().E(e.split("\r\n"),function(e){var t=getTop().trim(e).split(" ");if(2<=t.length){var i=t.shift(),o=t.join(" "),n=parseInt(a.GetFileSize(o));r.push({_sCode:i,_sName:o.split("\\").pop(),_nSize:n}),s+=n}}),this._addControlFile("activex",r,s)}},_addControlFile:function(t,e,i,o){if(this.getAttachSize()+i>this.getAttachLimit())this.showAttachLimit(this.getAttachLimit());else{var n=this,a=[],r=[];getTop().E(e,function(e){e._nSize<=0?a.push(e._sName):n._isWarnningType(e._sName)?r.push(n._subFileName(e._sName)):n._addFileCell(t,[t,getTop().now(),e._sCode].join("_"),e._sCode,e._sName,e._nSize,e._oFile)}),"nftn"==o?this._checkBtn():this._checkBtn()._upload(),(0<a.length||0<r.length)&&getTop().msgBox(getTop().T(['<div style="display:$sizedisp$;">$sizefiles$ \u7684\u5927\u5c0f\u4e3a 0 \u5b57\u8282\uff0c\u56e0\u6b64\u65e0\u6cd5\u6dfb\u52a0\u6b64\u6587\u4ef6\u3002</div>','<div style="display:$typedisp$;">$typefiles$ \u662f\u53ef\u6267\u884c\u6587\u4ef6\u3002\u51fa\u4e8e\u5b89\u5168\u6027\u8003\u8651\uff0c\u4e0d\u5141\u8bb8\u6dfb\u52a0\u6b64\u6587\u4ef6\u3002</div>']).replace({sizedisp:a.length?"":"none",sizefiles:getTop().htmlEncode(a.join(", ")),typedisp:r.length?"":"none",typefiles:getTop().htmlEncode(r.join(", "))}),"dialog")}},_addFlashOrAppletFile:function(e,t,i,o){if(this._isAllowSelectFile()){for(var n=[],a=0,r=parseInt(e),s=parseInt(t);r<=s;r++){var l=r,d=new String(i.getFileInfo(r,"name")),c=parseInt(i.getFileInfo(r,"size")||0);n.push({_sCode:l,_sName:d.split("\\").pop(),_nSize:c}),a+=c}this._addControlFile(o,n,a)}},_addFileCell:function(e,t,i,o,n,a){var r=t||this._getNewAttachId(),s="Uploader"+r,l=!(!a||!a.get)&&a.get("bUpToFtn");if(!getTop().S(s)){var d={tradition:"tradition",ie:"ie"}[e||"tradition"]||"control";this._pushExistList(r,e,i,o,n,d,a);var c=document.createElement("div");c.className="attsep",c.id="D"+s,c.innerHTML=this._getFileCellTmpl(d).replace({id:t,value:i,name:s,ext:e,filename:getTop().htmlEncode(o),dispfname:_insertWbr(o),size:n||0,formatsize:this._formatSize(parseInt(n||0),!0),ftn:l}),"ie"==d&&getTop().show(c,!1),getTop().S(l?"BigAttach":"filecell",window).appendChild(c),getTop().show(getTop().S("attachContainer",getTop().getMainWin()),!0),o&&setFileNameToSubject(o)}return this},_checkBtn:function(){var e=this.hasAttach();return getTop().show(getTop().S("sAddAtt1",window),!e),getTop().show(getTop().S("sAddAtt2",window),e),this},_clearUploadInfo:function(){return this._moCurUploader=this._moCurUploadAttachInfo=this._moCurUploadTimeStamp=null,this},_disableFlash:function(){if(this._moFlashCtrl&&this._moFlashCtrl.disable(),getTop().show(getTop().S("flashUploadContainer",window),!1),this._bUseNewLogic){var e=getTop().S("AttachFrame",window);getTop().show(e.firstChild,!1)}return this},_doFlashUploaderSetup:function(e,t,i){var o=this;o._moFlashCtrl=e,setTimeout(function(){o._mbIsInitlized=!0,t?e.getFlash().initlize("multi"):o._disableFlash()},100)},_formatSize:function(e,t){if(isNaN(e))return"";if(1048576<e){var i=parseInt(100*e/1048576)/100+"M";return t?"("+i+")":i}if(1024<e){i=parseInt(100*e/1024)/100+"K";return t?"("+i+")":i}if(0<e&&e<1024){i=e+"B";return t?"("+i+")":i}return 0==e?" ":void 0},_getHTML5DropCode:function(){var t=getTop(),i=this,o=QMDragFile;return(getTop().gbIsFF?function e(){return setTimeout(function(){o._addEvent(2),t.S("html5_dragdrop_area",window).innerHTML=i._msDragEnter},100),'<div id="html5_dragdrop_area" style="width:100%;height:100%;font-size:14px;text-align:center;line-height:150px;"></div>'}:function n(){return setTimeout(function(){o._addEvent(4);var e=t.S("html5_dragdrop_area",window);e.innerHTML=i._msDragEnter,t.addEvent(e.parentNode,"dragover",function(e){o._nCloseTimeout&&(t.clearTimeout(o._nCloseTimeout),o._nCloseTimeout=null),t.stopPropagation(e)})},100),'<div style="width:100%;height:100%;font-size:14px;text-align:center;line-height:150px;position:relative;"><input type="file" style="position:absolute;width: 100%;height: 100%;top: 0;left: 0;opacity:0;" multiple="true"/><div id="html5_dragdrop_area"></div></div>'})()},_getFirefoxDropCode:function(){var n=this;return setTimeout(function(){var e=getTop().S("dndMsg",window),i={dragenter:function(){e.innerHTML=n._msDragOver},dragexit:function(){e.innerHTML=n._msDragEnter},dragover:function(){},dragdrop:function(e){var t=getTop().createActiveX(2);n._addActiveXFile(e,t),delete t,n.hideDragAndDropContainer(),i.dragexit()}},t=getTop().createActiveX(4),o=getTop().S("ff_dragdrop_area",window);t.AddTarget(o,function(e,t){i[e](t)}),e.innerHTML=n._msDragEnter},100),'<div id="ff_dragdrop_area" style="width:100%;height:100%;" ondragover="event.preventDefault()"></div>'},_getActiveXDropCode:function(){if(!getTop().gbIsIE)return this._getFirefoxDropCode();var o=this;return setTimeout(function(){var i={ENTER:function(){e.text=o._msDragOver},LEAVE:function(){e.text=o._msDragEnter},OVER:function(){},FINISH:function(e){var t=getTop().createActiveX(2);o._addActiveXFile(e,t),delete t,o.hideDragAndDropContainer(),i.LEAVE()}},e=getTop().S("dropAndDragFile",window);e.text=o._msDragEnter,e.backColor=16777215,e.textColor=0,e.textFacName="\u5b8b\u4f53",e.textFontSize=10,e.textFontWeight=500,e.OnFilesDroped=function(e){(i[e]||i.FINISH)(e)}},100),['<object id="dropAndDragFile" classid="CLSID:F4BA5508-8AB7-45C1-8D0A-A1237AD82399"'," width=100% height=100%></object>"].join("")},_getCurAttachId:function(){return(this._mnAttachId||1)-1},_getExistAttachInfo:function(e){return(this._moExistInfos||{})[e=e||""]},_getExistListIdxByAttachId:function(e){var t=-1;if(this._moExistInfos[e])for(var i=this._moExistList,o=0,n=i.length;o<n;o++)if(i[o]==e){t=o;break}return t},_getExistListIdxByAttachName:function(e){return this._getExistListIdxByAttachId(e.replace(/^Uploader/,""))},_getFlashUploaderCode:function(){return getTop().generateFlashCode("flashUploader",getTop().getPath("swf_cdn")+"uploader.swf?r="+Math.random()+"&uin="+getTop().getCookie("biz_username"),{width:"100%",height:"100%"},{wmode:"transparent"})},_getFileCellTmpl:function(e){var t=this._moTmplSet,i=t[e];if("exist"==e)return getTop().TE(['<div class="attsep" id="ea_$id$" >','<span style="margin-right:5px;" onclick="QMAttach.preview(\'$id$\')" uploadid="$id$">','<input type="button" class="ico_att" style="margin:1px 3px 0 0!important;margin:0 -1px 2px 0" />','<input type="hidden" id="$id$" name="$attachname$" value="$value$">','<span ui-type="filename" compose_path="$id$" id="eas_$id$">$viewname$</span>&nbsp;','<span class="addrtitle">(','<span id="sea_$id$">$size$</span>)</span>',"</span>",'<a onClick="delExistAttach(\'$id$\');return false" class="att_del" href="javascript:;">\u5220\u9664</a>',"</div>"]);if("exist_big"==e)return getTop().TE(['<div class="addrtitle attsep" id="eabig_$id$" mode="$mode$">','<span id="A$name$" style="margin-right:5px;" onclick="QMAttach.preview(\'$id$\')">','<a href="$downloadlink$"></a>','<input type="button" class="ico_attbig" style="margin:0 1px 0 0!important;margin:0 3px 2px 0" />','<input type="hidden" name="fid" value="$fid$" />','<span  class="black" expiretime="$exptime$" style="vertical-align: middle;">','<span ui-type="filename">$filename$</span>','<span class="addrtitle">&nbsp;($filesize$)</span>',"</span>","</span>","$@$if($ispic$)$@$",'<a onClick="attachInsertImage(this.getAttribute(\'viewfileurl\'));" style="margin-right: 5px;" class="att_addpic" viewfileurl="/cgi-bin/ftnDownload302?sid=$sid$&fid=$fid$&code=$code$&k=$key$">\u6dfb\u52a0\u5230\u6b63\u6587</a>',"$@$else if($bIsDoc$)$@$",'<a title="\u6dfb\u52a0\u5230\u6b63\u6587" style="margin-right:5px;" class="att_addpic" onclick="existAttachInsertFile(\'$@$if($fid$)$@$$fid$$@$else$@$$uid$$@$endif$@$\')" >\u6dfb\u52a0\u5230\u6b63\u6587</a>',"$@$endif$@$",'<a onClick="delBigAttach(this)" class="att_del" href="javascript:;" style="vertical-align: middle;">\u5220\u9664</a>',"</div>"]);if("exist_meeting"==e)return getTop().TE(['<div class="attsep" id="ea_$id$" >','<span style="margin-right:5px;" uploadid="$id$">','<input type="button" class="ico_att" style="margin:1px 3px 0 0!important;margin:0 -1px 2px 0" />','<input type="hidden" id="$id$" name="$attachname$" value="$value$">','<span ui-type="filename" compose_path="$id$" id="eas_$id$">$viewname$</span>&nbsp;',"</span>",'<a onClick="delExistAttach(\'$id$\');return false" class="att_del" href="javascript:;">\u5220\u9664</a>',"</div>"]);if(!i){var o=['<div id="A$name$" class="left" style="margin-right:3px;*margin-right:2px;line-height: 16px;height: 16px;margin-top:-2px">','<input type="button" class="',"$@$if($ftn$)$@$","ico_attbig","$@$else$@$","ico_att","$@$endif$@$",'" style="margin-top: 3px;" />'];switch(e){case"rawinput":o=o.concat(['<input name="$name$" ext="$ext$" id="$name$" type="hidden" value="$value$" filename="$filename$" filesize="$size$" />','<span ui-type="filename" id="S$name$">$dispfname$</span>&nbsp;<input type="button" class="ss_icon_loading" id="L$name$" style="width:16px;height:15px;padding:0;border:none;margin:0 3px 0 0!important;margin:0 3px 2px 0;" /><span id="SIZE$name$" name="$size$" class="addrtitle" style="display:none;"></span>',"</span>",'<span id="E$name$" class="upload_ctrl" ','style="display:none;color:red;margin-right:5px;cursor:default">',"\u4e0a\u4f20\u5931\u8d25","</span>"]);break;case"tradition":o=o.concat(['<input name="$name$" class="file" id="$name$" contentEditable="false" type="file" onchange="',"setFileNameToSubject(this.value);",'" size=45>',"</div>"]);break;case"ie":o=o.concat(['<input name="$name$" class="file upload" id="$name$" type="file" onchange="',"QMAttach.afterAddFileWithIE(this);",'">','<span id="S$name$"></span>&nbsp;<span id=SIZE$name$ name="$size$"></span></div>',"</div>"]);break;case"control":o=o.concat(['<input name="$name$" ext="$ext$" id="$name$" type="hidden" value="$value$" filename="$filename$" filesize="$size$" disabled>','<span id="S$name$">$dispfname$</span>&nbsp;<span id="SIZE$name$" name="$size$" style="color:#7a8f99;display: inline-block;margin-top: 4px;height:16px;">&nbsp;$formatsize$&nbsp;</span>',"</div>",'<div id="P$name$" class="left bd_upload" style="font-size:1px;width:100px;height:10px;overflow:hidden;border-width:1px;margin-top:5px;">','<div id="PB$name$" class="fdbody" style="width:0%;font-size:1px;height:10px;overflow:hidden;padding:0;border:0;margin:0;"></div>',"</div>",'<div id="E$name$" class="left upload_ctrl" ','style="display:none;color:red;margin-right:5px;cursor:default">\u4e0a\u4f20\u5931\u8d25</div>'])}t[e]=i=getTop().TE(o.concat(['<div class="left upload_ctrl" >','<a id="R$name$" style="margin-right:5px;display:none;" onclick="',"QMAttach.retryUpload('$name$');",'">\u91cd\u8bd5</a>','<span style="display: inline-block;margin-top: 1px;" id="V$name$Container" onclick="attachInsertImage(this.getAttribute(\'viewfileurl\'));">','<a id="V$name$" style="display:none;margin-right:5px;cursor: pointer;" class="att_addpic">\u6dfb\u52a0\u5230\u6b63\u6587</a>',"</span>",'<span style="display: inline-block;margin-top: 1px;" id="C$name$Container" onclick="attachInsertFile(this.getAttribute(\'fileid\'), this.getAttribute(\'codeid\'));">','<a id="C$name$" style="display:none;margin-right:5px;cursor: pointer;" class="att_addpic">\u6dfb\u52a0\u5230\u6b63\u6587</a>',"</span>",'<a style="display: inline-block;margin-top: 1px;" onclick="delAttach(\'$name$\');return false" href="javascript:;">\u5220\u9664</a>','<a id="O$name$" style="margin-left:5px;display:none;" onclick="',"QMAttach.disableControl('$name$');",'">\u53bb\u6389\u5e76\u6539\u7528\u4f20\u7edf\u4e0a\u4f20\u5668</a>',"</div>",'<div style="clear:both;"></div>']))}return i},_getNewAttachId:function(){return this._mnAttachId++},_updateExistAttachInfo:function(e){var t=getTop(),i=e.sId;return this._moExistInfos[i]&&t.extend(this._moExistInfos[i],e),null},_getNextReadyAttachInfo:function(){for(var e=this._moExistList,t=this._moExistInfos,i=0,o=e.length;i<o;i++){var n=t[e[i]];if("ready"==n._sStatus)return n}return null},_getNextAttachInfoByStatus:function(e){var t=this._moExistList,i=this._moExistInfos;e=e||"ready";for(var o=0,n=t.length;o<n;o++){var a=i[t[o]];if(a._sStatus==e)return a}return null},_getTotalControlAttachLength:function(){return this._moExistList.length-this._getTotalStatusAttachLength("")},_getTotalStatusAttachLength:function(e){for(var t=this._moExistList,i=this._moExistInfos,o=0,n=0,a=t.length;n<a;n++)i[t[n]]._sStatus==e&&o++;return o},_getUploadUrl:function(){var e=getTop();return e.T("$host$/cgi-bin/upload?sid=$sid$&ssl_edition=$ssl$&uin=$bizusername$&r=$r$").replace({host:[location.protocol,location.host].join("//"),sid:e.getSid(),ssl:e.getCookie("ssl_edition"),bizusername:e.getCookie("biz_username"),r:Math.random()})},_initFlashUploader:function(){var o=this,e=getTop();setTimeout(function(){new e.qmFlash({id:"flashUploader",win:window,onSelect:function(e,t){o._addFlashOrAppletFile(e,t,this.getFlash(),"flash")},onProcess:function(e,t){o._isCurUploadAttach(e)&&o._uploadProgress(t)},onError:function(e,t,i){o._isCurUploadAttach(e)&&o._uploadError(t,i)},onComplete:function(e,t){o._isCurUploadAttach(e)&&o._uploadComplete(t)}}).setup(function(e,t){o._doFlashUploaderSetup(this,e,t)})},10)},_initDragAndDropContainer:function(){var e=getTop(),t=this,i=e.getMainWin().document,o=t._moDragAndDropContainer;if(!o){var n="dndContainer"+e.unikey();(o=t._moDragAndDropContainer=i.createElement("div")).id="dndContainer",o.className="QMEditorMenuBorder dndContainer",o.innerHTML=e.T(['<div style="padding:5px 5px 0;font-size:12px;">','<a class="right" id="$sCloseBtnId$">',"\u5173\u95ed","</a>","</div>",'<div style="height:150px;"></div>']).replace({sCloseBtnId:n}),i.body.insertBefore(o,i.body.firstChild),e.S(n,i).onclick=function(){t.hideDragAndDropContainer()}}t.hideDragAndDropContainer()},_showDragAndDropContainer:function(e,t,i){var o=this,n=getTop(),a=o._isSupportHTML5Drag(!0),r=n.S("dragAndDropTrap",window);if(r&&o._isAllowSelectFile()&&(a||!o._isSupportHTML5Drag(!1))){var s=o._moDragAndDropContainer,l=n.GelTags("a",r)[0],d=n.calcPos(n.S("AttachFrame",window)),c=!1;if(s||(c=!0,s=o._moDragAndDropContainer=document.createElement("div"),document.body.insertBefore(s,document.body.firstChild),s.id="dndContainer",s.className="QMEditorMenuBorder",s.innerHTML=n.T(['<div style="padding:5px 5px 0;font-size:12px;">','<a class="right" onclick="QMAttach.hideDragAndDropContainer();">',"\u5173\u95ed","</a>",'<div id="dndMsg" class="graytext">loading...</div>',"</div>",'<div style="height:150px;"></div>'])),n.gbIsWebKit)try{var p=n.GelTags("input",s)[0].files;p&&0<p.length&&(c=!0)}catch(m){}if(c||parseInt(s.style.left)<0){function g(){s.style.left=d[3]+"px",s.style.top=d[2]+2+"px",l.innerHTML="",l.title="\u70b9\u51fb\u5173\u95ed\u62d6\u62fd\u6258\u76d8",getPageEditor()._bOpenDragDropContainer=!0}if(c){function u(){s.lastChild.innerHTML=a?o._getHTML5DropCode():o._getActiveXDropCode(),n.S("dndMsg",window).innerHTML="&nbsp;"}getTop().gbIsFF?setTimeout(u,100):u(),getTop().gbIsWebKit?setTimeout(g,100):g()}else g()}else e&&o.hideDragAndDropContainer()}},_initDragAndDropTrap:function(e){var a=this;setTimeout(function(){var o=getTop().S("dragAndDropTrap",window);if(o){var n=getTop().GelTags("a",o)[0];e&&(n.disabled=!0,n.className+=" graytext"),getTop().addEvent(document,"click",function(e){var t=e.srcElement||e.target,i=a._moDragAndDropContainer;if(getTop().isObjContainTarget(o,t)&&"\u62d6\u62fd\u4e0a\u4f20"==t.innerText){if(n.disabled)return showInstallActiveXDialog("drag")}else"\u62d6\u62fd\u4e0a\u4f20"==t.innerText||i&&!getTop().isObjContainTarget(i,t)&&a.hideDragAndDropContainer()}),getTop().show(o,!0),o.title="\u70b9\u51fb\u6253\u5f00\u9644\u4ef6\u6258\u76d8\uff0c\u5141\u8bb8\u76f4\u63a5\u62d6\u52a8\u6587\u4ef6\u5230\u8be5\u533a\u57df\u6dfb\u52a0\u9644\u4ef6\u3002"}},10)},_isAllowFlash:function(){var e,t=getTop();return t&&t.QMFileAdaptor&&t.QMFileAdaptor.getNormalUploadCom&&"function"==typeof t.QMFileAdaptor.getNormalUploadCom&&(e=t.QMFileAdaptor.getNormalUploadCom()),!this._mbIsDisableControl&&getTop().qmFlash.isSupported()&&(getTop().gbIsIE||"https:"!=location.protocol||"FlashLocal"==e)},_isAllowUseActiveX:function(){return!this._mbIsDisableControl&&getTop().detectActiveX(2,1)&&1!=getTop().getUserCookieFlag("CCSHOW")[5]&&!getTop().gbIsMac},_isAllowSelectFile:function(){if(!this._mbIsInitlized)return!1;if(!getTop().getGlobalVarValue("UPLOADEXPIRE"))return!0;var t=getTop();return new t.QMDialog({sId:"mailAlarm",sTitle:"\u90ae\u7bb1\u63d0\u793a",sBodyHtml:t.T(['<div style="padding:10px 0 5px 10px;text-align:left;">','<img src="$imgPath$ico_question.gif" align="absmiddle" style="float:left;margin:14px 0 0 10px;">','<div style="width:300px;height:80px;overflow:hidden;"><table width=300px height=80px><tr><td style="line-height:20px;">','\u60a8\u6700\u8fd124\u5c0f\u65f6\u5185\u53d1\u9001\u8d85\u8fc7<b style="color:red;">$size$M</b>\u7684\u666e\u901a\u9644\u4ef6\uff0c\u572824\u5c0f\u65f6\u671f\u6ee1\u524d',"\u5c06\u4e0d\u80fd\u53d1\u9001\u5927\u9644\u4ef6\uff0c\u4e3a\u4fdd\u8bc1\u670d\u52a1\u8d44\u6e90\u5408\u7406\u5229\u7528\uff0c\u8bf7\u6539\u7528\u201c\u8d85\u5927\u9644\u4ef6\u201d\u529f\u80fd\u53d1\u9001\u3002","</td></tr></table></div>","</div>",'<div style="text-align:right;padding:0 10px 10px 0;">','<input class="wd2 btn" type=button id="confirm" value=\u786e\u8ba4 style="margin-right:5px;" >','<input class="wd2 btn" type=button id="cancel" value=\u53d6\u6d88>',"</div>"]).replace({imgPath:t.getPath("image"),size:200}),nHeight:120,onload:function(){var e=this;t.addEvent(e.S("confirm"),"click",function(){e.close(),initFileTransporter()}),t.addEvent(e.S("cancel"),"click",function(){e.close()})},onshow:function(){this.S("confirm").focus()}}),!1},_isCurUploadAttach:function(e){var t=this._moCurUploadAttachInfo;return t&&t._sCode==e},_isSupportActiveXDrag:function(){return getTop().detectActiveX(4,1)},_isSupportHTML5Drag:function(e){var t=getTop();return(t.gbIsFF&&t.FileReader||t.gbIsChrome&&4<=(""+t.gsChromeVer).split(".")[0]||t.gbIsSafari&&4<=(""+t.gsSafariVer).split(".")[0])&&(!e||QMDragFile.bInit)},_isWarnningType:function(e){for(var t=this._msWarnningTypes.split("|"),i=!1,o=(e||"").split(".").pop().toLowerCase(),n=0;n<t.length;n++)o==t[n]&&(i=!0);return i},_isSecretAllowType:function(e){for(var t=this._msSecretAllowTypes.split("|"),i=!1,o=(e||"").split(".").pop().toLowerCase(),n=0;n<t.length;n++)if(o==t[n]){i=!0;break}return i},_pushExistList:function(e,t,i,o,n,a,r){this._moExistList.push(e),this._moExistInfos[e]={_sId:e,_sMode:t,_sCode:i,_sName:o,_nSize:n,_oFile:r,_sStatus:"control"==a?"ready":"",_sUploadId:null,_bIsSeted:!1}},_removeForwardAttachList:function(e){for(var t=getTop().S("fattachlist",window),i=-1!=t.value.indexOf(" |")?" |":"|",o=t.value.split(i)||[],n=-1,a=0;a<o.length;a++)if(getTop().fixNonBreakSpace(o[a])==e){n=a;break}-1!=n&&(o.splice(n,1),t.value=o.join(i))},_removeNotFinishAttach:function(){_oExistList=this._moExistList,_oExistInfos=this._moExistInfos;for(var e=_oExistList.length-1;0<=e;e--){var t=_oExistList[e],i=_oExistInfos[t]._sStatus;i&&"finish"!=i&&this.delAttach("Uploader"+t)}return this},_spliceExistList:function(e){return delete this._moExistInfos[e],this._moExistList.splice(e,1)},_stopCurUpload:function(e){var t=this,i=t._moCurUploadAttachInfo;if(i){switch(t._mkCtrlTime(i,!0),t._moCurUploadAttachInfo=null,i._sMode){case"activex":t._moCurUploader.StopUpload();break;case"flash":t._moCurUploader.cancel();break;case"applet":t._moCurUploader.cancel(i._sCode);break;case"xhr5":t._moCurUploader.abort();break;case"flashFTN":t._moCurUploader.set("sStatus","cancel"),t._moCurUploader.fCancel();case"h5c":t._moCurUploader.set("sStatus","cancel");case"rawinput":t._moCurUploader.set("sStatus","cancel")}t._upload(!0)}return t},_subFileName:function(e){var t=e.length-6,i=e.substr(0,t),o=e.substr(t);return getTop().subAsiiStr(i,8,"...")+o},_unFormatSize:function(e){return-1!=(e=e.toLowerCase()).indexOf("k")?1024*parseFloat(e):-1!=e.indexOf("m")?1024*parseFloat(e)*1024:parseFloat(e)},_updateAttachUI:function(e,t,i){var o="Uploader"+e,n=getTop();return n.E(t.split("|"),function(e){n.show(n.S(e+o,window),!0)}),n.E(i.split("|"),function(e){n.show(n.S(e+o,window),!1)}),this},_updateAttachStatus:function(e,t,i,o){if(!e)return this;var n=this,a=getTop(),r=e._sId,s=e._sCode,l="",d="";switch(t){case"ready":case"progress":l="P",d="E|O|R",this._uploadProgress(0,1,e);break;case"finish":var c=e._oFile;if(c&&c.get&&c.get("bUpToFtn")){var p=a.S("DUploader"+r,window);addExistBigAttach((c.get("nServerSecond")||c.get("nCreateTime"))+2592e3,c.get("sDownloadPage"),c.get("sName"),c.get("sFileId"),this._formatSize(parseInt(c.get("nSize")||0)),100,{nExpireTime:c.get("expireTimeStr"),sId:c.get("sId"),oUploaderDom:p}),a.removeSelf(p)}else{d="E|O|R|P";var g=a.S("AUploader"+r,window);g&&(g.style.cursor="pointer",g.onclick=function(){n.preview(r)},g.setAttribute("uploadid",r));var u=(e._sName||"").split(".").pop()||"";_isSupportImportWord(e._sName)?(l+="|C",a.S("CUploader"+r,window).setAttribute("codeid",s),a.S("CUploader"+r+"Container",window).setAttribute("codeid",s),a.S("CUploader"+r,window).setAttribute("fileid",r),a.S("CUploader"+r+"Container",window).setAttribute("fileid",r)):"img"==a.getViewTypeByExt(u)&&e.sFileUrl&&(l+="|V",a.S("VUploader"+r,window).setAttribute("viewfileurl",e.sFileUrl),a.S("VUploader"+r+"Container",window).setAttribute("viewfileurl",e.sFileUrl))}if("rawinput"==e._sMode){var m=a.S("SIZEUploader"+r,window);m&&!isNaN(e._nSize)&&(m.innerText="("+QMAttach._formatSize(e._nSize)+")")}break;case"error":l="E|O|R",d="P",getTop().S("EUploader"+r,window).title=getTop().T("\u9519\u8bef\u7c7b\u578b\uff1a$type$\n\u9519\u8bef\u6d88\u606f\uff1a$msg$").replace({type:i,msg:o})}return e._sStatus=t,this._updateAttachUI(r,l,d)},_upload:function(e){var t=this;if(!t._moCurUploadAttachInfo){var i=t._getNextReadyAttachInfo();if(i){var o,n={xhr5:t._uploadWidthXHR,activex:t._uploadWithActiveX,flash:t._uploadWithFlash,applet:t._uploadWithApplet,flashFTN:t._uploadNextFile,h5c:t._uploadNextFile,rawinput:t._uploadNextFile}[i._sMode];if(t._moCurUploadAttachInfo=i,n)try{t._updateAttachStatus(i,"progress"),n.call(t)}catch(a){o=a.msg}else o="no unpload func:"+i._sMode;o&&t._uploadError("__start__",o)}else if(e&&"function"==typeof t.onfinish){try{t.onfinish.call(t)}catch(a){getTop().doPageError(a.message,"compose.js","QMAttach.onfinish")}t.onprogress=null,t.onfinish=null}}return t},_uploadComplete:function(_asData){var _oSelf=this,_oCurInfo=this._moCurUploadAttachInfo;if(_oCurInfo){var resp={},filetype,viewfileurl;if(-1<_asData.indexOf("viewfileurl"))try{resp=eval(_asData),filetype=resp.filetype,viewfileurl=resp.viewfileurl}catch(e){}if(resp.filename){1==filetype&&(_oSelf._moCurUploadAttachInfo.sFileUrl=viewfileurl+"&sid="+_oTop.getSid());var sFileCattachName=resp.filename;sFileCattachName&&(_oSelf._moCurUploadAttachInfo.sFileCattachName=sFileCattachName,_oCurInfo._sUploadId=sFileCattachName.split("/").pop()),_oSelf._uploadProgress(100,1)._updateAttachStatus(_oCurInfo,"finish")._clearUploadInfo()._upload(!0),1<this._getTotalControlAttachLength()&&"http:"==location.protocol&&getTop().requestShowTip("AttachFrame",31,window)}else if(0==_asData.indexOf("/data/")){var _sData=getTop().trim(_asData);_oCurInfo._sUploadId=_sData.split("/").pop(),this._uploadProgress(100,1)._updateAttachStatus(_oCurInfo,"finish")._clearUploadInfo()._upload(!0),1<this._getTotalControlAttachLength()&&"http:"==location.protocol&&getTop().requestShowTip("AttachFrame",31,window)}else this._uploadError("__response__",_sData)}},_uploadError:function(e,t){this._updateAttachStatus(this._moCurUploadAttachInfo,"error",e,t)._clearUploadInfo()._upload(!0)},_uploadProgress:function(e,t,i){var o=this,n=i||o._moCurUploadAttachInfo;if(n){var a=Math.floor(e*(t||.95)),r=getTop().now();if(n._nPercent!=a&&(n._nPercent=a,o._mkCtrlTime(n),(100<=r-o._mnRomanceTime||1==t||i)&&(o._mnRomanceTime=r,getTop().S("PBUploader"+n._sId,window).style.width=a+"%",!i&&"function"==typeof o.onprogress)))try{var s=o._getTotalControlAttachLength(),l=s-1-o._getTotalStatusAttachLength("ready");o.onprogress.call(o,Math.floor((a+100*l)/s))}catch(d){}}return o},_uploadWithActiveX:function(){var _oSelf=this,_oCtrl=_oSelf._moCurUploader=getTop().createActiveX(2,getPageEditor().getEditWin()),_nTimeStamp=_oSelf._moCurUploadTimeStamp=getTop().now();_oCtrl.OnEvent=function(_aObj,_asEventID,_anP1,_anP2,_anP3){if(_oSelf._moCurUploadTimeStamp==_nTimeStamp)var _oProcessFunc={1:function(){_oSelf._uploadError("activex progress error",[_anP1,_anP2].join("|"))},2:function(){_oSelf._uploadProgress(100*_anP1/_anP2)},3:function(){if("200"!=_oCtrl.ResponseCode)_oSelf._uploadError("activex response error "+_oCtrl.ResponseCode,[_anP1,_anP2].join("|"));else{var resp=eval(_oCtrl.Response),filetype=resp.filetype,viewfileurl=resp.viewfileurl;1==filetype&&(_oSelf._moCurUploadAttachInfo.sFileUrl=viewfileurl+"&sid="+_oTop.getSid());var sFileCattachName=resp.filename;sFileCattachName&&(_oSelf._moCurUploadAttachInfo.sFileCattachName=sFileCattachName),_oSelf._uploadComplete(resp.filename)}}}[_asEventID]()},_oCtrl.URL=_oSelf._getUploadUrl()+"&insertParam=true",_oCtrl.AddHeader("Cookie",document.cookie),_oCtrl.AddFormItem("sid",0,0,getTop().getSid()),_oCtrl.AddFormItem("mode",0,0,"file"),_oCtrl.AddFormItem("UploadFile",4,0,this._moCurUploadAttachInfo._sCode),_oCtrl.StartUpload()},_uploadWithApplet:function(){var e=this._moAppletCtrl.getApplet();this._moCurUploader=e,this._moCurUploadTimeStamp=getTop().now(),e.addUploadVar("sid",getTop().getSid()),e.addUploadVar("mode","file"),e.addUploadVar("lang","utf8"),e.setUploadUrl(this._getUploadUrl());var t=e.upload(this._moCurUploadAttachInfo._sCode);"ok"!=t&&getTop().doPageError(["uploadWithApplet(",this._moCurUploadAttachInfo._sCode,") Err:",t].join(""),"compose.js",3094)},_uploadWithFlash:function(){var e=this._moFlashCtrl.getFlash();this._moCurUploader=e,this._moCurUploadTimeStamp=getTop().now(),e.addUploadVar("sid",getTop().getSid()),e.addUploadVar("mode","file"),e.addUploadVar("lang","utf8"),e.setUploadUrl(this._getUploadUrl()+"&insertParam=true"),e.upload(this._moCurUploadAttachInfo._sCode,"UploadFile")},_uploadWidthXHR:function(){try{var _oTop=getTop(),_oSelf=this,_nTimeStamp=_oSelf._moCurUploadTimeStamp=_oTop.now(),_oRequest=new XMLHttpRequest;_oSelf._moCurUploader=_oRequest,_oRequest.upload.onprogress=function(e){e.lengthComputable&&_oSelf._uploadProgress(Math.floor(e.loaded/e.total*100))},_oRequest.onreadystatechange=function(){if(4==_oRequest.readyState){_oRequest.onreadystatechange=_oRequest.upload.onprogress=null;var resp=eval(_oRequest.responseText),filetype=resp.filetype,viewfileurl=resp.viewfileurl;1==filetype&&(_oSelf._moCurUploadAttachInfo.sFileUrl=viewfileurl+"&sid="+_oTop.getSid());var sFileCattachName=resp.filename;sFileCattachName&&(_oSelf._moCurUploadAttachInfo.sFileCattachName=sFileCattachName),_oSelf._uploadComplete(resp.filename)}};var _oFile=_oSelf._moCurUploadAttachInfo._oFile,_sName=_oSelf._moCurUploadAttachInfo._sName;_sName=encodeURIComponent(_sName),_oRequest.open("POST",_oSelf._getUploadUrl()+"&mode=file&resp_charset=UTF8&insertParam=true",!0),_oRequest.setRequestHeader("X-QQMAIL-FILENAME",_sName),_oRequest.setRequestHeader("content-type","application/octet-stream"),_oRequest.send(_oFile)}catch(_aoError){debug([_aoError.message,_aoError.lineNumber])}},_showAppletPermission:function(){var e=this._moDragAndDropContainer;e&&(e.lastChild.innerHTML=['<table style="width:100%;height:100%;">','<tr><td align="center">',"<div><b>\u60a8\u7981\u6b62\u4e86\u8be5\u529f\u80fd\u4f7f\u7528</b></div>","<div>\u60a8\u5fc5\u987b\u9000\u51fa\u6d4f\u89c8\u5668\u624d\u80fd\u91cd\u65b0\u5f00\u542f\u3002</div>","</td></tr>","</table>"].join(""))},_mkCtrlTime:function(e,t){var i=this,o=getTop(),n=e||i._moCurUploadAttachInfo,a=["stat=custom&type=timecontrol&info=",n._sMode.substr(0,2),"_",o.gbIsIE?1:o.gbIsFF?2:o.gbIsChrome?3:o.gbIsSafari?4:5].join("");if(t)return i._mnMarkCtrlTimeStatus&&clearTimeout(i._mnMarkCtrlTimeStatus),void(i.mnMarkCtrlTimeBegin=0);100<=n._nPercent?i._mnMarkCtrlTimeStatus?(clearTimeout(i._mnMarkCtrlTimeStatus),i._mnMarkCtrlTimeStatus=null):o.ossLog("delay","all",a+"_t_"+(o.now()-i.mnMarkCtrlTimeBegin)):93<n._nPercent&&(i._mnMarkCtrlTimeStatus||(i.mnMarkCtrlTimeBegin=o.now(),i._mnMarkCtrlTimeStatus=setTimeout(function(){o.ossLog("delay","all",a+"_d"),i._mnMarkCtrlTimeStatus=null},1e4)))},_uploadNextFile:function(){var t=this,e=getTop(),i=t._moCurUploadAttachInfo;return!!i&&(e.E(t._moCurUploadAttachArray,function(e){if(e.get("sId")==i._sId){if(_oCurrentFile=t._moCurUploader=e,e.uploadToFtn&&e.get("bUpToFtn"))return e.set("nAppId",72),e.uploadToFtn();0==e.get("sType").indexOf("H5C")&&e.set({bIsUptoFtnForNormal:!0,nPort:80}),e.upload()}}),!0)},getInfoUid:function(t){var i=this._moExistInfos,o=[];return getTop().E(this._moExistList,function(e){t[i[e]._sUploadId]&&o.push({name:getTop().htmlEncode(i[e]._sName),id:"Uploader"+i[e]._sId})}),o}};function delAttach(e){QMAttach.delAttach(e)}function delAllAttach(){for(var e=QMAttach.getExistList(),t=0;t<e.length;t++)delAttach(e[t])}function delExistAttach(e){QMAttach.delExistAttach(e)}function delBigAttach(e){return QMAttach.delBigAttach(e),!1}function setFileNameToSubject(e){var t=getTop().S("subject",window),i=arguments.callee;if(e&&t&&!t.value&&!i._bIsEverSeted&&"groupsms"!=getPageId()){var o=e.split("\\").pop();t.value=o.split(".").slice(0,-1).join(".")||o,i._bIsEverSeted=!0}}function cknt(){getTop()._bIsCanConnectGoogle=!0}function outputAttachBtn(e,t,i,o){return QMAttach.outputBtn(e,t,i,o)}function outputFrameAttachBtn(e,t,i,o){var n,a=getTop();return a&&a.QMFileAdaptor&&a.QMFileAdaptor.getNormalUploadCom&&"function"==typeof a.QMFileAdaptor.getNormalUploadCom&&(n=a.QMFileAdaptor.getNormalUploadCom()),"NoFlash"==n?outputFlashFMailAttachBtn(e,t):"RawLocal"==n?outputFlashFMailAttachBtn(e,t):a.QMFileAdaptor.isBrowser("ie")&&a.gnIEVer<11&&!window.location.host.match(/exmail\.qq\.com$/)?QMAttach.outputBtn(e,t,i,o):"H5CPopupMail"==n?outputH5cAttachBtn(e,t):"FlashPopupFMail"==n?outputFlashFMailAttachBtn(e,t):QMAttach.outputBtn(e,t,i,o)}function outputH5cAttachBtn(e,t){return getTop().TE(["<span id='composecontainer'>","<span tabindex='0' class='compose_toolbtn qmEditorAttach dragAndDropTrap_box' onkeypress='triggerSelectFile(this, event)' onmouseover='attachOn()' onmouseout='attachOut()'>","<span sizelimit='50' title='\u6dfb\u52a0\u5c0f\u4e8e 50M \u7684\u6587\u4ef6\u4f5c\u4e3a\u9644\u4ef6' id='AttachFrame' style='position: relative;'>","<input tabindex='-1' type='button' class='ico_att' align='absmiddle' unselectable='on' onmousedown='return false'>","<a tabindex='-1' href='javascript:;' id='addAttach'>","<span id='sAddAtt1'>\u6dfb\u52a0\u9644\u4ef6</span>","<span onclick='return false;' onmousedown='return false;' style='display:none;' id='sAddAtt2'>\u7ee7\u7eed\u6dfb\u52a0</span>","</a>","</span>","<span id='dragAndDropTrap' title='\u70b9\u51fb\u6253\u5f00\u9644\u4ef6\u6258\u76d8\uff0c\u5141\u8bb8\u76f4\u63a5\u62d6\u52a8\u6587\u4ef6\u5230\u8be5\u533a\u57df\u6dfb\u52a0\u9644\u4ef6\u3002'>","<a onmousedown='return false;' title='\u70b9\u51fb\u6253\u5f00\u62d6\u62fd\u6258\u76d8' class='ico_moreupload'></a>","</span>","</span>",'$@$if($baDisplay$!="none")$@$',"<span id='bigAttachLink' tabindex='-1' style='margin-right:12px;' title='\u53ef\u4ee5\u5411\u4efb\u4f55\u90ae\u7bb1\u53d1\u9001\u6700\u5927 2G \u7684\u9644\u4ef6' onclick='initFileTransporter();return false' onmousedown='return false;' onkeypress='initFileTransporter();return false;'>","<input tabindex='-1' name='activexControlBtn' type='button' class='ico_attbig' align='absmiddle' hidefocus=''>","<a tabindex='-1' href='javascript:;' hidefocus=''>\u8d85\u5927\u9644\u4ef6</a>","</span>","$@$endif$@$","</span>"]).replace({baDisplay:t?"":"none"})}function outputFlashFMailAttachBtn(e,t){return getTop().TE(["<span id='composecontainer'>","<span tabindex='0' class='compose_toolbtn qmEditorAttach dragAndDropTrap_box' onkeypress='triggerSelectFile(this, event)' onmouseover='attachOn()' onmouseout='attachOut()'>","<span sizelimit='50' title='\u6dfb\u52a0\u5c0f\u4e8e 50M \u7684\u6587\u4ef6\u4f5c\u4e3a\u9644\u4ef6' id='AttachFrame' style='position: relative;'>","<input tabindex='-1' type='button' class='ico_att' align='absmiddle' unselectable='on' onmousedown='return false'>","<a href='javascript:;' id='addAttach' tabindex='-1'>","<span id='sAddAtt1' tabindex='-1'>\u6dfb\u52a0\u9644\u4ef6</span>","<span onclick='return false;' onmousedown='return false;' style='display:none;' id='sAddAtt2' tabindex='-1'>\u7ee7\u7eed\u6dfb\u52a0</span>","</a>","</span>","<span id='dragAndDropTrap' title='\u70b9\u51fb\u6253\u5f00\u9644\u4ef6\u6258\u76d8\uff0c\u5141\u8bb8\u76f4\u63a5\u62d6\u52a8\u6587\u4ef6\u5230\u8be5\u533a\u57df\u6dfb\u52a0\u9644\u4ef6\u3002'>","<a onmousedown='return false;' title='\u70b9\u51fb\u6253\u5f00\u62d6\u62fd\u6258\u76d8' class='ico_moreupload'></a>","</span>","</span>",'$@$if($baDisplay$!="none")$@$',"<span id='bigAttachLink' tabindex='-1' style='margin-right:12px;' title='\u53ef\u4ee5\u5411\u4efb\u4f55\u90ae\u7bb1\u53d1\u9001\u6700\u5927 2G \u7684\u9644\u4ef6'' onclick='initFileTransporter();return false;' onmousedown='return false;' onkeypress='initFileTransporter();return false;'>","<input tabindex='-1' name='activexControlBtn' type='button' class='ico_attbig' align='absmiddle' hidefocus=''>","<a tabindex='-1' href='javascript:;' hidefocus=''>\u8d85\u5927\u9644\u4ef6</a>","</span>","$@$endif$@$","</span>"]).replace({baDisplay:t?"":"none"})}function attachOn(){var e=getTop();e.addClass(e.S("addAttach",window),"composeAddAttach")}function attachOut(){var e=getTop();e.rmClass(e.S("addAttach",window),"composeAddAttach")}function triggerSelectFile(e,t){if(13!==t.keyCode)return!1;var i=getTop().finds('input[name="UploadFile"]',e);i&&i.length&&i[0].click()}function addExistBigAttach(e,t,i,o,n,a,r){var s=getTop().S("BigAttach",window),l=void 0!==a;if(s){var d,c="BigAttach_"+o;getTop().S(c,window)?d=getTop().S(c,window):((d=document.createElement("div")).id=c,r&&r.oUploaderDom?s.insertBefore(d,r.oUploaderDom):s.appendChild(d)),d.className="addrtitle attsep js_exist_big_attach",t||100==a?d.removeAttribute("uncomplete"):d.setAttribute("uncomplete",!0);var p="";if(r&&r.nExpireTime&&-1!=e&&("\u5373\u5c06\u8fc7\u671f"==r.nExpireTime?p="<span class='red'>"+r.nExpireTime+"</span>":-1!=r.nExpireTime.indexOf("\u5929")?p=parseInt(r.nExpireTime.substring(0,r.nExpireTime.indexOf("\u5929")),10)<4?"<span class='red'>"+r.nExpireTime+"\u540e\u8fc7\u671f</span>":r.nExpireTime+"\u540e\u8fc7\u671f":-1!=r.nExpireTime.indexOf("\u5c0f\u65f6")?p="<span class='red'>"+r.nExpireTime+"\u540e\u8fc7\u671f</span>":-1!=r.nExpireTime.indexOf("\u5206\u949f")&&(p="<span class='red'>"+r.nExpireTime+"\u540e\u8fc7\u671f</span>"),p=", "+p),0<e&&"undefined"==typeof r.nExpireTime&&-1!=e){var g=e-Date.parse(new Date)/1e3;0<g&&(4<=Math.ceil(g/86400)?p=Math.ceil(g/86400)+"\u5929\u540e\u8fc7\u671f":1<=Math.ceil(g/86400)&&Math.ceil(g/86400)<=3?p="<span class='red'>"+Math.ceil(g/86400)+"\u5929\u540e\u8fc7\u671f</span>":0==Math.floor(g/86400)&&0<Math.floor(g/3600)&&Math.floor(g/3600)<24?p="<span class='red'>"+Math.floor(g/3600)+"\u5c0f\u65f6\u540e\u8fc7\u671f</span>":0==Math.floor(g/3600)&&0<Math.floor(g/60)?p="<span class='red'>"+Math.floor(g/60)+"\u5206\u949f\u540e\u8fc7\u671f</span>":0==Math.floor(g/60)&&(p="<span class='red'>\u5373\u5c06\u8fc7\u671f</span>")),p=", "+p}-1==e&&(p=", "+(p="\u65e0\u9650\u671f")),d.innerHTML=getTop().TE(["<ul class='left' style='clear:left;dispaly:block;margin:2px 0 0;padding:0;cursor:pointer;' onclick=\"QMAttach.preview('$fid$')\" uploadid=\"$fid$\" key='$key$' code='$code$' fid='$fid$' attachtype='big' filename='$@$html($filename$)$@$'>","<input type='button' class='ico_attbig' align='absmiddle' style='margin:0 1px 0 0!important;margin:0 3px 2px 0'>","<input type='hidden' name='fid' value='$fid$' />","<span class='black' expiretime='$expire$'>","$filename$","<span style='font-weight:normal; color:#7a8f99'> $@$if($size$)$@$($size$$expiredays$)$@$endif$@$</span><wbr><wbr>","</span>","</ul>","$@$if($percent$<100)$@$","<ul class='left bd_upload' style='font-size:1px;width:100px;height:10px;overflow:hidden;border-width:1px;margin-left:5px;dispaly:block;'>","<ul class='fdbody' style='width:$percent$%;font-size:1px;height:10px;overflow:hidden;padding:0;border:0;'></ul>","</ul>","$@$endif$@$","<ul class='left' style='dispaly:block;margin: 1px 0 0;;padding:0;'>","<a href='$url$'></a>","&nbsp;<nobr>","$@$if($percent$==100)$@$","<a style='display:inline-block;margin-top: 1px;' onclick='delBigAttach(this)' data-sid='$sid$'>\u5220\u9664</a></nobr>","$@$endif$@$","</ul>"]).replace({expire:e,filename:getTop().htmlEncode(i),size:n,percent:l?a:100,url:t+"&fid="+o,expiredays:p||"",fid:o||"",sid:r?r.sId:"",key:r?r.key:"",code:r?r.code:""}),getTop().show(getTop().S("attachContainer",getTop().getMainWin()),!0),setFileNameToSubject(i)}}function addBigAttach(e,t,i,o,n,a,r){QMAttach.mbHideBigAttach?getTop().showError("\u7fa4\u4fe1\u606f\u6682\u65f6\u4e0d\u652f\u6301\u53d1\u9001\u8d85\u5927\u9644\u4ef6"):addExistBigAttach(e,["http://exmail.qq.com",o=o.replace(/&code=/gi,"&temp="),"&code=",n,"&s=email"].join(""),t,a,i,undefined,r)}function getCurrentReceivers(e){if("compose"!=getPageId())return"";var t=getTop(),o=[];return t.E(e||["to","cc","bcc","sc"],function(e){var t=QMAddrInput.get(e,window),i=t&&t.get();i&&(o=o.concat(i))}),o.join(";")}function iniBigAttach(e){for(var t=getTop().GelTags("hr",getTop().S("source",window)),i=t.length-1;0<=i;i--){var o=t[i];if((o=o.parentNode)&&"QQMailBigAttach"==o.id){if(e)for(var n=getTop().GelTags("span",o),a=n.length-1;0<=a;a--){var r=n[a];if("qqmailbgattach"==r.className){var s=r.firstChild.innerHTML;void 0===s&&(s=r.firstChild.nodeValue);var l=getTop().trim(r.firstChild.nextSibling.innerHTML.split(",")[0]).replace(/\(|\)/gi,"");addExistBigAttach(r.getAttribute("expiretime"),r.getAttribute("downloadlink"),s,"",l)}}o.parentNode.removeChild(o)}}}function initColorSubject(){var t=getTop(),e=t.S("cpanelBtn",window);if(e){for(var i=["11","\u6a59\u7ea2\u8272","13","\u6df1\u7eff\u8272","14","\u9c9c\u7d2b\u8272","10","\u7eaf\u9ed1\u8272"],o=[{sItemValue:'<span style="margin-left:5px;">\u5f69\u8272\u4e3b\u9898...</span>'}],n=0,a=i.length;n<a;n+=2)o.push({sId:i[n],sItemValue:["<div id='",i[n],"' class='s",i[n],"_bg' style='margin-top:3px;width:15px;height:15px;float:left;'></div>&nbsp;",i[n+1]].join("")});o.push({sItemValue:"<div style='float:right;margin-right:10px;'><a href='http://service.exmail.qq.com/cgi-bin/help?subtype=1&&id=11&&no=138' target='_blank'>\u5e2e\u52a9</a></div>"}),e.onclick=function(){var e=t.calcPos(this);new t.QMMenu({oEmbedWin:window,sId:"colorsubject",nX:e[1]-96,nY:e[2]+1,nWidth:100,oItems:o,nItemHeight:21,onitemclick:setSubjectColor})}}}function showSubjectMsg(e){var t=getTop().S("subject",window);if(e)""==t.value&&(t.value=getTop().gsMsgNoSubject,setTimeout(function(){showSubjectMsg(!1)},5e3));else if(t.value==getTop().gsMsgNoSubject){t.value="";try{document.selection.createRange().select()}catch(i){}}}function setSubjectColor(e){getTop().S("xqqstyle",window).value=e,getTop().S("subject",window).className="s"+e,showSubjectMsg(!0),getTop().show(getTop().S("cpanel",window),!1)}function initAddrCtrl(e,t,a){var r=getTop(),s=e||window,l=(window.addrDomain={},window.InputObjs=[]);a=r.extend({bAddrTip:!1,bDomCheck:!0,bNick:!1},a);try{s.focus()}catch(o){}function d(e){_addrAssociate("sc"==e?l.slice(3):l.slice(0,3))}if(r.E(t||["to","cc","bcc","sc"],function(o){var e=r.S(o+"AreaCtrl",s),t=r.S(o,s),n=0;if(e&&t){_getSupportGroup();var i=new QMAddrInput({id:o,win:s,tabIndex:t.tabIndex,dom:{container:e},dispMode:a.bNick?"onlynick":"full",maxHeight:a.nMaxHeight,onfocus:function(){setFocus(o),d(o)},onblur:function(){},onchange:function(e,t){var i=this.get(";");a.bSecret&&goCompose._oSecretChecker&&goCompose._oSecretChecker.check(t),goCompose._oDomainChecker&&goCompose._oDomainChecker.check(),"to"==o&&!n&&getTop().S("aSC",window)&&5<=i.split(";").length&&(n=1,getTop().requestShowTip("aSc",16,window)),d(o)}});i.disabled(t.disabled).add(t.value),t.value="",l.push(i)}}),a.bSecret&&(goCompose._oSecretChecker=QMSecretAddrCheck.createChecker(l)),a.bDomCheck){var i="reply_all"==location.getParams().s?3:7;(goCompose._oDomainChecker=QMAddrDomainCheck.createChecker(l,i,{oPermit:r.S("receiverMsgContainer",window)})).check()}initAddrLinkEvent(s)}function initAddrLinkEvent(a){getTop().E(["to","cc","bcc","sc"],function(i){var t=i.toUpperCase(),e=QMAddrInput.get(i,a),o=getTop().S(["a"+t],a),n=getTop().S([i+"_btn"],a);e&&o&&(o.onclick="sc"==i?function(e){showSeparatedCopy()&&getTop().ossLog("delay","all",getTop().T("stat=compose_send&t=$t$&sub=sc").replace(location.getParams())),getTop().preventDefault(e||window.event),goCompose._oDomainChecker&&goCompose._oDomainChecker.check()}:function(e){setFocus(!this.disabled&&showInputCtrl(t)?i:getFocus()==i?"to":getFocus()),QMAddrInput.get(getFocus(),a).focus("end"),getTop().preventDefault(e||window.event),goCompose._oDomainChecker&&goCompose._oDomainChecker.check()}),e&&n&&(n.onclick=function(e){var t=getTop();t.QMLinkman&&t.QMAddress&&t.QMAddress.isInit()&&(QMAddrInput.get(i,window).showMemDlg(),getTop().preventDefault(e||window.event))})})}function _addrAssociate(_aoQMAddrInputs){var _oTop=getTop(),_fSelf=arguments.callee,_oAjax=_fSelf.ajax,_oCache=_fSelf.cache||(_fSelf.cache={});_oAjax||(_oAjax=_fSelf.ajax=new _oTop.QMAjax,_oAjax.url="/cgi-bin/addr_domain_check",_oAjax.onComplete=function(_asResp){_showHint(_oCache[_oAjax._sEmail]=eval(_asResp.responseText)),_oTop.ossLog("realtime","all","stat=custom&type=addressaptitude&info=open")});for(var _oEmails=[],i=0,len=_aoQMAddrInputs.length,_sEmail;i<len;i++)for(var _oAddrInput=_aoQMAddrInputs[i],_oAddrs=_oAddrInput&&!_oAddrInput.isDisabled()&&_oAddrInput.get("json")||[],j=0,len2=_oAddrs.length;j<len2;j++)_oAddrs[j].valid&&_oEmails.push(_oAddrs[j].addr);_oEmails.length?_oCache[_sEmail=_oEmails.sort().join(";")]?_showHint(_oCache[_sEmail]):(_oAjax._sEmail=_sEmail,_oAjax.abort(),_oAjax.send(_oTop.T("his=1&sid=$sid$&uin=$uin$&addrfilt=$addr$").replace({sid:_oTop.getSid(),uin:_oTop.getUin(),addr:_sEmail}))):_showHint([]);function _showHint(e){var t,i=_fSelf.showSpan||(_fSelf.showSpan=_oTop.S("addrAssociation",window)),o=[],n=_oTop.T('addAddr("\\"$name$\\"&lt;$email$&gt;;")'),a=_oTop.TE(["$@$for($_this_$)$@$$@$if($_idx_$<3)$@$",'<a style="pointer:cursor;" title="$email$" onclick=\''+n+"'>$name$</a>","$@$if($_idx_$<$_root_.length$-1&&$_idx_$<2)$@$, $@$endif$@$","$@$endif$@$$@$endfor$@$"]);if(i){if(e.length){for(var r=0,s=e.length;r<s;r++)(t=_oTop.QMAddress.getAddress(e[r]))&&o.push({name:_oTop.htmlEncode(t.name),email:t.email});i.innerHTML=a.replace(o)}_oTop.show(i.parentNode,!!o.length)}}}function setFocus(e){e&&(arguments.callee._moFocusObj=e)}function getFocus(){return setFocus._moFocusObj||"to"}function addAddr(e,t){var i=QMAddrInput.get(getFocus(),window);i&&(i.add(e),t||i.focus("end"))}function showQuickAddr(e){var t=getTop(),i=getTop().S("quickaddr_div",window),o=t.QMAddress;if(i)return"succeed"==e&&o.isInit()?i.innerHTML.indexOf("lm_panel")<0&&new t.QMLinkman({oData:[{title:"\u6700\u8fd1\u8054\u7cfb\u4eba",addrs:o.getGroup("hot")}],oDom:i,onproselect:"postcard"==initComposeForPage.pageId?null:function(){QMAddrInput.get(getFocus(),window).showMemDlg()},onselect:function(e){var t=o.getAddress(e);QMAddrInput.get(getFocus(),window).add('"'+t.name+'"<'+t.email+">",!1)}}):i.innerHTML=t.TE(['<div style="padding:155px 0 0;text-align:center;">','$@$if($status$=="loading")$@$','<div class="cpright_loading"><span class="loading_icon"></span>\u52a0\u8f7d\u4e2d...</div>',"$@$else$@$",'<a href="javascript:;" onclick="window.loadAddress();">\u91cd\u65b0\u52a0\u8f7d</a>',"$@$endif$@$","</div>"]).replace({status:e}),!1}function quickAddToAddr(e){var p=getTop(),o=p.QMAddress.isShared("client");p.QMAddress.getClientGroupAccessData();for(var t=p.TE(['<div class="secretQuickAddr">','<div class="secretQuickAddrItem">','<div class="sqa_item_left">\u4fdd\u5b58\u81f3</div>','<div class="sqa_item_right">','<div class="secretSaveTo" ck="showSaveToMenu">','<input type="text" disabled class="searchinput" name="" id="secretQuickAddr_saveto" value="$initSaveto$">','<span class="ss_icon ss_endicon ss_icon_arrowdown"></span>',"</div>","</div>","</div>",'<div class="secretQuickAddrItem" id="clientGroupItem" style="$initGroupStyle$">','<div class="sqa_item_left">\u5206\u7ec4(\u5fc5\u586b)</div>','<div class="sqa_item_right">','<div class="">','<span id="secretClientGroupTxt" style="$initClientGroupNameStyle$">$secretClientGroupName$</span>','<a ck="showClientGroupMenu" style="line-height: 30px;">\u9009\u62e9</a>','<input type="hidden" disabled id="secretClientGroupId" value=$secretClientGroupId$>',"</div>",'<div class="sqa_err_txt" id="sqa_clientgroup_err" style="display:none;"></div>',"</div>","</div>",'<div class="sep_line"></div>','<div class="secretQuickAddrItem">','<div class="sqa_item_left">\u59d3\u540d(\u5fc5\u586b)</div>','<div class="sqa_item_right">','<input type="text" id="name" tabindex="1" ku="keydowncheck">','<div class="sqa_err_txt" id="sqa_name_err" style="display:none;"></div>',"</div>","</div>",'<div class="secretQuickAddrItem">','<div class="sqa_item_left">\u90ae\u7bb1</div>','<div class="sqa_item_right">','<input type="text" id="email" tabindex="2" value="$email$" ku="keydowncheck">','<div class="sqa_err_txt" id="sqa_email_err" style="display:none;"></div>',"</div>","</div>",'<div class="secretQuickAddrItem">','<div class="sqa_item_left">\u624b\u673a(\u5fc5\u586b)</div>','<div class="sqa_item_right">','<input type="text" class="" id="tel" tabindex="3" ku="keydowncheck">','<div class="sqa_err_txt" id="sqa_tel_err" style="display:none;"></div>',"</div>","</div>",'<div class="secretQuickAddrItem" style="margin-bottom: 0;">','<div class="sqa_item_left">\u516c\u53f8</div>','<div class="sqa_item_right">','<input type="text" class="" id="org" tabindex="4">',"</div>","</div>","</div>"]),i=p.TE(['<a ck="save" class="btn_blue" href="javascript:;">\u4fdd\u5b58</a>','<a ck="cancel" class="btn_gray" href="javascript:;">\u53d6\u6d88</a>']),n=p.QMAddress.getClientGroups(),a=p.QMAddress.getClientGroupAccess(),r=[],s=0;s<n.length;s++)for(var l=0;l<a.length;l++)n[s].id==a[l].sId&&1==a[l].caneditmember&&r.push({sId:n[s].id,sItemValue:n[s].name});0==r.length&&r.push({bDisSelect:!0,sItemValue:"\u65e0\u8054\u7cfb\u4eba\u7ec4"});new(getTop().QMDialog)({sId:"id_addToAddrbook",sTitle:"\u5feb\u901f\u65b0\u5efa\u8054\u7cfb\u4eba",nWidth:600,nFootHeight:40,sBodyHtml:t.replace({email:e,initSaveto:o?"\u516c\u5171\u8054\u7cfb\u4eba":"\u4e2a\u4eba\u5730\u5740\u672c",initGroupStyle:o?"display:;":"display:none;",secretClientGroupId:r[0].sId!=undefined?r[0].sId:"",secretClientGroupName:r[0].sId!=undefined?r[0].sItemValue:"",initClientGroupNameStyle:r[0].sId!=undefined?"margin-right: 10px;":"display: none;margin-right: 10px;"}),sFootHtml:i,bAnimation:!1,onshow:function(){var d=this,c=getTop();c.liveEvent(d.getPanelDom(),{rule:function(){return{click:{save:{bPropagable:!1},cancel:{bPropagable:!1},showSaveToMenu:{bPropagable:!1},showClientGroupMenu:{bPropagable:!1}},keyup:{keydowncheck:{bPropagable:!1}}}},events:function(){return{save:function(e,t){var n="\u516c\u5171\u8054\u7cfb\u4eba"==d.S("secretQuickAddr_saveto").value.trim()?"client":"normal",a=d.S("name").value.trim(),r=d.S("email").value.trim(),i=d.S("tel").value.trim(),o=d.S("org").value.trim(),s=d.S("secretClientGroupId").value.trim(),l=!0;""==a&&(c.addClass(d.S("name"),"sqa_input_err"),d.S("sqa_name_err").innerText="\u8bf7\u586b\u5199\u59d3\u540d",d.S("sqa_name_err").style.display="",l=!1),r&&!new RegExp("^[0-9a-zA-Z.\\-_]+@[0-9a-z+_.=-]+.[0-9a-z]{2,4}$","gi").test(r)&&(c.addClass(d.S("email"),"sqa_input_err"),d.S("sqa_email_err").innerText="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u4ef6\u5730\u5740",d.S("sqa_email_err").style.display="",l=!1),""==i?(c.addClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").innerText="\u4fdd\u5bc6\u90ae\u7bb1\u7684\u6536\u4ef6\u4eba\u5c06\u901a\u8fc7\u8be5\u624b\u673a\u53f7\u9a8c\u8bc1\u67e5\u770b",d.S("sqa_tel_err").style.display="",l=!1):/^[\s0-9-+]+$/gi.test(i)||(c.addClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").innerText="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",d.S("sqa_tel_err").style.display="",l=!1),"client"==n&&""==s&&(d.S("sqa_clientgroup_err").innerText="\u8bf7\u9009\u62e9\u5206\u7ec4",d.S("sqa_clientgroup_err").style.display="",l=!1),l&&c.QMAjax.send("/cgi-bin/laddr_addedit?sid="+p.getSid()+"&operate=save&t=contact.json&ef=js&resp_charset=UTF8&view="+n,{method:"POST",content:c.T("name=$name$&email=$email$&tel=$tel$&org=$org$&sViewType=$sViewType$&group=$group$").replace({name:a,email:"\u4e2a\u4eba\u90ae\u7bb1/5:"+r,tel:"\u624b\u673a/4097:"+i,org:"\u516c\u53f8\u540d\u79f0:"+o,sViewType:n,group:[r,s].join(":")}),onload:function(e,t){if(e){var i=p.evalValue(t);if("undefined"==typeof i.errcode){"client"==n&&(i.sItemType="client"),c.showInfo("\u4fdd\u5b58\u6210\u529f");var o={name:a,email:r,pinyin:"",id:i.sId,kind:"",nid:"",phone:i.oTel&&i.oTel[0]&&i.oTel[0].sVal};return c.QMAddress._addSecretPerson(o,"normal"==n?["personal"]:["client"]),goCompose._oSecretChecker&&goCompose._oSecretChecker.check("fromInput"),d.close(),void((new Image).src="/qy_mng_logic/reportKV?type=SecretMail&itemName=secret|addContact|succ&r="+Math.random())}if(-2==i.errcode)return void alert("sessionTimeout");if(-112==i.errcode)return void c.showError("\u8054\u7cfb\u4eba\u5df2\u5b58\u5728");if(-113==i.errcode)return void c.showError("\u4f60\u7684\u5730\u5740\u672c\u8054\u7cfb\u4eba\u5df2\u8d85\u9650");if(i.errmsg)return void c.showError(i.errmsg)}c.showError("\u4fdd\u5b58\u5931\u8d25")}})},keydowncheck:function(e,t){var i=d.S("name").value.trim();_email=d.S("email").value.trim(),_tel=d.S("tel").value.trim(),"id_addToAddrbook_s_name"==t.id&&(""==i?(c.addClass(d.S("name"),"sqa_input_err"),d.S("sqa_name_err").innerText="\u8bf7\u586b\u5199\u59d3\u540d",d.S("sqa_name_err").style.display=""):(c.rmClass(d.S("name"),"sqa_input_err"),d.S("sqa_name_err").style.display="none")),"id_addToAddrbook_s_email"==t.id&&_email&&(new RegExp("^[0-9a-zA-Z.\\-_]+@[0-9a-z+_.=-]+.[0-9a-z]{2,4}$","gi").test(_email)?(c.rmClass(d.S("email"),"sqa_input_err"),d.S("sqa_email_err").style.display="none"):(c.addClass(d.S("email"),"sqa_input_err"),d.S("sqa_email_err").innerText="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u4ef6\u5730\u5740",d.S("sqa_email_err").style.display="")),"id_addToAddrbook_s_tel"==t.id&&(""==_tel?(c.addClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").innerText="\u4fdd\u5bc6\u90ae\u7bb1\u7684\u6536\u4ef6\u4eba\u5c06\u901a\u8fc7\u8be5\u624b\u673a\u53f7\u9a8c\u8bc1\u67e5\u770b",d.S("sqa_tel_err").style.display=""):/^[\s0-9-+]+$/gi.test(_tel)?(c.rmClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").style.display="none"):(c.addClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").innerText="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",d.S("sqa_tel_err").style.display=""))},cancel:function(e,t){d.close()},showSaveToMenu:function(e,t){if(c.QMMenu("secretDlg_saveTo")&&"hiding"==c.QMMenu("secretDlg_saveTo")._msStatus)c.QMMenu("secretDlg_saveTo").hide();else if(c.QMMenu("secretDlg_saveTo"))c.QMMenu("secretDlg_saveTo").show();else{var i=[];o&&i.push({sId:"0",sItemValue:'<div class="ss_drop_item"><a href="javascript:;">\u516c\u5171\u8054\u7cfb\u4eba</a></div>'}),i.push({sId:"1",sItemValue:'<div class="ss_drop_item ss_drop_split"><a href="javascript:;">\u4e2a\u4eba\u5730\u5740\u672c</a></div>'}),new(getTop().QMMenu)({sId:"secretDlg_saveTo",oEmbedToDom:d.getPanelDom(),nX:160,nY:96,nWidth:356,oItems:i,sClassName:"ss_drop_wrap",onitemclick:function(e){d.S("secretQuickAddr_saveto").value="0"==e?"\u516c\u5171\u8054\u7cfb\u4eba":"\u4e2a\u4eba\u5730\u5740\u672c",d.S("clientGroupItem").style.display="0"==e?"":"none"}})}},showClientGroupMenu:function(e,t){new(getTop().QMMenu)({oEmbedToDom:d.getPanelDom(),nX:160,nY:140,nWidth:356,oItems:r,sClassName:"ss_drop_wrap",onitemclick:function(e,t){d.S("secretClientGroupTxt").innerText=t.sItemValue,d.S("secretClientGroupTxt").style.display="",d.S("secretClientGroupId").value=e,d.S("sqa_clientgroup_err").style.display="none"}})}}}})}})}function quickEditAddr(a){var p=getTop(),e=getTop().QMAddress.isShared("client"),t="normal",g=p.QMAddress.search(a,1,["personal"]);0==g.length&&e&&(g=p.QMAddress.search(a,1,["client"]),t="client");var u={};g[0]&&g[0].id&&_oTop.QMAjax.send("/cgi-bin/laddr_detail?sid="+p.getSid()+"&ef=js&operate=view&GrpID=&AddrID="+g[0].id+"&t=contact.json&view="+t,{method:"POST",onload:function(e,t){if(e){var i=p.evalValue(t).oList[0];i&&(u.sItemType=i.sItemType,u.oGroup=i.oGroup[0],u.oName=i.oName[0]&&i.oName[0].sVal,u.oPersonEmail=i.oEmail[0]&&i.oEmail[0].sVal,u.oWorkEmail=i.oEmail[1]&&i.oEmail[1].sVal,u.oPersonTel=i.oTel[0]&&i.oTel[0].sVal,u.oWorkTel=i.oTel[1]&&i.oTel[1].sVal,u.oIMWX=i.oIM[0]&&i.oIM[0].sVal,u.oIMQQ=i.oIM[1]&&i.oIM[1].sVal,u.oAdr=i.oAdr[0]&&i.oAdr[0].sVal,u.orgName=i.oOrg[0]&&i.oOrg[0].sOrg1,u.oDepart=i.oOrg[0]&&i.oOrg[0].sOrg2,u.oPos=i.oOrg[0]&&i.oOrg[0].sTitle,u.oNote=i.oNote[0]&&i.oNote[0].sVal);var o=p.TE(['<div class="secretQuickAddr">','<div class="secretQuickAddrItem">','<div class="sqa_item_left">\u4fdd\u5b58\u81f3</div>','<div class="sqa_item_right">','<div class="secretSaveTo" ck="showSaveToMenu">','<input type="text" disabled class="searchinput" name="" id="secretQuickAddr_saveto" value="$saveTo$">','<span class="ss_icon ss_endicon ss_icon_arrowdown"></span>',"</div>","</div>","</div>",'<div class="secretQuickAddrItem" id="clientGroupItem"  style="$groupStyle$">','<div class="sqa_item_left">\u5206\u7ec4(\u5fc5\u586b)</div>','<div class="sqa_item_right">','<div class="">','<span id="secretClientGroupTxt" style="margin-right: 10px;">$secretClientGroupName$</span>','<a ck="showClientGroupMenu" style="line-height: 30px;">\u9009\u62e9</a>','<input type="hidden" disabled id="secretClientGroupId" value=$secretClientGroupId$>',"</div>",'<div class="sqa_err_txt" id="sqa_clientgroup_err" style="display:none;"></div>',"</div>","</div>",'<div class="sep_line"></div>','<div class="secretQuickAddrItem">','<div class="sqa_item_left">\u59d3\u540d(\u5fc5\u586b)</div>','<div class="sqa_item_right">','<input type="text" id="name" tabindex="1" ku="keydowncheck" value="$name$">','<div class="sqa_err_txt" id="sqa_name_err" style="display:none;"></div>',"</div>","</div>",'<div class="secretQuickAddrItem">','<div class="sqa_item_left">\u90ae\u7bb1</div>','<div class="sqa_item_right">','<input type="text" id="email" tabindex="2" value="$email$" ku="keydowncheck">','<div class="sqa_err_txt" id="sqa_email_err" style="display:none;"></div>',"</div>","</div>",'<div class="secretQuickAddrItem">','<div class="sqa_item_left">\u624b\u673a(\u5fc5\u586b)</div>','<div class="sqa_item_right">','<input type="text" class="" id="tel" tabindex="3" ku="keydowncheck" value="$phone$">','<div class="sqa_err_txt" id="sqa_tel_err" style="display:none;"></div>',"</div>","</div>",'<div class="secretQuickAddrItem" style="margin-bottom: 0;">','<div class="sqa_item_left">\u516c\u53f8</div>','<div class="sqa_item_right">','<input type="text" class="" id="org" tabindex="4" value="$corpname$">',"</div>","</div>","</div>"]),n=p.TE(['<a ck="save" class="btn_blue" href="javascript:;">\u4fdd\u5b58</a>','<a ck="cancel" class="btn_gray" href="javascript:;">\u53d6\u6d88</a>']);new(getTop().QMDialog)({sId:"id_quickEditAddrbook",sTitle:"\u5feb\u901f\u7f16\u8f91\u8054\u7cfb\u4eba",nWidth:600,nFootHeight:40,sBodyHtml:o.replace({saveTo:"normal"==u.sItemType?"\u4e2a\u4eba\u5730\u5740\u672c":"\u516c\u5171\u8054\u7cfb\u4eba",groupStyle:"normal"==u.sItemType?"display:none;":"",secretClientGroupId:u.oGroup&&u.oGroup.sId||"",secretClientGroupName:u.oGroup&&u.oGroup.sName||"",name:u.oName||"",email:a,phone:u.oPersonTel||"",corpname:u.orgName||""}),sFootHtml:n,bAnimation:!1,onshow:function(){var d=this,c=getTop();c.liveEvent(d.getPanelDom(),{rule:function(){return{click:{save:{bPropagable:!1},cancel:{bPropagable:!1},showSaveToMenu:{bPropagable:!1},showClientGroupMenu:{bPropagable:!1}},keyup:{keydowncheck:{bPropagable:!1}}}},events:function(){return{save:function(e,t){var n="\u516c\u5171\u8054\u7cfb\u4eba"==d.S("secretQuickAddr_saveto").value.trim()?"client":"normal",a=d.S("name").value.trim(),r=d.S("email").value.trim(),i=d.S("tel").value.trim(),o=d.S("org").value.trim(),s=d.S("secretClientGroupId").value.trim(),l=!0;""==a&&(c.addClass(d.S("name"),"sqa_input_err"),d.S("sqa_name_err").innerText="\u8bf7\u586b\u5199\u59d3\u540d",d.S("sqa_name_err").style.display="",l=!1),r&&!new RegExp("^[0-9a-zA-Z.\\-_]+@[0-9a-z+_.=-]+.[0-9a-z]{2,4}$","gi").test(r)&&(c.addClass(d.S("email"),"sqa_input_err"),d.S("sqa_email_err").innerText="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u4ef6\u5730\u5740",d.S("sqa_email_err").style.display="",l=!1),""==i?(c.addClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").innerText="\u4fdd\u5bc6\u90ae\u7bb1\u7684\u6536\u4ef6\u4eba\u5c06\u901a\u8fc7\u8be5\u624b\u673a\u53f7\u9a8c\u8bc1\u67e5\u770b",d.S("sqa_tel_err").style.display="",l=!1):/^[\s0-9-+]+$/gi.test(i)||(c.addClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").innerText="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",d.S("sqa_tel_err").style.display="",l=!1),"client"==n&&""==s&&(d.S("sqa_clientgroup_err").innerText="\u8bf7\u9009\u62e9\u5206\u7ec4",d.S("sqa_clientgroup_err").style.display="",l=!1),l&&c.QMAjax.send("/cgi-bin/laddr_addedit?sid="+p.getSid()+"&operate=save&t=contact.json&ef=js&resp_charset=UTF8&view="+n,{method:"POST",content:c.T("id=$id$&name=$name$&email=$personemail$&email=$workemail$&tel=$persontel$&tel=$worktel$&IM=$wx$&IM=$qq$&adr=$corpaddr$&org=$org$&org2=$depart$&title=$pos$&note=$note$&sViewType=$sViewType$&group=$group$").replace({name:a,personemail:"\u4e2a\u4eba\u90ae\u7bb1/5:"+r,persontel:"\u624b\u673a/4097:"+i,org:"\u516c\u53f8\u540d\u79f0:"+o,sViewType:n,group:[r,s].join(":"),id:g[0].id,workemail:"\u5de5\u4f5c\u90ae\u7bb1/6:"+(u.oWorkEmail||""),worktel:"\u5ea7\u673a/4097:"+(u.oWorkTel||""),wx:u.oIMWX,qq:u.oIMQQ,corpaddr:u.oAdr,depart:u.oDepart,pos:u.oPos,note:"\u5907\u6ce8:"+u.oNote}),onload:function(e,t){if(e){var i=p.evalValue(t);if("undefined"==typeof i.errcode){"client"==n&&(i.sItemType="client"),c.showInfo("\u4fdd\u5b58\u6210\u529f");var o={name:a,email:r,id:i.sId,phone:i.oTel&&i.oTel[0]&&i.oTel[0].sVal};return c.QMAddress._addSecretPerson(o,"normal"==n?["personal"]:["client"]),goCompose._oSecretChecker&&goCompose._oSecretChecker.check("fromInput"),void d.close()}if(-2==i.errcode)return void alert("sessionTimeout");if(-112==i.errcode)return void c.showError("\u8054\u7cfb\u4eba\u5df2\u5b58\u5728");if(-113==i.errcode)return void c.showError("\u60a8\u7684\u5730\u5740\u672c\u8054\u7cfb\u4eba\u5df2\u8d85\u9650");if(i.errmsg)return void c.showError(i.errmsg)}c.showError("\u4fdd\u5b58\u5931\u8d25")}})},keydowncheck:function(e,t){var i=d.S("name").value.trim();_email=d.S("email").value.trim(),_tel=d.S("tel").value.trim(),"id_addToAddrbook_s_name"==t.id&&(""==i?(c.addClass(d.S("name"),"sqa_input_err"),d.S("sqa_name_err").innerText="\u8bf7\u586b\u5199\u59d3\u540d",d.S("sqa_name_err").style.display=""):(c.rmClass(d.S("name"),"sqa_input_err"),d.S("sqa_name_err").style.display="none")),"id_addToAddrbook_s_email"==t.id&&_email&&(new RegExp("^[0-9a-zA-Z.\\-_]+@[0-9a-z+_.=-]+.[0-9a-z]{2,4}$","gi").test(_email)?(c.rmClass(d.S("email"),"sqa_input_err"),d.S("sqa_email_err").style.display="none"):(c.addClass(d.S("email"),"sqa_input_err"),d.S("sqa_email_err").innerText="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u4ef6\u5730\u5740",d.S("sqa_email_err").style.display="")),"id_addToAddrbook_s_tel"==t.id&&(""==_tel?(c.addClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").innerText="\u4fdd\u5bc6\u90ae\u7bb1\u7684\u6536\u4ef6\u4eba\u5c06\u901a\u8fc7\u8be5\u624b\u673a\u53f7\u9a8c\u8bc1\u67e5\u770b",d.S("sqa_tel_err").style.display=""):/^[\s0-9-+]+$/gi.test(_tel)?(c.rmClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").style.display="none"):(c.addClass(d.S("tel"),"sqa_input_err"),d.S("sqa_tel_err").innerText="\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",d.S("sqa_tel_err").style.display=""))},cancel:function(e,t){d.close()},showSaveToMenu:function(e,t){if(c.QMMenu("secretDlg_editSaveTo")&&"hiding"==c.QMMenu("secretDlg_editSaveTo")._msStatus)c.QMMenu("secretDlg_editSaveTo").hide();else if(c.QMMenu("secretDlg_editSaveTo"))c.QMMenu("secretDlg_editSaveTo").show();else{var i=[];getTop().QMAddress.isShared("client")&&i.push({sId:"0",sItemValue:'<div class="ss_drop_item"><a href="javascript:;">\u516c\u5171\u8054\u7cfb\u4eba</a></div>'}),i.push({sId:"1",sItemValue:'<div class="ss_drop_item ss_drop_split"><a href="javascript:;">\u4e2a\u4eba\u5730\u5740\u672c</a></div>'}),new(getTop().QMMenu)({sId:"secretDlg_editSaveTo",oEmbedToDom:d.getPanelDom(),nX:160,nY:96,nWidth:356,oItems:i,sClassName:"ss_drop_wrap",onitemclick:function(e){d.S("secretQuickAddr_saveto").value="0"==e?"\u516c\u5171\u8054\u7cfb\u4eba":"\u4e2a\u4eba\u5730\u5740\u672c",d.S("clientGroupItem").style.display="0"==e?"":"none"}})}},showClientGroupMenu:function(e,t){for(var i=p.QMAddress.getClientGroups(),o=[],n=0;n<i.length;n++)o.push({sId:i[n].id,sItemValue:i[n].name});0==o.length&&o.push({bDisSelect:!0,sItemValue:"\u65e0\u8054\u7cfb\u4eba\u7ec4"}),new(getTop().QMMenu)({oEmbedToDom:d.getPanelDom(),nX:160,nY:140,nWidth:356,oItems:o,sClassName:"ss_drop_wrap",onitemclick:function(e,t){d.S("secretClientGroupTxt").innerText=t.sItemValue,d.S("secretClientGroupTxt").style.display="",d.S("secretClientGroupId").value=e,d.S("sqa_clientgroup_err").style.display="none"}})}}}})}})}}})}function showVipIntro(e){var o=getTop(),t=o.TE(['<div class="versionCmp">','<div class="versionCmp_cnt">','<div class="vc_title">\u4ec0\u4e48\u662fVIP\u5e10\u53f7\uff1f</div>','<div class="vc_subtitle">VIP\u5e10\u53f7\u662f\u4f01\u4e1a\u90ae\u300c\u4e13\u4e1a\u7248\u300d\u63d0\u4f9b\u7684\u5e10\u53f7\u7279\u6743\u670d\u52a1</div>',"<table>","<thead>","<tr>",'<td style="width:100px;">\u9879\u76ee</td>','<td style="width: 270px;">\u666e\u901a\u6210\u5458</td>','<td style="width: 270px;">VIP\u6210\u5458</td>',"</tr>","</thead>","<tbody>","<tr>","<td>\u90ae\u7bb1\u5bb9\u91cf</td>","<td>\u4ec5\u62e5\u67091G\u5bb9\u91cf</td>","<td>\u62e5\u6709\u65e0\u9650\u5bb9\u91cf</td>","</tr>","<tr>","<td>\u4e2a\u4eba\u4e2d\u8f6c\u7ad9</td>","<td>\u4ec5\u62e5\u67092G\u5bb9\u91cf</td>","<td>\u62e5\u670932G\u5bb9\u91cf</td>","</tr>","<tr>","<td>\u4fdd\u5bc6\u90ae\u4ef6</td>","<td>\u65e0\u6cd5\u4f7f\u7528</td>","<td>\u53ef\u4f7f\u7528</td>","</tr>","<tr>","<td>\u90ae\u4ef6\u5907\u4efd</td>","<td>\u65e0\u6cd5\u5907\u4efd</td>","<td>\u53ef\u5b9e\u65f6\u5907\u4efd</td>","</tr>","<tr>","<td>\u90ae\u4ef6\u5f52\u6863</td>","<td>\u65e0\u6cd5\u5f52\u6863</td>","<td>\u53ef\u6c38\u4e45\u5f52\u6863</td>","</tr>","<tr>","<td>\u4f01\u4e1a\u540d\u7247</td>","<td>\u65e0\u6cd5\u4f7f\u7528</td>","<td>\u53ef\u4f7f\u7528</td>","</tr>","<tr>","<td>\u53d1\u4fe1\u9891\u7387\u9650\u5236</td>","<td>\u4e0d\u652f\u6301\u6dfb\u52a0\u4e3a\u767d\u540d\u5355</td>","<td>\u53ef\u6dfb\u52a0\u4e3a\u767d\u540d\u5355</td>","</tr>","<tr>","<td>\u9650\u5236\u6210\u5458\u5916\u53d1</td>","<td>\u4e0d\u652f\u6301\u6dfb\u52a0\u4e3a\u767d\u540d\u5355</td>","<td>\u53ef\u6dfb\u52a0\u4e3a\u767d\u540d\u5355</td>","</tr>","<tr>","<td>IP\u767b\u5f55\u6743\u9650</td>","<td>\u4e0d\u652f\u6301\u6dfb\u52a0\u4e3a\u767d\u540d\u5355</td>","<td>\u53ef\u6dfb\u52a0\u4e3a\u767d\u540d\u5355</td>","</tr>","<tr>","<td>\u90ae\u4ef6\u5ba1\u6838</td>","<td>\u4e0d\u652f\u6301\u6dfb\u52a0\u4e3a\u767d\u540d\u5355\uff1b\u4e0d\u652f\u6301\u4f5c\u4e3a\u5ba1\u6838\u4eba</td>","<td>\u53ef\u6dfb\u52a0\u4e3a\u767d\u540d\u5355\uff1b\u53ef\u4f5c\u4e3a\u5ba1\u6838\u4eba</td>","</tr>","<tr>","<td>\u90ae\u4ef6\u8f6c\u79fb</td>","<td>\u4e0d\u652f\u6301\u4f5c\u4e3a\u8f6c\u79fb\u90ae\u7bb1</td>","<td>\u53ef\u4f5c\u4e3a\u8f6c\u79fb\u90ae\u7bb1</td>","</tr>","<tr>","<td>\u90ae\u4ef6\u64a4\u56de</td>","<td>\u4ec5\u53ef\u64a4\u56de24\u5c0f\u65f6\u5185\u53d1\u4fe1</td>","<td>\u53ef\u64a4\u56de15\u5929\u5185\u53d1\u4fe1</td>","</tr>","</tbody>","</table>",'<div class="vc_foot">','<a class="button_blue vipIntroBtn" ck="$btnCK$">$btnTxt$</a>',"<div>","</div>","</div>"]);new o.QMDialog({sId:"id_vipIntro",sTitle:"",nWidth:792,nHeight:630,nFootHeight:0,sBodyHtml:t.replace({btnTxt:e?1==e?"\u5347\u7ea7\u4e3aVIP":"\u5347\u7ea7\u4e3a\u4e13\u4e1a\u7248":"\u8054\u7cfb\u7ba1\u7406\u5458\u5f00\u901a",btnCK:e?1==e?"fSecretGoVip":"fSecretGoProfessional":"contactManager"}),bAnimation:!0,onshow:function(){var i=this;getTop().liveEvent(i.getPanelDom(),{rule:function(){return{click:{contactManager:{bPropagable:!1},fSecretGoProfessional:{bPropagable:!1},fSecretGoVip:{bPropagable:!1}}}},events:function(){return{contactManager:function(e,t){i.close(),o.goUrlMainFrm("/cgi-bin/readtemplate?sid="+o.getSid()+"&t=compose&action=get_corp_manger_email&s=cnew&r="+Math.random()+"&loc=frame_html%2C%2C,21",!1,!1)},fSecretGoProfessional:function(e,t){i.close(),secretGoProfessional()},fSecretGoVip:function(e,t){i.close(),secretGoVip()}}}})}})}function secretGoProfessional(){var a=getTop();(new Image).src="/qy_mng_logic/reportKV?type=SecretMail&itemName=secret|novip|baseVer|up&r="+Math.random(),(new Image).src="/qy_mng_logic/reportKV?type=SecretMail&itemName=secret|novip|baseVer|up|corp&owneruin="+top.window.g_owneruin+"&r="+Math.random(),a.QMAjax.send("/cgi-bin/readtemplate?sid="+a.getSid()+"&action=get_owner_vip_info&t=biz_rf_mgr&ef=jsnew&r="+Math.random(),{method:"POST",onload:function(e,t){if(e)if("1"==a.evalValue(t).data.is_super_admin){var i=a.S("manageMail");if(i&&i.getAttribute("onclick")){var o=i.getAttribute("onclick");0<o.indexOf("&target=bizmail_admin")?o=o.replace("&target=bizmail_admin","&target=bizmail_admin&secrethash=vipupgrade"):0<o.indexOf("&init=1")?o=o.replace("&init=1","&init=1#setting/versionCompare"):0<o.indexOf("%2526init%253D1")&&(o=o.replace("%2526init%253D1",encodeURIComponent(encodeURIComponent("&init=1#setting/versionCompare")))),i.setAttribute("onclick",o),i.click()}else if(i&&i.getAttribute("href")){var n=i.getAttribute("href");0<n.indexOf("%253Dbizmail_admin")?n+=encodeURIComponent(encodeURIComponent("&secrethash=vipupgrade")):0<n.indexOf("weixin_scan_verify_admin")&&(n=n.replace("t=weixin_scan_verify_admin","t=weixin_scan_verify_admin&secrethash=vipupgrade")),i.setAttribute("href",n),top.window.location=i.getAttribute("href")}}else a.showError("\u4f60\u6ca1\u6709\u6743\u9650\u8fdb\u884c\u6b64\u64cd\u4f5c")}})}function secretGoVip(){var o=getTop();(new Image).src="/qy_mng_logic/reportKV?type=SecretMail&itemName=secret|novip|proVer|up&r="+Math.random(),(new Image).src="/qy_mng_logic/reportKV?type=SecretMail&itemName=secret|novip|proVer|up|corp&owneruin="+top.window.g_owneruin+"&r="+Math.random(),o.QMAjax.send("/cgi-bin/readtemplate?sid="+o.getSid()+"&action=get_owner_vip_info&t=biz_rf_mgr&ef=jsnew&r="+Math.random(),{method:"POST",onload:function(e,t){if(e){var i=o.evalValue(t);"1"==i.data.is_super_admin?"1"==i.data.has_quota?((new Image).src="/cgi-bin/readtemplate?sid="+o.getSid()+"&action=upgrade_self_to_vip&r="+Math.random(),o.showInfo("\u4f60\u5df2\u5347\u7ea7VIP\u6210\u529f"),o.S("compose_main",document).style.display="",o.S("secretFirstPage",document).style.display="none",(new Image).src="/cgi-bin/readtemplate?action=set_show_vip_secretmail_intro_bit&sid="+o.getSid()+"&r="+Math.random()):o.showError("\u5df2\u65e0VIP\u5e10\u53f7\u7684\u540d\u989d\uff0c\u8bf7\u5230\u7ba1\u7406\u540e\u53f0\u8d2d\u4e70"):o.showError("\u4f60\u6ca1\u6709\u6743\u9650\u8fdb\u884c\u6b64\u64cd\u4f5c")}}})}function _getSupportGroup(){var e=location.getParams();return-1<";compose;compose_postcard;compose_postcard_dlg;compose_card;compose_video;".indexOf(";"+e.t+";")&&"reply_all"!=e.s}function showSeparatedCopy(l){var d=getTop(),e=d.S("trSC",window),c=!d.isShow(e),p=QMAddrInput.get("sc",window)[c&&!l?"clear":"flush"](),g=c?null:p.get("json"),u={};if(g)for(var t=0,i=g.length;t<i;t++){var o=g[t];u[o.addr]=o.format}d.E(["to","cc","bcc"],function(e){var t=e.toUpperCase(),i=d.S("a"+t,window),o=QMAddrInput.get(e,window).flush();if(i&&(d.setClass(i,c?i.className+" nounderline cur_default":d.trim(i.className.replace(/nounderline cur_default/,""))),i.disabled=c),d.show(d.S("tr"+t,window),!(c||i&&"true"!=i.getAttribute("show"))),o&&(o.disabled(c),!l&&c&&p.add(o.get().join("; ")),g)){for(var n=[],a=null,r=0,s=g.length;r<s;r++)o.hasAddr((a=g[r]).addr)&&(n.push(a.format),delete u[a.addr]);o.clear().add(n.join("; "))}});var n=d.S("aSC",window);if(n&&(n.innerHTML=(c?"\u53d6\u6d88":"")+"\u5206\u522b\u53d1\u9001",d.show(n.previousSibling,c),d.show(n.previousSibling.previousSibling,!c)),d.S("separatedcopy",window).value=c.toString(),p.disabled(!c),d.show(e,c),c)p.focus("end");else{var a=[];for(var r in u)a.push(r);QMAddrInput.get("to",window).add(a.join("; ")),QMAddrInput.get("to",window).focus("end")}return c}function showInputCtrl(e,t){var i=getTop().S("tr"+e,window),o=getTop().S("a"+e,window),n=getTop().isShow(i),a=QMAddrInput.get(e.toLowerCase(),window);return getTop().show(i,!n),o.innerHTML=(n?"\u6dfb\u52a0":"\u5220\u9664")+o.innerHTML.substr(2,2),o.setAttribute("show",n?"false":"true"),a.disabled(n)[0==t||n?"length":"focus"]("end"),getTop().setUserCookieFlag("CCSHOW","CC"==e?0:1,n?0:1),!n}function hideRightArea(e,t){var i=getTop().S("rightArea",window);if(i){e=!!e;var o=getTop().S("rightAreaBtn",window);o.onclick=function(){hideRightArea(!e)},o.innerHTML='<input type="button" hidefocus class='+(e?"prefd />":"nextfd />"),getTop().show(i,e),t||getTop().setUserCookieFlag("CCSHOW",2,e?"0":"1")}}function initCookieSetting(){var e=getTop().getUserCookie("CCSHOW")||"",t=window.QMAddrInput&&QMAddrInput.get("cc",window),i=window.QMAddrInput&&QMAddrInput.get("bcc",window);t&&(t.length()||1==e.charAt(0))&&showInputCtrl("CC",!1),i&&(i.length()||1==e.charAt(1))&&showInputCtrl("BCC",!1),getTop().S("rightArea",window)&&1==e.charAt(2)&&hideRightArea(!1,!0)}function loadValue(e){e&&getPageEditor()&&(_fixQQMailStationery("100%"),getInputObj("content_compare",null,!0).value=getPageEditor().getContent(),_fixQQMailStationery(getTop().gbIsIE?"auto":"100%"));var t=arguments.callee,o=t._cache;getTop().E(t._ctrls,function(e,t){var i=getInputObj(e,null,!0);i&&i.value!=o[t]&&(o[t]=i.value)})}function getLoadValueCache(){return loadValue._cache}function _isContentEdited(){var e=loadValue._ctrls,t=loadValue._cache;getPageEditor()&&(_fixQQMailStationery("100%"),getInputObj("content_compare",null,!0).value=getPageEditor()&&getPageEditor().getContent(),_fixQQMailStationery(getTop().gbIsIE?"auto":"100%"));for(var i=e.length-1;0<=i;i--){var o=getInputObj(e[i],null,!0);if((o&&o.value||"").replace(/<Param .*?\">/gi,"")!=(t[i]||"").replace(/<Param .*?\">/gi,""))return!0}return!1}function _isFtnUploading(){return getTop().QMDialog("ftnupload_attach")}function _isFtnComplete(){var e=getTop().QMDialog("ftnupload_attach"),t=e&&e.getDialogWin().oMainObj;return t&&t.mnUploaderCount==t.mnSuccessCount}function _isFtnCenterUploading(){return getTop().QMDialog("ftnupload_self")}function _isFtnCenterComplete(){var e=getTop().QMDialog("ftnupload_self"),t=e&&e.getDialogWin().oMainObj;return t&&t.mnUploaderCount==t.mnSuccessCount}function setNeedCloseConform(e){setNeedCloseConform._mbIsNeedCloseConform=e}function isNeedCloseConform(){return setNeedCloseConform._mbIsNeedCloseConform}function _createReloadInfo(){var e=getTop();getTop().goReloadInfo={isconfirm:_isContentEdited(),content:e.filteSignatureTag(getPageEditor().getContent(),"FILTE<:"),subject:e.S("subject",window).value,bacode:e.S("BigAttach",window).innerHTML,deffontinfo:e.extend({},getPageEditor().getDefaultFontInfo())}}function _reloadSaveContent(e){var t=getTop().goReloadInfo||getTop().goAsyncContent;if(getTop().goReloadInfo=null,t&&t.content){var i=getTop(),o=t.deffontinfo,n=t.bacode,a=e&&e.hideBigAttach,r=getTop().S("subject",window),s=getTop().S("BigAttach",window),l=getPageEditor();a&&n&&(getTop().showError("\u7fa4\u4fe1\u606f\u6682\u65f6\u4e0d\u652f\u6301\u53d1\u9001\u8d85\u5927\u9644\u4ef6"),n=""),r&&(r.value=t.subject),s&&n&&n.replace(/\s/gi,"")&&(s.innerHTML=n,i.show("attachContainer",!0,i.getMainWin())),l&&o&&l.setDefaultFontInfo(o.fontName,o.fontSize,o.fontColor),l&&l.setContent(t.content)}return t}function confirmCheckBeforeClose(){return window.getFlashCurrentState&&401==getFlashCurrentState()?"recording":getTop().S("voiceid",window)&&getTop().S("voiceid",window).value?"recorded":_isContentEdited()?"content":_isFtnUploading()?"ftnuploading":"exit"}function closePage(){var e;if(isNeedCloseConform()){var t=new Array(42).join("-")+new Array(5).join(" ");if(getTop().isDisableCtl("sendbtn",window))return getTop().QMDialog("composeExitAlert","close"),getTop().switchFolder("folder_newmail"),getTop().T([t,"\n\u63d0\u793a\uff1a\u60a8\u786e\u5b9a\u8981\u7ec8\u6b62\u5f53\u524d\u884c\u4e3a\uff1f\n",t]);if("exit"!=(e=confirmCheckBeforeClose()))return getTop().QMDialog("composeExitAlert","close"),getTop().switchFolder("folder_newmail"),getTop().T([t,"\n",{driftcontent:"\u63d0\u793a\uff1a\u672a\u53d1\u9001\u7684\u5185\u5bb9\u5c06\u4f1a\u4e22\u5931\u3002",content:"\u63d0\u793a\uff1a\u672a\u4fdd\u5b58\u7684\u5185\u5bb9\u5c06\u4f1a\u4e22\u5931\u3002",recording:"\u63d0\u793a\uff1a\u60a8\u6b63\u5728\u5f55\u5236\u97f3\u89c6\u9891\uff0c\u672a\u53d1\u9001\u5c06\u4f1a\u4e22\u5931\u3002",recorded:"\u63d0\u793a\uff1a\u60a8\u5df2\u7ecf\u5f55\u5236\u97f3\u89c6\u9891\uff0c\u672a\u53d1\u9001\u5c06\u4f1a\u4e22\u5931\u3002",ftnuploading:"\u63d0\u793a\uff1a\u60a8\u6b63\u5728\u4e0a\u4f20\u6587\u4ef6\uff0c\u5173\u95ed\u9875\u9762\u5c06\u505c\u6b62\u4e0a\u4f20\u3002"}[e],"\n",t]).replace({content:"note"==getPageId()?"\u8bb0\u4e8b":"\u90ae\u4ef6"})}setNeedCloseConform(!0)}function redirectExitURLId(e){if(1!=e||!getTop().QMHistory.tryBackTo("readmail")&&!getTop().QMHistory.tryBackTo("mail_list")){var t=["/cgi-bin/addressbook/addr_listall?","/cgi-bin/today?","/cgi-bin/cardlist?ListType=Cards&Cate1Idx=listall&t=card&loc=cardlist,cardlist,fromtab,1&","/cgi-bin/readtemplate?t=compose&s=cnew&","/cgi-bin/grouplist?t=compose_group&","/cgi-bin/note_list?t=note_first_page&info=1&","/cgi-bin/mail_list?folderid=8&t=mail_list_group&","/cgi-bin/readtemplate?t=compose_audiomail&","/cgi-bin/addr_listall?func=birthcard&t=birth_friendlist&","/cgi-bin/readtemplate?t=compose_video&","/cgi-bin/readtemplate?t=compose_postcard&","/cgi-bin/readtemplate?t=compose_drift&maxage=0&","/cgi-bin/readtemplate?t=compose_meeting&","/cgi-bin/readtemplate?t=compose_secret&"];(e<0||t.length<=e)&&(e=1);var i=t[e]+"sid="+getTop().getSid()+"&r="+Math.random();1==getTop().bnewwin&&(i+="&newwin=true"),12==e&&((new Image).src="/qy_mng_logic/reportKV?type=ConfMail&itemName=bizmail|confmail|entry&uin="+_oTop.getUin()+"&r="+Math.random()),getTop().goUrlMainFrm((1==e?getTop().QMHistory.getUrl(getTop().QMHistory.getLastRecordId()):null)||i,!1,2<=e&&e<=4)}}function exitConfirm(e){var t,n=getTop(),i=function(){"function"==typeof e?e():n.globalEval(e,window)},o="draft"==getPageConfig().subtmpl&&!location.getParams().backurl,a=getTop().S("fmailid",window)&&n.S("fmailid",window).value;if(a==getPageConfig().mailid&&(a=""),isNeedCloseConform()&&"remind"!=getPageId()&&("exit"!=(t=confirmCheckBeforeClose())||!o&&a&&!goCompose._bIsUserSave)){disableAutoSave(),getPageEditor()&&getPageEditor().saveRange();var r=getTop().S("qqgroupid",window)&&!n.S("qqgroupid",window).disabled,s={exitstyle:"",delstyle:"display:none",exitbtn:"\u5426",disattach:n.getMainWin().sendAfterUpload()?"block":"none"};return"note"==getPageId()?s.title="\u5185\u5bb9\u5df2\u88ab\u4fee\u6539\uff0c\u786e\u5b9a\u4fdd\u5b58\u8be5\u8bb0\u4e8b\u5417\uff1f":"postcard"==getPageId()?(s.title="\u5185\u5bb9\u5df2\u88ab\u4fee\u6539\uff0c\u786e\u5b9a\u4e0d\u53d1\u9001\u6b64\u660e\u4fe1\u7247\u5417\uff1f",s.savestyle="display:none;",s.exitbtn="\u786e\u5b9a"):(s.title=a&&!o?"\u6b64\u90ae\u4ef6\u5df2\u4fdd\u5b58\u4e3a\u8349\u7a3f\uff0c\u662f\u5426\u9700\u8981\u4fdd\u7559\uff1f":o?"\u8349\u7a3f\u5df2\u88ab\u4fee\u6539\uff0c\u662f\u5426\u8981\u4fdd\u5b58\u6b64\u6b21\u6539\u52a8\uff1f":"\u5185\u5bb9\u5df2\u88ab\u4fee\u6539\uff0c\u662f\u5426\u8981\u5c06\u6b64\u90ae\u4ef6\u5b58\u4e3a\u8349\u7a3f\uff1f",o||(s.exitstyle="display:none;",s.delstyle="")),new n.QMDialog({sId:"composeExitAlert",sTitle:"\u79bb\u5f00\u63d0\u793a",sBodyHtml:n.TE(['<div class="dialog_feedback">','<span class="dialog_icon icon_info_b"></span>','<div class="dialog_f_c">','<div $@$if($disattach$=="block")$@$class="dialog_f_t"$@$endif$@$>$title$</div>','<div class="dialog_f_d" style="width:370px;display:$disattach$"">\u8bf7\u6ce8\u610f\uff1a\u5df2\u8bbe\u5b9a\u4f20\u5b8c\u8d85\u5927\u9644\u4ef6\u540e\u90ae\u4ef6\u81ea\u52a8\u53d1\u9001\uff0c\u73b0\u5728\u79bb\u5f00\uff0c\u5c06\u4f7f<br/>\u81ea\u52a8\u53d1\u9001\u5931\u8d25\u3002\u70b9\u201c\u53d6\u6d88\u201d\u53ef\u505c\u7559\u5728\u5199\u4fe1\u9875\u9762\u3001\u7b49\u5f85\u81ea\u52a8\u53d1\u9001\u3002</div>',"</div>","</div>",'<div class="dialog_operate">','<input type="button" id="btn_exit_save" name="btn_exit_save" class="btn_gray btn_input" value="\u662f" style="$savestyle$" />','<input type="button" class="btn_gray btn_input" value="$exitbtn$" id="btn_exit_notsave" name="btn_exit_notsave" style="$exitstyle$" />','<input type="button" class="btn_gray btn_input" value="\u5426" id="btn_delete_save" name="btn_delete_save" style="$delstyle$" />','<input type="button" class="btn_gray btn_input" id="btn_not_exit" value="\u53d6\u6d88"/>','<div class="clr"></div>',"</div>"]).replace(s),nWidth:null,nHeight:null,onshow:function(){if(r||"voice"==getPageId()||"note"==getPageId()||"postcard"==getPageId())try{this.S("btn_exit_notsave").focus()}catch(e){debug("error when focus on element 'btn_exit_notsave'")}else try{this.S("btn_delete_save").focus()}catch(e){debug("error when focus on element 'btn_delete_save'")}},onload:function(){var o=this;n.addEvent(o.S("btn_exit_save"),"click",function(){"exit"!=t?(o.close(),doProcess("note"==getPageId()?"":"savedraft",{card:"card",note:"send"}[getPageId()]||"save","note"==getPageId()?1:0),setNeedCloseConform(!1),i()):n.fireMouseEvent(o.S("btn_exit_notsave"),"click")}),n.addEvent(o.S("btn_exit_notsave"),"click",function(){n.disableAll(!0),setNeedCloseConform(!(o.S("btn_exit_notsave").disabled=!0)),o.close(),i()}),n.addEvent(o.S("btn_delete_save"),"click",function(){var t=function(){if(o.S("btn_exit_notsave"))return n.fireMouseEvent(o.S("btn_exit_notsave"),"click")};if(a){var i=new n.QMAjaxRequest("/cgi-bin/mail_mgr");i.onComplete=function(e){-1!=e.responseText.indexOf("isMainFrameError")?i.onError():(getTop().hiddenMsg(),getTop().reloadLeftWin(),t())},i.onError=function(){n.showError("\u5220\u9664\u8349\u7a3f\u5931\u8d25"),t()},i.send(n.T("sid=$sid$&Fun=$fun$&mailaction=$mailaction$&mailid=$mailid$").replace({sid:n.getSid(),fun:"PerDel",mailaction:"mail_del",mailid:a})),o.S("btn_delete_save").disabled=!0,n.disableAll(!0),n.showInfo("\u6b63\u5728\u5220\u9664\u8349\u7a3f")}else t()}),n.addEvent(o.S("btn_not_exit"),"click",function(){return o.close(),!1}),n.addEvent(o.S("_closebtn_"),"click",function(e){return o.close(),!1})},onbeforeclose:function(){return n.disableAll(!1),enableAutoSave(),!0},onclose:function(){getPageEditor()&&getPageEditor().loadRange()}})}setNeedCloseConform(!1),i()}function saveContentGoUrl(e){_createReloadInfo(),setNeedCloseConform(!1),getTop().goUrlMainFrm(e,!1,!0)}function selectGroup(e){e=-1==String(e).indexOf("@groupmail.qq.com")?e+"@groupmail.qq.com":e;var t=getTop().S("Gname_"+e,window);t&&(getTop().S("qqgroupid",window).value=e,getTop().S("groupname",window).value=t.innerHTML)}function useStationery(){hideRightArea(!0,!0),changeTab("stationery_div"),""!=getTop().S("stationery",window).src&&0!=getTop().S("stationery",window).src.indexOf("javascript:")||setTimeout('getTop().S("stationery", window).src="/cgi-bin/readtemplate?t=stationery&sid="+getTop().getSid();',10)}function useComposeTmpl(){if(hideRightArea(!0,!0),changeTab("compose_tmpl_div"),""==getTop().S("compose_tmpl",window).src){var e=getTop().S("compose_tmpl",window);e.onload=function(){getTop().S("compose_tmpl_loading",window).style.display="none"},e.src="/cgi-bin/readtemplate?t=compose_tmpl&sid="+getTop().getSid()}}function changeTab(e){for(var t=["AddrTab","stationery_div","card_div","compose_tmpl_div"],i=["addr_cmd","stationery_cmd","card_cmd","compose_tmpl_cmd"],o=["cptab","cptab cpslt"],n=0,a=t.length;n<a;n++){var r=getTop().S(t[n],window);if(r){var s=e==t[n]?1:0;getTop().S(i[n],window).className=o[s],getTop().show(r,s)}}var l=getTop();l.LogKvEx({businame:"common_stat",item:"webmail|menu|"+e+"|click",sid:l.getSid()})}function _autoResizeEditor(){arguments.callee._bIsRunning||setTimeout(function(){_resizeEditor(),setInterval(_resizeEditor,1500)},getTop().gbIsIE?100:300)}function _resizeEditor(){if(getPageEditor()){var e=document.documentElement,t=document.body,i=getPageEditor().getEditorArea(),o=e.clientHeight,n=Math.min(t.scrollHeight,e.scrollHeight)+(getTop().gbIsIE&&6===getTop().gnIEVer?10:0),a=i.clientHeight,r=arguments.callee._nMinHeight||(arguments.callee._nMinHeight=a+15),s=o-n+a;(s=s<r?r:s)!=a&&(i.style.height=s+"px");try{var l=i.getElementsByTagName("iframe")[0];if("compose"==getPageId()&&/Trident\/[67]\./.test(navigator.userAgent)&&!getTop().gbIsEdge){var d=.9*s;l.clientHeight<d&&(l.style.height=d+"px")}else"compose"!=getPageId()||98!=_getEditorSignId("sign")&&99!=_getEditorSignId("sign")||(l.style.height=.95*s+"px")}catch(c){}}}function autoSave(e){e&&_isContentEdited()&&isEnabledAutoSave()&&("note"!=getPageId()?doProcess("autosave","save"):doProcess("note_autosave","save",!0)),goCompose._oAutoSaveTimer=setTimeout(function(){autoSave(!0)},(getPageId(),3e5))}function clearAutoSave(){disableAutoSave(),clearTimeout(goCompose._oAutoSaveTimer)}function isEnabledAutoSave(){var e=arguments.callee._bIsEnableAutoSave;return"boolean"!=typeof e||e}function disableAutoSave(){isEnabledAutoSave._bIsEnableAutoSave=!1}function enableAutoSave(){isEnabledAutoSave._bIsEnableAutoSave=!0}function _combineBgMusicMail(e,t){getTop().S("mailbgmusic",window)&&(getTop().S("mailbgmusic",window).value="use");var i=getTop().getUserInfo("alias"),o=t.song?getTop().T("<b>$songDisp$</b>($singerDisp$)").replace({songDisp:getTop().htmlEncode(t.song),singerDisp:getTop().htmlEncode(t.singer)}):"",n=t.song?getTop().T('<a href="http://music.soso.com/music.cgi?w=$songorg$&pl=$singerorg$" target="_blank">\u67e5\u770b</a>&nbsp;').replace({songorg:t.song,singerorg:t.singer}):getTop().T('<a href="$url$" target="_blank">\u4e0b\u8f7d</a>').replace({url:t.url});return getTop().T(["$content$",'<player id="cmd:bgmusic" url="$url$" song="$song$" singer="$singer$"></player> ','<div id=QQMailBgMusicInfo style="font:12px;color:#909090;">',"<br><br><br><br>\u4f60\u7684\u670b\u53cb $alias$ \u4e3a\u8fd9\u5c01\u90ae\u4ef6\u63d2\u5165\u4e86\u80cc\u666f\u97f3\u4e50 - $bgmusic$","$viewurl$&nbsp;",'<a id="_bgmusic_play_btn_" href="http://mail.qq.com/zh_CN/htmledition/playmusic.html?song=$song$&singer=$singer$&sender=$encodealias$&url=$encodeurl$" target="_blank">\u64ad\u653e</a>',"</div>"]).replace({content:e,url:t.url,alias:i,bgmusic:o,viewurl:n,song:t.song?encodeURIComponent(t.song):"",singer:t.singer?encodeURIComponent(t.singer):"",encodeurl:t.url?encodeURIComponent(t.url):"",encodealias:encodeURIComponent(i)})}function _checkInRemind(e){return!(20<e.length)||(getTop().msgBox("\u6bcf\u6b21\u53d1\u9001\uff0c\u597d\u53cb\u4e2a\u6570\u4e0d\u80fd\u8d85\u8fc720\u4e2a\u3002","dialog",!0,0,"\u5931\u8d25\u4fe1\u606f"),!1)}function doProcessCheck(e,t,i,n){if("voice"==t&&!CheckVoiceBeforeCompose())return!1;if("card"==t&&window.setBirthCardReceiver&&!setBirthCardReceiver("savedraft"==e?0:1))return!1;var a=getTop(),r=0;try{var o={},s=["to","cc","bcc","sc"],l=!1,d=[],c=!1;if("card"==t&&window.setBirthCardReceiver||"qq"==getPageId()||"note"==getPageId()||"group"==getPageId()||"groupsms"==getPageId())l=!0;else{for(var p=s.length-1;0<=p;p--){var g=s[p],u="undefined"==typeof QMAddrInput,m=window.QMAddrDomainCheck;if("card"==getPageId()&&u){var f=o[g]=a.QMAddrInput.get(g,a);m=a.QMAddrDomainCheck}else if(!u){var h=a.QMDialog("postcard_dlg"),_=window;h&&(_=h.getDialogWin());f=o[g]=QMAddrInput.get(g,_)}if(f){if("send"==t&&m&&!m.permit(f.get("validemail")))return a.showError("\u90ae\u4ef6\u5730\u5740\u8fc7\u591a\uff0c\u65e0\u6cd5\u53d1\u9001\u3002"),!1;if("send"==t&&"compose"==getPageId()&&getPageEditor()&&-1!=getPageEditor().getContent().indexOf('tmpl_modified="not_modified"'))return a.showError("\u90ae\u4ef6\u4e2d\u6709\u5c1a\u672a\u4fee\u6539\u7684\u6a21\u677f\u6587\u5b57\uff0c\u8bf7\u4fee\u6539"),!1;if("postcard"==getPageId()&&!checkWordText())return!1;var v=a.S(g,window);if(f&&v){var T=v.disabled=f.flush().isDisabled(),w=v.value=T?"":f.get().join("; ");T||(d=T?"":d.concat(f.get("errhtml")),l||(l=!!w),"remind"!=getPageId()||_checkInRemind(f.get("json"))||(c=!0))}}}if("remind"==getPageId()&&c)return!1}if(!("note"==getPageId()||"group"==getPageId()||"groupsms"==getPageId()||a.S("separatedcopy",window)&&a.S("separatedcopy",window).disabled||"voice"!=t&&"send"!=t&&("card"!=t||""!=e))){if(!l){"card"==t?(a.showError(a.gsMsgNoCardSender),splashToCtrl(a.QMDialog("GreetingCard").S("bccAreaCtrl")),a.show(a.S("cardTip",window),!0)):"postcard"==getPageId()?(a.showError(a.gsMsgNoSender),splashToCtrl("bccAreaCtrl")):(a.showError(a.gsMsgNoSender),splashToCtrl("toAreaCtrl"));for(var b=0,S=s.length;b<S;b++){if((f=o[s[b]])&&!f.isDisabled()){f.focus("end");break}}return!1}if(i<++r){if(d.length)return new a.QMDialog({sId:"Address_error",sTitle:"\u6536\u4ef6\u4eba\u683c\u5f0f\u9519\u8bef",nWidth:450,nHeight:"auto",sBodyHtml:a.T(['<table width="100%" cellspacing="0" cellpadding="0" style="height:113px;">','<tr><td valign="top" style="line-height:18px;padding:12px 10px 0 12px;text-align:left;word-break:break-all;">',"\u60a8\u586b\u5199\u7684\u4ee5\u4e0b\u6536\u4ef6\u4eba\u5b58\u5728\u683c\u5f0f\u9519\u8bef\uff1a",'<div style="height:53px;overflow:hidden;margin-top:3px;">','"<b style="color:red;">$result$</b>"',"</div>","</td></tr>","</table>"]).replace({result:d.join('</b>","<b style="color:red;">')}),sFootHtml:'<input type="button" class="btn_blue btn_input" id="confirm" value="\u786e\u5b9a" />',onload:function(){var e=this;a.addEvent(this.S("confirm"),"click",function(){e.close()})},onshow:function(){this.S("confirm").focus()}}),!1;if(getPageConfig().bSecretMail){var y=[];function $(e){for(var t="",i=0;i<e.length;i++)t+='"'+e[i]+'";';return t}if(0<(y=goCompose._oSecretChecker&&goCompose._oSecretChecker.sendCheck()).notInAddrbookArr.length||0<y.noTelArr.length||0<y.groupAddrArr.length||0<y.publicMailArr.length||0<y.foreignPhonesArr.length)return new a.QMDialog({sId:"SecretAddress_error",sTitle:"\u6536\u4ef6\u4eba\u9519\u8bef",nWidth:485,nHeight:"auto",sBodyHtml:a.TE(['<table width="100%" cellspacing="0" cellpadding="0" style="height:113px;">','<tr><td valign="top" style="font-size: 14px;line-height: 20px;padding:12px 10px 0 12px;text-align:left;word-break:break-all;">',"$@$if($notInAddrbookArr.length$>0)$@$",'<div style="color:#2B2B2B;">\u4ee5\u4e0b\u6536\u4ef6\u4eba\u4e0d\u662f\u901a\u8baf\u5f55\u7684\u8054\u7cfb\u4eba\uff1a</div>','<div style="overflow:hidden;margin-top:3px;">','<div style="color:#FF0200;">$notInAddrbookStr$</div>',"</div>","$@$endif$@$","$@$if($noTelArr.length$>0)$@$",'<div style="color:#2B2B2B;">\u4ee5\u4e0b\u6536\u4ef6\u4eba\u6ca1\u6709\u624b\u673a\u53f7\uff1a</div>','<div style="overflow:hidden;margin-top:3px;">','<div style="color:#FF0200;">$noTelStr$</div>',"</div>","$@$endif$@$","$@$if($groupAddrArr.length$>0)$@$",'<div style="color:#2B2B2B;">\u4fdd\u5bc6\u90ae\u4ef6\u6682\u4e0d\u652f\u6301\u53d1\u5f80\u90ae\u4ef6\u7fa4\u7ec4\uff1a</div>','<div style="overflow:hidden;margin-top:3px;">','<div style="color:#FF0200;">$groupAddrStr$</div>',"</div>","$@$endif$@$","$@$if($publicMailArr.length$>0)$@$",'<div style="color:#2B2B2B;">\u4fdd\u5bc6\u90ae\u4ef6\u6682\u4e0d\u652f\u6301\u53d1\u5f80\u4e1a\u52a1\u90ae\u7bb1\uff1a</div>','<div style="overflow:hidden;margin-top:3px;">','<div style="color:#FF0200;">$publicMailStr$</div>',"</div>","$@$endif$@$","$@$if($foreignPhonesArr.length$>0)$@$",'<div style="color:#2B2B2B;">\u4fdd\u5bc6\u90ae\u4ef6\u6682\u65f6\u4e0d\u652f\u6301\u53d1\u5f80\u56fd\u5916\u624b\u673a\u7684\u6536\u4ef6\u4eba\uff1a</div>','<div style="overflow:hidden;margin-top:3px;">','<div style="color:#FF0200;">$foreignPhonesStr$</div>',"</div>","$@$endif$@$","</td></tr>","</table>"]).replace({notInAddrbookArr:y.notInAddrbookArr,notInAddrbookStr:$(y.notInAddrbookArr),noTelArr:y.noTelArr,noTelStr:$(y.noTelArr),groupAddrArr:y.groupAddrArr,groupAddrStr:$(y.groupAddrArr),publicMailArr:y.publicMailArr,publicMailStr:$(y.publicMailArr),foreignPhonesArr:y.foreignPhonesArr,foreignPhonesStr:$(y.foreignPhonesArr)}),sFootHtml:'<input type="button" class="btn_blue btn_input" id="confirm" value="\u786e\u5b9a" />',onload:function(){var e=this;a.addEvent(this.S("confirm"),"click",function(){e.close()})},onshow:function(){this.S("confirm").focus()}}),!1;a.S("aliastomobile",window).value=y._emailToPhone.join(";")}}a.gSendmailSubject=a.S("subject",window).value}}catch(X){}try{var C=a.S("qqgroupid",window);if(("send"==t||"card"==t)&&C&&!C.disabled&&-1==C.value.indexOf("@"))return"card"==t?(a.showError("\u8bf7\u9009\u62e9\u4e00\u4e2aQQ\u7fa4"),changeTab("AddrTab"),a.show(a.S("cardTip",window),!0),window.scroll(0,0)):a.showError("\u8bf7\u9009\u62e9\u4e00\u4e2aQQ\u7fa4"),!1;if(C&&!a.trim(getPageEditor().getContent(!0)))return a.confirmBox({title:"\u5931\u8d25\u4fe1\u606f",msg:["<div>","\u7fa4\u90ae\u4ef6\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u586b\u5199\u5185\u5bb9","</div>"].join(""),width:430,onreturn:function(e){var t=getPageEditor();t&&t.focus()}}),!1;if("send"==t&&"vote"==getInputObj("mailtype").value){if(""==a.S("votesubject",window).value)return a.showError("\u8bf7\u586b\u5199\u6295\u7968\u4e3b\u9898"),a.S("votesubject",window).focus(),splashToCtrl("votesubject"),!1;var x=a.SN("option",window);for(b=0,S=x.length;b<S;b++)if(""==x[b].value&&b<2)return a.showError(["\u8bf7\u586b\u5199\u9009\u9879",b+1,"\u7684\u5185\u5bb9"].join("")),x[b].focus(),splashToCtrl(x[b]),!1}}catch(X){}try{var A=a.S("subject",window);A.value==a.gsMsgNoSubject&&(A.value="");var E=a.isShow(A)?A.value:"";if(240<a.getAsiiStrLen(E))return a.showError("\u4e3b\u9898\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7120\u4e2a\u4e2d\u6587\u5b57\u7b26"),!1;if(i<++r&&!(goCompose._bIsSkinSubject||a.trim(E)||"compose"!=getPageId()&&"qfcompose"!=getPageId()||"send"!=t))return a.confirmBox({msg:["<div><strong>","\u60a8\u7684\u90ae\u4ef6\u6ca1\u6709\u586b\u5199\u4e3b\u9898\u3002","</strong></div>","<div>","\u60a8\u786e\u5b9a\u7ee7\u7eed\u53d1\u9001\uff1f","</div>"].join(""),width:430,onreturn:function(e){e&&setTimeout(function(){goCompose._bIsSkinSubject=!0,n(r)},100)}}),!1}catch(X){}try{if(isMeetingMail()&&"send"==t){var I=jQuery("input[name='conf_dtstart']").attr("value"),M=jQuery("input[name='conf_dtend']").attr("value"),F=new Date/1e3;a=getTop();if(M<I)return a.showError("\u7ed3\u675f\u65f6\u95f4\u4e0d\u80fd\u65e9\u4e8e\u5f00\u59cb\u65f6\u95f4"),!1;if(i<++r&&I&&I<F)return new a.QMDialog({sid:"meetingdlg",sTitle:"\u63d0\u793a",sBodyHtml:a.TE(['<div class="cnfx_content" style="line-height:1.6;">','<div style="font-size: 13px;">\u8be5\u65e5\u7a0b\u9080\u8bf7\u53d1\u751f\u5728\u8fc7\u53bb\uff0c\u662f\u5426\u7ee7\u7eed\u53d1\u9001\uff1f</div>',"</div>"]).replace({}),sFootHtml:['<a id="ok" class="btn_blue" initlized="true" md="0" href="javascript:;" nocheck="true">\u4ecd\u7136\u53d1\u9001</a>','<a id="cancel" md="0" nocheck="true" initlized="true" class="btn_gray" href="javascript:;">\u4e0d\u53d1\u9001</a>'].join(""),nHeight:"auto",nWidth:350,onload:function(){var e=this;e.S("ok").onclick=function(){e.close(),n(r)},e.S("cancel").onclick=function(){e.close()}}}),!1;var k=a.S("conf_addr",window),D=k.value;if(""==getTop().trim(D))return a.showError("\u8bf7\u586b\u5199\u65e5\u7a0b\u5730\u70b9"),splashToCtrl("conf_addr"),k.focus(),k=null,!1}}catch(X){}try{var P=QMAttach.checkAttachWarnningType();if(0!=P.length)return a.msgBox("\u60a8\u7684\u9644\u4ef6\u4e2d\u5305\u542b\u53ef\u6267\u884c\u6587\u4ef6\uff1a"+P.join(", ")+"\uff0c\u51fa\u4e8e\u5b89\u5168\u6027\u8003\u8651\uff0c\u90ae\u4ef6\u4e2d\u4e0d\u5141\u8bb8\u5305\u542b\u6b64\u7c7b\u9644\u4ef6","dialog",!0,0,"\u5931\u8d25\u4fe1\u606f"),!1;var Q=QMAttach.getAttachSize("normal"),U=QMAttach.getAttachLimit();if(U<Q)return QMAttach.showAttachLimit(U),!1;if((_isFtnUploading()&&!_isFtnComplete()||_isFtnCenterUploading()&&!_isFtnCenterComplete())&&"autosave"!=e&&i<++r)return a.confirmBox({sId:"confirmcheckuploading",title:"\u6e29\u99a8\u63d0\u793a",msg:["\u6709\u8d85\u5927\u9644\u4ef6\u8fd8\u672a\u4e0a\u4f20\u5b8c\u6bd5","savedraft"==e?"\uff0c\u672a\u4e0a\u4f20\u5b8c\u7684\u9644\u4ef6\u4e0d\u4f1a\u5728\u8349\u7a3f\u4e2d\u4fdd\u5b58":"\uff0c\u73b0\u5728\u5f3a\u884c\u53d1\u9001\u90ae\u4ef6\u5c06\u4f1a\u4e22\u5931\u9644\u4ef6"].join(""),onreturn:function(e){e&&(_getSubmitForm()&&n(r))}}),!1;var N=goCompose._oDomainChecker,L="forward"==getPageConfig().subtmpl&&0==N.getExDomain().length,B=_getSubmitForm().sendtime,j=B&&"1"==B.value;if(N&&"savedraft"!=e&&"autosave"!=e&&!L&&!j&&i<++r){var q=N.getAttachLimit(),z=q.nLim,O=q.oUnknown,H=1048576*QMAttach.mnAttBigSizeIn,W=1048576*QMAttach.mnAttBigSizeEx;if(!O.length&&H<Q&&Q<z?q.type=1:q.sDom&&z<Q?q.type=2:0<O.length&&W<Q&&(q.type=3,q.sUnkDom=O[0]),q.type&&0<H)return new a.QMDialog({sTitle:"\u9644\u4ef6\u63d0\u793a",nWidth:430,nHeight:178,sBodyHtml:a.TE(['<div style="padding:10px 0 5px 10px;text-align:left;">','<img src="$image_path$ico_question.gif" align="absmiddle" style="float:left;margin:5px 10px 0;">','<div style="padding-top:10px;word-break:break-all;line-height:150%;margin:0 10px 10px 65px;" class="b_size">',"$@$if($type$==1)$@$",'<div class="bold" style="margin-bottom:10px;">\u60a8\u6dfb\u52a0\u7684\u9644\u4ef6\u6587\u4ef6\u8d85\u8fc7$baseattsize$</div>',"\u5efa\u8bae\u60a8\u8f6c\u4e3a\u8d85\u5927\u9644\u4ef6($aboutmore$)\u53d1\u9001\u3002<br>",'<div class="addrtitle">\u8d85\u5927\u9644\u4ef6\u4e0d\u6c38\u4e45\u4fdd\u5b58\uff0c\u66f4\u73af\u4fdd\uff0c\u5bf9\u65b9\u4e5f\u53ef\u4ee5\u9ad8\u901f\u4e0b\u8f7d\u3002</div>',"$@$else$@$",'<div class="bold"  style="margin-bottom:10px;">\u6b64\u5c01\u90ae\u4ef6\u9644\u4ef6\u5df2\u8fbe$attsize$</div>',"$@$if($type$==3)$@$","$sUnkDom$\u90ae\u7bb1\u53ef\u80fd\u65e0\u6cd5\u63a5\u6536\u8f83\u5927\u7684\u90ae\u4ef6\u3002","$@$else if($type$==2)$@$","$sDom$\u90ae\u7bb1\u53ef\u80fd\u4e0d\u63a5\u6536\u8d85\u8fc7$sLim$\u7684\u90ae\u4ef6\u9644\u4ef6\u3002","$@$endif$@$","<br/>\u5efa\u8bae\u5c06\u666e\u901a\u9644\u4ef6\u76f4\u63a5\u8f6c\u4e3a\u8d85\u5927\u9644\u4ef6($aboutmore$)\u53d1\u9001\uff0c","\u8ba9\u90ae\u4ef6\u4e0d\u53d7\u5bf9\u65b9\u90ae\u7bb1\u5927\u5c0f\u9650\u5236\u3002","$@$endif$@$","</div>","</div>",'<div style="text-align:right;position:absolute;bottom:0px;right:0;left:0;width:100%;">','<div style="padding:0 27px 12px 0;">','<input type="button" class="btn" id="bigAttSend" value="\u662f\uff0c\u4f7f\u7528\u8d85\u5927\u9644\u4ef6"> ',"$@$if($type$==1)$@$",'&nbsp;&nbsp;<a id="send" value="" nocheck="true">\u4e0d\uff0c\u4f7f\u7528\u666e\u901a\u9644\u4ef6</a> ',"$@$else$@$",'&nbsp;&nbsp;<a type="button" id="send" value="" nocheck="true">\u4e0d\uff0c\u4f7f\u7528\u666e\u901a\u9644\u4ef6</a> ','&nbsp;&nbsp;&nbsp;&nbsp;<a type="button" id="compose" value="" nocheck="true">\u53d6\u6d88</a> ',"$@$endif$@$","</div>","</div>"]).replace(a.extend(q,{image_path:a.getPath("image"),aboutmore:'<a href="http://service.exmail.qq.com/cgi-bin/help?subtype=1&&no=1000593&&id=35" target="_blank">\u8be6\u60c5</a>',attsize:QMAttach._formatSize(Q),baseattsize:QMAttach._formatSize(H),sLim:QMAttach._formatSize(z)})),onshow:function(){this.S("bigAttSend").focus()},onload:function(){var o=this;function e(e){var t=_getSubmitForm().exstore,i=_getSubmitForm().bigattachcnt;t&&(t.value=2==e),i&&2==e&&(i.value=1),o.close(),0<e&&(setTimeout(function(){n(r)},100),a.ossLog("delay","all","stat=nothing&locval=,,attbigsize,"+(10*q.type+e)))}a.addEvent(o.S("bigAttSend"),"click",function(){e(2)}),a.addEvent(o.S("send"),"click",function(){e(1)}),a.addEvent(o.S("compose"),"click",function(){e(0)}),a.ossLog("delay","all","stat=nothing&locval=,,attbigsize,"+q.type)}}),!1}}catch(X){debug(["attach check",X.message],61882714)}if(i<++r)try{var V=getPageConfig().subtmpl;if(!goCompose._bIsSkinNoAttach&&"savedraft"!=e&&"autosave"!=e&&"reply"!=V&&"reply_all"!=V&&"forward"!=V&&"draft"!=V&&"content"!=V&&a.S("AttachFrame",window)&&!QMAttach.hasAttach(!0)){E=a.isShow(a.S("subject",window))?a.S("subject",window).value:"";var R=getPageEditor().getContent(!0),G=/attachment|attachments/gi;if(-1!=E.indexOf("\u9644\u4ef6")||-1!=R.indexOf("\u9644\u4ef6")||-1!=E.search(G)||-1!=R.search(G))return a.confirmBox({msg:['<div style="padding:0 10px 0 0;"><b>',"\u60a8\u7684\u90ae\u4ef6\u5185\u5bb9\u63d0\u5230\u9644\u4ef6\uff0c\u4f46\u60a8\u53ef\u80fd\u5fd8\u8bb0\u4e86\u6dfb\u52a0\u9644\u4ef6\u3002","</b></div>","<div>","\u60a8\u786e\u5b9a\u7ee7\u7eed\u53d1\u9001\uff1f","</div>"].join(""),width:430,onreturn:function(e){e&&(goCompose._bIsSkinNoAttach=!0,setTimeout(function(){n(r)},100))}}),!1}}catch(X){debug(["attach add",X.message],61882714)}return!0}function doProcessSafe(e,t,i){try{i()}catch(a){var o=arguments.callee,n="note"==getPageId()?"\u65e5\u5fd7\u4fdd\u5b58\u5931\u8d25 ":"\u90ae\u4ef6\u53d1\u9001\u5931\u8d25 ";"dialog"==a.dispmode?getTop().msgBox(a.message,"dialog",!0,0,n):"voice"==t||"send"==t||"card"==t&&""==e?(getTop().msgBox(getTop().T(["<div>","\u5931\u8d25\u539f\u56e0\uff1a$desc$ ",'<div style="display:$cache$">\u5931\u8d25\u7801\uff1a$code$ ','(<a href="http://support.qq.com/cgi-bin/beta1/titlelist_simple?pn=0&order=3&fid=350" target="_blank" title="\u628a\u5931\u8d25\u539f\u56e0\u4e0e\u5931\u8d25\u7801\u53d1\u5230\u90ae\u7bb1\u53cd\u9988\u610f\u89c1\uff0c\u6211\u4eec\u4f1a\u5c3d\u5feb\u5904\u7406\uff01">\u62a5\u544a\u5931\u8d25\u539f\u56e0</a>)',"</div>","</div>",'<div style="color:red;display:$cache$">',"\u8bf7\u5c1d\u8bd5\u6e05\u7a7a\u6d4f\u89c8\u5668\u7f13\u5b58\uff0c\u7136\u540e\u91cd\u65b0\u8fdb\u5165\u90ae\u7bb1\u3002",'<a href="http://service.exmail.qq.com/cgi-bin/help?subtype=1&&id=7&&no=339" target="_blank">\u67e5\u770b\u5e2e\u52a9</a>',"</div>"]).replace({desc:a.message,code:o._mnCurProcessId,cache:0==a.clrcache?"none":""}),"dialog",!0,0,n),getTop().recodeComposeStatus(4,null,[o._mnCurProcessId,encodeURIComponent(a.message)].join("|"),!0)):getTop().showError(a.message),getTop().disableAll(!1),enableAutoSave()}}function _patseHTML(e){var a={S:function(e){return _oTop.S(e,_oTop.getMainWin())},E:_oTop.E,T:_oTop.T,TE:_oTop.TE,attr:_oTop.attr,insertHTML:_oTop.insertHTML,GelTags:_oTop.GelTags,addEvent:_oTop.addEvent,getEventTarget:_oTop.getEventTarget,isObjContainTarget:_oTop.isObjContainTarget};_oTop.getMainWin().document.body.innerHTML="&nbsp;"+e,setTimeout(function(){!function i(e,o){var n=_oTop.getMainWin(),t=a.GelTags("script",o.document.body);o.gnScriptIdx=-1,o.document.write=function(e){t[o.gnScriptIdx]&&a.insertHTML(t[o.gnScriptIdx],"afterEnd",e)},a.E(t,function(e,t){o.gnScriptIdx=t;try{_oTop.globalEval(e.innerHTML,n)}catch(i){debug(i)}})}(0,_oTop.getMainWin()),function t(){var e=_oTop.getMainWin();e.document.body.onbeforeunload=null,e.clearAutoSave()}()})}function composeFormSubmit(i,o){if(i){var e,t=getPageId(),n=QMAttach.getExistList(),a=n.length?QMAttach.getExistInfos()[n[n.length-1]]._sMode:"";if("compose"!=t&&"group"!=t||"save"==i.actiontype.value||"tradition"==a||"ie"==a||"1"!=getTop().gbBackGroundSend||!(e=getTop().BackGroundSend)){if(isEditMeetingMail()){for(var r=getTop().meetingEditData||{},s=r.invitee||[],l="",d=i.to.value,c=0;c<s.length;c++)d.indexOf(s[c].alias)<0&&(l+='"'+s[c].name+'"<'+s[c].alias+">;");if(l){var p=i.subject.value||"";p=0==p.indexOf("\u65e5\u7a0b\u5df2\u4fee\u6539\uff1a")?p.replace("\u65e5\u7a0b\u5df2\u4fee\u6539\uff1a","\u65e5\u7a0b\u5df2\u53d6\u6d88\uff1a"):"\u65e5\u7a0b\u5df2\u53d6\u6d88\uff1a"+p;var g={sc:l,method:"CANCEL",UID:r.mUID,mailid:r.mailid,virtual:"virtual",sid:getTop().getSid(),conf_dtstart:r.begin_time,conf_dtend:r.end_time,timezone_offset:new Date(1e3*r.begin_time).getTimezoneOffset()+480,mailtype:6,s:"meeting",subject:p,conf_addr:r.address,content__html:r.notes,sendmailname:r.organizer.alias,savesendbox:1,actiontype:"send",separatedcopy:!0,partial_cancel:!0};jQuery.ajax({url:i.action+"?resp_charset=UTF8&f=json&r="+Math.random(),method:"POST",data:g,success:function(e){if(-1!==navigator.userAgent.indexOf("Edge/17.17134")&&"send"==o){var t=new FormData(i);jQuery.ajax({url:i.action+"?resp_charset=UTF8",method:"POST",processData:!1,contentType:!1,headers:{"Content-Type":"multipart/form-data"},data:t,success:function(e){_patseHTML(e)}})}else i.submit()},error:function(e){if(-1!==navigator.userAgent.indexOf("Edge/17.17134")&&"send"==o){var t=new FormData(i);jQuery.ajax({url:i.action+"?resp_charset=UTF8",method:"POST",processData:!1,contentType:!1,headers:{"Content-Type":"multipart/form-data"},data:t,success:function(e){_patseHTML(e)}})}else i.submit()}})}else if(-1!==navigator.userAgent.indexOf("Edge/17.17134")&&"send"==o){var u=new FormData(i);jQuery.ajax({url:i.action+"?resp_charset=UTF8",method:"POST",processData:!1,contentType:!1,headers:{"Content-Type":"multipart/form-data"},data:u,success:function(e){_patseHTML(e)}})}else i.submit()}else if(-1!==navigator.userAgent.indexOf("Edge/17.17134")&&"send"==o){u=new FormData(i);jQuery.ajax({url:i.action+"?resp_charset=UTF8",method:"POST",processData:!1,contentType:!1,headers:{"Content-Type":"multipart/form-data"},data:u,success:function(e){_patseHTML(e)}})}else i.submit();try{if(sendConfMailReport(),-1!==getTop().S("content",window).value.indexOf("qywx_sign_card_11228f42671348d4941b5c1385195130")){(new Image).src="/qy_mng_logic/reportKV?type=WeworkCardNew&item=bizmail_for_qywx_sign_send_num&r="+Math.random();var m=getTop().S("to",window).value.split(";").length;(new Image).src="/qy_mng_logic/reportKV?type=WeworkCardNew&item=bizmail_for_qywx_sign_rece_num&value="+m+"&r="+Math.random()}}catch(M){}}else setNeedCloseConform(!(doProcessSafe._mnCurProcessId=85)),getTop().showProcess(0),e.send(i,t);doProcessSafe._mnCurProcessId=90,i.verifycode&&(i.verifycode.value=""),i.verifycode_cn&&(i.verifycode_cn.value="");var f=getTop();try{f.goUserInfo.get("RealAllSignature")[301]&&((new Image).src="/qy_mng_logic/reportKV?type=WeworkCardNew&itemName=qqmail_cardicon_send&uin="+f.getUin()+"&r="+Math.random());var h=this.getPageEditor(),_=h&&h.getEditWin&&f.finds(".weworkSignature_link",h.getEditWin());_&&_.length&&((new Image).src="/qy_mng_logic/reportKV?type=WeworkCardNew&itemName=qqmail_card_send&uin="+f.getUin()+"&r="+Math.random())}catch(F){}var v=getTop().S("online_document_file_form",window);if(v&&window.fetch){var T=v.key.value,w=[];for(c=0;c<i.elements.length;c++){var b=i.elements[c];if("to"==b.name)for(var S=b.value.split(";"),y=0;y<S.length;y++){var $=getTop().trim(S[y]);try{var C=/".+?"<(.+?)>/g.exec($)[1];w.push(",0,,"+C+",,,,")}catch(M){}}}var x=[];for(c=0;c<w.length;c++)x.push("collaborators="+encodeURIComponent(w[c]));function A(e,t){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)");if(t)var o=t.match(i);else o=getTop().location.search.substr(1).match(i);return null!=o?/^[\u4e00-\u9fa5]+$/.test(decodeURIComponent(o[2]))?o[2]:jQuery("<div/>").text(o[2]).html():null}var E=decodeURIComponent(A("url")),I=A("docsid",E.substr(E.indexOf("?")));jQuery.ajax({url:"https://doc.qmail.com/docs/authority/add?docsid="+I,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:getTop().T("key=$key$&$collaborators$").replace({sid:getTop().getSid(),key:T,collaborators:x.join("&")}),xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){}})}else;}}function doProcess(D,P,Q,u,m){doProcessSafe(D,P,function(){if(doProcessSafe._mnCurProcessId=0,!getTop().isDisableCtl("sendbtn",window)&&(doProcessSafe._mnCurProcessId=10,doProcessCheck(D,P,m||0,function(e){doProcess(D,P,Q,u,e)}))){doProcessSafe._mnCurProcessId=20,disableAutoSave();var M=_getSubmitForm();M.target="actionFrame",doProcessSafe._mnCurProcessId=30;var F=null,k=getPageEditor();if(k){if(_fixQQMailStationery("100%"),"send"==P&&"compose"==getPageId()&&getTop().removeSelf(getTop().S("tmpl_style",k.getEditWin())),F=k.getContent(),null!=document.getElementById("feedbackform")){for(var e="",t="",i="",o=document.getElementsByTagName("input"),n=0;n<o.length;n++)if("exception"==o[n].id){if("no"==o[n].getAttribute("isnull")&&0==o[n].value.length)return e=o[n].name+"\u4e0d\u80fd\u4e3a\u7a7a!",o[n].focus(),void getTop().showError(e);t+=o[n].name+": "+o[n].value+"<br/>"}var a=document.getElementById("cal");null!=a&&(i+="\u5f02\u5e38\u90ae\u4ef6\u53d1\u9001\u65f6\u95f4: "+a.innerHTML);var r=document.getElementById("timeh");if(null!=r)i+=10<=parseInt(r.getAttribute("v"))?" "+r.getAttribute("v"):" 0"+r.getAttribute("v");var s=document.getElementById("timem");if(null!=s)i+=10<=parseInt(s.getAttribute("v"))?" : "+s.getAttribute("v"):" : 0"+s.getAttribute("v");0!=i.length&&(i+="<br/>"),F=(t+=i)+"\u5907\u6ce8\u4fe1\u606f\u5982\u4e0b: <br/>"+F}_fixQQMailStationery(getTop().gbIsIE?"auto":"100%"),F=_addDefaultFontStyle(F);try{getInputObj("content_compare",null,!0).value=F}catch(g){}F=getTop().filteSignatureTag(filterSourceContent(F),"FILTE<:")}else{if(!window.GetSendContent)throw{message:"\u65e0\u6cd5\u83b7\u53d6\u7f16\u8f91\u5668"};F=window.GetSendContent(D,P,Q,u,m)}if(null==F)throw{message:"\u65e0\u6cd5\u83b7\u53d6\u7f16\u8f91\u5668\u5185\u5bb9"};doProcessSafe._mnCurProcessId=31,doProcessSafe._mnCurProcessId=32,"voice"==P&&(F=CombineVoiceMail(F,getTop().S("voiceid",window).value,getTop().S("voicename",window).value),DisableRecord()),doProcessSafe._mnCurProcessId=33,k&&k.getBgMusicInfo()&&(F=_combineBgMusicMail(F,k.getBgMusicInfo())),doProcessSafe._mnCurProcessId=40,"save"!=P&&getTop().audioStop();var l=!(doProcessSafe._mnCurProcessId=72);getTop().createBlankIframe(getTop(),{id:"sendmailFrame",onload:function(){l?getTop().doSendFinishCheck(this):(l=!0,doProcessSafe._mnCurProcessId=73,M.target="sendmailFrame","autosave"==D?p(!0):(QMAttach.onprogress=d,QMAttach.onfinish=p,QMAttach.upload()))}})}function d(e){getTop().showProcess(2,1,e,"\u9644\u4ef6\u4e0a\u4f20\u4e2d")}function c(){doProcessSafe(D,P,function(){!function I(){var e="",t=k&&("text"==(k.getContentType&&k.getContentType())||"txt"==k._msEditCore)||!1,i=""===D&&"send"===P;if(getTop().S("BigAttach",window)){for(var o=getTop().GelTags("div",getTop().S("BigAttach",window)),n=0,a=new RegExp("bmp|doc|eml|exl|gif|html|jpg|mov|pdf|ppt|psd|rar|swf|tu|txt"),r=getTop().T(['<div style="padding:10px 0;font-size:12px;">','<div title="%filename%&#10;&#13;\u6587\u4ef6\u5927\u5c0f\uff1a%filesize%&#10;&#13;\u5230\u671f\u65f6\u95f4\uff1a%expiredtimeString%" class="bigatt_bt">','<div style="float:left;margin:2px 8px 0 0;">','<a target="_blank" href="%downloadlink%"><img border="0" src="http://res.mail.qq.com/zh_CN/htmledition/images/fj/fu_%filetype%.gif"/></a>',"</div>",'<div class="name_big" >','<span class=\'qqmailbgattach\' expiretime="%expiretime%" downloadlink="%downloadlink%"\t>','<a style="color:#000;" target="_blank" href="%downloadlink%">%filename%</a><span style="color:#A0A0A0;"> (%filesize%, %expiredtimeDesc%)</span>',"</span>",'<div class="down_big">','<a target="_blank" href="%downloadlink%">\u8fdb\u5165\u4e0b\u8f7d\u9875\u9762</a><span style="display:none;">\uff1a%downloadlink%</span>',"</div>","</div>","</div>","</div>"],"%"),s=o.length-1;0<=s;s--)if(getTop().isShow(o[s])&&!o[s].getAttribute("uncomplete")){var l=getTop().GelTags("span",o[s])[0],d=getTop().GelTags("a",o[s])[0].href,c=l.getAttribute("expiretime");c||(c=(l=getTop().GelTags("span",l)[0]).getAttribute("expiretime")),l.firstChild.nodeValue||l.firstChild.innerHTML;var p=getTop().htmlEncode(l.firstChild.nodeValue),g=l.firstChild.nodeValue.split(".").pop(),u=/\(\s*(?:([^,\s]+)\s*|(\S*)\s*,.*)\)/gi.exec(l.childNodes[1].innerText),m=u&&2<u.length&&u[1]||u[2]||"1K",f=getTop().formatDate(new Date(1e3*parseInt(c)),"$YY$\u5e74$MM$\u6708$DD$\u65e5 $hh$:$mm$");a.test(g)||(g="qita"),k&&"text"==k.getContentType()?e+=(l.innerText||l.textContent)+("NaN"!=f?" (\u6709\u6548\u65f6\u95f4\u5230: "+f+")":"")+"\n\u94fe\u63a5: "+d+"\n\n":e+=r.replace({filename:p,filesize:m,filetype:g,expiretime:c,expiredtimeString:"NaN"!=f?f:"",expiredtimeDesc:"-1"==c?"\u65e0\u9650\u671f":f+" \u5230\u671f",downloadlink:d}),n++}0<n&&M.bigattachcnt&&(M.bigattachcnt.value=n)}if(doProcessSafe._mnCurProcessId=50,e){var h=getTop().T(['<div id=QQMailBigAttach style="padding: 2px; margin-bottom: 15px;background-color:#E0ECF9;width:auto;font-family:Verdana,Arial,Tahoma;font-size:14px;" >','<hr style="display:none;" />','<div style="text-align:left;padding: 6px 0pt 10px 6px;">','<b style="font-size: 14px;"><img border="0" align="absmiddle" style="margin-right:4px;" src="http://res.mail.qq.com/zh_CN/htmledition/images/icon_att.gif"/>\u4ece%domain%\u90ae\u7bb1\u53d1\u6765\u7684\u8d85\u5927\u9644\u4ef6</b>',"</div>",'<div style="padding: 0pt 8px 6px 12px;background:#fff;">','<div style="clear:both;" >%bigattachlist%</div>',"</div>","</div>"],"%"),_="";k&&"text"==k.getContentType()?(_="\u4ee5\u4e0b\u6587\u4ef6\u901a\u8fc7\u817e\u8baf\u4f01\u4e1a\u90ae\u7bb1\u7684\u4e2d\u8f6c\u7ad9\u53d1\u7ed9\u60a8\u3002\u4fdd\u5b58\u65f6\u95f4\u6709\u9650\u5236\uff0c\u8bf7\u53ca\u65f6\u63d0\u53d6\u3002",F+="\n\n\n"+new Array(60).join("-")+"\n"+_+"\n"+e):F+=h.replace({domain:"\u817e\u8baf\u4f01\u4e1a",bigattachlist:e})}doProcessSafe._mnCurProcessId=60,isMeetingMail()||(F=getTop().fixNonBreakSpace(F),QMCharCode.hasNonGbkChar(F)&&(Q=!0,getInputObj("sendcharset").value="utf-8")),t||k&&k.getContentByHasMapWarpLink&&i&&(F=k.getContentByHasMapWarpLink(F)),"send"==P&&"compose"==getPageId()&&k&&getTop().S("tmpl_module",k.getEditWin())&&(F=(F=F.replace(/un="tmpl_default"/gi,"").replace(/tmpl_index="\d+"/gi,"").replace(/tmpl_background="url.*?"/gi,"")).replace(/BACKGROUND: url\(\/\/exmail.qq.com\//g,"background: url(//exmail.qq.com/")),M.content.value=F.replace(/<\/:includetail.*?>/gi,"").replace(/<:includetail.*?>/gi,"").replace(/<\/:sign.*?>/gi,"").replace(/<:sign.*?>/gi,""),doProcessSafe._mnCurProcessId=70,getTop().disableAll(!0,window),doProcessSafe._mnCurProcessId=71,null!=D&&(M.t.value=D),M.actiontype.value=P,getTop().isSaveData=!1,QMAttach.setInput(getTop().S("cattachlist",window),getTop().S("upfilelist",window));try{getTop().S("st_replytime",window).value=+new Date-getTop().currentReadMailStartTime}catch(E){}if(doProcessSafe._mnCurProcessId=74,"zh_TW"==getTop().getLocale())try{M.acceptCharset="UTF-8",getInputObj("sendcharset").value="UTF8"}catch(E){}if("voice"==P||"send"==P||"card"==P&&""==D){if(doProcessSafe._mnCurProcessId=75,"card"==P){if(!CheckHasSetCard())throw{message:getTop().gsMsgNoCard,clrcache:!1};ComposeCard(F)}if(M.actiontype.value="send",doProcessSafe._mnCurProcessId=76,"note"==getPageId())getTop().showProcess(1,1,"\u8bb0\u4e8b\u4fdd\u5b58\u4e2d");else{var v=["<img src='",getTop().getPath("image"),"newicon/a_send.gif' width='14px' height='14px' align='absmiddle'>&nbsp;",getTop().gsMsgSend].join("");getTop().showProcess(1,!1,v)}if(doProcessSafe._mnCurProcessId=77,"note"!=getPageId()&&-1!=M.action.indexOf("/cgi-bin/compose_send")){getTop().gSendTimeStart=new Date;try{var T=QMAttach.getExistList(),w={cgitm:getTop().g_cgiTimeStamp||0,clitm:getTop().g_clientTimeStamp||0,comtm:getTop().gSendTimeStart.valueOf(),supflash:getTop().qmFlash.isSupported(),supactivex:getTop().detectActiveX(2,1),suphtml5:QMAttach._isSupportHTML5Drag(),logattcnt:T.length,logattsize:QMAttach.getAttachSize(),logattmethod:T.length?QMAttach.getExistInfos()[T[T.length-1]]._sMode:""};for(var b in w){var S;(S=document.createElement("input")).type="hidden",S.name=b,S.value=w[b],M.appendChild(S)}}catch(E){}}doProcessSafe._mnCurProcessId=78}else if(getTop().isSaveData=!0,"savedraft"==D){if("card"==P){if(!CheckHasSetCard())throw{message:getTop().gsMsgNoCard};ComposeCard(F)}getTop().showProcess(1,1,getTop().gsMsgAutoSave)}else getTop().showProcess(1,1,"note"==getPageId()?"\u8bb0\u4e8b\u6b63\u5728\u88ab\u4fdd\u5b58":getTop().gsMsgAutoSave);if(doProcessSafe._mnCurProcessId=80,getTop().isUseActiveXCompose=!1,getTop().gbIsOpera&&((S=document.createElement("input")).type="hidden",S.name="random",S.value=Math.random(),M.appendChild(S)),"groupsms"==getPageId()){var y=getTop(),$=k.getContent().toLowerCase(),C=k.getContent(!0),x=y.trim(C.replace(/&nbsp;/gi,""));if(!x&&$.indexOf("<img")<0)return y.showError("\u7fa4\u90ae\u4ef6\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u586b\u5199\u5185\u5bb9"),y.disableCtl("sendbtn",!1,window),!1;!x&&0<=$.indexOf("<img")&&!M.subject.value?M.subject.value="\u56fe\u7247":x&&(M.subject.value="")}if("autosave"!=D&&"save"!=P&&getTop().QMAddress&&getTop().QMAddress.setExpired(!0),getInputObj("newsnapcnt",null,!0).value=0,getTop().gbIsChrome&&41<getTop().gsChromeVer.split(".")[0]){var A=M.content.value.match(/data:image\/jpeg;base64/g);getInputObj("newsnapcnt",null,!0).value=null!=A?A.length:0}composeFormSubmit(M,P)}()})}function p(e){doProcessSafe(D,P,function(){if(doProcessSafe._mnCurProcessId=71.1,!e&&QMAttach.hasUploadError())return getTop().confirmBox({msg:getTop().T("\u4e0a\u4f20\u9644\u4ef6\u51fa\u9519\uff01\n\u60a8\u786e\u5b9a\u8981$action$\u8fd9\u5c01\u7f3a\u5931\u9644\u4ef6\u7684\u90ae\u4ef6\u5417\uff1f").replace({action:"save"==P?"\u4fdd\u5b58":"\u53d1\u9001"}),onreturn:function(e){doProcessSafe._mnCurProcessId=71.2,e?c():getTop().cancelDoSend()}});doProcessSafe._mnCurProcessId=71.3,c()})}})}function _composeKeyDown(e){var t=getTop(),i=e.srcElement||e.target,o=t.addrHint;if(o&&o.monitorKeyDown&&o.monitorKeyDown(e),o&&"function"==typeof o.isHintPanelShow&&o.isHintPanelShow()&&"function"==typeof o.monitorKeyDown&&"body"==i.tagName.toLowerCase()&&(38==e.keyCode||40==e.keyCode||13==e.keyCode))return e.preventDefault(),!1;var n=location.href;if(10==e.keyCode||13==e.keyCode||83==e.keyCode){if((83!=e.keyCode&&e.ctrlKey||83==e.keyCode&&e.altKey)&&n.indexOf("compose_postcard_dlg")<0)getTop().fireMouseEvent(getTop().SN("sendbtn",window)[0],"click");else if(!(10!=e.keyCode&&13!=e.keyCode||"subject"!=i.id&&"to"!=i.id&&"cc"!=i.id&&"bcc"!=i.id))return!1}else if(e.ctrlKey||e.metaKey)83==e.keyCode||115==e.keyCode?isEnableAutoSave()&&-1==n.indexOf("=compose_")&&-1!=n.indexOf("=compose")&&doProcess("savedraft","save"):86!=e.keyCode&&118!=e.keyCode||-1==n.indexOf("t=compose")||-1!=n.indexOf("_card")||e.cancelBubble||QMAttach.selectFile("clipboard",e);else if(27==e.keyCode){var a=getPageEditor();a&&a.getEditorCustomVar&&a.getEditorCustomVar("FullScreenToolbar.bUseFullEdtior")&&a.getEditorCustomVar("FullScreenToolbar.gooutFullScreenEditor")()}return!0}function _composeKeyUp(e){var t=getTop(),i=t.addrHint,o=(t.QMAddress,getPageEditor().getEditWin());return i&&i.monitorKeyUp(e,o),!0}function _composeBlur(e){var t=_oTop.addrHint;t&&"function"==typeof t.closeHint&&t.closeHint()}function initFileTransporter(e){var t=getTop(),i="ftnupload_attach",o=t.T("/cgi-bin/readtemplate?sid=$sid$&t=ftn_bigattach$autoselect$").replace({sid:t.getSid(),autoselect:e?"&cmd=bigattachUpload,1,1":""});t.QMDialog(i,"max")||new t.QMDialog({sId:i,sTitle:"<span class='attach_add_title'>\u6dfb\u52a0\u8d85\u5927\u9644\u4ef6</span>",bMin:!0,nWidth:467,nHeight:476,sUrl:o,onbeforeclose:function(){if(this.getDialogWin()._msg){this.getDialogWin()._msg("/FtnUI/Dlg_close");var e=this.getDialogWin()._bRet;return void 0===e||e}return!0}}),t.LogKvEx({businame:"common_stat",item:"webmail|menu|bigattach|click",sid:t.getSid()})}function showInstallActiveXDialog(e){var t=getTop().detectActiveX("filetransport"==e?3:0),i="\u817e\u8baf\u90ae\u7bb1"+getTop().QMAXInfo.getTitle()+"\u5b89\u88c5\u63d0\u793a",o=getTop().T(['<div id="optContainer">','<div style="padding:20px 0 0 20px;line-height:1.5;height:115px;*height:135px;text-align:left;overflow:hidden;">','<div style="height:100px;float:left;margin-top:-6px;">','<img src="$images_path$ico_question.gif" />',"</div>",'<div id="setupMsg" >',"<b>\u60a8\u8fd8\u672a\u5b89\u88c5\u817e\u8baf\u90ae\u7bb1\u622a\u5c4f\u63d2\u4ef6\u3002</b><br>\u5b89\u88c5\u540e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u529f\u80fd\uff1a<br>",getTop().gbIsIE||getTop().gbIsFF?'<input hidefocus="" type="button" style="margin:2px 5px 0;" class="ico_att">\u62d6\u62fd\u4e0a\u4f20\u9644\u4ef6<br>':"",'<input hidefocus="" type="button" style="margin:2px 5px 0;" class="ico_attbig">\u8d85\u5927\u9644\u4ef6<br>','<input hidefocus="" style="background: url($images_path$newicon/compose.png) no-repeat -80px 0px;margin:2px 5px 0;height:16px;width:16px;padding:0;border:0;" type="button" unselectable="on">\u622a\u5c4f',"</div>","</div>",'<div class="dialog_operate">','<a id="setup" class="btn_blue" style="width:60px" target="_blank" href="$download$">\u4e0b\u8f7d$opt$</a>','<a id="cancel" class="btn_gray" style="width:40px" href="javascript:;">\u53d6\u6d88</a>',"</div>","</div>"]),n=getTop();new n.QMDialog({sId:"activexDialog",sTitle:i,sBodyHtml:o.replace({control:getTop().QMAXInfo.getTitle(),images_path:getTop().getPath("image",!0),download:"http://mail.qq.com/cgi-bin/readtemplate?t=browser_addon&check=false&returnto="+encodeURIComponent(encodeURIComponent(location.protocol+"//"+location.hostname+"/cgi-bin/frame_html?sid="+getTop().getSid())),opt:t?"\u5347\u7ea7":"\u5b89\u88c5"}),nWidth:400,nHeight:210,onload:function(){n.addEvent(this.S("cancel"),"click",function(){n.QMDialog("activexDialog","close")})},onshow:function(){this.S("setup").focus()}}),{compose:!0,card:!0,note:!0}[getPageId()]&&autoSave(!0,null)}function initSendTimeInput(e,t){var i=new Date,o=getTop().trim(e.replace(/\D/gi," ").replace(/ +/gi," ")).split(" "),n=i.getFullYear();if(""==o[0]){var a={"\u6b63":1,"\u4e00":1,"\u4e8c":2,"\u4e09":3,"\u56db":4,"\u4e94":5,"\u516d":6,"\u4e03":7,"\u516b":8,"\u4e5d":9,"\u5341":10,"\u5341\u4e00":11,"\u814a":12,"\u521d":0,"\u5eff":20},r=a[(o=getTop().trim(e).split("\u6708"))[0]],s=a[o[1].charAt(1)];if(10==s)var l={"\u521d":10,"\u4e8c":20,"\u5eff":20,"\u4e09":30}[o[1].charAt(0)];else l=a[o[1].charAt(0)]+s;for(var d=n-1;d<n+1;d++){var c=getTop().Lunar||Lunar,p=c.lunarDateToSolar(d,r,l,c.isChangeToLeapMonth(d,r));if(p.valueOf()+864e5>=i.valueOf()){n=p.getFullYear(),o[0]=p.getMonth()+1,o[1]=p.getDate();break}}}else o[0]<i.getMonth()+1&&n++;document.write(getTop().T(['<textarea style="display:none;" name="sendtimetip" disabled>','\u53d1\u4fe1\u65f6\u95f4\u5df2\u8bbe\u5728<b class="grn">%nick%</b>\u597d\u53cb\u751f\u65e5\uff0c\u60a8\u53ef\u4ee5\u81ea\u884c\u4fee\u6539\uff1a',"</textarea>",'<input type="hidden" name="sendtimeyear" value="%year%" />','<input type="hidden" name="sendtimemonth" value="%month%" />','<input type="hidden" name="sendtimeday" value="%day%" />','<input type="hidden" name="sendtimehour" value="0" />','<input type="hidden" name="sendtimemin" value="0" />'],"%").replace({nick:getTop().htmlEncode(t),year:n,month:o[0],day:o[1]}))}function createPostNewWindow(e,t,i,o){var n=window,a=n.document,r="_creAtenEWpOstwIn_";_oNewWinForm=getTop().S(r,n),_oNewWinForm||(_oNewWinForm=a.createElement("form"),_oNewWinForm.id=r,_oNewWinForm.method="post",a.body.appendChild(_oNewWinForm)),_oNewWinForm.innerHTML="",t.indexOf("sid=")<0&&(t=[t,t.indexOf("?")<0?"?":"&","sid=",getTop().getSid()].join("")),_oNewWinForm.action=t,_oNewWinForm.target=e,_oNewWinForm.onsubmit=function(){n.open("about:blank",e,o)},(i=i||{}).sid=i.sid||getTop().getSid(),getTop().E(i,function(e,t){var i=a.createElement("input");i.type="hidden",i.name=t,i.value=e,_oNewWinForm.appendChild(i)}),_oNewWinForm.submit()}function setComposeData(e){getPageEditor().setContent(e.content||""),getInputObj("subject").value=e.subject||""}function uploadComposeEml(){new QMDialog({sId:"uploademldlg",nHeight:100,nWidth:400,sTitle:"\u4e0a\u4f20eml\u6587\u4ef6",sBodyHtml:TE(['<form style="width:100%;" method="post" id="uploademl" name="uploademl" target="actionFrame" action="/cgi-bin/qf_upload" enctype="multipart/form-data">','<div style="padding: 25px 10px;">','<label>\u8bf7\u9009\u62e9eml\u6587\u4ef6:</label><input type="hidden" name="sid" value="$sid$"/>','<input tabindex="-1" type="file" name="UploadFile" class="btn" value=""/>',"</div>",'<div class="cnfx_btn">','<input type="submit" value="\u4e0a\u4f20" class="wd2 btn"/>','<input type="button" value="\u53d6\u6d88" class="wd2 btn"  id="cancel"/>',"</div>","</form>"]).replace({sid:getSid()}),onload:function(){var e=this;e.S("cancel").onclick=function(){getActionWin().location.href="javascript:;",e.close()}}})}function _showPreview(){var e;getPageEditor();_fixQQMailStationery("100%"),e=getPageEditor().getContent(),_fixQQMailStationery(getTop().gbIsIE?"auto":"100%"),e=_addDefaultFontStyle(e),e=getTop().filteSignatureTag(filterSourceContent(e),"FILTE<:"),e=getTop().fixNonBreakSpace(e);var t=getTop().T("height=$height$,width=$width$,top=$top$,left=$left$,toolbar=no,scrollbars=yes,menubar=no").replace({top:100,left:100,height:500,width:550});-1!=location.host.indexOf("set")&&-1!=location.host.indexOf("exmail.qq.com")&&(e=e.replace(/img src=\"\/cgi-bin\/viewfile\?/g,'img src="//'+location.host+"/cgi-bin/viewfile?"));getTop().gsDistributeDomain?createPostNewWindow("newwin",getTop().getTopHost()+"/cgi-bin/readtemplate",{content:e,t:"compose_preview"},t):createPostNewWindow("newwin","/cgi-bin/readtemplate",{content:e,t:"compose_preview"},t)}function _addDefaultFontStyle(e){var t=e;if("html"==getPageEditor().getContentType()){var i=getPageEditor().getDefaultFontInfo();for(var o in i)if(i[o]){t=getTop().T(['<div style="$fontName$$fontSize$$fontColor$;">',"$content$","</div>"]).replace({fontName:i.fontName&&["font-family:",i.fontName,";"].join(""),fontSize:i.fontSize&&["font-size:",i.fontSize,";"].join(""),fontColor:i.fontColor&&["color:",i.fontColor,";"].join(""),content:t});break}}return t}function setOtherComposeOptionEvent(){var t=getTop(),i=t.S("otherComposeOptionBtn",window),o=t.S("otherComposeOptionCntr",window);t.addEvent(i,"click",function(){var e=t.isShow(o);t.show(o,!e),i.getElementsByTagName("img")[0].className="arrow"+(e?"down":"up"),_resizeEditor()})}function setMultiSignatureSelect(){var s=getTop();try{var l=s.goUserInfo.get("RealAllSignature")}catch(r){return setTimeout(arguments.callee,500)}if(l){var d=s.S("signSelContainer",window);if(d){var i=s.TE(['<div class="left" style="cursor:pointer;" id="signSelContainerClickItem">','\u7b7e\u540d\uff1a$@$if($sItemValue$)$@$$sItemValue$$@$else$@$\u4e0d\u4f7f\u7528$@$endif$@$<span class="addrtitle" style="font-family: arial,sans-serif; padding-left:4px; font-size:9px; position:relative; top:-1px;" >\u25bc</span>&nbsp;',"</div>",'<span class="left addrtitle" >&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;</span>']),o=[{sId:"-1",sItemValue:"\u4e0d\u4f7f\u7528"}],e=0,t=_getEditorSignId("sign");for(var n in l){var a=l[n];0<=n&&n<100?o.push({sId:n,sItemValue:a[1]||"\u7b7e\u540d1"}):301==n&&o.push({sId:n,sItemValue:a[1]||"\u4f01\u4e1a\u540d\u7247"}),t==n&&(e=o.length-1)}if(o.length<=1)return;s.addEvent(d,"click",function(e){var t=s.calcPos(d);new s.QMMenu({oEmbedWin:window,sId:"signatureMenu",nX:t[3],nY:t[2]-21*o.length-30,nItemHeight:21,bAnimation:!1,oItems:o,onitemclick:function(e,t){d.innerHTML=i.replace(t),setSignature("sign",e)}})}),d.innerHTML=i.replace(o[e]);var c=s.goUserInfo.get("WeworkQrcode");l[301]&&l[301].length&&c&&1==c.need_notice_qrcode_setting&&setTimeout(function(){var e=['<div class="qm_tooltip">','<h1 style="font-size: 14px;color: #000;margin-bottom:14px;text-align:center;">\u53ef\u4ee5\u4f7f\u7528\u300c\u4f01\u4e1a\u540d\u7247\u300d\u4f5c\u4e3a\u7b7e\u540d\u6863\u4e86</h1>',l[301][0],'<a id="use_wework_card_signature" style="background-image: linear-gradient(180deg, #228ACA 0%, #0374BC 100%);border: 1px solid #0D649B;border-radius: 2px;font-size: 12px;color: #FFF;padding:2px;display:block;margin: 16px auto 0 auto;box-sizing:border-box;width:80px;text-align: center;text-decoration: none;cursor: pointer;">\u7acb\u5373\u4f7f\u7528</a>',"</div>"].join(""),t=new s.QMPanel({oEmbedWin:s,sStyle:"position:absolute;width:278px; height:190px; margin-top: -200px;margin-left: -100px;box-sizing:border-box;",nWidth:"auto",nHeight:"auto",sId:"wework_card",sBodyHtml:e,onload:function(){}}),i=(getTop().$panel=t).getPanelDom();i.style.left="",i.style.top="",d.appendChild(i),i.onclick=function(e){e.stopPropagation()};var o=function(e){var t=e.target;s.isObjContainTarget(i,t)||(i.parentNode.removeChild(i),s.removeEvent(document.body,"click",o))};getTop().S([t._msPanelId,"use_wework_card_signature"].join("_"),window).onclick=function(){s.QMAjax.send("/cgi-bin/setting1?fun=set_qrcode_sign&f=json&"+s.getSid(),{onload:function(e,t){console.log("setting1 signature _abIsOk = ",e),e&&(console.log("setting1 signature _avParam = ",t),i.parentNode.removeChild(i),s.removeEvent(document.body,"click",o),setSignature("sign",301))}})},s.addEvent(document.body,"click",o);var n=s.finds(".QMEditorIfrmEditArea",window)[0];if(n){var a=function(e){i.parentNode.removeChild(i),s.removeEvent(n.contentDocument.body,"click",a)};s.addEvent(n.contentDocument.body,"click",a)}var r=function(e){i.parentNode.removeChild(i),s.removeEvent(s.document.body,"click",r)};s.addEvent(s.document.body,"click",r),c.need_notice_qrcode_setting=0,s.goUserInfo.set({WeworkQrcodeData:c})},200)}}}function syncMultiSignatureData(){if(setMultiSignatureSelect(),setMultiSignatureSelect._selector){var e=_getEditorSignId("sign");setMultiSignatureSelect._selector.value=getTop().getAllSignature()[e]?e:-1}}function _getEditorSignId(e){var t=getPageEditor();if(!t)return-1;var i=t.getContentTags(e)[0];return i?i.getAttribute("signid"):-1}function _setEditorSignValue(e,t,i){var n=getPageEditor();if(n){var o={};if(l("sign"),l("qzone"),l("includetail"),t||o[e]){if(!o.sign){var a=o.qzone,r="beforeBegin";a||(a=n.getContentObj("QQMAILSTATIONERY")||n.getContentTags("body")[0],r="beforeEnd"),d("sign",a,r)}o.qzone||d("qzone",o.sign,"afterEnd");var s=o[e];s.innerHTML=t,s.setAttribute("signid",i),"sign"==e&&syncMultiSignatureData(),setTimeout(focusPageEditor)}}function l(e){return o[e]=n.getContentTags(e)[0]}function d(e,t,i){if(n){var o=t.parentNode;o&&"DIV"==o.tagName&&o.firstChild==t&&(t=o),getTop().insertHTML(t,i,getTop().T("<div><$type$></$type$></div>").replace({type:e})),l(e)}}}function setSignature(t,i){if(!getTop().S("tmpl_style",getPageEditor().getEditWin())){if(-1==i)return _setEditorSignValue(t,"",-1);var o=arguments.callee,e="";try{switch(t){case"sign":var n=getTop().getAllSignature()[i];n&&parseInt(i)<100?e=getTop().getSignatureHeader(98==parseInt(i)?1:0)+n[0]:n&&301==parseInt(i)&&(e=getTop().getSignatureHeader(1)+n[0]);break;default:return}}catch(a){return function tD(){setTimeout(function(){o(t,i)},200)}()}try{e=filterComposeContent(e)}catch(r){}_setEditorSignValue(t,e,i)}}function sendAfterUpload(e){if(!e)return"undefined"==getTop().getMainWin().gbCkSendafterupload?0:getTop().getMainWin().gbCkSendafterupload;getTop().getMainWin().gbCkSendafterupload=e}QMAttach._qmTmpFile=function(e){this._moInfo={},this.set(e);var t=this.init(e);this.set(t)},QMAttach._qmTmpFile.prototype={set:function(e,t){if(e)return"object"==typeof e?getTop().extend(this._moInfo,e):this._moInfo[e]=t,this},get:function(e){return e?this._moInfo[e]:this._moInfo},init:function(e){for(var t={},i=["_sName","_mailid","_attachid","_attachname","_sUploadId","_sName","_nSize","_sId","sNf"],o=["sName","mailid","attachid","attachname","sFileId","sFilePath","nSize","sId","sNf"],n=0;n<i.length;n++)if(e[i[n]]){var a=o[n];e[a]?t[a]=e[a]:t[a]=e[i[n]]}return t}},loadValue._ctrls=["to","cc","bcc","subject","content_compare"],loadValue._cache=[];var QMCharCode={_m:[[0,127],[164,164],[167,168],[176,177],[183,183],[215,215],[224,225],[232,234],[236,237],[242,243],[247,247],[249,250],[252,252],[257,257],[275,275],[283,283],[299,299],[324,324],[328,328],[333,333],[363,363],[462,462],[464,464],[466,466],[468,468],[470,470],[472,472],[474,474],[476,476],[593,593],[609,609],[711,711],[713,715],[729,729],[913,929],[931,937],[945,961],[963,969],[1025,1025],[1040,1103],[1105,1105],[8208,8208],[8211,8214],[8216,8217],[8220,8221],[8229,8230],[8240,8240],[8242,8243],[8245,8245],[8251,8251],[8364,8364],[8451,8451],[8453,8453],[8457,8457],[8470,8470],[8481,8481],[8544,8555],[8560,8569],[8592,8595],[8598,8601],[8712,8712],[8719,8719],[8721,8721],[8725,8725],[8730,8730],[8733,8736],[8739,8739],[8741,8741],[8743,8747],[8750,8750],[8756,8759],[8765,8765],[8776,8776],[8780,8780],[8786,8786],[8800,8801],[8804,8807],[8814,8815],[8853,8853],[8857,8857],[8869,8869],[8895,8895],[8978,8978],[9312,9321],[9332,9371],[9472,9547],[9552,9587],[9601,9615],[9619,9621],[9632,9633],[9650,9651],[9660,9661],[9670,9671],[9675,9675],[9678,9679],[9698,9701],[9733,9734],[9737,9737],[9792,9792],[9794,9794],[12288,12291],[12293,12311],[12317,12318],[12321,12329],[12353,12435],[12443,12446],[12449,12534],[12540,12542],[12549,12585],[12832,12841],[12849,12849],[12963,12963],[13198,13199],[13212,13214],[13217,13217],[13252,13252],[13262,13262],[13265,13266],[13269,13269],[19968,40869],[63788,63788],[63865,63865],[63893,63893],[63975,63975],[63985,63985],[64012,64015],[64017,64017],[64019,64020],[64024,64024],[64031,64033],[64035,64036],[64039,64041],[65072,65073],[65075,65092],[65097,65106],[65108,65111],[65113,65126],[65128,65131],[65281,65374]]};function splashToCtrl(e,t){var i=e.style?e:getTop().S(e,window),o=0,n=isNaN(t)?6:t;!function(){i.style.backgroundColor=o++%2==0?"#f9f2b3":"#fff",o<n&&setTimeout(arguments.callee,100)}()}function doVerifySubmit(){doProcess("","card"==getPageId()?"card":"send",!1,!1,99)}function doVerifyCancel(){}function doFtnUploaded(){var n=getTop();new n.QMDialog({sId:"ftnfinished",sTitle:"\u6b63\u5728\u81ea\u52a8\u53d1\u9001",bClose:!1,sBodyHtml:n.T(['<div class="cnfx_content">','<img src="$image_path$ico_question.gif" align="absmiddle" style="float:left;margin:5px 10px 0;">','<div style="padding:12px 0 10px;line-height:1.5;">\u8d85\u5927\u9644\u4ef6\u4e0a\u4f20\u5b8c\u6bd5\uff0c\u5373\u5c06\u4e8e <strong id="countsecond">10</strong> \u79d2\u540e\u81ea\u52a8\u53d1\u9001\u672c\u90ae\u4ef6\u3002<br/>\u6b64\u524d\u60a8\u53ef\u4ee5\u53d6\u6d88\u81ea\u52a8\u53d1\u9001\uff0c\u7ee7\u7eed\u7f16\u8f91\u90ae\u4ef6\u3002</div>',"</div>"]).replace({image_path:n.getPath("image",!0)}),sFootHtml:['<input class="btn_gray btn_input" id="cancel" type="button" md="0" nocheck="true" initlized="true" value="\u7acb\u5373\u53d1\u9001"/>','<input class="btn_blue btn_input" id="confirm" type="button" md="0" nocheck="true" initlized="true" value="\u53d6\u6d88\u81ea\u52a8\u53d1\u9001" />'].join(""),nHeight:"auto",onload:function(){var e=this,t=10,i=setInterval(function(){e.S("countsecond")&&(e.S("countsecond").innerHTML=t--)},1e3),o=setTimeout(function(){e.S("countsecond")&&n.SN("sendbtn",window)[0].click(),clearInterval(i),e.close()},1e4);n.addEvent(e.S("confirm"),"click",function(){clearTimeout(o),clearInterval(i),e.close()}),n.addEvent(e.S("cancel"),"click",function(){clearTimeout(o),clearInterval(i),e.close(),n.SN("sendbtn",window)[0].click()})}})}function QMDragFile(){var e=QMDragFile;getTop();e._moTop=getTop(),e._moMainWin=window,QMAttach._isSupportHTML5Drag()&&(e._initEvent()._addEvent(1),QMDragFile.bInit=!0)}function _getSubmitForm(){return"groupsms"==getPageId()?getTop().S("frmCompose",window):getTop().S("frm",window)}function asyncGetContent(e){var t=getTop(),i=t.htmlDecode(t.trim(e));i&&/^https?:\/\/[\w.]+qq.com(\/)/i.test(i)&&t.loadJsFile(i,!1,t.document,function(){t.goAsyncContent||t.showError("\u90ae\u4ef6\u5185\u5bb9\u83b7\u53d6\u5931\u8d25")})}function _isSupportImportWord(e){return"doc"==_getViewTypeByFileName(e)&&!{txt:1,eml:1,rtf:1,dpt:1,ett:1,mht:1,wpt:1,pptx:1}[getTop().getFileExt(e)]}function _appendEditorFileContent(e,t,i){var o=getTop();if(o.trim(e)){if(i){if(1048576<e.length)return;e='<pre style="word-wrap: break-word; white-space: pre-wrap;">'+o.htmlEncode(e)+"</pre>"}return t.execCmd("insertHTML",e),!0}}function _getViewTypeByFileName(e){return getTop().getViewTypeByExt(getTop().getFileExt(e))}function onClickHintAddr(e){if(getTop().QMProfileTips){var t=e.currentTarget;getTop().QMProfileTips.doMouseEvent("over",getPageEditor().getEditWin(),t)}}QMCharCode.findGbkChar=function(e){var t,i,o,n=this._m;for(t=0,i=n.length-1;t<=i;)if(e>n[o=Math.floor((t+i)/2)][1]&&(t=o+1),e<n[o][0]&&(i=o-1),e>=n[o][0]&&e<=n[o][1])return 1;return 0},QMCharCode.hasNonGbkChar=function(e){for(var t=Math.min(e.length,1e4)-1;0<=t;t--){var i=e.charCodeAt(t);if(0==this.findGbkChar(i))return!0}return!1},QMDragFile.bInit=!1,QMDragFile._getFileList=function(e){var t=getTop(),i=[];try{for(var o=e,n=o.length,a=0;a<n;a++){var r=o[a];i.push({_sCode:t.unikey(),_sName:r.name||r.fileName,_nSize:r.size||r.fileSize,_oFile:r})}}catch(s){debug([s.message,s.lineNumber])}return i},QMDragFile._initEvent=function(){var c=this,p=getTop(),g=QMAttach;return c._nCloseTimeout=null,c._moWinDragover=function(e){if(!p.gbIsSafari||4!=(""+p.gsSafariVer).split(".")[0]){var t=e.dataTransfer,i=t.types,o=!1;if(i){for(var n=i.length-1;0<=n;n--)if("Files"==i[n]){o=!0;break}}else p.gbIsSafari&&(o=!0);if(o){var a=p.S("qqmail_mask"),r=!(a&&p.isShow(a)),s=p.getEventTarget(e);if(r){for(;s&&"html5_dragdrop_area"!=s.id;)s=s.parentNode;p.preventDefault(e),g._showDragAndDropContainer(!1);var l=s?"copy":"none",d=p.S("html5_dragdrop_area",c._moMainWin);t.effectAllowed=l,t.dropEffect=l,d&&(d.innerHTML=s?g._msDragOver:g._msDragEnter)}c._nCloseTimeout&&p.clearTimeout(c._nCloseTimeout),c._nCloseTimeout=p.setTimeout(function(){QMAttach.hideDragAndDropContainer();var e=p.S("html5_dragdrop_area",c._moMainWin);e&&(e.innerHTML=g._msDragEnter)},500)}}},c._moContainerDrop=function(e){for(var t=0,i=e.dataTransfer.files,o=c._getFileList(i),n=o.length-1;0<=n;n--)t+=o[n]._nSize;QMAttach._addControlFile("xhr5",o,t),p.stopPropagation(e),p.preventDefault(e)},c},QMDragFile._addEvent=function(e,t){var a=this,i=getTop(),o=a._moMainWin,n=getPageEditor()&&getPageEditor().getEditWin(),r=i.S("html5_dragdrop_area",a._moMainWin);if(1&e&&i.addEvents([i,o,n],{dragover:a._moWinDragover},t),2&e&&i.gbIsFF&&i.addEvents(r,{drop:a._moContainerDrop},t),4&e){var s=r.previousSibling;i.addEvents(s,{change:function(e){for(var t=0,i=s.files,o=a._getFileList(i),n=o.length-1;0<=n;n--)t+=o[n]._nSize;QMAttach._addControlFile("xhr5",o,t),QMAttach.hideDragAndDropContainer()}},t)}return a};var _getPreviewView=function(){var l=getTop();return function(e,t){var i=e.get("sName"),o=l.getFileExt(i),n=l.getFileTypeByExt(o||""),a=l.getViewTypeByExt(o),r=e.get("mailid")?[e.get("mailid"),e.get("attachid"),e.get("attachname")].join("|"):"";return l.T(["/cgi-bin/$appname$?sid=$sid$&upfilelistitem=$upfileid$&mailattach=$mailattach$","&filename=$filename$&filetype=$filetype$&t=$t$&readprev=$compose$&filepath=$filepath$","&action=$action$$viewdocparam$&viewtype=$viewtype$&r=$rand$&sc=false"]).replace({sid:l.getSid(),rand:Math.random(),appname:{txt:"readtemplate",html:"readtemplate",eml:"viewdocument"}[n]||{compress:"viewcompress",video:"viewfile",music:"viewfile",img:"viewfile"}[a]||"viewdocument",action:"compress"==a?"list":function s(e){return-1<"txt,html".indexOf(l.getFileTypeByExt(e||""))}(o)?"view":"",compose:"normal",t:t||"attachments_simple",upfileid:e.get("sFileId")||e.get("sFileCattachName"),filename:l.encodeURI(i),filetype:n,filepath:e.get("sFileCattachName")||e.get("sFilePath")||"",mailattach:r,viewdocparam:"doc"==a?"&s=yozo&fromattach=1&from=attachfolder":"",viewtype:"eml"==o?"eml":""})}}();function isMeetingMail(){var e=!1;try{6==jQuery("input[name='mailtype']").attr("value")&&(e=!0)}catch(t){}return e}function isNewMeetingMail(){return!!isMeetingMail()&&-1<location.search.indexOf("t=compose_meeting")}function isEditMeetingMail(){return!!isMeetingMail()&&-1<location.search.indexOf("t=compose_meeting_edit")}function sendConfMailReport(){isEditMeetingMail()?(new Image).src="/qy_mng_logic/reportKV?type=ConfMail&itemName=bizmail|confmail|edit&uin="+_oTop.getUin()+"&r="+Math.random():isNewMeetingMail()&&((new Image).src="/qy_mng_logic/reportKV?type=ConfMail&itemName=bizmail|confmail|newsend&uin="+_oTop.getUin()+"&r="+Math.random())}function compose_js(){}