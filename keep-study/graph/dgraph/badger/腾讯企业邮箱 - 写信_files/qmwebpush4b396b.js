(function(_aoWin,_aoUndefined){var _oQMWebpush={getInst:function(){return _oQMWebpush._LOGIC_POLL},callBack:function(e,o,n){_aoWin.QMWin&&QMWin.call?QMWin.call(e||this,o,n):callBack.call(e||this,o,n)},uin:function(){return _aoWin.QMWin&&QMWin.uin?QMWin.uin():getUin()},sid:function(){return _aoWin.QMWin&&QMWin.sid?QMWin.sid():getSid()},_ajax:function(t){var e=_aoWin,o=t.vData,n=["r=",Math.random()];if(t.sType=t.sType||"GET",t.nTimeout=t.nTimeout||15e3,"string"!=typeof o)for(var _ in o)if("[object Array]"==Object.prototype.toString.call(o[_]))for(var i=0,a=o[_].length;i<a;i++)n.push("&",_,"=",encodeURIComponent(o[_][i]));else n.push("&",_,"=",encodeURIComponent(o[_]));else n.push(o);if(e.QMWin&&QMWin.ajax)QMWin.ajax({sDataType:"json",sUrl:t.sUrl,vData:n.join(""),sType:t.sType,nTimeout:t.nTimeout,ongetxhr:function(){return t.oAjaxInst||QMWin.ajaxSetting().ongetxhr()},onerror:function(e,o,n){_oQMWebpush.callBack(null,t.oncomplete,[!1,o,e])},onsuccess:function(e,o,n){_oQMWebpush.callBack(null,t.oncomplete,[!0,e,n])}});else{var l=t.sUrl,s="GET"==t.sType;s&&n.unshift(l,l.indexOf("?")<0?"?":"&"),QMAjax.send(s?n.join(""):l,{method:t.sType,timeout:t.nTimeout,content:s?"":n.join(""),onload:function(e,o,n){"abort"==o&&(o="timeout"),_oQMWebpush.callBack(null,t.oncomplete,[e,o,n])}},new QMAjax("","",0,t.oAjaxInst))}},_createIframe:function(e){var o=_aoWin;o.QMWin&&QMWin.insertIframe?QMWin.insertIframe(e,"afterBegin"):createIframe(o,e.src,e)}};_oQMWebpush._LOGIC_KEY={_GETWEBPUSHKEY:"/cgi-bin/getwpkey",_RETRY:5,_RETRYTIME:60,_DELAYTIME:3e5,_mnRetry:0,_mbGettingKey:!1,_msKey:"",_moGetKeyList:[],getKey:function(e,o){var n=this;return n._msKey&&!o?n._msKey:(n._mnRetry=0,n._moGetKeyList.push(e),n._getKeyDelayFromCgi(),null)},expire:function(){return this._msKey="",this},_mbDelayTimeHandle:null,_mnPreviousTime:0,_getKeyDelayFromCgi:function(){var e=this;return _oQMWebpush.debug(["_oSelf._getKeyDelayFromCgi",e._mnPreviousTime,!e._mbDelayTimeHandle,!e._mbGettingKey]),e._mbDelayTimeHandle||(e._mnPreviousTime&&+new Date-e._mnPreviousTime<6e4?e._mbDelayTimeHandle=setTimeout(function(){e._mbDelayTimeHandle=null,e._getKeyFromCgi()},e._DELAYTIME):e._getKeyFromCgi()),e},_getKeyFromCgi:function(){var _oSelf=this;_oQMWebpush.debug(["_oSelf._mbGettingKey begin",_oSelf._mbGettingKey,_oSelf._mnRetry]),_oSelf._mbGettingKey||++_oSelf._mnRetry>_oSelf._RETRY||(_oSelf._mbGettingKey=!0,_oSelf._mnPreviousTime=+new Date,_oQMWebpush._ajax({sUrl:_oSelf._GETWEBPUSHKEY,vData:{resp_charset:"UTF8",ef:"js",sid:_oQMWebpush.sid()},oncomplete:function(_abIsOk,_asParam,_aoXmlObj){_oSelf._mbGettingKey=!1;var _nDelay=_oSelf._RETRYTIME,_obj;if(_abIsOk){try{_obj=eval("("+_asParam+")")}catch(e){_oQMWebpush.debug(["_getKeyFromCgi eval\u9519\u8bef",e.message])}if(_obj&&_obj.k){_oSelf._msKey=_obj.k;for(var _oList=_oSelf._moGetKeyList,i=0,_nLen=_oList.length;i<_nLen;i++)_oSelf._msKey&&_oQMWebpush.callBack(_oSelf,_oList[i],[_oSelf._msKey]);return _oSelf._moGetKeyList=[],void(_oSelf._mnRetry=0)}}_obj&&(_nDelay="-2"==_obj.errcode?-1:parseInt(_obj.errmsg)||_nDelay),_oQMWebpush.debug(["_getKeyFromCgi\u8fd4\u56de\u9519\u8bef",_obj&&_obj.errcode,_nDelay]),0<=_nDelay&&setTimeout(function(){_oSelf._getKeyDelayFromCgi()},1e3*_nDelay)}}))}};var poll_url="/poll";try{"withCredentials"in new XMLHttpRequest&&!_aoWin.XDomainRequest&&"exmail.qq.com"==location.hostname&&(poll_url=location.protocol+"//poll.exmail.qq.com/poll")}catch(e){}_oQMWebpush._LOGIC_POLL={_moProxyWin:null,_mbCreatingProxy:!1,_moLongConnectAjax:null,_mbLongConnecting:!1,_msKey:null,_msTime:"0",_mnOpenServices:0,_moEventList:[],_ABORTTIME:30,_POLL:poll_url,_PROXY_URL:"/zh_CN/htmledition/domain_admin.html?"+location.host+"&v=110701",open:function(e){var o=this;return o._mnOpenServices|=e,_oQMWebpush.debug(["\u5f00\u901a\u4e86",o._mnOpenServices,e]),o._poll()},close:function(e){var o=this;return o._mnOpenServices&=~e,_oQMWebpush.debug(["\u5173\u95ed",o._mnOpenServices,e]),o},addEvent:function(e,o,n){var t=this;if(_oQMWebpush.debug(["\u52a0\u8f7d\u4e8b\u4ef6",e]),e&&o){for(var _=0,i=t._moEventList,a=i.length;_<a;_++)if(i[_][1]==o){i[_][0]|=e;break}a<=_&&i.push([e,o]),n&&t.open(e)}return t},delEvent:function(e){if(e)for(var o=0,n=this._moEventList,t=n.length;o<t;o++)n[o][1]==e&&n.splice(o,1);return this},_fireEvent:function(e,o){var n=this;_oQMWebpush.debug(["_fireEvent service",n._mnOpenServices,e,o]);for(var t=0,_=n._moEventList,i=_.length;t<i;t++)_oQMWebpush.debug(["_fireEvent loop",n._mnOpenServices&e&_[t][0],_[t][0]]),n._mnOpenServices&e&_[t][0]&&_oQMWebpush.callBack(n,_[t][1],[e,o]);return n},_getSKey:function(){var o=this,e=_oQMWebpush._LOGIC_KEY.getKey(function(e){o._msKey=e,o._poll()},!0);return o._msKey=e,o},_analysePoll:function(e){for(var o={},n=0,t=0,_=e.length;t<_;t++){var i=e[t];n<i.t&&(n=i.t),(o[i.b]=o[i.b]||[]).push(i.c)}for(var a in this._msTime=n,o)this._fireEvent?_oQMWebpush.debug([a]):_oQMWebpush.debug(["_analysePoll_noevent"]),this._fireEvent(a,o[a]);return this},_abort:function(){var e=this;return e._moLongConnectAjax&&e._mbLongConnecting&&(e._moLongConnectAjax.abort(),e._mbLongConnecting=!1),e},_poll:function(){_oQMWebpush.debug(["poll\u8c03\u7528"]);var _oSelf=this;return!_oSelf._mnOpenServices||_oSelf._mbLongConnecting?(_oQMWebpush.debug(["poll1",_oSelf._mnOpenServices,_oSelf._mbLongConnecting]),_oSelf):_oSelf._moLongConnectAjax?_oSelf._msKey?(_oSelf._abort()._mbLongConnecting=!0,_oQMWebpush.debug(["poll\u8bf7\u6c42",_oSelf._msTime]),_oQMWebpush._ajax({sUrl:_oSelf._POLL,vData:{u:_oQMWebpush.uin(),s:_oSelf._mnOpenServices,k:_oSelf._msKey,t:_oSelf._msTime,i:_oSelf._ABORTTIME,r:Math.random()},nTimeout:1e3*(_oSelf._ABORTTIME+3),oAjaxInst:_oSelf._moLongConnectAjax,oncomplete:function(_abIsOk,_asParam,_aoXmlObj){_oSelf._mbLongConnecting=!1;var _oJson=null,_nDelay=10;if(_abIsOk)try{_oJson=eval(_asParam)}catch(e){_oQMWebpush.debug(["poll\u8fd4\u56dejson\u6709\u8bef"])}if(_abIsOk||"timeout"!=_asParam){if(_oJson)if(_oQMWebpush.debug(["poll\u7684json",_oJson.e,_oJson.d]),_oJson.e){if(-100==_oJson.e)return _oSelf._getSKey();isNaN(_oJson.d)||(_nDelay=parseInt(_oJson.d))}else _oSelf._analysePoll(_oJson),_nDelay=0}else _oQMWebpush.debug([_asParam]),_nDelay=0;_oQMWebpush.debug(["_nDelay",_nDelay]),0<=_nDelay&&setTimeout(function(){_oSelf._poll()},1e3*_nDelay)}}),_oSelf):(_oQMWebpush.debug(["poll3"]),_oSelf._getSKey()):(_oQMWebpush.debug(["poll2"]),_oSelf._createProxy())},_createProxy:function(){var t=this;return t._moProxyWin&&t._mbCreatingProxy||(t._mbCreatingProxy=!0,_oQMWebpush._createIframe({id:"webpush"+ +new Date,style:"position:absolute;z-index:-1;width:1px;height:1px;left:-5;top:-5px;",src:t._PROXY_URL,onload:function(){var e,o;t._mbCreatingProxy=!1;try{o=!!(e=this.contentWindow).xmlHttp}catch(n){_oQMWebpush.debug([n.message]),o=0}o&&(t._moProxyWin=e,t._moLongConnectAjax=e.xmlHttp(),t._poll()),_oQMWebpush.debug(["createiframe",o])}})),t}},_aoWin.QMWebpush=_oQMWebpush,_oDebugcache=[],_oQMWebpush.debug=function(e){_aoWin.debug,_oDebugcache.push([(new Date).toLocaleString()," : ",e.join?e.join(","):e].join(""))},_oQMWebpush.output=function(){var e=document.createElement("div");e.style.cssText="position:absolute;width:300px;height:400px;z-index:999;background:white;",e.innerHTML=["<a href='javascript:void(0);' style='display:block;text-align:center;' onclick='document.body.removeChild(this.parentNode)'>\u9690\u85cf</a><div style='width:100%;height:100%'><textarea style='width:100%;height:100%'>",_oDebugcache.join("\n"),"</textarea></div>"].join(""),document.body.appendChild(e)},_oQMWebpush.debug(["QMWin",_aoWin.QMWin])})(window);