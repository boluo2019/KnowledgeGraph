QMEditorAdapter,extend(QMEditor.CONST.LANGUAGE.zh_CN,{FUN_PHOTO:"\u4e0a\u4f20\u7167\u7247",FUN_PHOTO_LABEL:"\u7167\u7247",FUN_MO:"\u63d2\u5165\u8868\u60c5",FUN_MO_LABEL:"\u8868\u60c5",FUN_SCREENSNAP:"\u6355\u83b7\u5c4f\u5e55",FUN_SCREENSNAP_SETUP_TIP:"\u8bf7\u70b9\u51fb\u5b89\u88c5\u622a\u5c4f"+QMAXInfo.getTitle()+"\r\u5b89\u88c5\u540e\u60a8\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u622a\u5c4f\uff0c\u5e76\u53d1\u9001\n\u7ed9\u60a8\u7684\u597d\u53cb\u4e00\u8d77\u4ea4\u6d41\u5206\u4eab\u3002",FUN_SCREENSNAP_LABEL:"\u622a\u5c4f",FUN_MUSIC:"\u63d2\u5165\u80cc\u666f\u97f3\u4e50",FUN_MUSIC_LABEL:"\u97f3\u4e50",FUN_MUSIC_LABEL_ADDED:"\u5df2\u6dfb\u52a0",COMM_CONFIRM:"\u786e\u5b9a",COMM_CANCEL:"\u53d6\u6d88",COMM_HELP:"\u5e2e\u52a9",PO_LOCAL_PHOTO:"\u4e0a\u4f20\u7167\u7247",PO_LOCAL_DESC:"( \u8bf7\u70b9\u51fb\u201c"+(gbIsIE||gbIsFF||gbIsQBWebKit?"\u6d4f\u89c8":gbIsOpera?"\u9009\u62e9":"\u9009\u62e9\u6587\u4ef6")+"\u201d\uff0c\u5728\u60a8\u7535\u8111\u4e2d\u9009\u62e9\u60a8\u8981\u4e0a\u4f20\u7684\u7167\u7247\u3002)",PO_LOCAL_INPUT:"\u9009\u62e9\u7167\u7247\uff1a",PO_LOCAL_OK:"\u7acb\u5373\u4e0a\u4f20",PO_NET_PHOTO:"\u7f51\u7edc\u7167\u7247",PO_NET_DESC:"( \u8bf7\u5728\u4e0b\u9762\u8f93\u5165\u6846\u91cc\u9762\u586b\u4e0a\u5f85\u63d2\u5165\u56fe\u7247\u7684\u94fe\u63a5\u8def\u5f84\u3002)",PO_NET_INPUT:"\u7167\u7247\u8def\u5f84\uff1a",PO_NET_OK:"\u7acb\u5373\u63d2\u5165",PO_QQALBUM_DESC:"\u4eceQQ\u76f8\u518c\u9009\u53d6",PO_DLG_TITLE:"\u4e0a\u4f20\u56fe\u7247",PO_DLG_UPLOADING:"\u56fe\u7247\u4e0a\u4f20\u4e2d...",PO_DLG_UPLOADFAIL:"\u56fe\u7247\u4e0a\u4f20\u5931\u8d25\u4e86\uff01",PO_DLG_UPLOADFAIL_INFO:"\u56fe\u7247\u4e0a\u4f20\u5931\u8d25\uff1a\u60a8\u4e0a\u4f20\u7684\u56fe\u7247\u5927\u5c0f($curSize$)\u8d85\u8fc7\u4e86\u6700\u5927\u9650\u5236($allowSize$)\u3002",MO_LOADING:"\u8868\u60c5\u52a0\u8f7d\u4e2d...",MC_LOADING:"\u97f3\u4e50\u52a0\u8f7d\u4e2d...",MC_REPLACE_TIP:"\u60a8\u5df2\u7ecf\u6dfb\u52a0\u4e86\u80cc\u666f\u97f3\u4e50\uff0c\u662f\u5426\u9700\u8981\u66ff\u6362\u4e3a\u65b0\u7684\uff1f",SCREENSNAP_FAIL:"\u622a\u5c4f\u4e0d\u6210\u529f\uff01",SCREENSNAP_SAVEFAIL:"\u4fdd\u5b58\u622a\u5c4f\u56fe\u7247\u4e0d\u6210\u529f\uff01",UPLOADER_VERSION_LOW:"\u4e0a\u4f20"+QMAXInfo.getTitle()+"\u7248\u672c\u8fc7\u4f4e\uff0c\u8bf7\u5347\u7ea7\uff01",FUN_MAP_LABEL:"\u5730\u56fe",FUN_MORE_LABEL:"\u66f4\u591a"}),extend(QMEditor.CONST._TEMPLATE,{STYLE:T(["body, table, form {padding:0;margin:0;font-family:Verdana;font-size:12px;line-height:12px;}","table {padding-top:2px;}",".QMEditorTabEmptyLeft, .QMEditorTabEmptyRight {border-bottom:1px solid #aeaeae;}",".QMEditorTabEmptyLeft {padding-left:10px;}",".QMEditorTabEmptyRight {width:100%;}",".QMEditorTab {padding:4px 4px 2px 4px;border:1px solid #aeaeae;margin-top:2px;cursor:pointer;} ",".QMEditorTabSel {padding:4px;border:1px solid #aeaeae;border-bottom:none;border-top:2px solid #FFC83C;font-weight:bold;cursor:pointer;}",".QMEditorPoPanel {padding:15px 0 0 15px;}",".QMEditorPoDesc {margin-bottom:6px;color:gray;}",".QMEditorPoInputLabel {padding:5px 0 15px 1px;}","input {width:232px;height:20px;}",".QMEditorPoButton {text-align:right;padding-right:15px;}",".QMEditorButton1 {width:52px;margin:1px 2px 0 0}",".QMEditorButton2 {width:76px;*width:72px;margin:1px 2px 0 0}",".QMEditorButton1 .QMEditorButton2 {font-size:12x;height:auto;*height:22px;line-height:auto;*line-height:18px;padding:0 8px;*padding:0;}"])}),extend(QMEditor.CONST._TEMPLATE,{MENU_PHOTO:T(['<div style="width:330px;height:140px;" hideFocus="true"></div>']),_MENU_PHOTO_HEADER:T(['<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />',"<style>","$style$","</style>"]),_MENU_PHOTO_BODY:T(['<body tabindex="-1" unselectable="on">',"<body>"]),_IMG_UPLOAD:T(['<iframe tabindex="-1" name="QMEditorPhotoIframe$iframeId$"  src="javascript:\'\'" style="display:none;" onload="if(window.QMEditorPhotoLoaded)QMEditorPhotoLoaded(this);"  ></iframe>','<form tabindex="-1" action="$actionSrc$" id="composeImgForm" enctype="multipart/form-data" method="post" target="QMEditorPhotoIframe$iframeId$" >','<input tabindex="-1" type="file" name="UploadFile" id="composeUploadFile" onkeydown="return false;" style="padding-top: 25px;margin-top: -10px;margin-left: -10px;cursor: pointer;margin-top:-3px\\9;font-size:200px;" />','<input type="hidden" name="sid"  value="$sid$" />','<input type="hidden" name="fun" value="add" />','<input type="hidden" name="mode" value="download" />','<input type="hidden" name="widthlimit" value="$widthlimit$" />','<input type="hidden" name="heightlimit" value="$heightlimit$" />','<input type="hidden" name="sizelimit" value="$sizelimit$" />',"</form>"]),_MENU_PHOTO_BODYHTML:T(['<table cellspacing="0" cellpadding="0" border="0" width="100%" unselectable="on" ><tr>','<td class="QMEditorTabEmptyLeft" unselectable="on" nowrap >&nbsp;</td>','<td style="$uploadDisp$" unselectable="on" nowrap>','<div param="localPhoto" class="QMEditorTabSel" unselectable="on">$langLocalPhoto$</div>',"</td>",'<td unselectable="on" nowrap >','<div param="netPhoto" class="QMEditorTab" style="border-left:none;" unselectable="on" >$langNetPhoto$</div>',"</td>",'<td class="QMEditorTabEmptyRight" unselectable="on" nowrap >&nbsp;</td>',"</tr></table>",'<div class="QMEditorPoPanel" style="$uploadDisp$" unselectable="on" >','<iframe tabindex="-1" name="QMEditorPhotoIframe$iframeId$"  src="javascript:\'\'" style="display:none;" onload="if(window.QMEditorPhotoLoaded)QMEditorPhotoLoaded(this);"  ></iframe>','<form action="$actionSrc$" enctype="multipart/form-data" method="post" target="QMEditorPhotoIframe$iframeId$" >','<div class="QMEditorPoDesc" unselectable="on">$langLocalDesc$</div>','<div class="QMEditorPoInputLabel" >$langLocalInput$&nbsp;','<input tabindex="-1" type="file" name="UploadFile" onkeydown="return false;" />','<input type="hidden" name="sid"  value="$sid$" />','<input type="hidden" name="fun" value="add" />','<input type="hidden" name="mode" value="download" />','<input type="hidden" name="widthlimit" value="$widthlimit$" />','<input type="hidden" name="heightlimit" value="$heightlimit$" />','<input type="hidden" name="sizelimit" value="$sizelimit$" />',"</div>","</form>",'<div class="QMEditorPoButton" unselectable="on" >','<button class="QMEditorButton2" param="localok" >$langLocalOK$</button>&nbsp;','<button class="QMEditorButton1" param="cancel" >$langCancel$</button>',"</div>","</div>",'<div class="QMEditorPoPanel" style="display:none;" unselectable="on" >','<div class="QMEditorPoDesc" unselectable="on" >$langNetDesc$</div>','<div class="QMEditorPoInputLabel" unselectable="on" >$langNetInput$&nbsp;','<input type="text" class="txt" onmousedown="try{parent.stopPropagation(event);}catch(e){}" />',"</div>",'<div class="QMEditorPoButton" unselectable="on" >','<button class="QMEditorButton2" param="netok" >$langNetOK$</button>&nbsp;','<button class="QMEditorButton1" param="cancel" >$langCancel$</button>',"</div>","</div>"]),DIALOG_UPLOADIMG:T(['<div style="padding-top:40px;padding-bottom:55px;">','<div id="uploading">','<img src="$imgPath$ico_loading2.gif" width="32" height="32" align=absmiddle style="margin:0 4px 0 0" />$langUploading$','<span id="uploadProcess"></span>',"</div>",'<div id="uploadFail" style="display:none;" >',"$langUploadFail$","</div>","</div>"]),MENU_MO:T(['<div class="QMEditorMenuPanel" unselectable="on" ><span>$loading$</span></div>']),MENU_MUSIC:T(['<div class="QMEditorMenuPanel" unselectable="on" ><span>$loading$</span></div>']),PO_DLG_UPLOADING:TE(["\u6b63\u5728\u4e0a\u4f20","$@$if($cnt$ > 1)$@$","$idx$/$cnt$","$@$endif$@$","..."])}),QMEditor._ActiveX=function(t){this._moBindEditor=t},QMEditor._ActiveX._bind=function(t){return t?(t._mUseActivex||(t._mUseActivex=new QMEditor._ActiveX(t)),t._mUseActivex):null},QMEditor._ActiveX.prototype._modelDialog=function(t){var o,e=this._moBindEditor,i=e._moTemplate,n=e._moLanguage;new(getTop().QMDialog)({sId:"upload",sTitle:n.PO_DLG_TITLE,sBodyHtml:i.DIALOG_UPLOADIMG.replace({imgPath:getPath("image"),langUploading:n.PO_DLG_UPLOADING,langUploadFail:n.PO_DLG_UPLOADFAIL}),nWidth:400,nHeight:163,bAnimation:!1,onclose:function(){o&&clearInterval(o),e.loadRange(),callBack(t)},onshow:function(){var t=this;if(t.S("uploading")&&""==t.S("uploading").style.display){var e=1;o=setInterval(function(){e<=99?(t.S("uploadProcess")&&(t.S("uploadProcess").innerHTML=e+"%"),e++):o&&clearInterval(o)},200)}}})},QMEditor._ActiveX.prototype._uploadOk=function(){getTop().QMDialog("upload","close")},QMEditor._ActiveX.prototype._uploadFail=function(t){var e=getTop().QMDialog("upload"),o=e&&e.S("uploadFail");if(o){var i=this._moBindEditor._moLanguage;o.innerHTML=t?T(i.PO_DLG_UPLOADFAIL_INFO).replace(t):i.PO_DLG_UPLOADFAIL,show(o,!0),e&&e.S("uploading")&&show(e.S("uploading"),!1)}},QMEditor._ActiveX.prototype._uploading=function(t){var e=getTop().QMDialog("upload"),o=e&&e.S("uploadProcess");o&&(o.innerHTML=t,e&&e.S("uploading")&&show(e.S("uploading"),!0),e&&e.S("uploadFail")&&show(e.S("uploadFail"),!1))},QMEditor._ActiveX.prototype._screenSnap=function(e){var t=this._getScreenSnapObj();if(t){try{t._Type="foxmail.com"==getDomain()?1:0}catch(i){}var o=function(t){return function(){"function"==typeof e&&e(t)}};t.OnCaptureFinished=o(!0),t.OnCaptureCanceled=o(!1),t.DoCapture()}},QMEditor._ActiveX.prototype._getScreenSnapObj=function(){return this._moScreenSnapObj||detectActiveX(0,1)&&(this._moScreenSnapObj=createActiveX(0)),this._moScreenSnapObj},QMEditor._ActiveX.prototype._hasScreenSnapImg=function(){return this._msScreenImg},QMEditor._ActiveX.prototype._clearScreenSnapImg=function(){this._msScreenImg=""},QMEditor._ActiveX.prototype._isClipBoardImage=function(){return this._getScreenSnapObj()&&this._getScreenSnapObj().IsClipBoardImage},QMEditor._ActiveX.prototype._saveImg=function(t){return!(!this._getScreenSnapObj()||(this._isClipBoardImage()?(this._msScreenImg=this._getScreenSnapObj().SaveClipBoardBmpToFile(1),!this._msScreenImg&&(t&&alert(this._moBindEditor._moLanguage.SCREENSNAP_SAVEFAIL),1)):(t&&alert(this._moBindEditor._moLanguage.SCREENSNAP_FAIL),1)))},QMEditor._ActiveX.prototype._uploadCustomImg=function(t,e){return this._saveImg(t)&&this._startUploadCustomImg(null,t,e)},QMEditor._ActiveX.prototype._startUploadCustomImg=function(t,e,o){var a=this;if(!detectActiveX(2,1))return e&&alert(a._moBindEditor._moLanguage.UPLOADER_VERSION_LOW),!1;if(!a._msScreenImg&&!t)return!1;if(!gbIsIE&&t)return!1;a._moUploaderObj||(a._moUploaderObj=createActiveX(2,a._moBindEditor.getEditWin()));var i=a._moUploaderObj,n=!1;function r(t,e){n||(n=!0,i.StopUpload(),"function"==typeof o&&o(!!t,e))}a._modelDialog(r),i.StopUpload(),i.ClearHeaders(),i.ClearFormItems(),i.URL=a._moBindEditor._msPhotoActionSrc,i.OnEvent=function(t,e,o,i,n){a._onUploaderEvent(t,e,o,i,n,r)},i.AddHeader("Cookie",document.cookie),i.AddFormItem("fun",0,0,"add"),i.AddFormItem("sid",0,0,getSid()),i.AddFormItem("mode",0,0,"download"),i.AddFormItem("from",0,0,t?"":"snapscreen");var s=a._moBindEditor._moPhotoConfig||{};return i.AddFormItem("widthlimit",0,0,s.widthlimit||0),i.AddFormItem("heightlimit",0,0,s.heightlimit||0),i.AddFormItem("sizelimit",0,0,s.sizelimit||0),t?i.AddFormItemObject(t):i.AddFormItem("UploadFile",1,4,a._msScreenImg),i.StartUpload(),!0},QMEditor._ActiveX.prototype._onUploaderEvent=function(t,e,o,i,n,a){switch(e){case 1:return a(!1,{errCode:o});case 2:return void this._uploading(parseInt(90*o/i)+"%");case 3:if("200"!=this._moUploaderObj.ResponseCode)return a(!1,{errCode:o});this._uploading("100%"),this._processResponse(this._moUploaderObj.Response,a)}},QMEditor._ActiveX.prototype._processResponse=function(t,e){var o=t||"",i=o.indexOf('On_upload("'),n=o.indexOf('");',i),a=-1!=i&&-1!=n?o.substring(i+11,n):"err";if("err"!=a)return e(!0,{imgUrl:a});function r(t){return t=parseInt(t),'<span style="color:red;" >'+(isNaN(t)?"5M":parseInt(100*parseInt(t)/1048576)/100)+"M</span>"}return i=o.indexOf('On_upload_Fail("'),n=o.indexOf('");',i),-1!=i&&-1!=n?e(!1,{curSize:r((a=o.substring(i+16,n).replace(new RegExp('"',"ig"),"").split(","))[0]),allowSize:r(a[1])}):e(!1)},QMEditor.FUNCLIB._MENUCUSTOM=QMEditor.FUNCLIB._inheritFrom(function(){this._msId="MENUCUSTOM",this._msType="menu",this._msTmplName="MENU_CUSTOM",this._mbIsSaveRange=!0,this._moMenuData=[{}]},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB._MENUCUSTOM.prototype._initMenuElements=function(){this._moMenuElements={},function(t){if(t&&1==t.nodeType){var e=t.getAttribute("param");for(e&&(this._moMenuElements[e]=t),t=t.firstChild;t;t=t.nextSibling)arguments.callee.call(this,t)}}.call(this,this._moBindMenu),this._setMenuElementsEvent()},QMEditor.FUNCLIB._MENUCUSTOM.prototype._setMenuElementsEvent=function(){},QMEditor.FUNCLIB.MENU=QMEditor.FUNCLIB._inheritFrom(function(){this._msId="MENU",this._msType="menu",this._mnShowCount=0},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.MENU.prototype.showMenu=function(t,i){var n=this,e=n.getMenuItems(i);if(e&&0!=e.length&&e[0]&&e[0].sItemValue){var o=calcPos(i&&i.oContainer||n._moContainer),a=!n._moBindEditor._mbNotAllowArrow&&(i&&i.nArrowPos||n._moUiConfig.arrowPos)||0,r=a&&o[3]-calcPos(n._moBindEditor.getEditorArea())[3],s=a&&(r<0?1:Math.min(o[3]-calcPos(n._moBindEditor.getEditorArea())[3],a-7)),l=i&&i.nWidth||this._moUiConfig.width,d="right"==(n._moFuncConfig||{}).align||"right"==this._moUiConfig.align,p=l&&d?Math.max(o[1]-l,calcPos(n._moBindEditor.getEditorArea())[3]):o[3];t&&(!n._moBindEditor._mbIsFocus&&n._moBindEditor.focus(),n._changeStatus(!0)),n._moMenu&&n._moMenu.close(!0),n._moMenuCfg=i,n._moMenu=new QMMenu({oEmbedWin:this._moBindEditor.getEditorAreaWin(),nWidth:l||"auto",nZIndex:1121,sWidthDetect:"float",nItemHeight:i&&i.nItemHeight||this._moUiConfig.itemHeight||undefined,nArrowPos:s?s<10?10:s:0,nX:p+(s?"text"==n._msUiType?25:8:0),nY:o[2]+(s?-4:5),oItems:e,bAutoClose:i.bAutoClose||1<e.length,bProxyScroll:i.bAutoClose||1<e.length,onload:function(){n._mnShowCount++,n.initMenu(this,i)},onshow:function(){n.doMenuShow(this,i)},onclose:function(){--n._mnShowCount<=0&&(n._mnShowCount=0,n._changeStatus(!1)),i.fMenuClose&&i.fMenuClose()},onbeforeclose:function(t){n._moUiConfig.fBeforeclose&&n._moUiConfig.fBeforeclose.apply(n,[t])},onitemclick:function(t,e,o){n.doItemClick(t,e,i,o)}})}},QMEditor.FUNCLIB.MENU.prototype.hideMenu=function(t){this.getMenu()&&this.getMenu().close(),this._moMenuCfg=undefined},QMEditor.FUNCLIB.MENU.prototype._doShowMenuClick=function(t){var e,o=getEventTarget(t).getAttribute("opt"),i=!0,n=getTop();this._getStatus()&&(i="more"==o!=(this._moMenuCfg&&"more"==this._moMenuCfg.sName)),e=!(this._getStatus()||("more"==o||"Music"==this._msId)&&gbIsIE&&6===gnIEVer),i?this.showMenu(e,"more"==o?{sName:"more"}:{}):this.hideMenu(!0),n.LogKvEx({businame:"common_stat",item:"webmail|menu|more|click",sid:n.getSid()})},QMEditor.FUNCLIB.MENU.prototype.getUiType=function(){return this._msUiType},QMEditor.FUNCLIB.MENU.prototype.getMenu=function(){return this._moMenu},QMEditor.FUNCLIB.MENU.prototype.getMenuItems=function(t){return[{bDisSelect:!0,sStyle:"padding:0;",nHeight:"auto",sItemValue:this.getMenuUI(t)}]},QMEditor.FUNCLIB.MENU.prototype.getMenuUI=QMEditor.FUNCLIB.MENU.prototype.initMenu=QMEditor.FUNCLIB.MENU.prototype.doMenuShow=QMEditor.FUNCLIB.MENU.prototype.doItemClick=function(){},QMEditor.FUNCLIB._MENUIMAGE=QMEditor.FUNCLIB._inheritFrom(function(){this._msId="MENUIMAGE",this._msTmplName="MENU_IMAGE",this._mbIsFireUploadEvent=!0},QMEditor.FUNCLIB._MENUCUSTOM),QMEditor.FUNCLIB._MENUIMAGE.prototype._insertImage=function(t){var o=this._moBindEditor;o._execCmd("InsertImage",t,function(){var t=this._moEditDoc.selection;if(t&&"Control"==t.type){o._getSelectionElement();var e=this._moEditDoc.body.createTextRange();e.moveToElementText(this._moEditDoc.selection.createRange().item(0)),e.collapse(!1),e.select()}-1<o.getEditorId().indexOf("groupsms")&&setTimeout(function(){o._mfOnFocus.call(o," ")},1e3)})},QMEditor.FUNCLIB._MENUIMAGE.prototype._readyToUpload=function(){this._mbIsFireUploadEvent=!1},QMEditor.FUNCLIB._MENUIMAGE.prototype._isReadyToUpload=function(){return 1!=this._mbIsFireUploadEvent},QMEditor.FUNCLIB._MENUIMAGE.prototype._doUploadFinish=function(t,e){if(!this._mbIsFireUploadEvent){this._mbIsFireUploadEvent=!0;var o=QMEditor._ActiveX._bind(this._moBindEditor);t?(o._uploadOk(),this._insertImage(e.imgUrl)):o._uploadFail(e)}},QMEditor.FUNCLIB.MENUIMAGE=QMEditor.FUNCLIB._inheritFrom(function(){this._msId="MENUIMAGENEW",this._mbIsFireUploadEvent=!0},QMEditor.FUNCLIB.MENU),QMEditor.FUNCLIB.MENUIMAGE.prototype.insertImage=function(t){this.getBindEditor().insertImage(t)},QMEditor.FUNCLIB.MENUIMAGE.prototype._readyToUpload=function(){this._mbIsFireUploadEvent=!1},QMEditor.FUNCLIB.MENUIMAGE.prototype._isReadyToUpload=function(){return 1!=this._mbIsFireUploadEvent},QMEditor.FUNCLIB.MENUIMAGE.prototype._doUploadFinish=function(t,e){if(!this._mbIsFireUploadEvent){this._mbIsFireUploadEvent=!0;var o=QMEditor._ActiveX._bind(this.getBindEditor());t?(o._uploadOk(),this.insertImage(e.imgUrl)):o._uploadFail(e)}},QMEditor.setupFunc(),function(A,_aoUndefined){var _fInsertImage=QMEditor.prototype.insertImage,_fCalcSize=function(t,e){for(var o=finds("img[filesize]",e),i=t,n=0;n<o.length;n++)i+=parseInt(o[n].getAttribute("filesize"));return i<52428800};QMEditor.prototype.insertImage=function(t,o,e){var i=this,n=t.match(/filesize=.*&/),a=n&&n[0],r=a&&parseInt(a.split("=")[1]);_fCalcSize(r,i.getEditWin())?_fInsertImage.call(i,t,function(t,e){0<r&&e&&e.setAttribute("filesize",r),"function"==typeof o&&o.apply(i,arguments)},e):showError("\u6dfb\u52a0\u7684\u7167\u7247\u603b\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc750M")},QMEditor.FUNCLIB.Photo=QMEditor.FUNCLIB._inheritFrom(function(t){if(t){this.setBindEditor(t.editor);var e=this,o=e.getBindEditor().getLanguage(),i=e._moPhotoMethods=[],n="icon"==t.uiType;e._mbInitUpload=!n,e.setId("Photo"),e.setFuncConfig((t.oParamSet.funcConfig||{})[e.getId()]||{}),e.getBindEditor().getPhotoActionSrc()?i.push({sId:"upload",sItemValue:o.PO_LOCAL_PHOTO}):e._mbInitUpload=!1,!1!==e.getFuncConfig().url&&i.push({sId:"url",sItemValue:o.PO_NET_PHOTO}),this._moUiConfig.icon={className:"qmicon_addImg",bgleft:0,topNum:-72,width:24,margin:"0 0 0 0",imgstyle:"width:16px;height:16px;overflow:hidden;margin:2px 0 0 2px;",src:"newicon/compose_new.png",title:o.FUN_PHOTO},this._moUiConfig.text={margin:"0 11px 0 0",bgleft:0,bgup:-72,width:0,marginNB:"0 3px 0 0",src:"newicon/compose_new.png",moreBtn:n?0:1<i.length,imgUpload:1,title:o.FUN_PHOTO,label:o.FUN_PHOTO_LABEL},this._moUiConfig.big={src:QMEditor.getTopWin().getPath("image")+"compose_easy_photo.gif",label:o.FUN_PHOTO_LABEL}}},QMEditor.FUNCLIB.MENUIMAGE),QMEditor.FUNCLIB.Photo.prototype.getMenuItems=function(t){var e=this;return gbIsIE&&6==gnIEVer&&(t.nWidth=150),t?"more"==t.sName?(t.nWidth="zh_CN"==getTop().getLocale()?150:170,e._moPhotoMethods.slice(1)):t.sName||"text"!=e.getUiType()?t.sName||"icon"!=e.getUiType()?QMEditor.FUNCLIB.MENU.prototype.getMenuItems.call(this,t):(e.getBindEditor().getEditorCustomVar("FullScreenToolbar.bUseFullEdtior")&&getTop().LogKV({sValue:"editor|toolbar|fullscreen|photo"}),e._moPhotoMethods):void 0:!e._mbUseUploadBtn&&e._moPhotoMethods.length<2?QMEditor.FUNCLIB.MENU.prototype.getMenuItems.call(this,t):e._moPhotoMethods},QMEditor.FUNCLIB.Photo.prototype.getMenuUI=function(t){var e=t||{},h=this;switch(t.sName){case"qzone":return e.nWidth=364,e.nArrowPos=182,getRes('<div id="qzone" class="qzone_container" style="text-align:center;"><div style="text-align:center; margin:110px 0;"><img src="$images_path$ico_loading2.gif" align="absmiddle" />&nbsp;&nbsp;\u52a0\u8f7d\u4e2d</div></div>');case"attach":return e.nWidth=364,e.nArrowPos=t.nWidth/2,getRes(['<div class="QMEditorToolPop">','<h1 class="qmEditorHead">\u9644\u4ef6\u5939\u6536\u85cf\u56fe\u7247</h1>','<div class="qmEditorPicContent" id="content">','<div class="clr" id="contentclr"></div>','<div class="qzone_container" style="text-align:center; height:132px; padding-top:110px;"><img src="$images_path$ico_loading2.gif" align="absmiddle"/>&nbsp;&nbsp;\u52a0\u8f7d\u4e2d</div>',"</div>","</div>"]);case"webapns":getTop().LogKV("compose|toolbar|entrance|photo|tel");var o=QMEditor.getTopWin(),s=parseInt(QMEditor.getTopWin().goUserInfo.get("IOSWEBAPPVER"),10)||0,f=QMEditor.getTopWin().goUserInfo.get("IOSWEBAPPVERNEW"),l=parseInt(QMEditor.getTopWin().goUserInfo.get("ANDROIDWEBAPPVER"),10)||0,d=(new Date).valueOf(),p="",i="";function E(t){for(var e=window.goIphonePath||[],o=0;o<e.length;o++)if(t==e[o])return!0;return!1};function c(t){var g=new QMDialog({sId:"iphoneuploadimg",sTitle:"\u4ece\u624b\u673a\u76f8\u518c\u4e0a\u4f20",sBodyHtml:TE(['<div class="QMEditorToolPop">','<div class="qmEditorPicContent" id="content">',"$@$if($step3$==1)$@$",'<ul class="uploadfromapp_step" style="padding:25px 25px 0 25px;margin-bottom:0;"><li>1.\u626b\u63cf\u4e8c\u7ef4\u7801</li><li>2.$stitle2$</li><li class="ufa_actived ufa_last">3.\u4ece\u624b\u673a\u4e0a\u4f20\u7167\u7247</li></ul>',"$@$endif$@$",'<div id="loading" style="padding-bottom:25px;overflow:hidden;">',"$@$if($webappver$==1)$@$",'<div class="mail_choose_upload_photo"></div>','<p class="ufa_intro" style="width:268px;margin-top:14px;">\u8bf7\u6253\u5f00\u624b\u673a\u6536\u5230\u7684\u6d88\u606f\u63d0\u9192\uff0c\u9009\u62e9\u8981\u4e0a\u4f20\u7684\u7167\u7247\uff0c<br/>\u6216\u624b\u52a8\u6253\u5f00\u624b\u673a\u4e2d\u7684QQ\u90ae\u7bb1\u3002&nbsp;<a href="http://service.mail.qq.com/cgi-bin/help?subtype=1&&no=1001015&&id=23" target="_blank">\u5e2e\u52a9</a></p>',"$@$else$@$",'<div class="iphoneupload_phone_code"></div>','<p class="ufa_intro" style="margin-top:14px;">\u4f60\u4f7f\u7528\u7684QQ\u90ae\u7bb1\u7248\u672c\u8fc7\u4f4e\uff0c\u8bf7<a href="http://itunes.apple.com/cn/app/id473225145?mt=8&ls=1" target="_blank">\u5347\u7ea7</a>\u540e\u4f7f\u7528\u6b64\u529f\u80fd\u3002&nbsp;<a href="http://service.mail.qq.com/cgi-bin/help?subtype=1&&no=1001015&&id=23" target="_blank">\u5e2e\u52a9</a></p>',"$@$endif$@$","</div>",'<div id="loaded" class="iphoneuploading" style="display:none;">','<div class="iphoneupload_thumb" ><img id="showimg" src="#"/></div>','<div class="iphoneupload_bar">','<span class="iphoneupload_icon_iphone"></span>','<div class="iphoneupload_progress" style="overflow:hidden">','<div id="uploadprocess" class="iphoneupload_progress_fill" style="width:5%;"></div>',"</div>",'<span class="iphoneupload_icon_imac"></span>',"</div>",'<div id="uploadnum" style="display:none"><span id="current"></span>/<span id="total"></span></div>',"</div>","</div>","</div>"]).replace({webappver:1==s||1==l?1:0,step3:t?1:0,stitle2:p}),nWidth:384,bAnimation:!1,onload:function(){},onclose:function(){h._bIpUploading=!1,h._oTimer&&clearInterval(h._oTimer),getTop().QMWebpush.getInst().close(64),o.QMAjax.send(getTop().T("/cgi-bin/webapnscheck?sid=$sid$&action=clearindex").replace({sid:getTop().getSid()}),{method:"POST",onload:function(){}})}});h._bIpUploading=!0,h._nCurrentImg=0,h._nProcessPercent=0,h._bFirst=!1,("1"==s||"1"==l)&&o.QMAjax.send(o.T("/cgi-bin/webapnscheck?sid=$sid$&key=$key$").replace({sid:o.getSid(),key:t?"":d}),{method:"POST",onload:function(){h._oTimer&&(clearInterval(h._oTimer),h._oTimer=null),h._oTimer=setInterval(function(){o.QMAjax.send(o.T("/cgi-bin/webapnscheck?sid=$sid$&key=$key$&action=checkappimg").replace({sid:o.getSid(),key:d}),{method:"POST",onload:function(t,e){if(t&&h._bIpUploading){var o,i=evalValue(e),n=i.Thumbnailurl||[],a=i.total||1,r=i.imgurl||[],s=g.S("uploadprocess"),l=i.done,d=100/a;g.S("total").innerHTML=a;for(var p=0;p<n.length;p++){var c,_=n[p];if(_)if("done"!=_)if(!E(o=_+"&sid="+getSid()))h._bFirst||(s.style.width="0",h._bFirst=!0),"undefined"==typeof window.goIphonePath&&(window.goIphonePath=[]),window.goIphonePath.push(o),o&&g.S("showimg").setAttribute("src",o),show(g.S("loading"),0),show(g.S("loaded"),1),c=g.S("current").innerHTML==h._nCurrentImg+1?parseInt(g.S("current").innerHTML)+1:parseInt(h._nCurrentImg)+1,g.S("current").innerHTML=c}for(p=0;p<r.length;p++){var m=r[p],u="";m&&(E(u=m+"&sid="+getSid())||(h._nCurrentImg++,"undefined"==typeof window.goIphonePath&&(window.goIphonePath=[]),window.goIphonePath.push(u),s.style.width=d*h._nCurrentImg+"%",h.insertImage(u),"0.9.8"==f&&(s.style.width="100%",setTimeout(function(){g.close()},500))))}"true"==l&&(s.style.width="100%",setTimeout(function(){g.close()},500))}}})},2e3)}})}if(i="2"==s&&"0"==l?(p="\u66f4\u65b0\u5ba2\u6237\u7aef","\u4f60\u4f7f\u7528\u7684QQ\u90ae\u7bb1iPhone\u5ba2\u6237\u7aef\u7248\u672c\u8fc7\u4f4e\uff0c<br/>\u8bf7\u5148\u626b\u63cf\u4e8c\u7ef4\u7801\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u3002"):(p="\u4e0b\u8f7d\u5e76\u5b89\u88c5","\u6b64\u529f\u80fd\u9700\u8981QQ\u90ae\u7bb1\u624b\u673a\u5ba2\u6237\u7aef\u914d\u5408\u4f7f\u7528\uff0c<br/>\u8bf7\u5148\u626b\u63cf\u4e8c\u7ef4\u7801\u4e0b\u8f7d\u5b89\u88c5\u3002"),"1"==s||"1"==l)c();else{getTop().QMWebpush.getInst().addEvent(64,function(t,e){var o=e&&e[0]||{};if(64==t){var i,n=o.st||"",a=o.os,r="";if("download"==n)"android"==a?i="\u5df2\u626b\u63cf\u5e76\u5f00\u59cb\u4e0b\u8f7dQQ\u90ae\u7bb1\uff0c\u8bf7\u5728\u5b89\u88c5\u5b8c\u6210\u540e<br/>\u7528\u6b64QQ\u90ae\u7bb1\u5e10\u53f7\u767b\u5f55\u4f7f\u7528\u3002":"ios"==a&&(i="\u5df2\u626b\u63cf\uff0c\u8bf7\u4eceApp Store\u5b89\u88c5QQ\u90ae\u7bb1\uff0c<br/>\u5b89\u88c5\u6210\u529f\u540e\u7528\u6b64QQ\u90ae\u7bb1\u5e10\u53f7\u767b\u5f55\u4f7f\u7528\u3002"),r=T(['<ul class="uploadfromapp_step">',"<li>1.\u626b\u63cf\u4e8c\u7ef4\u7801</li>",'<li class="ufa_actived">2.$stitle2$</li>','<li class="ufa_last">3.\u4ece\u624b\u673a\u4e0a\u4f20\u7167\u7247</li>',"</ul>",'<div class="uploadfromapp_qr ufa_scaned">','<img src="/cgi-bin/generate_twodimcode?sid=$sid$&action=appdownload&skey=$skey$" />','<div class="ufa_angle1"></div>','<div class="ufa_angle2"></div>','<div class="ufa_angle3"></div>','<div class="ufa_angle4"></div>',"</div>",'<p class="ufa_intro" style="width:266px;">$sys$&nbsp;','<a href="http://service.mail.qq.com/cgi-bin/help?subtype=1&&no=1001015&&id=23" target="_blank">\u5e2e\u52a9</a></p>']).replace({sys:i,sid:getTop().getSid(),skey:d,stitle2:p}),_.S("content").innerHTML=r;else"login"==n&&("android"==a?(l=1,QMEditor.getTopWin().goUserInfo.set({ANDROIDWEBAPPVER:1})):"ios"==a&&(s=1,QMEditor.getTopWin().goUserInfo.set({IOSWEBAPPVER:1})),_.close(),c(1))}},!0);var _=new QMDialog({sId:"download",sTitle:"\u4ece\u624b\u673a\u76f8\u518c\u4e0a\u4f20",sBodyHtml:T(['<div class="uploadfromapp_wrap" id="content">','<ul class="uploadfromapp_step">','<li class="ufa_actived">1.\u626b\u63cf\u4e8c\u7ef4\u7801</li>',"<li>2.$stitle2$</li>",'<li class="ufa_last">3.\u4ece\u624b\u673a\u4e0a\u4f20\u7167\u7247</li>',"</ul>",'<div class="uploadfromapp_qr">','<img src="/cgi-bin/generate_twodimcode?sid=$sid$&action=appdownload&skey=$skey$" />','<div class="ufa_angle1"></div>','<div class="ufa_angle2"></div>','<div class="ufa_angle3"></div>','<div class="ufa_angle4"></div>',"</div>",'<p class="ufa_intro">$sdesc$&nbsp;<a href="http://service.mail.qq.com/cgi-bin/help?subtype=1&&no=1001015&&id=23" target="_blank">\u5e2e\u52a9</a></p>',"</div>"]).replace({sid:getTop().getSid(),skey:d,stitle2:p,sdesc:i}),nWidth:384,bAnimation:!1,onload:function(){},onclose:function(){getTop().QMWebpush.getInst().close(64),o.QMAjax.send(getTop().T("/cgi-bin/webapnscheck?sid=$sid$&action=clearindex").replace({sid:getTop().getSid()}),{method:"POST",onload:function(){}})}})}break;case"upload":break;case"url":default:return e.nWidth=402,e.nArrowPos=h.getBindEditor().getEditorCustomVar("FullScreenToolbar.bUseFullEdtior")||"text"==h._msUiType?201:0,e.sName="url",T(['<div style="margin:15px;">',"<p>\u63d2\u5165\u7f51\u7edc\u7167\u7247</p>",'<input id="select" class="left qm_addinput" name="select" type="text" value="http://">','<a id="ok" class="button_gray_s left" style="width:52px;">\u786e\u5b9a</a>','<div class="clr"></div>',"</div>"])}},QMEditor.FUNCLIB.Photo.prototype.initMenu=function(n,t){var a=this;"url"==t.sName?(addEvent(n.S("select"),"keypress",function(t){13==t.keyCode&&n.S("ok").click(),27==t.keyCode&&a.hideMenu(!0)}),n.S("ok").onclick=function(){var t=n.S("select").value;t&&"http://"!=t&&"https://"!=t?(a.hideMenu(!0),setTimeout(function(){a.insertImage(t)},0)):n.S("select").focus()}):"attach"==t.sName&&(addEvent(n.S("content"),"click",function(t){var e=getEventTarget(t);"IMG"==e.tagName?(a._insertAttachImage(e),n.close()):e.getAttribute&&e.getAttribute("retry")&&a._showAttachImage(n,0)}),a._mbLoadingAttach=!1,a._mnAttachNextPage=0,addEvent(n.S("content"),"scroll",function(t){if(!a._mbLoadingAttach){var e=n.S("content"),o=e.offsetHeight,i=e.clientHeight;o-e.scrollTop-i<Math.min(50,(o-i)/2)&&a._showAttachImage(n)}}))},QMEditor.FUNCLIB.Photo.prototype.doMenuShow=function(n,t){var a=this,e=t.sName;e||"icon"!=a.getUiType()||"upload"!=a._moPhotoMethods[0].sId?"url"==e?n.S("select").select():"qzone"==e?loadJsFile("$js_path$/qmqzoneimg.js",!0,window.document,function(){n.isClose()||window.QMQzoneImg.selectInMenu({oContainer:n.S("qzone"),onclick:function(t,e,o,i){n.close(),a.insertImage(o.url)}})}):"attach"==e&&a._showAttachImage(n):a._initUpload(n.getItemDom("upload"))},QMEditor.FUNCLIB.Photo.prototype._showAttachImage=function(_aoMenu){var _oSelf=this;if(_oSelf._mbLoadingAttach||_oSelf._mnAttachNextPage<0)return _oSelf;_oSelf._mbLoadingAttach=!0;var _oSelf=this,_sUrl=T("/cgi-bin/attachfolder?topmails=0&s=search&folderid=attach&hflag=attach&t=attachfolder.json&subject=&sender=&receiver=&searchmode=attach&advancesearch=0&showattachtag=1&perpage=18&filetype=1&action=list&func=getimage&page=$page$&sid=$sid$&resp_charset=UTF8&&ef=js").replace({page:_oSelf._mnAttachNextPage,sid:getSid()}),_sATTACH_FAIL=T(['<div style="text-align:center; line-height:1.5; margin-top:90px;">\u52a0\u8f7d\u5931\u8d25\uff0c<a href="javascript:void(0);" retry="1">\u91cd\u8bd5</a>\u3002</div>']),_sATTACH_NONE=T(['<div style="text-align:center; line-height:1.5; margin-top:90px;">\u60a8\u7684\u9644\u4ef6\u5939\u6536\u85cf\u4e2d\u6682\u65e0\u56fe\u7247\u3002<br/>\u5c06\u91cd\u8981\u56fe\u7247\u6536\u85cf\u8d77\u6765\uff0c\u5373\u53ef\u5728\u5199\u4fe1\u4e2d\u5feb\u901f\u6dfb\u52a0\u3002</div>']),_sATTACH_CONTENT=TE(["$@$for($oList$)$@$",'<div class="left pointer qmEditorPicSelect"'," onmouseover=\"this.className='left pointer  qmEditorPicSelect bd';\""," onmouseout=\"this.className='left pointer  qmEditorPicSelect';\"",">",'<table cellspacing="0" cellpadding="0"><tbody><tr><td valign="absmiddle">','<img src="',getTop().QMDistributeDomain.getHost(),'$sIconUrl$" viewurl="$sUrl$" mailid="$sMailId$" attachid="$sAttachId$" attachname="$sAttachName$" fileextenal="$sFileExt$" filebyte="$sFileByte$" style="width:100px;"/>',"</td></tr></tbody></table>","</div>","$@$endfor$@$",""]);show(_aoMenu.S("content").lastChild,1),QMAjax.send(_sUrl,{method:"GET",onload:function(_abIsOk,_asParam,_aoXmlObj){if(_oSelf._mbLoadingAttach=!1,_abIsOk)try{var _oJson=eval(_asParam);if(!_oJson.errcode){var _oContentDom=_aoMenu.S("content");show(_oContentDom.lastChild,0),_oContentDom.style.cssText="height:242px;overflow-y:auto;overflow-x:hidden;",insertHTML(_aoMenu.S("contentclr"),"beforeBegin",(0==_oSelf._mnAttachNextPage&&0==_oJson.oList.length?_sATTACH_NONE:_sATTACH_CONTENT).replace(_oJson)),_oSelf._mnAttachNextPage=_oJson.oPageInfo.nNext}}catch(e){_abIsOk=!1}_abIsOk||0!=_oSelf._mnAttachNextPage||(_aoMenu.S("content").innerHTML=_sATTACH_FAIL)}})},QMEditor.FUNCLIB.Photo.prototype._insertAttachImage=function(t){var n=this,a="loadimg",e=n.getBindEditor(),o=e.getTemplate(),i=e.getLanguage();new QMDialog({sId:a,sTitle:"\u52a0\u8f7d\u56fe\u7247",sBodyHtml:o.DIALOG_UPLOADIMG.replace({imgPath:getPath("image"),langUploading:i.PO_DLG_INSERTING,langUploadFail:i.PO_DLG_INSERTINGFAIL}),nWidth:400,bAnimation:!1,onclose:function(){}}),getAttachList([{mailid:t.getAttribute("mailid"),attachid:t.getAttribute("attachid"),attachname:t.getAttribute("attachname"),fileextenal:t.getAttribute("fileextenal"),filebyte:t.getAttribute("filebyte")}],function(t,e){if(t&&e){var o=e.attach;if(o&&o[0])return QMDialog(a,"close"),void n.insertImage(o[0].viewfileurl)}var i=QMDialog(a);show(i.S("uploading"),0),show(i.S("uploadFail"),1)})},QMEditor.FUNCLIB.Photo.prototype.doItemClick=function(t,e,o){this.showMenu(!1,{sName:t,nArrowPos:this.getUiConfig().arrowPos})},QMEditor.FUNCLIB.Photo.prototype._uploadingDlg=function(t,e,o,i){var n=this,a=QMDialog("uploadimg");if("close"==t)QMDialog("uploadimg","close");else if("process"==t)a.S("uploadProcess").innerHTML=parseInt(e)+"%";else if("error"==t)show(a.S("uploading"),0),show(a.S("uploadFail"),1);else{var r=n.getBindEditor(),s=r.getTemplate(),l=r.getLanguage();n._bCloseDlg=!1,new QMDialog({sId:"uploadimg",sTitle:l.PO_DLG_TITLE,sBodyHtml:s.DIALOG_UPLOADIMG.replace({imgPath:getPath("image"),langUploading:s.PO_DLG_UPLOADING.replace({cnt:o,idx:i||0}),langUploadFail:l.PO_DLG_UPLOADFAIL}),nWidth:400,bAnimation:!1,onclose:function(){n._mnIndex=0,n._bCloseDlg=!0,n._moFileList=null,n._nUploadFileSize=0,r.loadLastRange()}})}},QMEditor.FUNCLIB.Photo.prototype.init_=function(){var t=this;t._mbInitUpload&&(t._mbUseUploadBtn=!0,t.getContainer().style.position="relative",t._initUpload(t.getContainer().firstChild))},QMEditor.FUNCLIB.Photo.prototype._uploadImg=function(){var i=this,t=i._moBindEditor,e=QMEditor._ActiveX._bind(t),o=i._moMenuElements._oPhotoPanel.document,n=getTop();i._readyToUpload(),S("composeImgForm",o).submit(),S("composeUploadFile",o).value="",e._modelDialog(function a(t,e){if(i._isReadyToUpload()){try{i._moImgWin.location="about:blank"}catch(o){}i._doUploadFinish(!1)}}),n.LogKvEx({businame:"common_stat",item:"webmail|menu|photo|click",sid:n.getSid()})},QMEditor.FUNCLIB.Photo.prototype._initUpload=function(t){var o=this;if(o._moBindMenu=S("composeImgUploadDiv",getMainWin()),!o._moMenuElements){o._moMenuElements={};var e=o._moBindEditor,i=(e._moLanguage,e._moTemplate),n=e._moPhotoConfig||{},a=o._moBindMenu.firstChild,r=a.ownerDocument.parentWindow||a.ownerDocument.defaultView,s={iframeId:now(),actionSrc:e._msPhotoActionSrc,widthlimit:n.widthlimit||0,heightlimit:n.heightlimit||0,sizelimit:n.sizelimit||0,sid:getSid(),style:i.STYLE};createBlankIframe(r,{obj:a,scrolling:"no",transparent:!0,style:T("width:$width$;height:$height$;opacity:0;filter:alpha(opacity=0);").replace({width:a.style.width,height:a.style.height}),hideFocus:!0,header:i._MENU_PHOTO_HEADER.replace(s),body:i._MENU_PHOTO_BODY.replace(s),onload:function(t){var e=(o._moMenuElements._oPhotoPanel=this.contentWindow).document;e.body.innerHTML=i._IMG_UPLOAD.replace(s),e.charset="gb2312";e.body;o._moMenuElements.document=e,o._setElementsEvent()}})}},QMEditor.FUNCLIB.Photo.prototype._setElementsEvent=function(){var o,n=this,t=n._moMenuElements._oPhotoPanel,e=t.document,i=!!window.MSInputMethodContext&&!!document.documentMode;S("composeUploadFile",e).onchange=function(t){if(-1=="gif|jpg|jpeg|bmp|png".indexOf((this.value||"").toLowerCase().split(".").pop()))return showError("\u53ea\u5141\u8bb8\u4e0a\u4f20gif,jpg,jpeg,bmp,png\u7684\u56fe\u7247"),void(this.value="");var e=(new Date).getTime();i&&o&&e-o<500||(o=e,n._uploadImg(),setTimeout(function(){o=!1},500))},t.QMEditorPhotoLoaded=function(t){try{var e=t.contentWindow.location.href;if(0==e.indexOf("javascript:")||0==e.indexOf("about:blank"))return;var o=[];E(GelTags("script",t.contentWindow.document),function(t){o.push(t.innerHTML)}),QMEditor._ActiveX._bind(n._moBindEditor)._processResponse(o.join(""),function(t,e){n._doUploadFinish(t,e)})}catch(i){return n._doUploadFinish(!1,{})}},QMEditor.getTopWin().getMainWin().On_upload=QMEditor.getTopWin().getMainWin().On_upload_Fail=function(){}},QMEditor.setupFunc()}(QMEditorAdapter),function(t,e){var r="gicmopcfdmkpokppfpnkmgebcaohbffc",o=getTop(),i=!1,s=!1;QMEditor.FUNCLIB.ScreenSnap=QMEditor.FUNCLIB._inheritFrom(function(t){if(t.editor._msPhotoActionSrc){this._msId="ScreenSnap",this._msType="btn",this._moBindEditor=t.editor,this._updateUIInfo();var a,r=this,s=this._moBindEditor,l=QMEditor._ActiveX._bind(s),d="",p=gbIsIE||QMAXInfo.mbAblePlugin;gbIsWebKit&&42<=gsChromeVer.split(".")[0]&&gsChromeVer.split(".")[0]<=56&&this._detectNew(),this._mfOnKeyDown=function(t){t.ctrlKey&&t.altKey&&65==t.keyCode?(r._doDefaultClick(),preventDefault(t)):t.ctrlKey&&86==t.keyCode&&!getTop().gbIsMac&&(l._isClipBoardImage()?c(t):l._getScreenSnapObj()||(a=!getTop().gbIsOpera&&setTimeout(function(){a&&(a=null,s._mfOnShowInstallactive("paste"))},200),p||(d=s.getContent())))},this._mfOnContextMenu=function(t){l._saveImg()&&clipboardData.setData("Text","")},this._mfOnPaste=function(t){if(a&&(clearTimeout(a),a=null),l._isClipBoardImage())c(t);else if(l._hasScreenSnapImg())clipboardData.getData("Text")||c(t);else if(t.clipboardData&&window.FileReader&&!gbIsFF){var e,o,i=t.clipboardData;if(i.items&&1==i.items.length&&(o=i.items[0])&&/^image/i.test(o.type)&&(e=o.getAsFile())){var n=new FileReader;n.onload=function(t){var l=r._moBindEditor,e=getTop().QMAjax,o="/cgi-bin/upload?method=snapscreen&fun=add&mode=download&from=snapscreen&widthlimit=0&heightlimit=0&sizelimit=0&sid="+getSid();e.send(o,{content:'<img src="'+t.target.result.replace(/^data:image\/png/,"data:image/jpeg")+'">',onload:function(t,e,o){var i=o.responseText,n=i.indexOf("/cgi-bin/viewfile");if(-1<n){var a=i.substr(n),r=a.indexOf('"');if(-1<r){var s=a.substr(0,r);l._execCmd("InsertImage",s,function(){var t=this._moEditDoc.selection;if(t&&"Control"==t.type){l._getSelectionElement();var e=this._moEditDoc.body.createTextRange();e.moveToElementText(this._moEditDoc.selection.createRange().item(0)),e.collapse(!1),e.select()}-1<l.getEditorId().indexOf("groupsms")&&setTimeout(function(){l._mfOnFocus.call(l," ")},1e3)})}}}},!1)},n.readAsDataURL(e)}}else gbIsFF&&!getTop().gbIsMac?setTimeout(function(){for(var t=s.getContentTags("img"),e=0,o=t.length;e<o;e++)if(-1!=t[e].src.indexOf("/moz-screenshot-"))return removeSelf(t[e]),void s._mfOnShowInstallactive("paste")},200):p||setTimeout(function(){s.getContent()==d&&s._mfOnShowInstallactive("failpaste"),d=""},200)}}function c(t){s.saveRange(),r._readyToUpload(),l._saveImg(),l._startUploadCustomImg(null,!1,function(t,e){r._doUploadFinish(t,e)}),preventDefault(t),stopPropagation(t)}},QMEditor.FUNCLIB._MENUIMAGE),QMEditor.FUNCLIB.ScreenSnap.prototype._detectNew=function(){if(chrome&&chrome.runtime){var e=this;if(s)return!0;chrome.runtime.sendMessage(r,{command:"CheckCommand"},function(t){t&&t.app&&200==t.app.status&&t.host&&200==t.host.status&&(s=!0,e._upateUI())})}},QMEditor.FUNCLIB.ScreenSnap.prototype.insertImageForChrome=function(t,e,o){var i=this._moBindEditor;i._execCmd("InsertImage",t,function(){var t=this._moEditDoc.selection;if(t&&"Control"==t.type){i._getSelectionElement();var e=this._moEditDoc.body.createTextRange();e.moveToElementText(this._moEditDoc.selection.createRange().item(0)),e.collapse(!1),e.select()}-1<i.getEditorId().indexOf("groupsms")&&setTimeout(function(){i._mfOnFocus.call(i," ")},1e3)})},QMEditor.FUNCLIB.ScreenSnap.prototype._doDefaultClick=function(t){var e=this._moBindEditor,l=this,o=getTop();if(e.hideMenu(),!detectActiveX(0,1))if(gbIsWebKit&&42<=gsChromeVer.split(".")[0])if(s)chrome.runtime.sendMessage(r,{command:"CaptureCommand"},function(t){if(t){var e=getTop().QMAjax,o="/cgi-bin/upload?method=snapscreen&fun=add&mode=download&from=snapscreen&widthlimit=0&heightlimit=0&sizelimit=0&sid="+getSid();e.send(o,{content:'<img src="'+t.text+'">',onload:function(t,e,o){var i=o.responseText,n=i.indexOf("/cgi-bin/viewfile");if(-1<n){var a=i.substr(n),r=a.indexOf('"');if(-1<r){var s=a.substr(0,r);l.insertImageForChrome(s)}}}},!1)}});else if(!0!==getTop()._bIsCanConnectGoogle&&gsChromeVer.split(".")[0]<=56)window.location.host.match(/qq\.com$/)?this._showInstallactiveNew():o.confirmBox({title:"\u6e29\u99a8\u63d0\u793a",msg:['<div class="dialog_f_t" style="font-weight: normal;">\u4f60\u6b63\u5728\u4f7f\u7528\u81ea\u5b9a\u4e49\u57df\u540d\u767b\u5f55\uff0c\u6682\u4e0d\u652f\u6301\u622a\u5c4f\u529f\u80fd\u3002<br/>\u62b1\u6b49\u7ed9\u4f60\u5e26\u6765\u4e86\u56f0\u6270\uff0c\u6211\u4eec\u5c06\u5c3d\u5feb\u4f18\u5316\u3002',"</div>"].join(""),confirmBtnTxt:"\u786e\u5b9a",mode:"alert",onreturn:function(t){}});else{var i=-1!=navigator.userAgent.toLowerCase().indexOf("edge"),n=i?"Microsoft Edge\u6d4f\u89c8\u5668":"Chrome\u6d4f\u89c8\u566842\u6216\u4ee5\u4e0a\u7248\u672c";o.confirmBox({title:"\u6e29\u99a8\u63d0\u793a",msg:['<div class="dialog_f_t" style="font-weight: normal;">\u4f60\u6b63\u5728\u4f7f\u7528\u7684\u662f',n,"\uff0c\u6682\u4e0d\u652f\u6301\u622a\u5c4f\u529f\u80fd\u3002<br/>\u62b1\u6b49\u7ed9\u4f60\u5e26\u6765\u4e86\u56f0\u6270\uff0c\u6211\u4eec\u5c06\u5c3d\u5feb\u4f18\u5316\u3002","</div>"].join(""),confirmBtnTxt:"\u786e\u5b9a",mode:"alert",onreturn:function(t){}})}else{if("function"!=typeof this._moBindEditor._mfOnShowInstallactive)return;e._mfOnShowInstallactive()}e.saveRange();l=this;var a=QMEditor._ActiveX._bind(e);a._screenSnap(function(t){t?(l._readyToUpload(),a._uploadCustomImg(!0,function(t,e){l._doUploadFinish(t,e)})):e.loadRange()}),o.LogKvEx({businame:"common_stat",item:"webmail|menu|screensnap|click",sid:o.getSid()})},QMEditor.FUNCLIB.ScreenSnap.prototype._updateUIInfo=function(){var t=detectActiveX(0),e=this._moBindEditor._moLanguage;this._moUiConfig.icon={className:"qmicon_snap",bgleft:0,topNum:t?-119:-287,width:24,margin:"0 4px 0 0",imgstyle:"width:16px;height:16px;overflow:hidden;margin:2px 0 0 2px;",src:"newicon/compose_new.png",title:t?e.FUN_SCREENSNAP:e.FUN_SCREENSNAP_SETUP_TIP},this._moUiConfig.text={margin:"0 10px 0 0",bgleft:0,bgup:t?-119:-287,width:0,marginNB:"0 1px 0 0",lbMargin:"0 0 0 2px",src:"newicon/compose_new.png",title:t?e.FUN_SCREENSNAP:e.FUN_SCREENSNAP_SETUP_TIP,label:e.FUN_SCREENSNAP_LABEL}},QMEditor.FUNCLIB.ScreenSnap.prototype._screenSnapByNew=function(){if(chrome&&chrome.runtime&&!getTop().gbIsMac){var e=this._moBindEditor;if(s){if(i)return;i=!0,chrome.runtime.sendMessage(r,{command:"CaptureCommand"},function(t){i=!1,t&&t.text&&e.insertImage(t.text)})}else this._showInstallactiveNew()}},QMEditor.FUNCLIB.ScreenSnap.prototype._upateUI=function(){var t,e;(t=this._moContainer)&&(e=o.finds("input",t))&&0<e.length&&(e[0].style.cssText="",o.addClass(e[0],"qmEditorToolBarChromeSnapAvailable"))},QMEditor.FUNCLIB.ScreenSnap.prototype._showInstallactiveNew=function(){o.confirmBox({title:"\u817e\u8baf\u4f01\u4e1a\u90ae\u7bb1\u622a\u5c4f\u63d2\u4ef6",msg:['<div class="dialog_f_t" style="font-weight: normal;margin-top:3px;">\u4f7f\u7528\u622a\u5c4f\u529f\u80fd\uff0c\u9700\u8981\u4e0b\u8f7d\u5b89\u88c5\u817e\u8baf\u4f01\u4e1a\u90ae\u7bb1\u622a\u5c4f\u63d2\u4ef6\u3002</div>'].join(""),confirmBtnTxt:"\u4e0b\u8f7d\u5b89\u88c5",onreturn:function(t){if(t){o.getActionWin().location="/zh_CN//crx/QQMailScreenCapturePlugin_1_0_0_0.exe"}}})},QMEditor.setupFunc()}(QMEditorAdapter),QMEditorAdapter,extend(QMEditor.CONST.LANGUAGE.zh_CN,{FUN_WORD:"\u5bfc\u5165\u6587\u6863",FUN_WORD_LABEL:"\u6587\u6863",FUN_WORD_IMPORT_TITLE:"\u5bfc\u5165\u6587\u6863",FUN_WORD_IMPORT_BODY:"\u6b63\u5728\u5bfc\u5165\u2026",FUN_WORD_ERROR_MULTI:"\u4e0d\u652f\u6301\u6279\u91cf\u5bfc\u5165",FUN_WORD_ERROR_FILEINFO:"\u6587\u4ef6\u8def\u5f84\u8bc6\u522b\u9519\u8bef\u6216\u8d85\u51fa\u5927\u5c0f\u9650\u5236",FUN_WORD_ERROR_FILESIZE_OVERFLOW:"\u6587\u4ef6\u8fc7\u5927\uff0c\u65e0\u6cd5\u5bfc\u5165",FUN_WORD_ERROR_FILESIZE_ZERO:"\u4e0d\u80fd\u5bfc\u5165\u7a7a\u6587\u6863",FUN_WORD_ERROR_FILESIZE_OVERFLOW_TXT:"\u8bfb\u53d6\u6587\u6863\u5185\u5bb9\u5931\u8d25\uff0c\u6682\u65e0\u6cd5\u5bfc\u5165",FUN_WORD_ERROR_GETCONTENT:"\u8bfb\u53d6\u6587\u6863\u5185\u5bb9\u5931\u8d25\uff0c\u6682\u65e0\u6cd5\u5bfc\u5165",FUN_WORD_ERROR_SELECTFILE:"\u4e0a\u4f20\u5931\u8d25 \u8bf7\u91cd\u8bd5",FUN_WORD_ERROR_NOTSUPPERTYPE:"\u6682\u4e0d\u652f\u6301\u5bfc\u5165\u8fd9\u79cd\u6587\u6863\u683c\u5f0f",FUN_WORD_ERROR_UPLOAD:"\u4e0a\u4f20\u6587\u6863\u5931\u8d25\uff1a",FUN_WORD_ERROR_EDITORTYPE:"\u6587\u672c\u7f16\u8f91\u5668\u4e0d\u652f\u6301\u5bfc\u5165",FUN_WORD_ERROR_CGI_9006:"\u6587\u6863\u88ab\u52a0\u5bc6\uff0c\u5bfc\u5165\u5931\u8d25",FUN_WORD_ERROR_CGI_TIMEOUT:"\u52a0\u8f7d\u8d44\u6e90\u8d85\u65f6",FUN_WORD_ERROR_CGI_NOCONTENT:"\u8bfb\u53d6\u6587\u6863\u5185\u5bb9\u5931\u8d25\uff0c\u6216\u6587\u6863\u5185\u5bb9\u4e3a\u7a7a",FUN_WORD_ERROR_NOCONTENT:"\u8bfb\u53d6\u6587\u6863\u5185\u5bb9\u5931\u8d25\uff0c\u6216\u6587\u6863\u5185\u5bb9\u4e3a\u7a7a",FUN_WORD_ERROR_PARTFILEERR:"\u8bfb\u53d6\u6587\u6863\u5185\u5bb9\u5931\u8d25",FUN_WORD_ERROR_CGI_UNDEFINED:"\u672a\u77e5\u9519\u8bef\uff0c\u83b7\u53d6\u6587\u6863\u4fe1\u606f\u5931\u8d25",FUN_WORD_ADDED_FILECELL:"\u5df2\u5c06\u6587\u6863\u6dfb\u52a0\u4e3a\u9644\u4ef6",FUN_WORD_ERROR_FORMAT:"\u6682\u4e0d\u652f\u6301\u5bfc\u5165\u8fd9\u79cd\u6587\u6863\u683c\u5f0f"}),extend(QMEditor.CONST._TEMPLATE,{DIALOG_WORD_UPLOAD:T(['<div style="text-align:center;padding:58px; padding-bottom:78px;">','<img src="$images_path$ico_loading2.gif" style="position:relative; top: 12px;"> $say_uploading$ <span id="percent"></span>',"</div>"])}),QMEditor.FUNCLIB.Word=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="Word",this._msType="menu",this._moBindEditor=t.editor,this._msTmplName="DIALOG_WORD_UPLOAD";var e=this._moBindEditor._moLanguage;this._moUiConfig.icon={className:"qmicon_word",margin:"14px 0 0 0",src:"newicon/compose_new.png",title:e.FUN_WORD,topNum:-623},this._moUiConfig.text={margin:"0 12px 0 0",bgleft:0,bgup:-623,src:"newicon/compose_new.png",title:e.FUN_WORD,label:e.FUN_WORD_LABEL},this._setfDoDefaultClick(this._dofaultClick)},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.Word.prototype._initMenuElements=function(){var t=getTop(),e=this._moContainer;e.style.position="relative",e.id="editor_word_compose_tip",this.qmfileupload=t.QMFileUpload.create("popupflash",this._getUploadCfg(e))},QMEditor.FUNCLIB.Word.prototype._dofaultClick=function(){},QMEditor.FUNCLIB.Word.prototype._checkFileType=getTop().isSupportImportWord,QMEditor.FUNCLIB.Word.prototype._nMaxFileSize=52428800,QMEditor.FUNCLIB.Word.prototype._nMaxTxtFileSize=1048576,QMEditor.FUNCLIB.Word.prototype._getUploadingDialog=function(t){var e=this,o=getTop(),i=e._moBindEditor,n=i._moLanguage;return e._moUploadingDialog&&!t||(e._moUploadingDialog=new o.QMDialog({sTitle:n.FUN_WORD_IMPORT_TITLE,sId:"editor_func_word_upload",sBodyHtml:i._moTemplate.DIALOG_WORD_UPLOAD.replace({images_path:o.getPath("image"),say_uploading:n.FUN_WORD_IMPORT_BODY}),onclose:function(){e._moCurUploadFile&&e._moCurUploadFile.cancel(),o.qmAnimation.stop(e._getUploadingDialog().getPanelDom())}})),e._moUploadingDialog},QMEditor.FUNCLIB.Word.prototype._getUploadCfg=function(t){var a=this,r=getTop(),e=a._moBindEditor;return{onselect:function(t){if(a._checkEditorType()){if(1==t.length){var e=t[0],o=e.get("sName")||"";if(e.get("nSize")>a._nMaxFileSize)return a._showError("FUN_WORD_ERROR_FILESIZE_OVERFLOW");if(0===e.get("nSize"))return a._showError("FUN_WORD_ERROR_FILESIZE_ZERO");if(e.get("nSize")<0)return a._showError("FUN_WORD_ERROR_FILEINFO");if("txt"==r.getFileTypeByExt(r.getFileExt(o))&&e.get("nSize")>a._nMaxTxtFileSize)return a._showError("FUN_WORD_ERROR_FILESIZE_OVERFLOW_TXT");if(a._checkFileType(o)){var i=o.substr(o.length-3,o.length-1);if("doc"!=i&&"xls"!=i&&"ppt"!=i&&"ocx"!=i&&"ptx"!=i&&"lsx"!=i)return void a._showError("FUN_WORD_ERROR_FORMAT");this.upload(e)?(a._getUploadingDialog(!0).S("percent").style.display=/Flash|Ftn|Html5|Activex/.test(e.uploader().name)?"inline":"none",a._moCurUploadFile=e,a._mnUploadPercent=0):a._showError("FUN_WORD_ERROR_SELECTFILE")}else{var n=o.match(/\.([\w\d]+)$/);n=n?n[1].toLowerCase():"blank",a._showError("FUN_WORD_ERROR_NOTSUPPERTYPE")}}else a._showError("FUN_WORD_ERROR_MULTI");r.LogKvEx({businame:"common_stat",item:"webmail|menu|doc|click",sid:r.getSid()})}},onprocess:function(t){if(t.get("bChipFile")){var e=t.get("sUploadStep");"signing"==e?a._renderPercent(.1*t.get("nSignPercent")):"posting"==e&&a._renderPercent(10+.6*t.get("nPercent"))}else a._renderPercent(.7*t.get("nPercent"))},oncomplete:function(t){a._getFileContent(t)},onerror:function(t){a._showError(e._moLanguage.FUN_WORD_ERROR_UPLOAD+t.get("sError"))},oContainer:t}},QMEditor.FUNCLIB.Word.prototype._getFileContent=function(i){var n=this,a=getTop(),t=n._moBindEditor,e=t._moLanguage;function r(t){n._showError([e[t]||t].join(""))}var s=n._getUploadingDialog();if(!s.isClose()){a.qmAnimation.play(s.getPanelDom(),{win:t.getEditorAreaWin(),from:n._mnUploadPercent,to:97,speed:12e3,basespeed:1.3,tween:"Sine",easing:"easeOut",onaction:function(t){n._renderPercent(t)},oncomplete:function(){n._renderPercent(97)}});var l=a.getPreviewView(i)+"&filter=false";-1!=l.indexOf("&filetype=pdf&")&&(l+="&firstpage=1&lastpage=999"),a.QMAjax.send(l,{timeout:2e4,onload:function(t,e){if(!s.isClose())if(t&&e&&0!==(""+e).indexOf("\x3c!--cgi exception--\x3e")){if(!a.trim(e))return void r("FUN_WORD_ERROR_CGI_NOCONTENT");if(-1==e.indexOf("qmbox")){if(-1!=l.indexOf("/cgi-bin/readtemplate"))return void n._addContent(i,e,-1==l.indexOf("&filetype=html"));var o=a.evalValue(e);if(o.ret)return void("-9006"==o.ret?r("FUN_WORD_ERROR_CGI_9006"):r("FUN_WORD_ERROR_CGI_UNDEFINED"))}if(!n._checkEditorType())return;a.getOfficeRealContent(e,{onload:function(t,e){if(t)n._addContent(i,e);else switch(e){case"NoContent":r("FUN_WORD_ERROR_NOCONTENT");break;case"PartFileError":r("FUN_WORD_ERROR_PARTFILEERR");break;case"Timeout":r("FUN_WORD_ERROR_CGI_TIMEOUT");break;default:r("FUN_WORD_ERROR_CGI_UNDEFINED")}},charset:"UTF8"})}else r("FUN_WORD_ERROR_GETCONTENT")}})}},QMEditor.FUNCLIB.Word.prototype._showError=function(t){var e=this._moBindEditor._moLanguage;this._moUploadingDialog&&this._moUploadingDialog.close(),getTop().showError(e[t]||t)},QMEditor.FUNCLIB.Word.prototype._renderPercent=function(t){if(this._getUploadingDialog()&&!this._getUploadingDialog().isClose()){var e=this._getUploadingDialog().S("percent"),o=Number(t);return this._mnUploadPercent=o,e.innerHTML=Math.floor(o)+"%"}},QMEditor.FUNCLIB.Word.prototype._addContent=function(t,e,o){var i=this,n=getTop(),a=i._moBindEditor;if(i._checkEditorType())if(!0===n.appendEditorFileContent(e,a,o)){var r=i._getUploadingDialog();n.qmAnimation.stop(r.getPanelDom()),i._renderPercent(100);var s=r.option("onclose");r.option("onclose",function(){return n.showInfo("\u5bfc\u5165\u6210\u529f\u3002"),n.callBack.call(this,s,arguments)}),r.close()}else i._showError("FUN_WORD_ERROR_FILESIZE_OVERFLOW_TXT")},QMEditor.FUNCLIB.Word.prototype._checkEditorType=function(){return"html"==this._moBindEditor.getContentType()||(this._showError("FUN_WORD_ERROR_EDITORTYPE"),!1)},QMEditor.setupFunc(),QMEditorAdapter,QMEditor.FUNCLIB.More=QMEditor.FUNCLIB._inheritFrom(function(t){if(t){this._msId="More",this._msType="menu",this._moBindEditor=t.editor,this._moParamSet=t,getTop();var e=this._moBindEditor._moLanguage;this._moMoreMethods=[],this._moMoreMethods.push({sId:"map",sItemValue:'<span class="editor_btn_text qmEditorMap ">\u5730\u56fe</span>'}),this._moUiConfig.icon={className:"qmEditorMore",width:24,margin:"0 0 0 0",bgleft:0,topNum:-668,src:"newicon/compose_new.png",title:e.FUN_MORE_LABEL},this._moUiConfig.text={margin:"0 10px 0 0",bgleft:0,bgup:-668,width:0,src:"newicon/compose_new.png",title:e.FUN_MORE_LABEL,label:e.FUN_MORE_LABEL},this._setfDoDefaultClick(this._dofaultClick)}},QMEditor.FUNCLIB.MENU),QMEditor.FUNCLIB.More.prototype.getMenuItems=function(t){return t&&(t.nWidth=84),this._moMoreMethods},QMEditor.FUNCLIB.More.prototype._initMenuElements=function(){this._oMap=this.getFuncObj("Map"),_oFuncObj._setup({container:this._moContainer,uiType:"text"})},QMEditor.FUNCLIB.More.prototype.getFuncObj=function(t){return new QMEditor.FUNCLIB[t]({oParamSet:this._moParamSet,editor:this._moParamSet.editor,uiType:"text",container:this._moContainer})},QMEditor.FUNCLIB.More.prototype.doItemClick=function(t){var e;switch(t){case"music":e=this._oMusic;break;case"map":(e=this._moParamSet.editor.getMapFunc())._doDefaultClick.call(e),e=undefined;break;case"vote":getTop().getMainWin().createvote()}e&&(this._moBindEditor.changeEditMode&&this._moBindEditor.changeEditMode("html"),e._doShowMenuClick.call(e,arguments[3]))},QMEditor.setupFunc(),function(t,e){QMEditor.FUNCLIB.Map=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="Map",this._moBindEditor=t.editor,t.container&&(this._moContainer=t.container);var e=this._moBindEditor._moLanguage;this._moUiConfig.icon={className:"qmEditorMap",width:24,margin:"0 0 0 0",bgleft:0,topNum:-693,src:"newicon/compose_new.png",title:e.FUN_MAP_LABEL},this._moUiConfig.text={margin:"0 10px 0 0",bgleft:0,bgup:-693,width:0,src:"newicon/compose_new.png",title:e.FUN_MAP_LABEL,label:e.FUN_MAP_LABEL},this._msType="btn",this._setfDoDefaultClick(this._dofaultClick)},QMEditor.FUNCLIB._BASE),QMEditor.FUNCLIB.Map.prototype._initMapJs=function(){var t=getTop();t.initMapCallback=function(){};var e=getTop().isHttp()?"map.qq.com":"apis.map.qq.com";t.qq&&t.qq.maps&&t.qq.maps.Map||t.loadJsFile("//"+e+"/api/js?v=2.exp&libraries=place&key=UH3BZ-CYLKV-RHTPL-UAGSL-DRA4V-VGFSJ&callback=initMapCallback",!1,t.document,function(){},{},!0)},QMEditor.FUNCLIB.Map.prototype._dofaultClick=function(t){var e=this;new QMDialog({sId:"id_compose_editor_map_center",sTitle:"\u63d2\u5165\u5730\u56fe",nWidth:467,sBodyHtml:'<div id="div_content_body" style="height:400px;"></div>',bAnimation:!1,onload:function(){e.initMenu(this),e._initMapJs()},onshow:function(){},onclose:function(){},onbeforeclose:function(){}})},QMEditor.FUNCLIB.Map.prototype.getMenuUI=function(){return T('<div class="qmEditorMusicCntr qmEditorToolLoading"><img align="absmiddle" src="$images_path$ico_loading2.gif">&nbsp;&nbsp;\u52a0\u8f7d\u4e2d</div>').replace({images_path:getPath("image",!0)})},QMEditor.FUNCLIB.Map.prototype.initMenu=function(t,e){var o=this,i=o._moBindEditor,n=t.S("div_content_body");if(window.QMMap)o._initMenuForMo(t);else{var a={};a["$js_path$qqmaileditor/"+getFullResSuffix("plus/map.js")]=!0,i.loadFile(a,function(){window.QMMap?o._initMenuForMo(t):n.innerHTML='<div class="qmEditorMusicCntr">\u52a0\u8f7d\u5931\u8d25</div>'})}},QMEditor.FUNCLIB.Map.prototype._initMenuForMo=function(t){var i=this,n=i._moBindEditor,e=t.S("div_content_body");i._moMapPanel=new g(n),i._moMapPanel.setup({container:e,defaultLocation:i._mvDefaultLocation||"",height:"175px",width:"265px",num:i._mnNumPerPage,menuObj:t,style:n.getTemplate().STYLE,onselectMap:function(t,e,o){n.getBgMapInfo()&&!confirm(n.getLanguage().MC_REPLACE_TIP)||(o&&-1==o.indexOf("://")&&(o="http://"+o),n.setBgMapInfo(t,e,o),i.hideMenu(!0))},onclose:function(){i.hideMenu(!0)},onload:function(){i._moMapPanel.focus()}})};var g=function(t){this._mbIsSetuped=!1,this._moEditor=t,this._moResult={},this._moUrl={},this._moNCurPage={},this._moCurrentPos={},this._msCity="\u5317\u4eac"},r={province:"\u7701",city:"\u5e02",area:"\u533a",county:"\u53bf"},h=getTop().isHttp()?"map.qq.com":"apis.map.qq.com",f="R24BZ-6HBKP-REND3-LUK27-JT5O5-U3B5O";function s(){var t=getTop();var l=["http://p0.map.gtimg.com/hwaptiles","http://p1.map.gtimg.com/hwaptiles","http://p2.map.gtimg.com/hwaptiles","http://p3.map.gtimg.com/hwaptiles"];return new t.qq.maps.ImageMapType({name:"\u9ad8\u6e05\u5e95\u56fe",alt:"\u9ad8\u6e05\u5e95\u56fe",tileSize:new t.qq.maps.Size(128,128),minZoom:1,maxZoom:18,getTileUrl:function(t,e){var o=t.x,i=t.y;i=2*Math.pow(2,e)-i-1;var n=function r(t,e,o){var i=e<<o;if(t.y<0||t.y>=i)return null;if(0<=t.x&&t.x<i)return t;var n={x:t.x,y:e.y};return n.x=(t.x%i+i)%i,n}(t,2,e);if(!n)return null;var a=function s(t,e){var o=t%e;return o*e<0?o+e:o}(o+i,l.length);return o=n.x,l[a]+"/"+e+"/"+(o>>4)+"/"+(i>>4)+"/"+o+"_"+i+".png"}})}g.prototype.ZoomControl=function(t){t.context;var e,o=getTop(),i=t.map,n=t.win,a=g._TEMPLATE._ZOOM_CONTROL_.replace();(e=n.document.createElement("div")).innerHTML=a,i.controls[n.qq.maps.ControlPosition.TOP_LEFT].push(e),n.qq.maps.event.addDomListener(e,"click",function(t){var e=o.getEventTarget(t);"a_enlarge"==o.attr(e,"id")?i.setZoom(i.getZoom()+1):"a_narrow"==o.attr(e,"id")&&i.setZoom(i.getZoom()-1),o.preventDefault(t)})},g.prototype.getIconUrl=function(t){var e,o=["../images/newicon/icon_location",t,".png"].join(""),i=getTop(),n=getTop().location.hostname;/dev/i.test(n)?e="http://"+(t?"mail.qq.com":n)+"/zh_CN/htmledition/js/"+o+"?&r="+Math.random():("_2x"==t?e=i.getRes("$images_path$newicon/icon_location_2x.png"):t||(e=i.getRes("$images_path$newicon/icon_location.png")),0==e.indexOf("/zh_CN/")&&(e="http://"+n+e));return e},g.prototype.Marker=function(t){var e=t.context,o=t.location,i=t.map,n=t.win,a=new n.qq.maps.MarkerImage(e.getIconUrl(),new n.qq.maps.Size(62,68),new n.qq.maps.Point(0,0),new n.qq.maps.Point(31,33)),r=new n.qq.maps.Marker({position:o,draggable:!0,map:i});return r.setIcon(a),n.qq.maps.event.addListener(r,"dragend",function(t){e._updateCurLocation.apply(e,[t.latLng]),e._searchMapNearBy.apply(e,[t.latLng.getLng(),t.latLng.getLat()])}),r},g.prototype._updateCurLocation=function(t){var o=this,i=o._moMenuObj,e=getTop(),n=e;n.geocoderCallback=function(t){var e={address:t.result.address,location:o._moMarker.getPosition()};o._saveLocation(e),e.title="[\u5730\u70b9]",i.setHtml(i.S("currentPlace"),g._TEMPLATE._CURRENT_ITEM.replace(e))},e.loadJsFile("//apis.map.qq.com/ws/geocoder/v1/?callback=geocoderCallback&output=jsonp&location="+t.getLat()+","+t.getLng()+"&key="+f+"&get_poi=1",!0,n.document,"",{charset:"utf-8"},!0)},g.prototype.setup=function(t){return!(this.isSetuped()||!t||!t.container)&&(this._initData(t)._initUI(t),!0)},g.prototype.isSetuped=function(){return this._mbIsSetuped},g.prototype.focus=function(){if(this.isSetuped()){var t=this._moMenuObj.S("searchText");t&&gbIsIE?t.select():t.focus()}},g.prototype._initData=function(t){var e=this;return e._moContainer=t.container,e._mvDefaultLocation=t.defaultLocation,e._mnNumPerPage=t.num,e._moMenuObj=t.menuObj,"function"==typeof t.onload&&(e._mfOnload=t.onload),e._mfOnClose=t.onclose,e._mfOnSelectMap=t.onselectMap,e},g.prototype._initUI=function(t){var e=this,o=e._moMenuObj,i=g._TEMPLATE,n={style:t.style,images_path:getPath("image",!0),result:i._INFO.replace({info:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57\u8fdb\u884c\u641c\u7d22"}),sid:getSid()};o.setHtml(e._moContainer,i._DIVHTML.replace(n)),e._setEvent(),e._setData(),e._mbIsSetuped=!0,e._loadTXMapJs(),e._mfOnload&&e._mfOnload.call(e),setTimeout(function(){e.focus()},0)},g.prototype._beforeLoadPrev=function(){var t=getTop(),e=this,o=e._moMenuObj,i=e._moDivLoading,n=e._moDivWelcome,a=e._moInputPlaceSearch,r=o.S("span_searchDesc");e._mvDefaultLocation&&(t.show(r,!1),t.show(n,!1),t.show(i,!0),"string"==(typeof e._mvDefaultLocation).toLowerCase()?a.value=e._mvDefaultLocation:"object"==(typeof e._mvDefaultLocation).toLowerCase()&&(a.value=e._mvDefaultLocation.searchKeyword))},g.prototype._loadPrev=function(){this._getCityNameByLocalIp();getTop();var t=this,e=t._moMenuObj,o=t._moInputPlaceSearch;if(t._mvDefaultLocation)if("string"==(typeof t._mvDefaultLocation).toLowerCase())t._search(o.value);else if("object"==(typeof t._mvDefaultLocation).toLowerCase()){var i=t._mvDefaultLocation,n=t._moDivLoading,a=t.getLatLng(i.pos),r=e.S("placedetail");show(e.S("result"),!0),show(t._moSpanResultTitleText,!1),!i.title&&(i.title="[\u5730\u70b9]"),r.innerText=i.posDesc,t.createMap(i.center),t._moMap.setZoom(i.zoom),show(n,!1),t.setCenter(i.center),t._moMarker.setPosition(a);var s=document.createElement("div");s.innerHTML=i.title,i.title=s.innerText,s.innerHTML=i.posDesc,i.posDesc=s.innerText,t._moCurrentPos={title:i.title,address:i.posDesc,location:a},t._searchMapNearBy(a.getLng(),a.getLat(),i.title,!0)}},g.prototype._fBeforeclose=function(){var t=this,e=getTop(),o=t._moMenuObj,i=!t._mbIsFinished,n=t._moInputPlaceSearch,a=o.S("placedetail");if(i&&t._moMap)e._oPrevMapCfg_={title:e.htmlEncode(n.value),address:e.htmlEncode(a.innerHTML),mapCenterLocation:t._moMap.getCenter(),markerLocation:t._moMarker.getPosition(),currentPos:t._moCurrentPos};else if(e._oPrevMapCfg_)try{delete e._oPrevMapCfg_}catch(r){e._oPrevMapCfg_=undefined}},g.prototype._setData=function(){var t=this,e=t._moMenuObj,o=e.S("mapContainer"),i=e.S("resultData"),n=e.S("nearByPlacedetail"),a=e.S("searchText"),r=e.S("div_error"),s=e.S("div_loading"),l=e.S("div_welcome"),d=e.S("placedetail"),p=e.S("span_resultTitleText"),c=e.S("div_location");t._moDivMapContainer=o,t._moDivResultDom=i,t._moDomNearByPlaceDetail=n,t._moInputPlaceSearch=a,t._moDivLocation=c,t._moDivError=r,t._moDivLoading=s,t._moDivWelcome=l,t._moSpanResultTitleText=p,t._moDivPlaceDetail=d},g.prototype._getCityNameByLocalIp=function(){var e=this,t=e._moWin;citylocation=new t.qq.maps.CityService({complete:function(t){e._msCity=t.detail.name.substring(0,t.detail.name.length-1)}}),citylocation.searchLocalCity()},g.prototype._loadTXMapJs=function(){var e=this,o=getTop(),t=o;e._beforeLoadPrev(),(e._moWin=t).initMapCallback=function(){},t.qq&&t.qq.maps&&t.qq.maps.Map?e._loadPrev():o.loadJsFile("//"+h+"/api/js?v=2.exp&libraries=place&key="+f+"&callback=initMapCallback",!1,t.document,function(){o.waitFor(function(){return t.qq&&t.qq.maps&&t.qq.maps.Map},function(t){t?e._loadPrev():o.showError("\u52a0\u8f7d\u817e\u8baf\u5730\u56fejs\u5931\u8d25")},1e3,1e4)},{},!0)},g.prototype.setCenter=function(t){var e=this,o=(e._moWin,e._moDivMapContainer,e._moDivLocation),i=e.getLatLng(t);show(o,!0),e._moMarker.setPosition(i),e._moMap.setCenter(i)},g.prototype.getLatLng=function(t){var e=this._moWin,o=t;return"string"==typeof t&&(_oLocArr=t.split(","),o=new e.qq.maps.LatLng(_oLocArr[0],_oLocArr[1])),o},g.prototype.createMap=function(t){if(!this._moMap){var e,o=this,i=o._moWin,n=o._moDivMapContainer,a=o.getLatLng(t);(e=o._moMap=new i.qq.maps.Map(n,{center:a,panControl:!1,disableDefaultUI:!0,ZoomControl:!1,minZoom:4,maxZoom:17,mapTypeControl:!1,zoom:15,mapTypeId:"coordinate",mapTypeControlOptions:{mapTypeIds:["earth"]},zoomControlOptions:{style:i.qq.maps.ZoomControlStyle.SMALL}})).mapTypes.set("earth",new s),e.setMapTypeId("earth"),o._moMarker=new o.Marker({map:e,win:i,context:o,location:a}),new o.ZoomControl({map:e,win:i,context:o})}},g.prototype._setEvent=function(){var p=this,c=getTop(),_=p._moMenuObj,m=_.S("searchText"),e=_.S("span_searchDesc"),u=_.S("placedetail"),t=_.S("nearByPlacedetail"),d=_.S("resultData"),o=function(t){c.getEventTarget(t);m.value?e.style.display="none":e.style.display="","blur"!==t.type&&m.focus()},i={keydown:function(t){var e=getEventTarget(t),o=t.keyCode||0;return 13==o?p._search(e.value):27==o?p._callBack(p._mfOnClose):void 0},change:o,blur:o,keyup:o};function n(e,o){var i={mousewheel:function(t){stopPropagation(t),e.scrollTop+calcPos(e)[5]>=e.scrollHeight&&p._pageActionForNearBy({desc:o,container:e})},DOMMouseScroll:function(t){i.mousewheel(t)},scroll:function(t){i.mousewheel(t)}};return i}_.S("searchBtn").onclick=function(){p._search(m.value)},addEvents(m,i),addEvent(e,"click",o),_.S("span_confirm").onclick=function(){if(show(p._moDivLoading,!0),show(p._moDivLocation,!1),!p._mbIsUploading){var t=p._moMarker.getPosition(),e=p._moMap.getZoom(),o=e<4?t:p._moMap.getCenter(),i=[o.getLat(),",",o.getLng()].join(""),n=e<4?4:e,a=[t.getLat(),",",t.getLng()].join(""),r=encodeURIComponent(u.innerHTML),s=c.attr(u,"title"),l=["apis.map.qq.com/ws/staticmap/v2/?insertmap=1&key=",f,"&size=425*250&scale=2&center=",i,"&zoom=",n,"&markers=icon:",encodeURIComponent(p.getIconUrl("_2x")),"|label:A|",a].join("");p._mbIsUploading=!0,QMAjax.send("/cgi-bin/postcard",{content:c.T("t=$t$&sid=$sid$&layerxml=$layerxml$").replace({t:"postcard",sid:c.getSid(),layerxml:encodeURIComponent(g._TEMPLATE._LAYER_XML.replace({mapurl:htmlEncode(l),title:c.attr(u,"title"),address:u.innerHTML,hideTitle:s?0:1}))}),method:"POST",onload:function(t,e){t&&-1==e.indexOf("\x3c!--cgi exception--\x3e")?d(e+"&originalwidth=425&originalheight=250"):(c.showError("\u63d2\u5165\u5730\u56fe\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5"),d("badurl"))}}),_.close()}function d(t){p._moEditor.insertImage(t,function(){},{bIsFromMap:!0,originUrl:l,searchkeyword:m.value,title:htmlEncode(s),center:htmlEncode(i),zoom:e,pos:htmlEncode(a),detaildesc:htmlEncode(u.innerHTML),sMapRedirectUrl:["http://apis.map.qq.com/uri/v1/marker?referer=qqmail&marker=coord:",a,";title:",encodeURIComponent(s),";addr:",r].join("")})}},addEvent(_.S("allPlace"),"click",function(t){if(n=getEventTarget(t)){var e,o,i=n.getAttribute("param")||n.parentNode.getAttribute("param"),n=n.getAttribute("param")?n:n.parentNode;switch(i){case"me":if((o=n.getAttribute("sLocation"))&&o){if(hasClass(n,"now")&&0<finds("span.trangle_top",p._moMenuObj.S("a_toogle")).length)break;if("0"==getTop().attr(n,"idx")){p.toogle(),p.setCenter(o);break}(e=finds("span",n))&&0<e.length&&(p._saveLocation({title:e[0].innerHTML,address:e[1].innerHTML}),show(d,!1)),p._searchMapNearBy(o.split(",")[1],o.split(",")[0],e[0].innerHTML),p.setCenter(o),p.toogle()}break;case"toogle":p.toogle()}getTop().preventDefault(t)}}),addEvents(t,n(t,"nearby")),addEvents(d,n(d,"relative")),addEvent(d,"click",function(t){if(r=getEventTarget(t)){var e,o,i,n,a=r.getAttribute("param")||r.parentNode.getAttribute("param"),r=r.getAttribute("param")?r:r.parentNode;if("me"==a&&(e=r.getAttribute("sLocation"))&&e){show(p._moDivLoading,!0),show(p._moSpanResultTitleText,!1),(n=finds("span",r))&&0<n.length&&(o=n[0].innerHTML,i=n[1].innerHTML+n[0].innerHTML,getTop().attr(u,"title",o),u.innerHTML=i,show(d,!1));var s=getTop();function l(){p._moCurrentPos={title:o,address:i,location:p.getLatLng(e)},p.createMap(e),show(p._moDivLoading,!1),p.setCenter(e),_.setHtml(_.S("currentPlace"),g._TEMPLATE._CURRENT_ITEM.replace({title:o,address:i,location:p.getLatLng(e)})),p._searchMapNearBy(e.split(",")[1],e.split(",")[0],n[0].innerHTML,!0)}if(!(s.qq&&s.qq.maps&&s.qq.maps.Map))return void s.waitFor(function(){return s.qq&&s.qq.maps&&s.qq.maps.Map},function(t){t?l():s.loadJsFile("//"+h+"/api/js?v=2.exp&libraries=place&key="+f+"&callback=initMapCallback",!1,s.document,function(){},{},!0)});l()}getTop().preventDefault(t)}})},g.prototype._pageActionForNearBy=function(t,e){if(!this._mbIsLoading){var o,i=this,n=getTop(),a=(i._moDomNearByPlaceDetail,t.container),r=i._moWin,s=t.desc,l=i._moMenuObj;e?0!=e.status||0==e.count?i.showError("\u62b1\u6b49\uff0c\u672a\u627e\u5230\u76f8\u5173\u5730\u5740"):(i._moNCurPage[s]=0,o=g._TEMPLATE._TABLE[s].replace({count:"",data:e.data,total:"",index:"",num:"",_nCurPage:i._moNCurPage[s]}),show(i._moDivError,!1),o&&l.setHtml(a,o)):(i._mbIsLoading=!0,i._moNCurPage[s]++,r.searchCallback=function(t){try{o=g._TEMPLATE._TABLE[s].replace({count:"",data:t.data,total:"",index:"",num:"",_nCurPage:i._moNCurPage[s]}),show(i._moDivError,!1),o&&getTop().insertHTML(n.finds("ul",a)[0],"beforeEnd",o)}catch(e){}i._mbIsLoading=!1},n.loadJsFile(i._moUrl[s]+"&page_index="+i._moNCurPage[s],!0,r.document,"",{charset:"utf-8"},!0))}},g.prototype.toogle=function(e){this._moDomNearByPlaceDetail;var o,i=this._moMenuObj,t=i.S("a_toogle");(o=finds("span",t))&&0<o.length&&(o=o[0],E([{classname:"trangle_top",contrast:"trangle_down",from:204,to:0},{classname:"trangle_down",contrast:"trangle_top",from:0,to:204}],function(t){if(hasClass(o,t.classname))return e&&"trangle_top"==t.classname||(rmClass(o,t.classname),addClass(o,t.contrast),!e&&qmAnimation.moveVerti(i.S("allPlace"),"move",{from:t.from,to:t.to,speed:"fast"})),!1}))},g.prototype._callBack=function(){var t=arguments[0];if("function"==typeof t){for(var e=[],o=1,i=arguments.length;o<i;o++)e.push(arguments[o]);t.apply(g,e)}},g.prototype.showError=function(t){var e=this._moMenuObj,o=this._moDivError;e.setHtml(o,g._TEMPLATE._INFO.replace({info:t})),show(o,!0),show(this._moDivLocation,!1),show(this._moDivResultDom,!1)},g.prototype._search=function(t){var e=this,o=e._moMenuObj,i=(e._moDivResultDom,o.S("result")),n=e._moDivError;g._TEMPLATE;show(e._moDivWelcome,!1),show(e._moDivLoading,!0),show(e._moDivResultDom,!1),show(n,!1),show(i,!1),show(e._moDivLocation,!1),trim(t)?(show(i,!0),e._searchMap(t)):(show(i,!0),show(e._moSpanResultTitleText,!1),e.showError("\u8bf7\u586b\u5199\u5173\u952e\u5b57\u540e\u518d\u641c\u7d22"),show(e._moDivLoading,!1))},g.prototype._searchMap=function(i){var t,n=this,a=getTop(),e=n._moWin||a;e.searchCallback=function(t){var e=n._moMenuObj.S("resultData");try{show(n._moDivLoading,!1),show(n._moSpanResultTitleText,!0),show(e,!0),n._moResult.relative=t,n._pageActionForNearBy({desc:"relative",container:e},t)}catch(o){a.showError("\u5730\u5740\u83b7\u53d6\u5931\u8d25...")}for(k in r)(-1<i.indexOf(r[k])||-1<i.indexOf(k))&&!0},n._moUrl.relative=t="//apis.map.qq.com/ws/place/v1/search?callback=searchCallback&output=jsonp&boundary=region("+encodeURIComponent(n._msCity)+",1)&page_size=20&orderby=_distance&key="+f+"&keyword="+encodeURIComponent(i),a.loadJsFile(t+"&page_index=1",!0,e.document,"",{charset:"utf-8"},!0)},g.prototype._convertData=function(t,e,o){var n,a;if("0"==t.status&&(n=t.data)){for(i in n)if(n[i].title==e){if(0==i){a=n[0];break}a=n[0],n[0]=n[i],n[i]=a;break}!a&&o&&(n.unshift(this._moCurrentPos),t.count+=1)}return t},g.prototype._saveLocation=function(t){getTop().attr(this._moDivPlaceDetail,"title",t.title||""),this._moDivPlaceDetail.innerHTML=t.address},g.prototype._searchMapNearBy=function(t,e,i,n){var o,a=this,r=getTop(),s=a._moMenuObj,l=a._moWin;l.searchCallback=function(t){try{var e;i?(a._moResult.nearby=a._convertData(t,i,n),(e=a._moResult.nearby.data)&&0<e.length&&(e=e.shift())&&a._saveLocation(e),s.setHtml(s.S("currentPlace"),g._TEMPLATE._CURRENT_ITEM.replace(e))):a._moResult.nearby=t,a._pageActionForNearBy({desc:"nearby",container:a._moDomNearByPlaceDetail},a._moResult.nearby)}catch(o){r.showError("\u5730\u5740\u83b7\u53d6\u5931\u8d25...")}},a._moUrl.nearby=o="//apis.map.qq.com/ws/place/v1/search?callback=searchCallback&output=jsonp&boundary=nearby("+e+","+t+",1000)&page_size=20&orderby=_distance&key="+f,r.loadJsFile(o+"&page_index=1",!0,l.document,"",{charset:"utf-8"},!0)},g._TEMPLATE={_DIVHTML:TE(['<div unselectable="on" class="qmEdMap">','<div class="qmEdMap_head" unselectable="on">','<div class="qmEdMap_search" unselectable="on">','<input id="searchText" class="qm_addinput" type="text" onmousedown="try{stopPropagation(event);}catch(e){getTop().stopPropagation(event);}"><a id="searchBtn" class="button_gray_s">\u641c\u7d22</a>','<span id="span_searchDesc" class="qmEdMap_searchPlaceholder">\u4f8b\u5982\uff1a\u5317\u4eac\u5e02\u6d77\u6dc0\u533a\u6e05\u534e\u5927\u5b66</span>',"</div>","</div>",'<div class="qmEdMap_body">','<div id="result" class="qmEdMap_resultTitle" unselectable="on" style="display:none"><span id="span_resultTitleText" class="qmEdMap_resultTitleText">\u641c\u7d22\u7ed3\u679c</span></div>','<div id="div_loading" class="qmEdMap_resultLoading" style="display:none">','<img src="$images_path$ico_loading2.gif" alt="" title="" />',"</div>",'<div id="resultData" class="qmEdMap_resultList" style="display:none;">',"</div>",'<div id="placedetail" class="qmEditorMusicData" style="display:none" ></div>','<div id="div_location" class="qmEdMap_resultLocation" style="display: none;">','<div class="qmEdMap_resultMap">','<div id="mapContainer" style="height:250px;"></div>','<div id="allPlace" class="qmEdMap_resultMapList" style="top: 204px;">','<div id="currentPlace" class="qmEdMap_resultItem_MapWrap qmEdMap_resultItem_MapWrap_Curr"></div>','<div class="qmEdMap_resultItem_MapWrap">','<div class="mask"></div>','<div id="nearByPlacedetail" class="listWrap"></div>',"</div>","</div>","</div>",'<a id="span_confirm" href="javascript:void(0);" class="qmEdMap_resultAddBtn">\u63d2\u5165\u5730\u56fe\u5230\u6b63\u6587</a>',"</div>",'<div id="div_error" class="qmEdMap_resultEmpty" style="display: none;" unselectable="on">','<span class="qmEdMap_resultEmptyTips">\u62b1\u6b49\uff0c\u672a\u627e\u5230\u76f8\u5173\u5730\u5740</span>',"</div>","</div>",'<div id="div_welcome" class="qmEdMap_bg"></div>',"</div>"]),_CURRENT_ITEM:TE(['<div class="mask"></div>',"<ul>",'<li class="qmEdMap_resultItem qmEdMap_resultItem_Map qmEdMap_resultItem_Map_First">','<a id="a_toogle" href="javascript:void(0);" class="more" param="toogle" title="\u9644\u8fd1\u4fe1\u606f">','<span class="trangle trangle_top"></span>',"</a>",'<a  href="javascript:void(0);" class="now" idx="0"',' param="me" sLocation="$location.lat$,$location.lng$" ','><span class="title">$@$eval (getTop().htmlEncode($title$))$@$</span>','<span class="text" title="$address$">$address$</span>',"</a></li>","</ul>"]),_TABLE_INFO:TE(["$@$if($_nCurPage$==0)$@$<ul>$@$endif$@$","$@$for($data$)$@$",'<li class="qmEdMap_resultItem"><a href="javascript:void(0);" param="me" sLocation="$location.lat$,$location.lng$">','<span class="title" >$title$$@$if($type$&&$type$=="1")$@$-\u516c\u4ea4\u7ad9$@$else if($type$&&$type$=="2")$@$-\u5730\u94c1\u7ad9$@$endif$@$</span>','<span class="text" title="',"$address$",'">',"$address$","</span>","</a></li>","$@$endfor$@$","$@$if($_nCurPage$==0)$@$</ul>$@$endif$@$"]),_TABLE_NEARBY:TE(["$@$if($_nCurPage$==0)$@$<ul>$@$endif$@$","$@$for($data$)$@$",'<li class="qmEdMap_resultItem qmEdMap_resultItem_Map">','<a  href="javascript:void(0);" param="me" sLocation="$location.lat$,$location.lng$">','<span class="title">$@$eval (getTop().htmlEncode($title$))$@$</span>','<span class="text" title="','$@$if($type$&&$type$!="0")$@$',"$province$$city$$district$","$@$else$@$","$address$","$@$endif$@$",'">','$@$if($type$&&$type$!="0")$@$',"$province$$city$$district$","$@$else$@$","$address$","$@$endif$@$","</span>","</a>","</li>","$@$endfor$@$","$@$if($_nCurPage$==0)$@$</ul>$@$endif$@$"]),_INFO:T(['<span class="qmEdMap_resultEmptyTips">$info$</span>']),_NOTFOUND:T(['\u62b1\u6b49\uff0c\u627e\u4e0d\u5230\u4e0e"<font style="color:red;">$keyword$</font>"\u76f8\u7b26\u7684\u5185\u5bb9\u3002</div>']),_INSERTIMG:T(['<a href="$sMapRedirectUrl$" target="_blank"><img src="$sImgUrl$"></a>']),_NEARBY:TE(['<div class="nearby_item">',"$result.formatted_addresses.rough$-$result.address$",'<span style="display:none">$result.location.lat$,$result.location.lng$</span>',"</div>","$@$for($result.address_reference$)$@$",'<div class="nearby_item">$title$$_dir_desc$','<span style="display:none">$location.lat$,$location.lng$</span>',"</div>","$@$endfor$@$","$@$for($result.pois$)$@$",'<div class="nearby_item">$title$-$address$','<span style="display:none">$location.lat$,$location.lng$</span>',"</div>","$@$endfor$@$"]),_MAP_INFO:TE(["$@$if($isIE$!=true)$@$<div><br/></div>$@$endif$@$",'<a href="$sMapRedirectUrl$" onmousedown="this.setCapture&&this.setCapture();return false;" onmouseup="this.releaseCapture&&this.releaseCapture();return false;" target="_blank" ui-type="share_map" notForEdit="true" style="display: inline-block;position: relative;width: 425px;height: 250px;border: 1px solid #b0b0b0;text-decoration: none;">','<img class="share_map" alt="" title="" border="0" style="width:425px;height:250px">','<div class="share_map" contenteditable="false" style="$@$if($hideTitle$==1)$@$height:18px;$@$else$@$height:36px;$@$endif$@$cursor: default;position: absolute;bottom: 0;left: 0;width: 100%;padding: 4px 0;line-height: 18px;border-top: 1px solid #505050;">','<div style="$@$if($hideTitle$==1)$@$height:26px;$@$else$@$height:44px;$@$endif$@$position: absolute;top: 0;left: 0;bottom: 0;right: 0;width: 100%;background: #000;opacity: .8;-moz-opacity: .8;filter: Alpha(Opacity=80);-ms-filter: alpha(opacity=80);"></div>','<div style="position: relative;">','$@$if($hideTitle$!=1)$@$<span style="display: block;width: 405px;height: 18px;line-height: 18px;font-size: 12px;margin: 0 auto;color: #fff;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;-o-text-overflow: ellipsis;word-break: break-all;">$title$</span>$@$endif$@$','<span style="display: block;width: 405px;height: 18px;line-height: 18px;font-size: 12px;margin: 0 auto;color: #d0d0d0;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;-o-text-overflow: ellipsis;word-break: break-all;" title="$address$">$address$</span>',"</div>","</div>",'<img class="share_map_loading" src="$image_path$" alt="" width="32" height="32" style="position: absolute;top: 50%;left: 50%;margin: -16px 0 0 -16px;">',"</a>","$@$if($isIE$!=true)$@$&nbsp<div><br/></div>$@$else$@$<br/>$@$endif$@$"]),_LAYER_XML:TE(["<postcard>",'<layer left="0" top="0" width="850" height="500">','<layer left="0" top="0" width="850" height="500">','<image type="url" composite="" left="0" top="0" zoomwidth="0" zoomheight="0" realwidth="850" realheight="500" url="$mapurl$"/>',"</layer>",'<layer left="0" $@$if($hideTitle$!=1)$@$top="412" height="88"$@$else$@$top="448" height="52"$@$endif$@$ width="850">','<shade color="#000000" opacity="0.8" />',"</layer>","$@$if($hideTitle$!=1)$@$",'<layer left="20" top="415" width="850" height="36">','<text family="" font="msyh" size="24" color="#FFFFFF" lineheight="">',"<![CDATA[$title$]]>","</text>","</layer>","$@$endif$@$",'<layer left="20" top="450" width="850" height="36">','<text family="" font="msyh" size="24" color="#D0D0D0" lineheight="">',"<![CDATA[$address$]]>","</text>","</layer>","</layer>","</postcard>"]),_ZOOM_CONTROL_:T(['<div class="qmEdMap_resultMapControl"><a class="qmEdMap_resultMapControl_btn qmEdMap_resultMapControl_btn_Increase" id="a_enlarge"><a/><a class="qmEdMap_resultMapControl_btn qmEdMap_resultMapControl_btn_Decrease"      id="a_narrow"></a></div>'])},g._TEMPLATE._TABLE={relative:g._TEMPLATE._TABLE_INFO,nearby:g._TEMPLATE._TABLE_NEARBY},window.QMMap=g,QMEditor.setupFunc()}(QMEditorAdapter),QMEditorAdapter,QMEditor.FUNCLIB.Music=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="Music",this._moBindEditor=t.editor,this._msTmplName="MENU_MUSIC";var e=this._moBindEditor,o=e._moLanguage;this._moUiConfig.icon={className:"qmicon_addMusic"},this._moUiConfig.text={margin:"0 10px 0 0",bgleft:-96,width:0,marginNB:"0 2px 0 0",src:"newicon/compose.gif",title:o.FUN_MUSIC,label:o[e.getBgMusicInfo()?"FUN_MUSIC_LABEL_ADDED":"FUN_MUSIC_LABEL"]},this._moMenuData=[{loading:o.MC_LOADING}],this._mfOnShowMenu=this._doDefaultShowMenu;var i=this;e._onprivatechangebgmusic=function(){i._doChangeBgMusic(this.getBgMusicInfo())}},QMEditor.FUNCLIB._MENUCUSTOM),QMEditor.FUNCLIB.Music.prototype._initMenuElements=function(){var i=this,n=i._moBindEditor;if(!i._moMusicPanel){if(!window.QMBgMusic){if(i._mnWaitLoadTimer)return;return n._loadFile({"qqmaileditor/plus/bgmusic.js":!0}),void(i._mnWaitLoadTimer=setInterval(function(){i._initMenuElements()},200))}i._mnWaitLoadTimer&&(clearInterval(i._mnWaitLoadTimer),i._mnWaitLoadTimer=null),i._moMusicPanel=new QMBgMusic,i._moMusicPanel.setup({container:i._moBindMenu,height:"175px",width:"265px",style:n._moTemplate.STYLE,func:"soso",onselectmusic:function(t,e,o){n.getBgMusicInfo()&&!confirm(n._moLanguage.MC_REPLACE_TIP)||(o&&-1==o.indexOf("://")&&(o="http://"+o),n.setBgMusicInfo(t,e,o),i._hideMenu(!0))},onclose:function(){i._hideMenu(!0)},onload:function(){i._adjustMenuPos(),i._moMusicPanel.focus()}})}},QMEditor.FUNCLIB.Music.prototype._doDefaultShowMenu=function(t){this._moMusicPanel&&this._moMusicPanel.focus()},QMEditor.FUNCLIB.Music.prototype._doChangeBgMusic=function(t){if(this._moContainer){var e=GelTags("a",this._moContainer),o=e.length;0<o&&(e[o-1].innerHTML=this._moBindEditor._moLanguage[t?"FUN_MUSIC_LABEL_ADDED":"FUN_MUSIC_LABEL"])}},QMEditor.setupFunc(),QMEditorAdapter,QMEditor.FUNCLIB.Mo=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="Mo",this._moBindEditor=t.editor,this._msTmplName="MENU_MO";var e=this._moBindEditor._moLanguage;this._moUiConfig.icon={className:"qmicon_face",bgleft:0,topNum:-96,width:24,margin:"0 0 0 0",imgstyle:"width:16px;height:16px;overflow:hidden;margin:2px 0 0 2px;vertical-align:middle;",src:"newicon/compose_new.png",title:e.FUN_MO},this._moUiConfig.text={margin:"0 12px 0 0",bgleft:0,bgup:-96,width:0,marginNB:"0 4px 0 0",src:"newicon/compose_new.png",title:e.FUN_MO,label:e.FUN_MO_LABEL},this._moUiConfig.big={src:QMEditor.getTopWin().getPath("image")+"compose_easy_face.gif",label:e.FUN_MO_LABEL},this._moMenuData=[{loading:e.MO_LOADING}]},QMEditor.FUNCLIB._MENUIMAGE),QMEditor.FUNCLIB.Mo.prototype._initMenuElements=function(){var t=this;t._moPanel||(window.QMMo?(t._moPanel=new QMMo({tabList:t._moBindEditor._moFuncList.moTabs}),t._moPanel.setup({container:t._moBindMenu}),t._adjustMenuPos()):loadJsFile("$js_path$qqmaileditor/plus/"+getFullResSuffix("mo.js"),!0,document,function(){window.QMMo?(t._moPanel=new QMMo({tabList:t._moBindEditor._moFuncList.moTabs}),t._moPanel.setup({container:t._moBindMenu}),t._adjustMenuPos()):t._moBindMenu.innerHTML=t._moBindEditor._moTemplate.MENU_MO.replace({loading:"\u52a0\u8f7d\u5931\u8d25\uff01"})}))},QMEditor.FUNCLIB.Mo.prototype._afterHideMenu=function(){this._mnWaitLoadTimer&&(clearInterval(this._mnWaitLoadTimer),this._mnWaitLoadTimer=null)},QMEditor.FUNCLIB.Mo.prototype._doDefaultMenuClick=function(t){var e=t.target||t.srcElement,o=e&&e.getAttribute("param");this._moBindEditor,o&&(this._hideMenu(!0),this._insertImage(o))},QMEditor.setupFunc(),QMEditorAdapter,QMEditor.FUNCLIB.PhotoOld=QMEditor.FUNCLIB._inheritFrom(function(t){this._msId="PhotoOld",this._moBindEditor=t.editor,this._mbShowQQAlbum=!(!1===t.oParamSet.bPhotoQQAlbum),this._msTmplName="MENU_PHOTO";var e=this._moBindEditor._moLanguage;this._moUiConfig.icon={className:"qmicon_addImg",bgleft:0,topNum:-72,width:24,margin:"0 0 0 0",imgstyle:"width:16px;height:16px;overflow:hidden;margin:2px 0 0 2px;",src:"newicon/compose_new.png",title:e.FUN_PHOTO},this._moUiConfig.text={margin:"0 11px 0 0",bgleft:0,bgup:-72,width:0,marginNB:"0 3px 0 0",src:"newicon/compose_new.png",title:e.FUN_PHOTO,label:e.FUN_PHOTO_LABEL},this._moUiConfig.big={src:QMEditor.getTopWin().getPath("image")+"compose_easy_photo.gif",label:e.FUN_PHOTO_LABEL},this._mfOnShowMenu=this._doDefaultShowMenu},QMEditor.FUNCLIB._MENUIMAGE),QMEditor.FUNCLIB.PhotoOld.prototype._initMenuElements=function(){var s=this;if(!s._moMenuElements){s._moMenuElements={};var t=s._moBindEditor,e=t._moLanguage,l=t._moTemplate,o=t._moPhotoConfig||{},d=t._msPhotoActionSrc?"":"display:none",i=s._moBindMenu.firstChild,n=i.ownerDocument.parentWindow||i.ownerDocument.defaultView,p={iframeId:now(),css_path:getPath("css",!0),actionSrc:t._msPhotoActionSrc,widthlimit:o.widthlimit||0,heightlimit:o.heightlimit||0,sizelimit:o.sizelimit||0,sid:getSid(),uploadDisp:d,style:l.STYLE,langLocalPhoto:e.PO_LOCAL_PHOTO,langLocalDesc:e.PO_LOCAL_DESC,langLocalInput:e.PO_LOCAL_INPUT,langQQAlbum:e.PO_QQALBUM_DESC,qqalbumDisplay:s._mbShowQQAlbum?"":"none",langLocalOK:e.PO_LOCAL_OK,langNetPhoto:e.PO_NET_PHOTO,langNetDesc:e.PO_NET_DESC,langNetInput:e.PO_NET_INPUT,langNetOK:e.PO_NET_OK,langCancel:e.COMM_CANCEL};createBlankIframe(n,{obj:i,scrolling:"no",transparent:!0,style:T("width:$width$;height:$height$;").replace({width:i.style.width,height:i.style.height}),hideFocus:!0,header:l._MENU_PHOTO_HEADER.replace(p),body:l._MENU_PHOTO_BODY.replace(p),onload:function(t){var e=(s._moMenuElements._oPhotoPanel=this.contentWindow).document;e.body.innerHTML=l._MENU_PHOTO_BODYHTML.replace(p),s._msDefTabName=""==d?"localPhoto":"netPhoto",e.charset="gb2312";var o=e.body,i=s._moMenuElements;i.document=e,i._oLocalPanel=o.childNodes[1],i._oNetPanel=o.childNodes[2];var n=GelTags("div",o);i._oLocalBtn=n[0],i._oNetBtn=n[1];var a=GelTags("input",o);i._oLocalInput=a[0],i._oNetInput=a[a.length-1];var r=GelTags("button",o);i._oLocalOk=r[0],i._oNetOk=r[2],i._oCancel=r[1],i._oActionForm=GelTags("form",o)[0],i._oActionIfrm=GelTags("iframe",o)[0],s._setMenuElementsEvent()}})}},QMEditor.FUNCLIB.PhotoOld.prototype._setMenuElementsEvent=function(){var n=this,o=n._moMenuElements,t=o._oPhotoPanel,e=t.document;addEvent(e,"click",function(t){return n._doDefaultMenuClick(t),!0}),addEvent(e.body,"keydown",function(t){if(27==t.keyCode&&(n._doDefaultMenuClick({target:o._oCancel}),preventDefault(t)),13==t.keyCode){var e=t.target||t.srcElement;n._doDefaultMenuClick({target:e==o._oLocalInput?o._oLocalOk:e==o._oNetInput?o._oNetOk:null}),preventDefault(t)}}),t.QMEditorPhotoLoaded=function(t){try{var e=t.contentWindow.location.href;if(0==e.indexOf("javascript:")||0==e.indexOf("about:blank"))return;var o=[];E(GelTags("script",t.contentWindow.document),function(t){o.push(t.innerHTML)}),QMEditor._ActiveX._bind(n._moBindEditor)._processResponse(o.join(""),function(t,e){n._doUploadFinish(t,e)})}catch(i){return n._doUploadFinish(!1,{})}},QMEditor.getTopWin().getMainWin().On_upload=QMEditor.getTopWin().getMainWin().On_upload_Fail=function(){}},QMEditor.FUNCLIB.PhotoOld.prototype._doDefaultShowMenu=function(t){var i=this;waitFor(function(){return i._moMenuElements._oNetInput},function(){var t=i._moMenuElements;try{var e=t._oLocalInput;e.value="",e.value&&(e.select(),t.document.execCommand("delete"))}catch(o){}t._oNetInput.value="http://",i._changeTab(i._msDefTabName)})},QMEditor.FUNCLIB.PhotoOld.prototype._doDefaultMenuClick=function(t){var e=t.target||t.srcElement,o=e&&e.getAttribute("param"),i=getTop(),n=this;switch(n._moBindEditor,o){case"localPhoto":case"netPhoto":n._changeTab(o);break;case"netok":n._hideMenu(!0),n._insertImage(function a(t){return t.replace('"',"%22").replace("'","%27").replace(">","%3E")}(n._moMenuElements._oNetInput.value));break;case"localok":n._uploadImg(),n._hideMenu(!1);break;case"cancel":n._hideMenu(!0);break;case"qqalbum":i.QMQzoneImg?i.QMQzoneImg.select({onclick:function(t,e,o,i){n._insertImage(o.url)}}):showError("\u6253\u5f00\u76f8\u518c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"),n._hideMenu(!0)}},QMEditor.FUNCLIB.PhotoOld.prototype._changeTab=function(t){var e="localPhoto"==t,o=["QMEditorTabSel","QMEditorTab"],i=e?0:1,n=this._moMenuElements,a=e?n._oLocalInput:n._oNetInput;show(n._oLocalPanel,e),show(n._oNetPanel,!e),n._oLocalBtn.className=o[i],n._oNetBtn.className=o[1-i],a.focus(),a.select()},QMEditor.FUNCLIB.PhotoOld.prototype._uploadImg=function(){var e=this,t=e._moBindEditor,o=QMEditor._ActiveX._bind(t),i=e._moMenuElements._oLocalInput;i.value&&(-1!="gif|jpg|jpeg|bmp|png".indexOf((i.value||"").toLowerCase().split(".").pop())?(e._readyToUpload(),e._moMenuElements._oActionForm.submit(),o._modelDialog(function(){if(e._isReadyToUpload()){try{e._moMenuElements._oActionIfrm.contentWindow.location="about:blank"}catch(t){}e._doUploadFinish(!1)}})):showError("\u53ea\u5141\u8bb8\u4e0a\u4f20gif,jpg,jpeg,bmp,png\u7684\u56fe\u7247"))},void QMEditor.setupFunc();