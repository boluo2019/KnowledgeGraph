
rpc 学习笔记

---

- RPC基础
    - 序列化, 编码解码, 网络传输
- RPC治理功能
    - 连接管理, 健康检测, 负载均衡, 优雅启停机, 异常重试, 业务分组???, 熔断限流???
- RPC性能提升, 分布式环境下问题定位        


---

- 透明化
- 什么是rpc?
    - remote procedure call 远程过程调用
    - 作用是什么?
        - 屏蔽远程调用和本地调用的区别
        - 隐藏底层网络通信的复杂性, 使使用者专注于业务逻辑
- rpc的通信流程
    - 调用方对象->序列化->通网络传输->反序列化->接收方对象
    - 网络传输需要数据具有可靠性: TCP(四层协议)或HTTP(基于TCP的七层协议)
        - 协议: 网络中传输的数据格式的约定, 一般分为两部分:
            - 数据头: 用于身份识别, 包括协议标识,数据大小, 请求类型, 序列化类型等信息.
                - 协议标识???
                - 请求类型???
                - 序列化类型???
            - 消息体: 业务数据
    - 动态代理 -> 序列化 -> 编码 -> 网络 -> 传输 -> 网络 -> 解码 -> 反序列化 -> 反射执行
        - 序列化和反序列化只是针对用户数据对象.
        - 解码和编码做的什么工作??? 封装成TCP或HTTP请求??? 应该是的.
        - 为什么是反射执行???
- 类比
    - Spring中的AOP技术
        - 动态代理技术???拦截方法调用???
        - 字节码增强???
        - 拦截增强???
        - 依赖注入???
- rpc在架构中的位置
    - 分布式系统中的通信: "经络",各个微服务间的纽带
    - 实际应用:
        - MQ Client -> RPC -> MQBroker
        - Redis Client -> RPC -> Redis Cluster
        - JDBC -> RPC -> MySQL Cluster
        - gRPC -> gRPC -> gRPC Server
- 本地调用与远程调用在使用上的区别
    - 调用过程中超时了怎么处理业务???
    - 什么场景下最适合使用RPC???
    - 什么时候需要考虑开压缩???
    - RPC在使用过程中需要注意哪些问题???
        - 超时机制
        - 重试机制, 降级处理???
        - 通信,自定义协议(eg:protobuf), 序列化, 注册中心??? 
        - API设计, eg: 一次能走完的调用就不走多次
        - 监控系统: 监控调用链, 方便问题排查和性能调优
        - 流控: 接口访问量过高从而拖垮服务???
        - 将超时信息传递到后端, 这样业务端超时后, 服务端无需再处理超时的请求.
        - 分布式事务???
        - rpc 和 protobuf, http2/tcp 之间的分工???
        - 版本升级, 向下兼容??? 接口是契约???
- 怎样的RPC才算是好的???
    - 治理???
- netty和RPC什么关系???
    - netty: java中注明的网络通信框架

---

- 向下兼容
- HTTP协议与RPC协议的关系???
    - 都属于应用层协议    
    - 浏览器输入一个URL会发生什么???
        - DNS解析(得到IP) -> 封装一个http请求 -> 发送到IP上
- 协议的作用: 
    - 类似文字中的标点符号
    - 定义消息边界
- 为什么不直接用HTTP???
    - HTTP是无状态协议???(无状态什么意思???), 客户端无法对请求和响应进行关联(这里应该是指HTTP1.1)???, 每次都需重新建立链接???
        - 看评论这是指异步情况
    - keep-alive 不管用??? 长连接. 只在http2+有吗??? http1.1没有嘛???
- 如何设计协议
    - 定长协议   
        - 协议头: 协议长度, 序列化方式, 协议标识, 消息ID, 消息类型等.
        - 协议体: 请求接口方法, 请求的业务参数, 一些扩展属性等.
    - 可扩展协议
        - eg: 新增超时字段的场景
        - 协议头
            - 固定部分
            - 协议头内容: 协议头扩展字段
        - 协议体
- RPC如何做到请求和响应关联???
    - 请求和响应都带上消息id
    
    
- [极客时间 何小峰 课程地址](https://time.geekbang.org/column/article/199649)
- [HTTP官网](https://httpwg.org/specs/)
- [tidb深入了解grpc如何基于HTTP2构建的](https://pingcap.com/blog-cn/grpc/)