《重构》阅读笔记
---

今年7/8月份在做了一些重构工作，大致历时两个月，其中大概50%的时间实在写代码，50%的代码是做测试。
整个重构过程，经历过不少痛苦，比较可惜的是这个没有把过程中遇到的一些痛点记录下来，现在只能一个简单的复盘。

重构的动机是因为现有的接口设计不能满足业务需求，这就意味着我对接口要做大量的调整。
在调整接口的过程中，发现了一些问题，现在能够记得大致有：
* 有些接口抽象的不够好，职责划分不清楚，让调用者产生很多疑惑。
* 增加类似的功能点的时候，经常要修改接口，虽然这些接口不会对用户开放，但是这会导致每次修改都会涉及很多文件，然而核心改动的地方却很小。
* 有些废弃代码。
* 有些重复代码。
* 有些单元测试不够完整，有些单元测试不够清晰导致阅读难度大，维护成本高。
* ……

这些问题，有的让我困惑，有的让我不爽，有的让我叹息，有的让我头疼……

通过反复上的调整重构方案，最终重构完成了，而且幸运的是从重构完成到现在大概过了4个月，除了最初出现的4~5个小bug，
到目前为值还没有出现什么严重问题，这一点倒是让我很欣慰。但是这个重构涉及的代码量非常多，导致后面花了大量的时间来测试。

重构过程中除了原有代码中的问题影响了进度，另外一个重要的问题是重构方案的设计。最开始的时候，就是有个非常粗略的重构方案，
和小组成员也做过大致的讨论，感觉没什么问题。然后就着手写代码。写着写着，就发现要修改的代码越多，开始失控，
也发现了最初讨论通过的设计方案中没有考虑到的一些问题，导致不得细化设计方案，并且以文档的形式记录下来。

重构方案的反复设计修改过程中，我总结了一下几点：
1. 首先要有个总的设计方案。列出所有需求点，列出最终目标，设计方案如何满足所有需求点并且能达到最终目标。
   这一层非常抽象，而且几句话就能说清楚，但是一定要记录下来，以便后面重构过程中反复查看，不至于方向走偏。
2. 划分受影响的模块。尽量划清各个模块受影响的范围，将这个任务划分多个子任务，也要记录下来。
3. 对于每个模块的重构，需要再次划分，划分得到的子任务越独立越好，越小越好，也要记录下来。
4. 对于每个最小任务，一定要写好单元测试。

---

有了重构的经验，再看这本重构的书，就有了很多共鸣，一些自己在重构中遇到的疑惑，在这本书中有了解答。
使用的一些方法也在这本书中得到了支持，书里的内容是作者多年经验的总结，这些共同的东西，让我更加确信自己的做法是正确的方向。
就像Erich Gamma说的，《设计模式》为重构确定了目标，然而“确定目标”只是问题的一部分而已。《重构》才是帮助我们改造程序达到目标，
保持代码易读，已修改的关键。

这本书解释了重构的原理和最佳实践，提出了一系列的重构方法，这些技术使我们可以有条不紊的进行重构的关键。
我的体会是代码写的多了，不断的运用这些重构技术，才会认识和理解的更深刻，也就可以更好的运用。
我在这里记录下这些方法的核心内容，以便日后查看。

我很喜欢熊节的观点：
记住所有的坏味道，记住他们对应的重构手法，记住常见的重构步骤，然后你才可能有信心面对各种复杂情况，学会所有的招式，才可能“无招胜有招”。

---

基本定义： 重构是在不改变软件可观察行为的前提下改善其内部结构。
 


---






---
written by hqx 2019.12.22